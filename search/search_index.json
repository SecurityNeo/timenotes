{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u6781\u5ba2\u65f6\u95f4\u4e13\u680f\u5b66\u4e60\u7b14\u8bb0 \u4f5c\u8005\uff1a\u957f\u4eadctim \u516c\u4f17\u53f7\uff1aLinux\u4e91\u8ba1\u7b97\u7f51\u7edc","title":"Home"},{"location":"#_1","text":"\u4f5c\u8005\uff1a\u957f\u4eadctim \u516c\u4f17\u53f7\uff1aLinux\u4e91\u8ba1\u7b97\u7f51\u7edc","title":"\u6781\u5ba2\u65f6\u95f4\u4e13\u680f\u5b66\u4e60\u7b14\u8bb0"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/","text":"01 \u5982\u4f55\u5b66\u4e60 Linux \u6027\u80fd\u4f18\u5316 \u9996\u5148\u4e86\u89e3 \u6027\u80fd\u6307\u6807 \u7684\u6982\u5ff5\uff1a \u9ad8\u5e76\u53d1+\u54cd\u5e94\u5feb = \u541e\u5410+\u5ef6\u65f6 \u4e00\u822c\u4ece\u5e94\u7528\u8d1f\u8f7d\u548c\u7cfb\u7edf\u8d44\u6e90\u7684\u89c6\u89d2\u6765\u5206\u522b\u770b\u5f85\uff1a \u4ece\u5206\u5c42\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u6bcf\u4e00\u5c42\u90fd\u5bf9\u5e94\u4e0d\u540c\u7684\u6307\u6807\u8981\u6c42\u3002 \u5176\u6b21\u662f\u5b66\u4e60\u7684\u91cd\u70b9\uff1a\u61c2\u5f97\u57fa\u672c\u57fa\u7840\uff0c\u628a\u63e1\u6574\u4f53\u7cfb\u7edf\u6027\u80fd\u7684\u5168\u5c40\u89c2\uff0c\u4e0d\u8981\u6df1\u9677\u7ec6\u8282\u3002 \u6700\u540e\u5584\u4e8e\u603b\u7ed3\u3001\u5206\u7c7b\u3002 02 \u7406\u89e3\u5e73\u5747\u8d1f\u8f7d \u5e73\u5747\u8d1f\u8f7d \u5e73\u5747\u8d1f\u8f7d \uff1a\u6307\u5355\u4f4d\u65f6\u95f4\u5185\uff0c\u7cfb\u7edf\u5904\u4e8e \u53ef\u8fd0\u884c\u72b6\u6001\uff08R\uff09 \u548c \u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\uff08D\uff09 \u7684\u5e73\u5747\u8fdb\u7a0b\u6570\uff0c\u4e5f\u5c31\u662f \u5e73\u5747\u6d3b\u8dc3\u8fdb\u7a0b\u6570 \u3002 \u53ef\u8fd0\u884c\u72b6\u6001\uff1a \u6b63\u5728\u4f7f\u7528 CPU \u6216\u8005\u6b63\u5728\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b \u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\uff1a \u7b49\u5f85 IO \u54cd\u5e94\u3001\u78c1\u76d8\u8bfb\u5199\u7b49 \u67e5\u770b\u547d\u4ee4\uff1a uptime \u6216\u8005 top # uptime 02:34:03 up 2 days, 20:14, 1 user, load average: 0.63, 0.83, 0.88 \u6700\u540e\u4e09\u4e2a\u6570\u5b57\uff0c\u5206\u522b\u8868\u793a \u8fc7\u53bb 1 \u5206\u949f\u30015 \u5206\u949f\u300115 \u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d\u3002 \u67e5\u770bCPU\u7684\u4e2a\u6570\uff1a grep \"model name\" /proc/cpuinfo | wc -l \u7ecf\u9a8c\u4e4b\u8c08\uff1a \u5f53\u5e73\u5747\u8d1f\u8f7d\u9ad8\u4e8e CPU \u6570\u91cf 70% \u7684\u65f6\u5019\uff0c\u5c31\u5e94\u8be5\u5206\u6790\u8d1f\u8f7d\u9ad8\u7684\u95ee\u9898\u4e86\u3002\u8fd8\u6709\u5c31\u662f\u5224\u65ad\u8d1f\u8f7d\u7684\u8d8b\u52bf\u53d8\u5316\u3002 \u5e73\u5747\u8d1f\u8d23\u4e0e CPU \u4f7f\u7528\u7387 \u5e73\u5747\u8d1f\u8f7d\uff1a\u4e0d\u4ec5\u5305\u62ec\u4e86\u6b63\u5728\u4f7f\u7528 CPU \u7684\u8fdb\u7a0b\uff0c\u8fd8\u5305\u62ec\u7b49\u5f85 CPU \u548c \u7b49\u5f85 IO \u7684\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\uff1a\u5355\u4f4d\u65f6\u95f4\u5185 CPU \u7e41\u5fd9\u60c5\u51b5\u7684\u7edf\u8ba1\uff0c\u8ddf\u5e73\u5747\u8d1f\u8d23\u5e76\u4e0d\u4e00\u5b9a\u5b8c\u5168\u5bf9\u5e94\uff0c\u6709\u4ee5\u4e0b\u4e00\u4e9b\u8054\u7cfb\uff1a CPU \u5bc6\u96c6\u578b\u8fdb\u7a0b\uff1a\u4f7f\u7528\u5927\u91cf CPU \u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0c\u6b64\u65f6\u4e24\u8005\u7b49\u4ef7 IO \u5bc6\u96c6\u578b\u8fdb\u7a0b\uff1a\u7b49\u5f85 IO \u4e5f\u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0c\u4f46 CPU \u4f7f\u7528\u7387\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u5347\u9ad8 \u5927\u91cf\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b\u8c03\u5ea6\u4e5f\u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0cCPU \u4f7f\u7528\u7387\u4e5f\u4f1a\u6bd4\u8f83\u9ad8 \u5b9e\u9a8c \u5de5\u5177\uff1a \u5de5\u5177\u5305\uff1a stress \u548c sysstat stress \u662f\u4e00\u4e2aLinux\u7cfb\u7edf\u538b\u529b\u6d4b\u8bd5\u5de5\u5177 sysstat \u5305\u542b\u4e86\u5e38\u7528\u7684 Linux \u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u5982\uff1a mpstat \u548c pidstat mpstat \u591a\u6838CPU\u6027\u80fd\u5206\u6790\u529f\u80fd\uff0c\u7528\u4e8e\u5b9e\u65f6\u67e5\u770b\u6bcf\u4e2aCPU\u7684\u6027\u80fd\u6307\u6807\uff0c\u4ee5\u53ca\u6240\u6709CPU\u7684\u5e73\u5747\u6307\u6807 pidstat \u8fdb\u7a0b\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u7528\u6765\u5b9e\u65f6\u67e5\u770b\u8fdb\u7a0b\u7684CPU\u3001\u5185\u5b58\u3001I/O\u4ee5\u53ca\u4e0a\u4e0b\u6587\u5207\u6362\u7b49\u6027\u80fd\u6307\u6807 \u5e38\u7528\u547d\u4ee4\uff1a # \u6a21\u62df\u4e00\u4e2a CPU \u4f7f\u7528\u7387 100% \u7684\u573a\u666f stress --cpu 1 --timeout 600 # \u6a21\u62df I/O \u538b\u529b\uff0c\u4e0d\u65ad\u6267\u884c sync stress -i 1 --timeout 600 # \u6a21\u62df\u8d85\u914d\u7684\u573a\u666f\uff0c\u8fdb\u7a0b\u6570\u8d85\u8fc7 CPU \u4e2a\u6570 stress -c 8 --timeout 600 # mpstat \u67e5\u770b CPU \u4f7f\u7528\u7387\u7684\u53d8\u5316\u60c5\u51b5 # -P ALL \u76d1\u63a7\u6240\u6709 CPU\uff0c\u540e\u9762\u6570\u5b57 5 \u6807\u8bc6\u6bcf\u95f4\u9694 5s \u8f93\u51fa\u4e00\u7ec4\u6570\u636e mpstat -P ALL 5 # pidstat \u67e5\u770b\u54ea\u4e2a\u8fdb\u7a0b\u5bfc\u81f4\u4e86 CPU \u4f7f\u7528\u7387 100% pidstat -u 5 1 \u6ce8\u610f\uff1a 1 \u65e0\u6cd5\u770b\u5230 iowait \u5347\u9ad8 \u89e3\u51b3\u529e\u6cd5\uff1a\u4f7f\u7528 stress-ng\uff1astress-ng -i 1 --hdd 1 --timeout 600\uff08--hdd \u8868\u793a\u8bfb\u5199\u4e34\u65f6\u6587\u4ef6\uff09 2 pidstat \u8f93\u51fa\u6ca1\u6709 %wait \u89e3\u51b3\u529e\u6cd5\uff1a\u9700\u8981\u5347\u7ea7 sysstat \u5305 \u5230 11.5.5 \u7248\u672c\u4ee5\u540e 3 mpstat \u65e0\u6cd5\u89c2\u6d4b \u89e3\u51b3\u529e\u6cd5\uff1a\u7b49\u5f85\u65f6\u95f4\u957f\u4e00\u4e9b\uff0c\u6bd4\u5982 20s\uff1ampstat -P ALL 5 20 03 CPU \u4e0a\u4e0b\u6587\u5207\u6362 CPU \u4e0a\u4e0b\u6587\uff1a\u5305\u62ec CPU \u5bc4\u5b58\u5668 \u548c \u7a0b\u5e8f\u8ba1\u6570\u5668 \u3002\u524d\u8005\u662f CPU \u5185\u7f6e\u7684\u5bb9\u91cf\u5c0f\u3001\u4f46\u901f\u5ea6\u6781\u5feb\u7684\u5185\u5b58\uff1b\u540e\u8005\u662f\u7528\u6765\u5b58\u50a8 CPU \u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\u4f4d\u7f6e\u3001\u6216\u8005\u5373\u5c06\u6267\u884c\u7684\u5413\u4e00\u6761\u6307\u4ee4\u4f4d\u7f6e\u3002 \u5305\u62ec\uff1a\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3001\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u4ee5\u53ca\u4e2d\u65ad\u4e0a\u4e0b\u6587\u5207\u6362\u3002 CPU \u4e0a\u4e0b\u6587\u5207\u6362\u672c\u8d28\u662f CPU \u7279\u6743\u7ea7\u7684\u5207\u6362\u3002 \u8fdb\u7a0b\u4e0a\u4e0b\u6587 \u5207\u6362\u53d1\u751f\u5728\u5185\u6838\u6001\uff0c\u4e0d\u4ec5\u5305\u62ec\u865a\u62df\u5185\u5b58\u3001\u6808\u3001\u5168\u5c40\u53d8\u91cf\u7b49\u7528\u6237\u7a7a\u95f4\u7684\u8d44\u6e90\uff0c\u8fd8\u5305\u62ec\u4e86\u5185\u6838\u5806\u6808\u3001\u5bc4\u5b58\u5668\u7b49\u5185\u6838\u7a7a\u95f4\u7684\u72b6\u6001\u3002 \u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587 \u5207\u6362\u5305\u542b\u4e24\u79cd\u60c5\u51b5\uff1a\u4e00\u4e24\u4e2a\u7ebf\u7a0b\u5c5e\u4e8e\u4e0d\u540c\u7684\u8fdb\u7a0b\uff0c\u8fd9\u79cd\u60c5\u51b5\u548c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u4e00\u6837\uff0c\u4e8c\u4e24\u4e2a\u7ebf\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7531\u4e8e\u865a\u62df\u5185\u5b58\u3001\u5168\u5c40\u53d8\u91cf\u662f\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u53ea\u5207\u6362\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\uff08\u6808\uff09\u3001\u5bc4\u5b58\u5668\u7b49\u4e0d\u5171\u4eab\u7684\u6570\u636e\u3002 \u67e5\u770b CPU \u4e0a\u4e0b\u6587\u5207\u6362 # \u6bcf\u9694 5 \u79d2\u8f93\u51fa 1 \u7ec4\u6570\u636e $ vmstat 5 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 3 0 0 161484 134588 1522148 0 0 0 2 22 20 0 0 100 0 0 cs(context switch) \u6bcf\u79d2\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570 in(interrupt) \u6bcf\u79d2\u4e2d\u65ad\u6b21\u6570 r(running or runnable) \u5c31\u7eea\u961f\u5217\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u6b63\u5728\u8fd0\u884c\u548c\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b\u6570 b(Blocked) \u5904\u4e8e\u4e0d\u53ef\u4e2d\u65ad\u7761\u7720\u72b6\u6001\u7684\u8fdb\u7a0b\u6570 \u67e5\u770b\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570 # \u6bcf\u9694 5 \u79d2\u8f93\u51fa 1 \u7ec4\u6570\u636e $ pidstat -w 5 Linux 3.10.0-862.14.4.el7.x86_64 (by) 12/18/2018 _x86_64_ (1 CPU) 08:58:15 AM UID PID cswch/s nvcswch/s Command 08:58:15 AM 0 1 0.05 0.00 systemd 08:58:15 AM 0 2 0.00 0.00 kthreadd ... cswch(voluntary context swithches) \u6bcf\u79d2\u81ea\u613f\u4e0a\u4e0b\u6587\u5207\u6362\uff08\u8fdb\u7a0b\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u8d44\u6e90\u800c\u53d1\u751f\uff09 nvcswch(non voluntary context switches) \u6bcf\u79d2\u975e\u81ea\u613f\u4e0a\u4e0b\u6587\u5207\u6362\uff08\u8fdb\u7a0b\u7531\u4e8e\u65f6\u95f4\u7247\u5df2\u5230\u7b49\u539f\u56e0\uff0c\u88ab\u7cfb\u7edf\u5f3a\u5236\u8c03\u5ea6\uff09 \u4ee5\u4e0a\u9ed8\u8ba4\u663e\u793a\u7684\u662f\u8fdb\u7a0b\u7684\u6307\u6807\u6570\u636e\uff0c\u5982\u679c\u8981\u67e5\u770b\u7ebf\u7a0b\u6570\u636e\uff0c\u5219\u9700\u8981\u52a0\u4e0a -t \u53c2\u6570\u3002 # -wt \u8868\u793a\u8f93\u51fa\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6307\u6807 $ pidstat -wt 1 Linux 3.10.0-862.14.4.el7.x86_64 (by) 12/21/2018 _x86_64_ (1 CPU) 08:57:17 AM UID TGID TID cswch/s nvcswch/s Command 08:57:18 AM 0 3 - 2.02 0.00 ksoftirqd/0 08:57:18 AM 0 - 3 2.02 0.00 |__ksoftirqd/0 \u6a21\u62df\u7cfb\u7edf\u4e0a\u4e0b\u6587\u5207\u6362\u5de5\u5177 sysbench : \u4e00\u4e2a\u591a\u7ebf\u7a0b\u57fa\u51c6\u6d4b\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u6765\u6a21\u62df\u7cfb\u7edf\u591a\u7ebf\u7a0b\u8c03\u5ea6\u5207\u6362 ubuntu \u5b89\u88c5 apt install sysbench sysstat \u6a21\u62df\u7cfb\u7edf\u591a\u7ebf\u7a0b\u8c03\u5ea6 # \u4ee5 10 \u4e2a\u7ebf\u7a0b\u8fd0\u884c 5 \u5206\u949f\u57fa\u51c6\u6d4b\u8bd5\uff0c\u6a21\u62df\u591a\u7ebf\u7a0b\u5207\u6362\u95ee\u9898 sysbench --threads=10 --max-time=300 threads run \u67e5\u770b\u5f15\u8d77\u9891\u7e41\u4e2d\u65ad\u7684\u4e2d\u65ad\u7c7b\u578b \u67e5\u770b /proc/interrupts \u4f7f\u7528 watch -d cat /proc/interrupts \u67e5\u770b\u4e2d\u65ad\u7684\u53d8\u5316\u60c5\u51b5\uff0c\u91cd\u70b9\u5173\u6ce8 RES \u884c\uff0c\u91cd\u8c03\u5ea6\u4e2d\u65ad\uff0c\u8868\u793a\u5524\u9192\u7a7a\u95f2\u72b6\u6001\u7684 CPU \u6765\u8c03\u5ea6\u65b0\u7684\u4efb\u52a1\u8fd0\u884c\uff0c\u8fd9\u662f SMP \u7cfb\u7edf\u4e2d\uff0c\u8c03\u5ea6\u5668\u7528\u6765\u5206\u6563\u4efb\u52a1\u5230\u4e0d\u540c CPU \u7684\u673a\u5236\u3002 \u7ed3\u8bba\uff1a \u6bcf\u79d2\u5207\u6362\u6b21\u6570\u5728\u6570\u767e-\u4e00\u4e07\u4e14\u5207\u6362\u6b21\u6570\u7a33\u5b9a\u90fd\u7b97\u662f\u6b63\u5e38\uff0c\u5982\u679c\u8d85\u8fc7\u4e00\u4e07\u6b21\uff0c\u6216\u8005\u5207\u6362\u6b21\u6570\u51fa\u73b0\u6570\u91cf\u7ea7\u589e\u957f\u65f6\u5c31\u4e0d\u7a33\u5b9a\u3002 04 CPU \u4f7f\u7528\u7387 \u8ba1\u7b97\u516c\u5f0f\uff1a CPU \u4f7f\u7528\u7387=1-\u7a7a\u95f2\u65f6\u95f4/\u603bCPU\u65f6\u95f4 \u4e3a\u4e86\u8ba1\u7b97\u51c6\u786e\uff0c\u4e00\u822c\u4f1a\u7b97\u65f6\u95f4\u5dee\uff1a \u5e73\u5747CPU\u4f7f\u7528\u7387=1-(\u7a7a\u95f2\u65f6\u95f4new - \u7a7a\u95f2\u65f6\u95f4old)/(\u603bCPU\u65f6\u95f4new - \u603bCPU\u65f6\u95f4old) \u67e5\u770b CPU \u4f7f\u7528\u7387 top \u663e\u793a\u7cfb\u7edf\u603b\u4f53\u7684 CPU \u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u53ca\u5404\u4e2a\u8fdb\u7a0b\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff08\u9ed8\u8ba4\u6ca13s\u5237\u65b0\u4e00\u6b21\uff0c\u6309\u4e0b 1 \u67e5\u770b\u5355\u4e2a CPU \u7684\u4f7f\u7528\u7387\uff09 ps \u53ea\u663e\u793a\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff08\u6574\u4e2a\u8fdb\u7a0b\u751f\u547d\u5468\u671f\uff09 pidstat \u67e5\u770b\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u8be6\u7ec6 CPU \u4f7f\u7528\u7387 perf top \u5b9e\u65f6\u663e\u793a\u5360\u7528CPU\u65f6\u949f\u6700\u591a\u7684\u51fd\u6570\u6216\u6307\u4ee4 perf record \u6bd4 perf top \u591a\u4e86\u4fdd\u5b58\u91c7\u6837\u6570\u636e\u7684\u73af\u8282 perf report \u663e\u793a perf record \u7684\u62a5\u544a 05 \u4e0d\u53ef\u4e2d\u65ad\u8fdb\u7a0b\u548c\u50f5\u5c38\u8fdb\u7a0b \u8fdb\u7a0b\u7684\u72b6\u6001\uff1a R\uff1a\u8fdb\u7a0b\u5728 CPU \u5c31\u7eea\u961f\u5217\u4e2d\uff0c\u6b63\u5728\u8fd0\u884c\u6216\u7b49\u5f85\u8fd0\u884c D\uff08Disk Sleep\uff09\uff1a\u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\u7761\u7720 Z\uff08Zombie\uff09\uff1a\u50f5\u5c38\u8fdb\u7a0b S\uff08Inerruptible Sleep\uff09\uff1a\u53ef\u4e2d\u65ad\u72b6\u6001\u7761\u7720 I\uff08Idle\uff09\uff1a\u7a7a\u95f2\u72b6\u6001 T\uff08Traced\uff09\uff1a\u8868\u793a\u8fdb\u7a0b\u5904\u4e8e\u6682\u505c\u6216\u8ddf\u8e2a\u72b6\u6001 X\uff08Dead\uff09\uff1a\u8868\u793a\u8fdb\u7a0b\u5df2\u6d88\u4ea1 iowait \u5206\u6790 \u63a8\u8350\u4f7f\u7528 dstat\uff0c\u5b83\u5438\u6536\u4e86 vmstat\u3001iostat\u3001ifstat \u7b49\u51e0\u79cd\u5de5\u5177\u7684\u4f18\u70b9\u3002\u53ef\u4ee5\u540c\u65f6\u67e5\u770b CPU\u3001I/O\u3001\u7f51\u7edc\u548c\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u4fbf\u4e8e\u5bf9\u6bd4\u5206\u6790\u3002 \u67e5\u770b\u67d0\u4e00\u4e2a\u8fdb\u7a0b\u7684\u78c1\u76d8\u8bfb\u5199\u60c5\u51b5\uff1a pidstat -d -p 4344 1 3 # -d \u8868\u793a\u7edf\u8ba1 I/O \u6570\u636e\uff0c-p \u6307\u5b9a\u8fdb\u7a0b\u53f7 strace \u8ddf\u8e2a\u7cfb\u7edf\u8fdb\u7a0b\u7cfb\u7edf\u8c03\u7528\u7684\u5de5\u5177\u3002\u5148\u901a\u8fc7 pidstat -d \u627e\u51fa\u5f71\u54cd\u8fdb\u7a0b id\uff0c\u518d\u7528 strace \u6765\u8ddf\u8e2a\u3002 \u7f13\u5b58. \u7f13\u5b58\u547d\u4e2d\u60c5\u51b5 \u5de5\u5177\uff1a cachestat \u63d0\u4f9b\u4e86\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7f13\u5b58\u7684\u8bfb\u5199\u547d\u4e2d\u60c5\u51b5 cachetop \u63d0\u4f9b\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7f13\u5b58\u547d\u4e2d\u60c5\u51b5 \u7f51\u53cb\u603b\u7ed3\u7684\u6027\u80fd\u6392\u67e5\u601d\u8def \u6709\u76d1\u63a7\u7684\u65f6\u5019\uff0c\u770b\u76d1\u63a7\u5927\u76d8 \u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u770b\u7cfb\u7edf\u7684\u5e73\u5747\u8d1f\u8f7d\uff08 top \u6216 htop \uff09\uff0c\u6807\u793a\u8fd9\u7cfb\u7edf\u7684\u4e00\u4e2a\u6574\u4f53\u60c5\u51b5 \u5e73\u5747\u8d1f\u8f7d\u9ad8\uff0c\u770b\u5177\u4f53\u6bcf\u4e2aCPU\u6838\u7684\u4f7f\u7528\u60c5\u51b5\uff08 top \u63091 \uff09\uff0c\u5982\u679c\u5360\u6bd4\u5f88\u9ad8\uff0c\u90a3\u74f6\u9888\u5e94\u8be5\u662fCPU\uff0c\u63a5\u4e0b\u6765\u770b\u662f\u4ec0\u4e48\u8fdb\u7a0b\u5bfc\u81f4\u7684\uff08 pidstat \uff09 \u5982\u679cCPU\u6ca1\u95ee\u9898\uff0c\u5c31\u53bb\u770b\u5185\u5b58\uff0c\u9996\u5148 free \u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u7ed3\u5408\u770b cache \u548c buffer\uff0c\u518d\u770b\u4ec0\u4e48\u8fdb\u7a0b\u5360\u7528\u4e86\u8fc7\u9ad8\u7684\u5185\u5b58\uff08 top \u6392\u5e8f \uff09 \u5185\u5b58\u6ca1\u95ee\u9898\u5c31\u770b\u78c1\u76d8\uff08 iostat \uff09 \u8fd8\u6709\u5e26\u5bbd\u95ee\u9898\uff0c\u4f7f\u7528 iftop \u67e5\u770b\u6d41\u91cf\u4f7f\u7528\u60c5\u51b5\uff0c\u770b\u6d41\u91cf\u662f\u5426\u8d85\u8fc7\u672c\u673a\u7ed9\u5b9a\u5e26\u5bbd \u6d89\u53ca\u5230\u5177\u4f53\u5e94\u7528\uff0c\u6839\u636e\u5e94\u7528\u7684\u53c2\u6570\u6765\u67e5\u770b\uff0c\u6bd4\u5982\u8fde\u63a5\u6570\u662f\u5426\u8d85\u8fc7\u8bbe\u5b9a\u503c\u7b49 \u5982\u679c\u7cfb\u7edf\u5c42\u5404\u4e2a\u6307\u6807\u67e5\u4e0b\u6765\u90fd\u6ca1\u6709\u53d1\u73b0\u5f02\u5e38\uff0c\u90a3\u4e48\u4e45\u8981\u8003\u8651\u5916\u90e8\u7cfb\u7edf\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3001\u7f13\u5b58\u3001\u5b58\u50a8\u7b49\u3002 33 Linux \u7f51\u7edc\u57fa\u672c\u6a21\u578b \u7f51\u7edc\u6a21\u578b OSI \u5f00\u653e\u4e92\u8054\u4e03\u5c42\u6a21\u578b TCP/IP \u56db\u5c42\u6a21\u578b \u7f51\u7edc\u5e38\u89c1\u6280\u672f\uff1a \u4e03\u5c42\u8d1f\u8f7d\u5747\u8861 \u56db\u5c42\u8d1f\u8f7d\u5747\u8861 \u4e09\u5c42\u8bbe\u5907 \u4e8c\u5c42\u8bbe\u5907 Linux \u7f51\u7edc\u6808 Linux \u901a\u7528 IP \u7f51\u7edc\u6808\uff1a Linux \u7f51\u7edc\u6536\u53d1\u6d41\u7a0b \u603b\u4f53\u56fe\u793a\uff1a \u5de6\u8fb9\u662f\u6536\u5305\u6d41\u7a0b\uff0c\u53f3\u8fb9\u662f\u53d1\u5305\u6d41\u7a0b\u3002 \u6536\u5305\u6d41\u7a0b\uff1a \u7f51\u5361\u6536\u5230\u4e00\u4e2a\u7f51\u7edc\u5305\u540e\uff0c\u4f1a\u901a\u8fc7 DMA \u7684\u65b9\u5f0f\uff0c\u5c06\u8fd9\u4e2a\u5305\u9001\u5230\u6536\u5305\u961f\u5217\u4e2d \u7136\u540e\u901a\u8fc7 \u786c\u4e2d\u65ad \uff0c\u544a\u8bc9\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5df2\u7ecf\u6536\u5230\u5305 \u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4f1a\u4e3a\u8fd9\u4e2a\u5305\u5206\u914d\u5185\u6838\u6570\u636e\u7ed3\u6784\uff08sk_buff\uff09\uff0c\u5e76\u5c06\u5176\u62f7\u8d1d\u5230 sk_buff \u7f13\u51b2\u533a\u4e2d \u7136\u540e\u518d\u901a\u8fc7 \u8f6f\u4e2d\u65ad \uff0c\u901a\u77e5\u5185\u6838\u534f\u8bae\u6808\u6536\u5230\u4e86\u65b0\u7684\u5305 \u5185\u6838\u534f\u8bae\u6808\u4ece\u7f13\u51b2\u533a\u4e2d\u53d6\u51fa\u8fd9\u4e2a\u5305\uff0c\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u9010\u5c42\u5904\u7406\u8fd9\u4e2a\u5305 \u94fe\u8def\u5c42 \u68c0\u67e5\u62a5\u6587\u7684\u5408\u6cd5\u6027\uff0c\u627e\u51fa\u4e0a\u5c42\u534f\u8bae\uff08IPv4 \u8fd8\u662f IPv6\uff09\uff0c\u89e3\u5c01\u88c5\uff0c\u53bb\u6389\u5e27\u5934\u548c\u5e27\u5c3e\uff0c\u4ea4\u7ed9\u7f51\u7edc\u5c42\u3002 \u7f51\u7edc\u5c42 \u53d6\u51fa IP \u5934\uff0c\u5224\u65ad\u8fd9\u4e2a\u5305\u7684\u4e0b\u4e00\u6b65\u8d70\u5411\uff0c\u662f\u8f6c\u53d1\u8fd8\u662f\u7ee7\u7eed\u4ea4\u7ed9\u4e0a\u5c42\u5904\u7406\uff0c\u5982\u679c\u786e\u8ba4\u662f\u53d1\u7ed9\u672c\u673a\u7684\u5305\uff0c\u90a3\u4e48\u5c31\u68c0\u67e5\u4e0a\u5c42\u534f\u8bae\u7684\u7c7b\u578b\uff08\u662f UDP \u8fd8\u662f TCP\uff09\uff0c\u540c\u6837\u89e3\u5c01\u88c5\uff0c\u53bb\u6389 IP \u5934\uff0c\u4ea4\u7ed9\u4f20\u8f93\u5c42\u3002 \u4f20\u8f93\u5c42 \u53d6\u51fa TCP \u5934\u6216 UDP \u5934\uff0c\u6839\u636e <\u6e90IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684IP\u3001\u76ee\u7684\u7aef\u53e3> \u56db\u5143\u7ec4\uff0c\u627e\u51fa\u5bf9\u5e94\u7684 socket\uff0c\u628a\u6570\u636e\u62f7\u8d1d\u5230 socket \u7684\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\u3002 \u5e94\u7528\u5c42 \u7a0b\u5e8f\u5c31\u53ef\u4ee5\u4f7f\u7528 socket \u63a5\u53e3\uff0c\u8bfb\u53d6\u5230\u63a5\u6536\u5230\u7684\u6570\u636e\u4e86\u3002 \u53d1\u5305\u6d41\u7a0b\uff1a \u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 socket API \u53d1\u9001\u7f51\u7edc\u5305 \u7531\u4e8e\u7cfb\u7edf\u8c03\u7528\u4f1a\u9677\u5165\u5230\u5185\u6838\u7684\u5957\u63a5\u5b57\u5c42\u4e2d\uff0c\u5957\u63a5\u5b57\u5c42\u4f1a\u5c06\u6570\u636e\u653e\u5230 socket \u53d1\u9001\u7f13\u51b2\u533a\u4e2d \u7f51\u7edc\u534f\u8bae\u6808\u4ece socket \u7f13\u51b2\u533a\u53d6\u51fa\u6570\u636e\uff0c\u518d\u6309\u7167 \u534f\u8bae\u6808\uff0c\u81ea\u4e0a\u800c\u4e0b\u5730\u9010\u5c42\u5904\u7406\u6570\u636e\u5305\u3002 \u8fd9\u4e00\u5207\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5305\u88ab\u9001\u5230\u53d1\u9001\u961f\u5217\u4e2d\uff0c\u4f1a\u89e6\u53d1\u8f6f\u4e2d\u65ad\u901a\u77e5\u9a71\u52a8\u7a0b\u5e8f\uff0c\u6709\u5305\u9700\u8981\u53d1\u9001\u3002 \u9a71\u52a8\u7a0b\u5e8f\u518d\u901a\u8fc7 DMA \uff0c\u4ece\u53d1\u5305\u961f\u5217\u4e2d\u8bfb\u51fa\u7f51\u7edc\u5305\uff0c\u7ee7\u800c\u901a\u8fc7\u7269\u7406\u7f51\u5361\u53d1\u9001\u51fa\u53bb\u3002 34 Linux \u7f51\u7edc\u6027\u80fd\u5206\u6790\u6307\u6807\u548c\u5de5\u5177 \u6027\u80fd\u6307\u6807 \u8bf4\u5230\u7f51\u7edc\u6027\u80fd\u4f18\u5316\uff0c\u6709\u54ea\u4e9b\u53ef\u8861\u91cf\u7684\u6307\u6807\u5462\uff1f \u5e38\u7528\u7684\u6307\u6807\u65e0\u5916\u4e4e\u56db\u4e2a\uff1a\u5e26\u5bbd\u3001\u541e\u5410\u91cf\u3001\u5ef6\u65f6\u3001PPS\uff08Packet Per Second\uff09\u3002 \u5e26\u5bbd\uff1a \u8868\u793a\u94fe\u8def\u6700\u5927\u7684\u4f20\u8f93\u901f\u7387\uff0c\u5355\u4f4d\u901a\u5e38\u662f b/s\uff08\u6bd4\u7279/s\uff09 \u541e\u5410\u91cf\uff1a \u8868\u793a\u5355\u4f4d\u65f6\u95f4\u5185\u6210\u529f\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff0c\u5355\u4f4d\u901a\u5e38\u662f b/s\uff08\u6bd4\u7279/s\uff09 \u6216 B/s\uff08\u5b57\u8282/\u79d2\uff09\uff0c \u5ef6\u65f6\uff1a \u8868\u793a\u4ece\u7f51\u7edc\u8bf7\u6c42\u53d1\u51fa\u540e\uff0c\u4e00\u76f4\u5230\u6536\u5230\u8fdc\u7aef\u54cd\u5e94\uff0c\u6240\u9700\u8981\u7684\u65f6\u95f4\u3002 PPS\uff1a \u8868\u793a\u4ee5\u7f51\u7edc\u5305\u4e3a\u5355\u4f4d\u7684\u4f20\u8f93\u901f\u7387\uff0c\u5355\u4f4d\u662f Packet/s\uff08\u5305/\u79d2\uff09\uff0c\u7528\u4ee5\u8861\u91cf\u7f51\u7edc\u7684\u8f6c\u53d1\u80fd\u529b\u3002 \u9664\u4e86\u4ee5\u4e0a\u56db\u4e2a\u5e38\u7528\u7684\u6307\u6807\u4e4b\u5916\uff0c\u8fd8\u6709\uff1a \u7f51\u7edc\u7684\u53ef\u7528\u6027\uff08\u7f51\u7edc\u662f\u5426\u80fd\u6b63\u5e38\u901a\u4fe1\uff09 \u5e76\u53d1\u8fde\u63a5\u6570\uff08TCP\u8fde\u63a5\u6570\u91cf\uff09 \u4e22\u5305\u6570\uff08\u4e22\u5305\u767e\u5206\u6bd4\uff09 \u91cd\u4f20\u7387\uff08\u91cd\u65b0\u4f20\u8f93\u7684\u7f51\u7edc\u5305\u6bd4\u4f8b\uff09 \u7f51\u7edc\u914d\u7f6e \u5de5\u5177\uff1a ip ifconfig \u5957\u63a5\u5b57\u4fe1\u606f netstat ss \u66f4\u63a8\u8350\u4f7f\u7528 ss\uff0c\u56e0\u4e3a\u5b83\u6bd4 netstat \u901f\u5ea6\u66f4\u5feb\u3002 \u5982\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a # head -n 3 \u8868\u793a\u53ea\u663e\u793a\u524d\u9762 3 \u884c # -l \u8868\u793a\u53ea\u663e\u793a\u76d1\u542c\u5957\u63a5\u5b57 # -n \u8868\u793a\u663e\u793a\u6570\u5b57\u5730\u5740\u548c\u7aef\u53e3 (\u800c\u4e0d\u662f\u540d\u5b57) # -p \u8868\u793a\u663e\u793a\u8fdb\u7a0b\u4fe1\u606f $ netstat -nlp | head -n 3 Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN 840/systemd-resolve # -l \u8868\u793a\u53ea\u663e\u793a\u76d1\u542c\u5957\u63a5\u5b57 # -t \u8868\u793a\u53ea\u663e\u793a TCP \u5957\u63a5\u5b57 # -n \u8868\u793a\u663e\u793a\u6570\u5b57\u5730\u5740\u548c\u7aef\u53e3 (\u800c\u4e0d\u662f\u540d\u5b57) # -p \u8868\u793a\u663e\u793a\u8fdb\u7a0b\u4fe1\u606f $ ss -ltnp | head -n 3 State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 128 127.0.0.53%lo:53 0.0.0.0:* users:((\"systemd-resolve\",pid=840,fd=13)) LISTEN 0 128 0.0.0.0:22 0.0.0.0:* users:((\"sshd\",pid=1459,fd=3)) \u5f53\u5957\u63a5\u5b57\u5904\u4e8e\u8fde\u63a5\u72b6\u6001\uff08Established\uff09\u65f6: Recv-Q \u8868\u793a\u5957\u63a5\u5b57\u7f13\u51b2\u8fd8\u6ca1\u6709\u88ab\u5e94\u7528\u7a0b\u5e8f\u53d6\u8d70\u7684\u5b57\u8282\u6570\uff08\u5373\u63a5\u6536\u961f\u5217\u957f\u5ea6\uff09 Send-Q \u8868\u793a\u8fd8\u6ca1\u6709\u88ab\u8fdc\u7aef\u4e3b\u673a\u786e\u8ba4\u7684\u5b57\u8282\u6570\uff08\u5373\u53d1\u9001\u961f\u5217\u957f\u5ea6\uff09 \u5f53\u5957\u63a5\u5b57\u5904\u4e8e\u76d1\u542c\u72b6\u6001\u65f6\uff1a Recv-Q \u8868\u793a syn backlog \u7684\u5f53\u524d\u503c Send-Q \u8868\u793a\u6700\u5927\u7684 syn backlog \u503c syn backlog \u662f TCP \u534f\u8bae\u6808\u4e2d\u7684\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\uff0c\u76f8\u5e94\u7684\u4e5f\u6709\u4e00\u4e2a\u5168\u8fde\u63a5\u961f\u5217\uff08accept queue\uff09\uff0c\u5b83\u4eec\u90fd\u662f\u7ef4\u62a4 TCP \u72b6\u6001\u7684\u91cd\u8981\u673a\u5236\u3002 \u534f\u8bae\u6808\u7edf\u8ba1\u4fe1\u606f \u540c\u6837\u9002\u7528 netstat\uff0css\uff1a $ netstat -s ... Tcp: 3244906 active connection openings 23143 passive connection openings 115732 failed connection attempts 2964 connection resets received 1 connections established 13025010 segments received 17606946 segments sent out 44438 segments retransmitted 42 bad segments received 5315 resets sent InCsumErrors: 42 ... $ ss -s Total: 186 (kernel 1446) TCP: 4 (estab 1, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 0 Transport Total IP IPv6 * 1446 - - RAW 2 1 1 UDP 2 2 0 TCP 4 3 1 ... ss \u53ea\u663e\u793a\u5df2\u7ecf\u8fde\u63a5\u3001\u5173\u95ed\u3001\u5b64\u513f\u5957\u63a5\u5b57\u7b49\u7b80\u8981\u7edf\u8ba1 netstat \u5219\u63d0\u4f9b\u7684\u662f\u66f4\u8be6\u7ec6\u7684\u7f51\u7edc\u534f\u8bae\u6808\u4fe1\u606f \u7f51\u7edc\u541e\u5410\u548c PPS \u63a8\u8350\u4f7f\u7528 sar -n \uff1a # \u6570\u5b57 1 \u8868\u793a\u6bcf\u9694 1 \u79d2\u8f93\u51fa\u4e00\u7ec4\u6570\u636e $ sar -n DEV 1 Linux 4.15.0-1035-azure (ubuntu) 01/06/19 _x86_64_ (2 CPU) 13:21:40 IFACE rxpck/s txpck/s rxkB/s txkB/s rxcmp/s txcmp/s rxmcst/s %ifutil 13:21:41 eth0 18.00 20.00 5.79 4.25 0.00 0.00 0.00 0.00 13:21:41 docker0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 13:21:41 lo 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 rxpck/s \u548c txpck/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 PPS \u3002 rxkB/s \u548c txkB/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 \u541e\u5410\u91cf \uff0c\u5355\u4f4d\u662f KB/\u79d2 rxcmp/s \u548c txcmp/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 \u538b\u7f29\u6570\u636e\u5305\u6570 \uff0c\u5355\u4f4d\u662f\u5305/\u79d2\u3002 %ifutil \u662f\u7f51\u7edc\u63a5\u53e3\u7684\u4f7f\u7528\u7387\uff0c\u5373\u534a\u53cc\u5de5\u6a21\u5f0f\u4e0b\u4e3a (rxkB/s+txkB/s)/Bandwidth\uff0c\u800c\u5168\u53cc\u5de5\u6a21\u5f0f\u4e0b\u4e3a max(rxkB/s, txkB/s)/Bandwidth \u5e26\u5bbd\uff08Bandwidth\uff09\u53ef\u4ee5\u7528 ethtool \u5de5\u5177\u67e5\u8be2\uff0c\u5355\u4f4d\u901a\u5e38\u662f Gb/s \u6216\u8005 Mb/s\uff08\u5c0f\u5199 b\uff09\uff0c\u67e5\u8be2\u7f51\u5361\u5e26\u5bbd\uff1a $ ethtool eth0 | grep Speed Speed: 1000Mb/s \u8fde\u901a\u6027\u548c\u5ef6\u65f6 \u901a\u5e38\u4f7f\u7528 ping\uff1a # -c3 \u8868\u793a\u53d1\u9001\u4e09\u6b21 ICMP \u5305\u540e\u505c\u6b62 $ ping -c3 114.114.114.114 PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data. 64 bytes from 114.114.114.114: icmp_seq=1 ttl=54 time=244 ms 64 bytes from 114.114.114.114: icmp_seq=2 ttl=47 time=244 ms 64 bytes from 114.114.114.114: icmp_seq=3 ttl=67 time=244 ms --- 114.114.114.114 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2001ms rtt min/avg/max/mdev = 244.023/244.070/244.105/0.034 ms 35 C10K \u3001C100K\u3001C10M \u95ee\u9898 C10K \u5355\u673a\u652f\u6301 1\u4e07\u5e76\u53d1\u8bf7\u6c42 C100K \u5355\u673a\u652f\u630110\u4e07\u5e76\u53d1\u8bf7\u6c42 55 \u5206\u6790\u6027\u80fd\u7684\u4e00\u822c\u5957\u8def \u7cfb\u7edf\u8d44\u6e90\u74f6\u9888 \u5e94\u7528\u7a0b\u5e8f\u74f6\u9888","title":"Linux\u6027\u80fd\u4f18\u5316\u5b9e\u6218"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#01-linux","text":"\u9996\u5148\u4e86\u89e3 \u6027\u80fd\u6307\u6807 \u7684\u6982\u5ff5\uff1a \u9ad8\u5e76\u53d1+\u54cd\u5e94\u5feb = \u541e\u5410+\u5ef6\u65f6 \u4e00\u822c\u4ece\u5e94\u7528\u8d1f\u8f7d\u548c\u7cfb\u7edf\u8d44\u6e90\u7684\u89c6\u89d2\u6765\u5206\u522b\u770b\u5f85\uff1a \u4ece\u5206\u5c42\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u6bcf\u4e00\u5c42\u90fd\u5bf9\u5e94\u4e0d\u540c\u7684\u6307\u6807\u8981\u6c42\u3002 \u5176\u6b21\u662f\u5b66\u4e60\u7684\u91cd\u70b9\uff1a\u61c2\u5f97\u57fa\u672c\u57fa\u7840\uff0c\u628a\u63e1\u6574\u4f53\u7cfb\u7edf\u6027\u80fd\u7684\u5168\u5c40\u89c2\uff0c\u4e0d\u8981\u6df1\u9677\u7ec6\u8282\u3002 \u6700\u540e\u5584\u4e8e\u603b\u7ed3\u3001\u5206\u7c7b\u3002","title":"01 \u5982\u4f55\u5b66\u4e60 Linux \u6027\u80fd\u4f18\u5316"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#02","text":"","title":"02 \u7406\u89e3\u5e73\u5747\u8d1f\u8f7d"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_1","text":"\u5e73\u5747\u8d1f\u8f7d \uff1a\u6307\u5355\u4f4d\u65f6\u95f4\u5185\uff0c\u7cfb\u7edf\u5904\u4e8e \u53ef\u8fd0\u884c\u72b6\u6001\uff08R\uff09 \u548c \u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\uff08D\uff09 \u7684\u5e73\u5747\u8fdb\u7a0b\u6570\uff0c\u4e5f\u5c31\u662f \u5e73\u5747\u6d3b\u8dc3\u8fdb\u7a0b\u6570 \u3002 \u53ef\u8fd0\u884c\u72b6\u6001\uff1a \u6b63\u5728\u4f7f\u7528 CPU \u6216\u8005\u6b63\u5728\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b \u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\uff1a \u7b49\u5f85 IO \u54cd\u5e94\u3001\u78c1\u76d8\u8bfb\u5199\u7b49 \u67e5\u770b\u547d\u4ee4\uff1a uptime \u6216\u8005 top # uptime 02:34:03 up 2 days, 20:14, 1 user, load average: 0.63, 0.83, 0.88 \u6700\u540e\u4e09\u4e2a\u6570\u5b57\uff0c\u5206\u522b\u8868\u793a \u8fc7\u53bb 1 \u5206\u949f\u30015 \u5206\u949f\u300115 \u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d\u3002 \u67e5\u770bCPU\u7684\u4e2a\u6570\uff1a grep \"model name\" /proc/cpuinfo | wc -l \u7ecf\u9a8c\u4e4b\u8c08\uff1a \u5f53\u5e73\u5747\u8d1f\u8f7d\u9ad8\u4e8e CPU \u6570\u91cf 70% \u7684\u65f6\u5019\uff0c\u5c31\u5e94\u8be5\u5206\u6790\u8d1f\u8f7d\u9ad8\u7684\u95ee\u9898\u4e86\u3002\u8fd8\u6709\u5c31\u662f\u5224\u65ad\u8d1f\u8f7d\u7684\u8d8b\u52bf\u53d8\u5316\u3002","title":"\u5e73\u5747\u8d1f\u8f7d"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#cpu","text":"\u5e73\u5747\u8d1f\u8f7d\uff1a\u4e0d\u4ec5\u5305\u62ec\u4e86\u6b63\u5728\u4f7f\u7528 CPU \u7684\u8fdb\u7a0b\uff0c\u8fd8\u5305\u62ec\u7b49\u5f85 CPU \u548c \u7b49\u5f85 IO \u7684\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\uff1a\u5355\u4f4d\u65f6\u95f4\u5185 CPU \u7e41\u5fd9\u60c5\u51b5\u7684\u7edf\u8ba1\uff0c\u8ddf\u5e73\u5747\u8d1f\u8d23\u5e76\u4e0d\u4e00\u5b9a\u5b8c\u5168\u5bf9\u5e94\uff0c\u6709\u4ee5\u4e0b\u4e00\u4e9b\u8054\u7cfb\uff1a CPU \u5bc6\u96c6\u578b\u8fdb\u7a0b\uff1a\u4f7f\u7528\u5927\u91cf CPU \u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0c\u6b64\u65f6\u4e24\u8005\u7b49\u4ef7 IO \u5bc6\u96c6\u578b\u8fdb\u7a0b\uff1a\u7b49\u5f85 IO \u4e5f\u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0c\u4f46 CPU \u4f7f\u7528\u7387\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u5347\u9ad8 \u5927\u91cf\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b\u8c03\u5ea6\u4e5f\u4f1a\u5bfc\u81f4\u5e73\u5747\u8d1f\u8f7d\u5347\u9ad8\uff0cCPU \u4f7f\u7528\u7387\u4e5f\u4f1a\u6bd4\u8f83\u9ad8","title":"\u5e73\u5747\u8d1f\u8d23\u4e0e CPU \u4f7f\u7528\u7387"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_2","text":"\u5de5\u5177\uff1a \u5de5\u5177\u5305\uff1a stress \u548c sysstat stress \u662f\u4e00\u4e2aLinux\u7cfb\u7edf\u538b\u529b\u6d4b\u8bd5\u5de5\u5177 sysstat \u5305\u542b\u4e86\u5e38\u7528\u7684 Linux \u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u5982\uff1a mpstat \u548c pidstat mpstat \u591a\u6838CPU\u6027\u80fd\u5206\u6790\u529f\u80fd\uff0c\u7528\u4e8e\u5b9e\u65f6\u67e5\u770b\u6bcf\u4e2aCPU\u7684\u6027\u80fd\u6307\u6807\uff0c\u4ee5\u53ca\u6240\u6709CPU\u7684\u5e73\u5747\u6307\u6807 pidstat \u8fdb\u7a0b\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u7528\u6765\u5b9e\u65f6\u67e5\u770b\u8fdb\u7a0b\u7684CPU\u3001\u5185\u5b58\u3001I/O\u4ee5\u53ca\u4e0a\u4e0b\u6587\u5207\u6362\u7b49\u6027\u80fd\u6307\u6807 \u5e38\u7528\u547d\u4ee4\uff1a # \u6a21\u62df\u4e00\u4e2a CPU \u4f7f\u7528\u7387 100% \u7684\u573a\u666f stress --cpu 1 --timeout 600 # \u6a21\u62df I/O \u538b\u529b\uff0c\u4e0d\u65ad\u6267\u884c sync stress -i 1 --timeout 600 # \u6a21\u62df\u8d85\u914d\u7684\u573a\u666f\uff0c\u8fdb\u7a0b\u6570\u8d85\u8fc7 CPU \u4e2a\u6570 stress -c 8 --timeout 600 # mpstat \u67e5\u770b CPU \u4f7f\u7528\u7387\u7684\u53d8\u5316\u60c5\u51b5 # -P ALL \u76d1\u63a7\u6240\u6709 CPU\uff0c\u540e\u9762\u6570\u5b57 5 \u6807\u8bc6\u6bcf\u95f4\u9694 5s \u8f93\u51fa\u4e00\u7ec4\u6570\u636e mpstat -P ALL 5 # pidstat \u67e5\u770b\u54ea\u4e2a\u8fdb\u7a0b\u5bfc\u81f4\u4e86 CPU \u4f7f\u7528\u7387 100% pidstat -u 5 1 \u6ce8\u610f\uff1a 1 \u65e0\u6cd5\u770b\u5230 iowait \u5347\u9ad8 \u89e3\u51b3\u529e\u6cd5\uff1a\u4f7f\u7528 stress-ng\uff1astress-ng -i 1 --hdd 1 --timeout 600\uff08--hdd \u8868\u793a\u8bfb\u5199\u4e34\u65f6\u6587\u4ef6\uff09 2 pidstat \u8f93\u51fa\u6ca1\u6709 %wait \u89e3\u51b3\u529e\u6cd5\uff1a\u9700\u8981\u5347\u7ea7 sysstat \u5305 \u5230 11.5.5 \u7248\u672c\u4ee5\u540e 3 mpstat \u65e0\u6cd5\u89c2\u6d4b \u89e3\u51b3\u529e\u6cd5\uff1a\u7b49\u5f85\u65f6\u95f4\u957f\u4e00\u4e9b\uff0c\u6bd4\u5982 20s\uff1ampstat -P ALL 5 20","title":"\u5b9e\u9a8c"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#03-cpu","text":"CPU \u4e0a\u4e0b\u6587\uff1a\u5305\u62ec CPU \u5bc4\u5b58\u5668 \u548c \u7a0b\u5e8f\u8ba1\u6570\u5668 \u3002\u524d\u8005\u662f CPU \u5185\u7f6e\u7684\u5bb9\u91cf\u5c0f\u3001\u4f46\u901f\u5ea6\u6781\u5feb\u7684\u5185\u5b58\uff1b\u540e\u8005\u662f\u7528\u6765\u5b58\u50a8 CPU \u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\u4f4d\u7f6e\u3001\u6216\u8005\u5373\u5c06\u6267\u884c\u7684\u5413\u4e00\u6761\u6307\u4ee4\u4f4d\u7f6e\u3002 \u5305\u62ec\uff1a\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3001\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u4ee5\u53ca\u4e2d\u65ad\u4e0a\u4e0b\u6587\u5207\u6362\u3002 CPU \u4e0a\u4e0b\u6587\u5207\u6362\u672c\u8d28\u662f CPU \u7279\u6743\u7ea7\u7684\u5207\u6362\u3002 \u8fdb\u7a0b\u4e0a\u4e0b\u6587 \u5207\u6362\u53d1\u751f\u5728\u5185\u6838\u6001\uff0c\u4e0d\u4ec5\u5305\u62ec\u865a\u62df\u5185\u5b58\u3001\u6808\u3001\u5168\u5c40\u53d8\u91cf\u7b49\u7528\u6237\u7a7a\u95f4\u7684\u8d44\u6e90\uff0c\u8fd8\u5305\u62ec\u4e86\u5185\u6838\u5806\u6808\u3001\u5bc4\u5b58\u5668\u7b49\u5185\u6838\u7a7a\u95f4\u7684\u72b6\u6001\u3002 \u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587 \u5207\u6362\u5305\u542b\u4e24\u79cd\u60c5\u51b5\uff1a\u4e00\u4e24\u4e2a\u7ebf\u7a0b\u5c5e\u4e8e\u4e0d\u540c\u7684\u8fdb\u7a0b\uff0c\u8fd9\u79cd\u60c5\u51b5\u548c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u4e00\u6837\uff0c\u4e8c\u4e24\u4e2a\u7ebf\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7531\u4e8e\u865a\u62df\u5185\u5b58\u3001\u5168\u5c40\u53d8\u91cf\u662f\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u53ea\u5207\u6362\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\uff08\u6808\uff09\u3001\u5bc4\u5b58\u5668\u7b49\u4e0d\u5171\u4eab\u7684\u6570\u636e\u3002","title":"03 CPU \u4e0a\u4e0b\u6587\u5207\u6362"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#cpu_1","text":"# \u6bcf\u9694 5 \u79d2\u8f93\u51fa 1 \u7ec4\u6570\u636e $ vmstat 5 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 3 0 0 161484 134588 1522148 0 0 0 2 22 20 0 0 100 0 0 cs(context switch) \u6bcf\u79d2\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570 in(interrupt) \u6bcf\u79d2\u4e2d\u65ad\u6b21\u6570 r(running or runnable) \u5c31\u7eea\u961f\u5217\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u6b63\u5728\u8fd0\u884c\u548c\u7b49\u5f85 CPU \u7684\u8fdb\u7a0b\u6570 b(Blocked) \u5904\u4e8e\u4e0d\u53ef\u4e2d\u65ad\u7761\u7720\u72b6\u6001\u7684\u8fdb\u7a0b\u6570","title":"\u67e5\u770b CPU \u4e0a\u4e0b\u6587\u5207\u6362"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_3","text":"# \u6bcf\u9694 5 \u79d2\u8f93\u51fa 1 \u7ec4\u6570\u636e $ pidstat -w 5 Linux 3.10.0-862.14.4.el7.x86_64 (by) 12/18/2018 _x86_64_ (1 CPU) 08:58:15 AM UID PID cswch/s nvcswch/s Command 08:58:15 AM 0 1 0.05 0.00 systemd 08:58:15 AM 0 2 0.00 0.00 kthreadd ... cswch(voluntary context swithches) \u6bcf\u79d2\u81ea\u613f\u4e0a\u4e0b\u6587\u5207\u6362\uff08\u8fdb\u7a0b\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u8d44\u6e90\u800c\u53d1\u751f\uff09 nvcswch(non voluntary context switches) \u6bcf\u79d2\u975e\u81ea\u613f\u4e0a\u4e0b\u6587\u5207\u6362\uff08\u8fdb\u7a0b\u7531\u4e8e\u65f6\u95f4\u7247\u5df2\u5230\u7b49\u539f\u56e0\uff0c\u88ab\u7cfb\u7edf\u5f3a\u5236\u8c03\u5ea6\uff09 \u4ee5\u4e0a\u9ed8\u8ba4\u663e\u793a\u7684\u662f\u8fdb\u7a0b\u7684\u6307\u6807\u6570\u636e\uff0c\u5982\u679c\u8981\u67e5\u770b\u7ebf\u7a0b\u6570\u636e\uff0c\u5219\u9700\u8981\u52a0\u4e0a -t \u53c2\u6570\u3002 # -wt \u8868\u793a\u8f93\u51fa\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6307\u6807 $ pidstat -wt 1 Linux 3.10.0-862.14.4.el7.x86_64 (by) 12/21/2018 _x86_64_ (1 CPU) 08:57:17 AM UID TGID TID cswch/s nvcswch/s Command 08:57:18 AM 0 3 - 2.02 0.00 ksoftirqd/0 08:57:18 AM 0 - 3 2.02 0.00 |__ksoftirqd/0","title":"\u67e5\u770b\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_4","text":"sysbench : \u4e00\u4e2a\u591a\u7ebf\u7a0b\u57fa\u51c6\u6d4b\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u6765\u6a21\u62df\u7cfb\u7edf\u591a\u7ebf\u7a0b\u8c03\u5ea6\u5207\u6362 ubuntu \u5b89\u88c5 apt install sysbench sysstat \u6a21\u62df\u7cfb\u7edf\u591a\u7ebf\u7a0b\u8c03\u5ea6 # \u4ee5 10 \u4e2a\u7ebf\u7a0b\u8fd0\u884c 5 \u5206\u949f\u57fa\u51c6\u6d4b\u8bd5\uff0c\u6a21\u62df\u591a\u7ebf\u7a0b\u5207\u6362\u95ee\u9898 sysbench --threads=10 --max-time=300 threads run","title":"\u6a21\u62df\u7cfb\u7edf\u4e0a\u4e0b\u6587\u5207\u6362\u5de5\u5177"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_5","text":"\u67e5\u770b /proc/interrupts \u4f7f\u7528 watch -d cat /proc/interrupts \u67e5\u770b\u4e2d\u65ad\u7684\u53d8\u5316\u60c5\u51b5\uff0c\u91cd\u70b9\u5173\u6ce8 RES \u884c\uff0c\u91cd\u8c03\u5ea6\u4e2d\u65ad\uff0c\u8868\u793a\u5524\u9192\u7a7a\u95f2\u72b6\u6001\u7684 CPU \u6765\u8c03\u5ea6\u65b0\u7684\u4efb\u52a1\u8fd0\u884c\uff0c\u8fd9\u662f SMP \u7cfb\u7edf\u4e2d\uff0c\u8c03\u5ea6\u5668\u7528\u6765\u5206\u6563\u4efb\u52a1\u5230\u4e0d\u540c CPU \u7684\u673a\u5236\u3002 \u7ed3\u8bba\uff1a \u6bcf\u79d2\u5207\u6362\u6b21\u6570\u5728\u6570\u767e-\u4e00\u4e07\u4e14\u5207\u6362\u6b21\u6570\u7a33\u5b9a\u90fd\u7b97\u662f\u6b63\u5e38\uff0c\u5982\u679c\u8d85\u8fc7\u4e00\u4e07\u6b21\uff0c\u6216\u8005\u5207\u6362\u6b21\u6570\u51fa\u73b0\u6570\u91cf\u7ea7\u589e\u957f\u65f6\u5c31\u4e0d\u7a33\u5b9a\u3002","title":"\u67e5\u770b\u5f15\u8d77\u9891\u7e41\u4e2d\u65ad\u7684\u4e2d\u65ad\u7c7b\u578b"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#04-cpu","text":"\u8ba1\u7b97\u516c\u5f0f\uff1a CPU \u4f7f\u7528\u7387=1-\u7a7a\u95f2\u65f6\u95f4/\u603bCPU\u65f6\u95f4 \u4e3a\u4e86\u8ba1\u7b97\u51c6\u786e\uff0c\u4e00\u822c\u4f1a\u7b97\u65f6\u95f4\u5dee\uff1a \u5e73\u5747CPU\u4f7f\u7528\u7387=1-(\u7a7a\u95f2\u65f6\u95f4new - \u7a7a\u95f2\u65f6\u95f4old)/(\u603bCPU\u65f6\u95f4new - \u603bCPU\u65f6\u95f4old)","title":"04 CPU \u4f7f\u7528\u7387"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#cpu_2","text":"top \u663e\u793a\u7cfb\u7edf\u603b\u4f53\u7684 CPU \u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u53ca\u5404\u4e2a\u8fdb\u7a0b\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff08\u9ed8\u8ba4\u6ca13s\u5237\u65b0\u4e00\u6b21\uff0c\u6309\u4e0b 1 \u67e5\u770b\u5355\u4e2a CPU \u7684\u4f7f\u7528\u7387\uff09 ps \u53ea\u663e\u793a\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff08\u6574\u4e2a\u8fdb\u7a0b\u751f\u547d\u5468\u671f\uff09 pidstat \u67e5\u770b\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u8be6\u7ec6 CPU \u4f7f\u7528\u7387 perf top \u5b9e\u65f6\u663e\u793a\u5360\u7528CPU\u65f6\u949f\u6700\u591a\u7684\u51fd\u6570\u6216\u6307\u4ee4 perf record \u6bd4 perf top \u591a\u4e86\u4fdd\u5b58\u91c7\u6837\u6570\u636e\u7684\u73af\u8282 perf report \u663e\u793a perf record \u7684\u62a5\u544a","title":"\u67e5\u770b CPU \u4f7f\u7528\u7387"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#05","text":"\u8fdb\u7a0b\u7684\u72b6\u6001\uff1a R\uff1a\u8fdb\u7a0b\u5728 CPU \u5c31\u7eea\u961f\u5217\u4e2d\uff0c\u6b63\u5728\u8fd0\u884c\u6216\u7b49\u5f85\u8fd0\u884c D\uff08Disk Sleep\uff09\uff1a\u4e0d\u53ef\u4e2d\u65ad\u72b6\u6001\u7761\u7720 Z\uff08Zombie\uff09\uff1a\u50f5\u5c38\u8fdb\u7a0b S\uff08Inerruptible Sleep\uff09\uff1a\u53ef\u4e2d\u65ad\u72b6\u6001\u7761\u7720 I\uff08Idle\uff09\uff1a\u7a7a\u95f2\u72b6\u6001 T\uff08Traced\uff09\uff1a\u8868\u793a\u8fdb\u7a0b\u5904\u4e8e\u6682\u505c\u6216\u8ddf\u8e2a\u72b6\u6001 X\uff08Dead\uff09\uff1a\u8868\u793a\u8fdb\u7a0b\u5df2\u6d88\u4ea1 iowait \u5206\u6790 \u63a8\u8350\u4f7f\u7528 dstat\uff0c\u5b83\u5438\u6536\u4e86 vmstat\u3001iostat\u3001ifstat \u7b49\u51e0\u79cd\u5de5\u5177\u7684\u4f18\u70b9\u3002\u53ef\u4ee5\u540c\u65f6\u67e5\u770b CPU\u3001I/O\u3001\u7f51\u7edc\u548c\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u4fbf\u4e8e\u5bf9\u6bd4\u5206\u6790\u3002 \u67e5\u770b\u67d0\u4e00\u4e2a\u8fdb\u7a0b\u7684\u78c1\u76d8\u8bfb\u5199\u60c5\u51b5\uff1a pidstat -d -p 4344 1 3 # -d \u8868\u793a\u7edf\u8ba1 I/O \u6570\u636e\uff0c-p \u6307\u5b9a\u8fdb\u7a0b\u53f7 strace \u8ddf\u8e2a\u7cfb\u7edf\u8fdb\u7a0b\u7cfb\u7edf\u8c03\u7528\u7684\u5de5\u5177\u3002\u5148\u901a\u8fc7 pidstat -d \u627e\u51fa\u5f71\u54cd\u8fdb\u7a0b id\uff0c\u518d\u7528 strace \u6765\u8ddf\u8e2a\u3002","title":"05 \u4e0d\u53ef\u4e2d\u65ad\u8fdb\u7a0b\u548c\u50f5\u5c38\u8fdb\u7a0b"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_6","text":"","title":"\u7f13\u5b58."},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_7","text":"\u5de5\u5177\uff1a cachestat \u63d0\u4f9b\u4e86\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7f13\u5b58\u7684\u8bfb\u5199\u547d\u4e2d\u60c5\u51b5 cachetop \u63d0\u4f9b\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7f13\u5b58\u547d\u4e2d\u60c5\u51b5","title":"\u7f13\u5b58\u547d\u4e2d\u60c5\u51b5"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_8","text":"\u6709\u76d1\u63a7\u7684\u65f6\u5019\uff0c\u770b\u76d1\u63a7\u5927\u76d8 \u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u770b\u7cfb\u7edf\u7684\u5e73\u5747\u8d1f\u8f7d\uff08 top \u6216 htop \uff09\uff0c\u6807\u793a\u8fd9\u7cfb\u7edf\u7684\u4e00\u4e2a\u6574\u4f53\u60c5\u51b5 \u5e73\u5747\u8d1f\u8f7d\u9ad8\uff0c\u770b\u5177\u4f53\u6bcf\u4e2aCPU\u6838\u7684\u4f7f\u7528\u60c5\u51b5\uff08 top \u63091 \uff09\uff0c\u5982\u679c\u5360\u6bd4\u5f88\u9ad8\uff0c\u90a3\u74f6\u9888\u5e94\u8be5\u662fCPU\uff0c\u63a5\u4e0b\u6765\u770b\u662f\u4ec0\u4e48\u8fdb\u7a0b\u5bfc\u81f4\u7684\uff08 pidstat \uff09 \u5982\u679cCPU\u6ca1\u95ee\u9898\uff0c\u5c31\u53bb\u770b\u5185\u5b58\uff0c\u9996\u5148 free \u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u7ed3\u5408\u770b cache \u548c buffer\uff0c\u518d\u770b\u4ec0\u4e48\u8fdb\u7a0b\u5360\u7528\u4e86\u8fc7\u9ad8\u7684\u5185\u5b58\uff08 top \u6392\u5e8f \uff09 \u5185\u5b58\u6ca1\u95ee\u9898\u5c31\u770b\u78c1\u76d8\uff08 iostat \uff09 \u8fd8\u6709\u5e26\u5bbd\u95ee\u9898\uff0c\u4f7f\u7528 iftop \u67e5\u770b\u6d41\u91cf\u4f7f\u7528\u60c5\u51b5\uff0c\u770b\u6d41\u91cf\u662f\u5426\u8d85\u8fc7\u672c\u673a\u7ed9\u5b9a\u5e26\u5bbd \u6d89\u53ca\u5230\u5177\u4f53\u5e94\u7528\uff0c\u6839\u636e\u5e94\u7528\u7684\u53c2\u6570\u6765\u67e5\u770b\uff0c\u6bd4\u5982\u8fde\u63a5\u6570\u662f\u5426\u8d85\u8fc7\u8bbe\u5b9a\u503c\u7b49 \u5982\u679c\u7cfb\u7edf\u5c42\u5404\u4e2a\u6307\u6807\u67e5\u4e0b\u6765\u90fd\u6ca1\u6709\u53d1\u73b0\u5f02\u5e38\uff0c\u90a3\u4e48\u4e45\u8981\u8003\u8651\u5916\u90e8\u7cfb\u7edf\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3001\u7f13\u5b58\u3001\u5b58\u50a8\u7b49\u3002","title":"\u7f51\u53cb\u603b\u7ed3\u7684\u6027\u80fd\u6392\u67e5\u601d\u8def"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#33-linux","text":"","title":"33 Linux \u7f51\u7edc\u57fa\u672c\u6a21\u578b"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_9","text":"OSI \u5f00\u653e\u4e92\u8054\u4e03\u5c42\u6a21\u578b TCP/IP \u56db\u5c42\u6a21\u578b \u7f51\u7edc\u5e38\u89c1\u6280\u672f\uff1a \u4e03\u5c42\u8d1f\u8f7d\u5747\u8861 \u56db\u5c42\u8d1f\u8f7d\u5747\u8861 \u4e09\u5c42\u8bbe\u5907 \u4e8c\u5c42\u8bbe\u5907","title":"\u7f51\u7edc\u6a21\u578b"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#linux","text":"Linux \u901a\u7528 IP \u7f51\u7edc\u6808\uff1a","title":"Linux \u7f51\u7edc\u6808"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#linux_1","text":"\u603b\u4f53\u56fe\u793a\uff1a \u5de6\u8fb9\u662f\u6536\u5305\u6d41\u7a0b\uff0c\u53f3\u8fb9\u662f\u53d1\u5305\u6d41\u7a0b\u3002 \u6536\u5305\u6d41\u7a0b\uff1a \u7f51\u5361\u6536\u5230\u4e00\u4e2a\u7f51\u7edc\u5305\u540e\uff0c\u4f1a\u901a\u8fc7 DMA \u7684\u65b9\u5f0f\uff0c\u5c06\u8fd9\u4e2a\u5305\u9001\u5230\u6536\u5305\u961f\u5217\u4e2d \u7136\u540e\u901a\u8fc7 \u786c\u4e2d\u65ad \uff0c\u544a\u8bc9\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5df2\u7ecf\u6536\u5230\u5305 \u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4f1a\u4e3a\u8fd9\u4e2a\u5305\u5206\u914d\u5185\u6838\u6570\u636e\u7ed3\u6784\uff08sk_buff\uff09\uff0c\u5e76\u5c06\u5176\u62f7\u8d1d\u5230 sk_buff \u7f13\u51b2\u533a\u4e2d \u7136\u540e\u518d\u901a\u8fc7 \u8f6f\u4e2d\u65ad \uff0c\u901a\u77e5\u5185\u6838\u534f\u8bae\u6808\u6536\u5230\u4e86\u65b0\u7684\u5305 \u5185\u6838\u534f\u8bae\u6808\u4ece\u7f13\u51b2\u533a\u4e2d\u53d6\u51fa\u8fd9\u4e2a\u5305\uff0c\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u9010\u5c42\u5904\u7406\u8fd9\u4e2a\u5305 \u94fe\u8def\u5c42 \u68c0\u67e5\u62a5\u6587\u7684\u5408\u6cd5\u6027\uff0c\u627e\u51fa\u4e0a\u5c42\u534f\u8bae\uff08IPv4 \u8fd8\u662f IPv6\uff09\uff0c\u89e3\u5c01\u88c5\uff0c\u53bb\u6389\u5e27\u5934\u548c\u5e27\u5c3e\uff0c\u4ea4\u7ed9\u7f51\u7edc\u5c42\u3002 \u7f51\u7edc\u5c42 \u53d6\u51fa IP \u5934\uff0c\u5224\u65ad\u8fd9\u4e2a\u5305\u7684\u4e0b\u4e00\u6b65\u8d70\u5411\uff0c\u662f\u8f6c\u53d1\u8fd8\u662f\u7ee7\u7eed\u4ea4\u7ed9\u4e0a\u5c42\u5904\u7406\uff0c\u5982\u679c\u786e\u8ba4\u662f\u53d1\u7ed9\u672c\u673a\u7684\u5305\uff0c\u90a3\u4e48\u5c31\u68c0\u67e5\u4e0a\u5c42\u534f\u8bae\u7684\u7c7b\u578b\uff08\u662f UDP \u8fd8\u662f TCP\uff09\uff0c\u540c\u6837\u89e3\u5c01\u88c5\uff0c\u53bb\u6389 IP \u5934\uff0c\u4ea4\u7ed9\u4f20\u8f93\u5c42\u3002 \u4f20\u8f93\u5c42 \u53d6\u51fa TCP \u5934\u6216 UDP \u5934\uff0c\u6839\u636e <\u6e90IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684IP\u3001\u76ee\u7684\u7aef\u53e3> \u56db\u5143\u7ec4\uff0c\u627e\u51fa\u5bf9\u5e94\u7684 socket\uff0c\u628a\u6570\u636e\u62f7\u8d1d\u5230 socket \u7684\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\u3002 \u5e94\u7528\u5c42 \u7a0b\u5e8f\u5c31\u53ef\u4ee5\u4f7f\u7528 socket \u63a5\u53e3\uff0c\u8bfb\u53d6\u5230\u63a5\u6536\u5230\u7684\u6570\u636e\u4e86\u3002 \u53d1\u5305\u6d41\u7a0b\uff1a \u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 socket API \u53d1\u9001\u7f51\u7edc\u5305 \u7531\u4e8e\u7cfb\u7edf\u8c03\u7528\u4f1a\u9677\u5165\u5230\u5185\u6838\u7684\u5957\u63a5\u5b57\u5c42\u4e2d\uff0c\u5957\u63a5\u5b57\u5c42\u4f1a\u5c06\u6570\u636e\u653e\u5230 socket \u53d1\u9001\u7f13\u51b2\u533a\u4e2d \u7f51\u7edc\u534f\u8bae\u6808\u4ece socket \u7f13\u51b2\u533a\u53d6\u51fa\u6570\u636e\uff0c\u518d\u6309\u7167 \u534f\u8bae\u6808\uff0c\u81ea\u4e0a\u800c\u4e0b\u5730\u9010\u5c42\u5904\u7406\u6570\u636e\u5305\u3002 \u8fd9\u4e00\u5207\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5305\u88ab\u9001\u5230\u53d1\u9001\u961f\u5217\u4e2d\uff0c\u4f1a\u89e6\u53d1\u8f6f\u4e2d\u65ad\u901a\u77e5\u9a71\u52a8\u7a0b\u5e8f\uff0c\u6709\u5305\u9700\u8981\u53d1\u9001\u3002 \u9a71\u52a8\u7a0b\u5e8f\u518d\u901a\u8fc7 DMA \uff0c\u4ece\u53d1\u5305\u961f\u5217\u4e2d\u8bfb\u51fa\u7f51\u7edc\u5305\uff0c\u7ee7\u800c\u901a\u8fc7\u7269\u7406\u7f51\u5361\u53d1\u9001\u51fa\u53bb\u3002","title":"Linux \u7f51\u7edc\u6536\u53d1\u6d41\u7a0b"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#34-linux","text":"","title":"34 Linux \u7f51\u7edc\u6027\u80fd\u5206\u6790\u6307\u6807\u548c\u5de5\u5177"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_10","text":"\u8bf4\u5230\u7f51\u7edc\u6027\u80fd\u4f18\u5316\uff0c\u6709\u54ea\u4e9b\u53ef\u8861\u91cf\u7684\u6307\u6807\u5462\uff1f \u5e38\u7528\u7684\u6307\u6807\u65e0\u5916\u4e4e\u56db\u4e2a\uff1a\u5e26\u5bbd\u3001\u541e\u5410\u91cf\u3001\u5ef6\u65f6\u3001PPS\uff08Packet Per Second\uff09\u3002 \u5e26\u5bbd\uff1a \u8868\u793a\u94fe\u8def\u6700\u5927\u7684\u4f20\u8f93\u901f\u7387\uff0c\u5355\u4f4d\u901a\u5e38\u662f b/s\uff08\u6bd4\u7279/s\uff09 \u541e\u5410\u91cf\uff1a \u8868\u793a\u5355\u4f4d\u65f6\u95f4\u5185\u6210\u529f\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff0c\u5355\u4f4d\u901a\u5e38\u662f b/s\uff08\u6bd4\u7279/s\uff09 \u6216 B/s\uff08\u5b57\u8282/\u79d2\uff09\uff0c \u5ef6\u65f6\uff1a \u8868\u793a\u4ece\u7f51\u7edc\u8bf7\u6c42\u53d1\u51fa\u540e\uff0c\u4e00\u76f4\u5230\u6536\u5230\u8fdc\u7aef\u54cd\u5e94\uff0c\u6240\u9700\u8981\u7684\u65f6\u95f4\u3002 PPS\uff1a \u8868\u793a\u4ee5\u7f51\u7edc\u5305\u4e3a\u5355\u4f4d\u7684\u4f20\u8f93\u901f\u7387\uff0c\u5355\u4f4d\u662f Packet/s\uff08\u5305/\u79d2\uff09\uff0c\u7528\u4ee5\u8861\u91cf\u7f51\u7edc\u7684\u8f6c\u53d1\u80fd\u529b\u3002 \u9664\u4e86\u4ee5\u4e0a\u56db\u4e2a\u5e38\u7528\u7684\u6307\u6807\u4e4b\u5916\uff0c\u8fd8\u6709\uff1a \u7f51\u7edc\u7684\u53ef\u7528\u6027\uff08\u7f51\u7edc\u662f\u5426\u80fd\u6b63\u5e38\u901a\u4fe1\uff09 \u5e76\u53d1\u8fde\u63a5\u6570\uff08TCP\u8fde\u63a5\u6570\u91cf\uff09 \u4e22\u5305\u6570\uff08\u4e22\u5305\u767e\u5206\u6bd4\uff09 \u91cd\u4f20\u7387\uff08\u91cd\u65b0\u4f20\u8f93\u7684\u7f51\u7edc\u5305\u6bd4\u4f8b\uff09","title":"\u6027\u80fd\u6307\u6807"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_11","text":"\u5de5\u5177\uff1a ip ifconfig","title":"\u7f51\u7edc\u914d\u7f6e"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_12","text":"netstat ss \u66f4\u63a8\u8350\u4f7f\u7528 ss\uff0c\u56e0\u4e3a\u5b83\u6bd4 netstat \u901f\u5ea6\u66f4\u5feb\u3002 \u5982\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a # head -n 3 \u8868\u793a\u53ea\u663e\u793a\u524d\u9762 3 \u884c # -l \u8868\u793a\u53ea\u663e\u793a\u76d1\u542c\u5957\u63a5\u5b57 # -n \u8868\u793a\u663e\u793a\u6570\u5b57\u5730\u5740\u548c\u7aef\u53e3 (\u800c\u4e0d\u662f\u540d\u5b57) # -p \u8868\u793a\u663e\u793a\u8fdb\u7a0b\u4fe1\u606f $ netstat -nlp | head -n 3 Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127.0.0.53:53 0.0.0.0:* LISTEN 840/systemd-resolve # -l \u8868\u793a\u53ea\u663e\u793a\u76d1\u542c\u5957\u63a5\u5b57 # -t \u8868\u793a\u53ea\u663e\u793a TCP \u5957\u63a5\u5b57 # -n \u8868\u793a\u663e\u793a\u6570\u5b57\u5730\u5740\u548c\u7aef\u53e3 (\u800c\u4e0d\u662f\u540d\u5b57) # -p \u8868\u793a\u663e\u793a\u8fdb\u7a0b\u4fe1\u606f $ ss -ltnp | head -n 3 State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 128 127.0.0.53%lo:53 0.0.0.0:* users:((\"systemd-resolve\",pid=840,fd=13)) LISTEN 0 128 0.0.0.0:22 0.0.0.0:* users:((\"sshd\",pid=1459,fd=3)) \u5f53\u5957\u63a5\u5b57\u5904\u4e8e\u8fde\u63a5\u72b6\u6001\uff08Established\uff09\u65f6: Recv-Q \u8868\u793a\u5957\u63a5\u5b57\u7f13\u51b2\u8fd8\u6ca1\u6709\u88ab\u5e94\u7528\u7a0b\u5e8f\u53d6\u8d70\u7684\u5b57\u8282\u6570\uff08\u5373\u63a5\u6536\u961f\u5217\u957f\u5ea6\uff09 Send-Q \u8868\u793a\u8fd8\u6ca1\u6709\u88ab\u8fdc\u7aef\u4e3b\u673a\u786e\u8ba4\u7684\u5b57\u8282\u6570\uff08\u5373\u53d1\u9001\u961f\u5217\u957f\u5ea6\uff09 \u5f53\u5957\u63a5\u5b57\u5904\u4e8e\u76d1\u542c\u72b6\u6001\u65f6\uff1a Recv-Q \u8868\u793a syn backlog \u7684\u5f53\u524d\u503c Send-Q \u8868\u793a\u6700\u5927\u7684 syn backlog \u503c syn backlog \u662f TCP \u534f\u8bae\u6808\u4e2d\u7684\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\uff0c\u76f8\u5e94\u7684\u4e5f\u6709\u4e00\u4e2a\u5168\u8fde\u63a5\u961f\u5217\uff08accept queue\uff09\uff0c\u5b83\u4eec\u90fd\u662f\u7ef4\u62a4 TCP \u72b6\u6001\u7684\u91cd\u8981\u673a\u5236\u3002","title":"\u5957\u63a5\u5b57\u4fe1\u606f"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_13","text":"\u540c\u6837\u9002\u7528 netstat\uff0css\uff1a $ netstat -s ... Tcp: 3244906 active connection openings 23143 passive connection openings 115732 failed connection attempts 2964 connection resets received 1 connections established 13025010 segments received 17606946 segments sent out 44438 segments retransmitted 42 bad segments received 5315 resets sent InCsumErrors: 42 ... $ ss -s Total: 186 (kernel 1446) TCP: 4 (estab 1, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 0 Transport Total IP IPv6 * 1446 - - RAW 2 1 1 UDP 2 2 0 TCP 4 3 1 ... ss \u53ea\u663e\u793a\u5df2\u7ecf\u8fde\u63a5\u3001\u5173\u95ed\u3001\u5b64\u513f\u5957\u63a5\u5b57\u7b49\u7b80\u8981\u7edf\u8ba1 netstat \u5219\u63d0\u4f9b\u7684\u662f\u66f4\u8be6\u7ec6\u7684\u7f51\u7edc\u534f\u8bae\u6808\u4fe1\u606f","title":"\u534f\u8bae\u6808\u7edf\u8ba1\u4fe1\u606f"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#pps","text":"\u63a8\u8350\u4f7f\u7528 sar -n \uff1a # \u6570\u5b57 1 \u8868\u793a\u6bcf\u9694 1 \u79d2\u8f93\u51fa\u4e00\u7ec4\u6570\u636e $ sar -n DEV 1 Linux 4.15.0-1035-azure (ubuntu) 01/06/19 _x86_64_ (2 CPU) 13:21:40 IFACE rxpck/s txpck/s rxkB/s txkB/s rxcmp/s txcmp/s rxmcst/s %ifutil 13:21:41 eth0 18.00 20.00 5.79 4.25 0.00 0.00 0.00 0.00 13:21:41 docker0 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 13:21:41 lo 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 rxpck/s \u548c txpck/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 PPS \u3002 rxkB/s \u548c txkB/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 \u541e\u5410\u91cf \uff0c\u5355\u4f4d\u662f KB/\u79d2 rxcmp/s \u548c txcmp/s \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 \u538b\u7f29\u6570\u636e\u5305\u6570 \uff0c\u5355\u4f4d\u662f\u5305/\u79d2\u3002 %ifutil \u662f\u7f51\u7edc\u63a5\u53e3\u7684\u4f7f\u7528\u7387\uff0c\u5373\u534a\u53cc\u5de5\u6a21\u5f0f\u4e0b\u4e3a (rxkB/s+txkB/s)/Bandwidth\uff0c\u800c\u5168\u53cc\u5de5\u6a21\u5f0f\u4e0b\u4e3a max(rxkB/s, txkB/s)/Bandwidth \u5e26\u5bbd\uff08Bandwidth\uff09\u53ef\u4ee5\u7528 ethtool \u5de5\u5177\u67e5\u8be2\uff0c\u5355\u4f4d\u901a\u5e38\u662f Gb/s \u6216\u8005 Mb/s\uff08\u5c0f\u5199 b\uff09\uff0c\u67e5\u8be2\u7f51\u5361\u5e26\u5bbd\uff1a $ ethtool eth0 | grep Speed Speed: 1000Mb/s","title":"\u7f51\u7edc\u541e\u5410\u548c PPS"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_14","text":"\u901a\u5e38\u4f7f\u7528 ping\uff1a # -c3 \u8868\u793a\u53d1\u9001\u4e09\u6b21 ICMP \u5305\u540e\u505c\u6b62 $ ping -c3 114.114.114.114 PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data. 64 bytes from 114.114.114.114: icmp_seq=1 ttl=54 time=244 ms 64 bytes from 114.114.114.114: icmp_seq=2 ttl=47 time=244 ms 64 bytes from 114.114.114.114: icmp_seq=3 ttl=67 time=244 ms --- 114.114.114.114 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2001ms rtt min/avg/max/mdev = 244.023/244.070/244.105/0.034 ms","title":"\u8fde\u901a\u6027\u548c\u5ef6\u65f6"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#35-c10k-c100kc10m","text":"","title":"35 C10K \u3001C100K\u3001C10M \u95ee\u9898"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#c10k-1","text":"","title":"C10K \u5355\u673a\u652f\u6301 1\u4e07\u5e76\u53d1\u8bf7\u6c42"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#c100k-10","text":"","title":"C100K \u5355\u673a\u652f\u630110\u4e07\u5e76\u53d1\u8bf7\u6c42"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#55","text":"","title":"55 \u5206\u6790\u6027\u80fd\u7684\u4e00\u822c\u5957\u8def"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_15","text":"","title":"\u7cfb\u7edf\u8d44\u6e90\u74f6\u9888"},{"location":"linux/Linux\u6027\u80fd\u4f18\u5316/#_16","text":"","title":"\u5e94\u7528\u7a0b\u5e8f\u74f6\u9888"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/","text":"01 \u5f00\u7bc7\u4ecb\u7ecd 03 \u5b66\u4e60\u8def\u5f84 04 \u8ba4\u8bc6 Linux \u5185\u6838\u4ee3\u7801 05 \u5feb\u901f\u4e0a\u624b Linux \u547d\u4ee4 \u7528\u6237\u540d\u548c\u5bc6\u7801 \u6d4f\u89c8\u6587\u4ef6 \u5b89\u88c5\u8f6f\u4ef6 \u5f00\u5173\u673a \u4e00\u56fe\u603b\u7ed3\u4e4b 05 \u7cfb\u7edf\u8c03\u7528 \u4e00\u56fe\u603b\u7ed3 06 x86 \u4f53\u7cfb\u67b6\u6784 07 Linux \u542f\u52a8\u8fc7\u7a0b 08 \u5185\u6838\u521d\u59cb\u5316 09 \u7cfb\u7edf\u8c03\u7528 10 \u8fdb\u7a0b 11 \u7ebf\u7a0b 12 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784 13 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e2d\uff09 \u52a0\u9910\uff08\u4e00\uff09\u5b66\u4e60\u653b\u7565 14 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e0b\uff09 15 \u8c03\u5ea6\uff08\u4e0a\uff09 16 \u8c03\u5ea6\uff08\u4e2d\uff09 17 \u8c03\u5ea6\uff08\u4e0b\uff09 18 \u8fdb\u7a0b\u7684\u521b\u5efa 19 \u7ebf\u7a0b\u7684\u521b\u5efa 20 \u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09\uff1a\u89c4\u5212\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u5e03\u5c40 21 \u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09 22 \u8fdb\u7a0b\u7a7a\u95f4\u7ba1\u7406 23 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09 24 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09 25 \u7528\u6237\u6001\u5185\u5b58\u6620\u5c04 26 \u5185\u6838\u6001\u5185\u5b58\u6620\u5c04 27 \u6587\u4ef6\u7cfb\u7edf 28 \u786c\u76d8\u6587\u4ef6\u7cfb\u7edf 01 \u5f00\u7bc7\u4ecb\u7ecd \u5f00\u7bc7\u8bcd\u5c31\u662f\u603b\u7ed3\u4e86\u63a5\u4e0b\u6765\u8981\u5b66\u4e60\u7684\u4e1c\u897f\u3002\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u95e8\u8bfe\u6709\u4ee5\u4e0b\u4eae\u70b9\uff1a \u6709\u6df1\u5ea6\uff08\u5176\u4e2d\u6d89\u53ca\u5230 Linux \u5185\u6838\u6e90\u7801\u89e3\u6790\uff09 \u6709\u5e7f\u5ea6\uff08\u4ece Linux \u57fa\u7840\uff0c\u8c08\u5230\u5185\u6838\uff0c\u5230\u865a\u62df\u5316\uff0c\u5230\u5bb9\u5668\u3001\u96c6\u7fa4\u3001\u6570\u636e\u4e2d\u5fc3\u64cd\u4f5c\u7cfb\u7edf\u7b49\uff09 \u6709\u8da3\u5473\uff08\u7c7b\u6bd4\u4e8e\u4e00\u5bb6\u516c\u53f8\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u8fd9\u5bb6\u516c\u53f8\u7684\u8001\u677f\uff09 \u56fe\u6587\u5e76\u8302 \u5f00\u7bc7\u653e\u51fa\u4e86\u4e00\u5f20 Linux \u64cd\u4f5c\u7cfb\u7edf\u5168\u666f\u56fe\uff08\u6df1\u5165\u5230\u4ee3\u7801\uff09\uff0c\u5982\u4e0b\uff1a \u8fd9\u5f20\u56fe\u5c55\u793a\u4e86\u8fdb\u7a0b\u3001\u6587\u4ef6\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u786c\u76d8\u4e4b\u95f4\u7684\u4e00\u4e2a\u5173\u7cfb\uff08Linux\u7684\u54f2\u5b66\u4e4b\u4e00\u5c31\u662f\u4e00\u5207\u7686\u6587\u4ef6\uff09\uff0c\u8fd9\u91cc\u9762\u6d89\u53ca\u5230\u5185\u6838\u4ee3\u7801\u7ed3\u6784\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u6570\u636e\u7ed3\u6784\u62fc\u63a5\u8d77\u6765\uff0c\u60f3\u8c61\u4e00\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u90a3\u4e48\u591a\u7ec4\u4ef6\uff0c\u600e\u4e48\u6837\u5f88\u597d\u5730\u7ba1\u7406\u8fd9\u4e9b\u7ec4\u4ef6\uff0c\u5c31\u662f\u628a\u4ed6\u4eec\u5b9a\u4e49\u6210\u4e00\u4e2a\u4e2a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u6709\u5173\u7cfb\u7684\u5c31\u8fde\u63a5\u8d77\u6765\u3002 03 \u5b66\u4e60\u8def\u5f84 \u4e00\u56fe\u80dc\u5343\u8a00 04 \u8ba4\u8bc6 Linux \u4ece\u7535\u8111\u7ec4\u88c5\u8bf4\u8d77\u3002\u4e00\u53f0\u7535\u8111\u786c\u4ef6\u4e0a\u6765\u8bf4\u81f3\u5c11\u5e94\u8be5\u5305\u62ec\u4ee5\u4e0b\u7ec4\u4ef6\uff0c\u624d\u80fd\u6ee1\u8db3\u6211\u4eec\u4e2a\u4eba\u7684\u4f7f\u7528\u9700\u6c42\u3002 \u5149\u6709\u8fd9\u4e9b\u786c\u4ef6\u8bbe\u5907\u4e5f\u73a9\u4e0d\u8f6c\u4e00\u53f0\u7535\u8111\uff0c\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5927\u8111\u7684\u4e1c\u897f\u6765\u6307\u6325\u8fd9\u4e9b\u786c\u4ef6\u624d\u884c\uff0c\u8fd9\u4e2a\u5927\u8111\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u3002 \u64cd\u4f5c\u7cfb\u7edf\u8981\u7ba1\u7406\u4e0d\u540c\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u5c31\u9700\u8981\u6709\u4e0d\u540c\u7684\u6a21\u5757\u7ec4\u4ef6\uff0c\u5c31\u50cf\u4e00\u4e2a\u7ec4\u7ec7\u9700\u8981\u8bbe\u5b9a\u51e0\u4e2a\u4e0d\u540c\u7684\u8d1f\u8d23\u4eba\u4e00\u6837\u3002\u4ece\u529f\u80fd\u548c\u7ba1\u7406\u5bf9\u8c61\u4e0a\u8bf4\uff0c\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u5927\u7c7b\uff08\u64cd\u4f5c\u7cfb\u7edf\u4f53\u7cfb\u7ed3\u6784\u56fe\uff09\uff1a \u4e0a\u9762\u8fd9\u5e45\u56fe\u5173\u6ce8\u70b9\u5728\u4e8e\u5185\u6838\u6001\uff0c\u5bf9\u4e8e\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u5e94\u8be5\u5305\u62ec\u7528\u6237\u6001\uff0c\u4ee5\u53ca\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u4ea4\u4e92\u6a21\u5757\uff0c\u4e0b\u9762\u8fd9\u5e45\u56fe\u5305\u542b\u4e86\u8fd9\u4e00\u5207\uff0c\u800c\u4e14\u8fd8\u5305\u62ec\u4e86\u786c\u4ef6\u90e8\u5206\uff0c\u975e\u5e38\u5b8c\u6574\uff1a \u5185\u6838\u4ee3\u7801 \u5982\u4f55\u627e Linux \u5185\u6838\u4ee3\u7801\uff1f Linux \u5185\u6838\u6e90\u7801\u94fe\u63a5\uff1a https://www.kernel.org/ \u5728\u91cc\u9762\u627e\u5230 kernel/git/torvalds/linux.git \u5373\u53ef\u4e0b\u8f7d \u63a8\u8350\u4e00\u4e2a \u5728\u7ebf\u9605\u8bfb\u6e90\u7801 \u7684\u7f51\u7ad9\uff08\u975e\u5e38\u8d5e\uff09\uff1a https://elixir.bootlin.com/linux/latest/source \u5185\u6838\u4ee3\u7801\u7ed3\u6784\u5982\u4f55\u4f53\u73b0\u51fa\u4e0a\u9762\u7684\u51e0\u5927\u5b50\u7cfb\u7edf\u7684\uff1f \u4ee5 Linux 3.0 \u4e3a\u4f8b\u770b\u770b\u5b83\u7684\u4ee3\u7801\u7ed3\u6784\uff1a \u76ee\u5f55 \u63cf\u8ff0 arch \u5305\u542b\u548c\u786c\u4ef6\u4f53\u7cfb\u7ed3\u6784\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u6bcf\u79cd\u5e73\u53f0\u5360\u4e00\u4e2a\u76f8\u5e94\u7684\u76ee\u5f55\uff0c\u5982 i386\u3001 ARM\u3001PowerPC\u3001MIPS \u7b49\u3002 block \u5757\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f I/O \u6a21\u5757\u3002 crypto \u5e38\u7528\u52a0\u5bc6\u548c\u6563\u5217\u7b97\u6cd5\uff08\u5982 AES\u3001SHA \u7b49\uff09\uff0c\u8fd8\u6709\u4e00\u4e9b\u538b\u7f29\u548c CRC \u6821 \u9a8c\u7b97\u6cd5\u3002 Documentation \u5185\u6838\u6e90\u7801\u6587\u6863 drivers \u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff0c\u6bcf\u4e2a\u4e0d\u540c\u7684\u9a71\u52a8\u5360\u7528\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u5982 char\u3001block\u3001net\u3001 mtd\u3001i2c \u7b49\u3002 firmware \u4f7f\u7528\u67d0\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u800c\u9700\u8981\u7684\u8bbe\u5907\u56fa\u4ef6 fs vfs \u548c \u652f\u6301\u7684\u5404\u79cd\u6587\u4ef6\u7cfb\u7edf\uff0c\u5982 EXT\u3001FAT\u3001NTFS\u3001JFFS2 \u7b49\u3002 include \u5185\u6838 \u5934\u6587\u4ef6\uff0c\u4e0e\u7cfb\u7edf\u76f8\u5173\u7684\u5934\u6587\u4ef6\u88ab\u653e\u7f6e\u5728 include/linux \u5b50\u76ee\u5f55\u4e0b init \u5185\u6838\u5f15\u5bfc\u548c\u521d\u59cb\u5316\u4ee3\u7801 ipc \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u4ee3\u7801 kernel \u5185\u6838\u7684\u6700\u6838\u5fc3\u90e8\u5206\uff0c\u5305\u62ec\u8fdb\u7a0b\u8c03\u5ea6\u3001\u5b9a\u65f6\u5668\u7b49\uff0c\u800c\u548c\u5e73\u53f0\u76f8\u5173\u7684\u4e00 \u90e8\u5206\u4ee3\u7801\u653e\u5728 arch/*/kernel \u76ee\u5f55\u4e0b lib \u5e93\u6587\u4ef6\u4ee3\u7801\uff0c\u901a\u7528\u5185\u6838\u51fd\u6570 mm \u5185\u5b58\u7ba1\u7406\u5b50\u7cfb\u7edf\u4ee3\u7801\uff0c\u548c\u5e73\u53f0\u76f8\u5173\u7684\u4e00\u90e8\u5206\u4ee3\u7801\u653e\u5728 arch/*/mm \u76ee\u5f55\u4e0b net \u7f51\u7edc\u5b50\u7cfb\u7edf\u76f8\u5173\u4ee3\u7801\uff0c\u5b9e\u73b0\u4e86\u5404\u79cd\u5e38\u89c1\u7684\u7f51\u7edc\u534f\u8bae samples \u793a\u4f8b\uff0c\u793a\u8303\u4ee3\u7801 scripts \u7f16\u8bd1\u5185\u6838\u6240\u7528\u7684\u811a\u672c\u6587\u4ef6 security Linux \u5b89\u5168\u6a21\u5757\uff0c \u4e3b\u8981\u5305\u542b SELinux \u6a21\u5757\u3002 sound \u97f3\u9891\u5b50\u7cfb\u7edf\uff0c ALSA\u3001OSS \u97f3\u9891\u8bbe\u5907\u7684\u9a71\u52a8\u6838\u5fc3\u4ee3\u7801\u548c\u5e38\u7528\u8bbe\u5907\u9a71\u52a8\u3002 usr \u65e9\u671f\u7528\u6237\u7a7a\u95f4\u4ee3\u7801\uff08\u6240\u8c13\u7684initramfs\uff09\uff0c \u5b9e\u73b0\u4e86\u7528\u4e8e\u6253\u5305\u548c\u538b\u7f29\u7684 cpio \u7b49 tools \u5728 Linux \u5f00\u53d1\u4e2d\u6709\u7528\u7684\u5de5\u5177 virt \u865a\u62df\u5316\u57fa\u7840\u7ed3\u6784 05 \u5feb\u901f\u4e0a\u624b Linux \u547d\u4ee4 \u7528\u6237\u540d\u548c\u5bc6\u7801 \u914d\u7f6e root \u5bc6\u7801\uff1a passwd \u6216 passwd root \uff08 passwd <user> \uff09 \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\uff1a useradd jay \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\u5e76\u52a0\u5230\u67d0\u4e2a\u7ec4\u91cc\uff1a useradd jay -g <gid> /etc/passwd \u548c /etc/group \u4e2d\u80fd\u591f\u770b\u5230\u7528\u6237\u5bc6\u7801\u548c\u7528\u6237\u7ec4\u7684\u4fe1\u606f \u6d4f\u89c8\u6587\u4ef6 ls -l drwxr-xr-x 6 root root 4096 Oct 20 2017 apt -rw-r--r-- 1 root root 211 Oct 20 2017 hosts \u7b2c\u4e00\u4e2a\u5b57\u6bb5\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26 - \u8868\u793a\u666e\u901a\u6587\u4ef6\uff0c d \u8868\u793a\u76ee\u5f55\u6587\u4ef6\uff0c l \u8868\u793a\u8fde\u63a5\u6587\u4ef6 \u63a5\u7740\u540e\u9762 9 \u4e2a\u5b57\u7b26\u8868\u793a\u6a21\u5f0f\uff08\u6743\u9650\u4f4d\uff09\uff0c\u524d\u9762 3 \u4e2a\u662f\u6240\u5c5e\u7528\u6237\u7684\u8bfb\u5199\u6267\u884c\u6743\u9650\uff0c\u4e2d\u95f4 3 \u4e2a\u662f\u7528\u6237\u6240\u5c5e\u7ec4\u7684\uff0c\u540e\u9762 3 \u4e2a\u662f\u5176\u4ed6\u7528\u6237\u7684\u3002\u6539\u53d8\u6743\u9650\u4f7f\u7528 chmod 711 <file> \u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u662f\u786c\u94fe\u63a5\u6570\u76ee \u7b2c\u4e09\u4e2a\u5b57\u6bb5\u662f\u6240\u5c5e\u7528\u6237 \u7b2c\u56db\u4e2a\u5b57\u6bb5\u662f\u6240\u5c5e\u7528\u6237\u7ec4 \u7b2c\u4e94\u4e2a\u5b57\u6bb5\u662f\u6587\u4ef6\u5927\u5c0f \u7b2c\u516d\u4e2a\u5b57\u6bb5\u662f\u6587\u4ef6\u88ab\u4fee\u6539\u7684\u65e5\u671f \u6700\u540e\u662f\u6587\u4ef6\u540d chmod \u6539\u53d8\u6587\u4ef6\u6743\u9650\uff0c chown \u6539\u53d8\u6240\u5c5e\u7528\u6237\uff0c chgrp \u6539\u53d8\u6240\u5c5e\u7ec4\u3002 # \u5c06\u6587\u4ef6 file.txt \u7684\u62e5\u6709\u8005\u6539\u4e3a root\uff0c\u8fd9\u4e2a\u547d\u4ee4\u9700\u8981\u6709\u8d85\u7ea7\u7528\u6237\u6743\u9650\u624d\u80fd\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u547d\u4ee4\u4e4b\u524d\u52a0\u4e0asudo sudo chown root file.txt # \u6539\u53d8\u6587\u4ef6\u7684\u62e5\u6709\u7ec4\u4e3aroot\u7ec4 sudo chgrp root file.txt # \u5c06\u6587\u4ef6\u7684\u6240\u5c5e\u7ec4\u7531 root \u6539\u4e3a tim chgrp -v tim file.txt \u5b89\u88c5\u8f6f\u4ef6 \u76f8\u5bf9\u4e8e Windows \u7684 exe \u3001 zip \u7b49\u5305\uff0cLinux \u5e38\u7528\u6709 rpm \uff08Centos \u7cfb\uff09\u3001 deb \uff08Ubuntu \u7cfb\uff09 \u548c tar.gz \u7b49\u5305\u3002 rpm \u548c deb # centos rpm rpm -i jdk-XXX_linux-x64_bin.rpm # ubuntu deb dpkg -i jdk-xxx_linux-x64_bin.deb # \u67e5\u770b\u5b89\u88c5\u8f6f\u4ef6\u5217\u8868 rpm -qa dpkg -l # \u7ffb\u9875 rpm -qa | more rpm -qa | less # \u52a0\u641c\u7d22 rpm -qa | grep jdk dpkg -l | grep jdk # \u5220\u9664 rpm -e dpkg -r Linux \u8f6f\u4ef6\u7ba1\u5bb6\uff1a yum \u548c apt-get # \u641c\u7d22\u8f6f\u4ef6 yum search jdk apt-cache search jdk # \u5b89\u88c5 yum install java-11-openjdk.x86_64 apt-get install openjdk-9-jdk \u914d\u7f6e\u8f6f\u4ef6\u6e90\uff1a\u56fd\u5185\u5e38\u7528\u662f \u963f\u91cc\u6e90 \u548c 163\u6e90 \u3002\uff08\u7528\u5230\u65f6\u641c\u7d22\u5373\u53ef\uff09 centos\uff1a /etc/yum.repos.d/CentOS-Base.repo ubuntu: /etc/apt/sources.list \u5305\u4e0b\u8f7d\u548c\u538b\u7f29\u89e3\u538b\u7f29 # \u4e0b\u8f7d wget # \u538b\u7f29\u89e3\u538b\u7f29 yum install zip.x86_64 unzip.x86_64 apt-get install zip unzip unzip <xx.zip> tar zxvf jdk-XXX_linux-x64_bin.tar.gz \u8fd0\u884c\u7a0b\u5e8f # 01 \u76f4\u63a5\u8fd0\u884c <command> \u6216\u8005 <./command> # 02 \u540e\u53f0\u8fd0\u884c nohup <command> >out.file 2>&1 & # \u540e\u53f0\u8fdb\u7a0b\u5173\u95ed ps -ef |grep \u5173\u952e\u5b57 |awk '{print $2}'|xargs kill -9 # 03 \u4ee5\u670d\u52a1\u7684\u65b9\u5f0f\u8fd0\u884c /lib/systemd/system # \u6bd4\u5982 mysql apt-get install mysql-server # \u5b89\u88c5 systemctl start mysql # \u542f\u52a8 systemctl enable mysql # \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8 # centos \u4e2d MySQL \u662f MariaDB\u3002/usr/lib/systemd/system/ \u5f00\u5173\u673a # \u5173\u673a shutdown -h now poweroff # \u91cd\u542f reboot \u4e00\u56fe\u603b\u7ed3\u4e4b 05 \u7cfb\u7edf\u8c03\u7528 \u8fdb\u7a0b\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\uff1a fork\uff1a\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u8fd4\u56de\u4e24\u4e2a\u503c\uff0c\u5982\u679c\u662f 0\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c >0 \u8868\u793a\u7236\u8fdb\u7a0b\uff0c\u503c\u662f\u5b50\u8fdb\u7a0b\u7684 ID\u3002 execve\uff1a\u521b\u5efa\u51fa\u7684\u5b50\u8fdb\u7a0b\u6267\u884c\u7684\u7cfb\u7edf\u8c03\u7528\uff08\u6709\u4e00\u5957\u51fd\u6570\u96c6\uff09\u3002 waitpid\uff1a\u7236\u8fdb\u7a0b\u76d1\u542c\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u60c5\u51b5\u3002 \u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u67e5\u8be2\u66f4\u52a0\u8be6\u7ec6\u7684\u4fe1\u606f: $ps -o pid,pgid,ppid,sid,tty,comm (tty\u8868\u793a\u63a7\u5236\u7ec8\u7aef\uff09 \u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\uff1a \u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u7cfb\u7edf\u8c03\u7528\uff1a brk\uff1a\u5f53\u5206\u914d\u5185\u5b58\u91cf\u5c0f\u7684\u65f6\u5019\uff08\u5177\u4f53\u662f 128K\uff09\u4f7f\u7528\uff1b mmap\uff1a\u5f53\u5206\u914d\u5185\u5b58\u91cf\u5927\u4e8e 128K \u65f6\u4f7f\u7528\uff0c\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u907f\u514d \u5185\u5b58\u788e\u7247 \u7684\u95ee\u9898\u3002\u53c2\u8003 \u8fd9\u91cc \u5f02\u5e38\u4e0e\u4fe1\u53f7\u5904\u7406\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\uff1a kill\uff1a\u7528\u6237\u8fdb\u7a0b\u53d1\u9001\u4e00\u4e2a\u9000\u51fa\u4fe1\u53f7\u7ed9\u53e6\u4e00\u4e2a\u8fdb\u7a0b sigaction\uff1a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff08\u65e0\u89c6(ignore)\u4fe1\u53f7\u3001\u9ed8\u8ba4(default)\u64cd\u4f5c\u3001\u81ea\u5b9a\u4e49\u64cd\u4f5c\uff09 $man 7 signal \u67e5\u9605\u66f4\u591a\u7684\u4fe1\u53f7\u3002\u4e00\u4e9b\u5e38\u7528\u7684\u4fe1\u53f7\uff1a SIGINT \u5f53\u952e\u76d8\u6309\u4e0b CTRL+C \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u4e2d\u65ad (INTERRUPT) \u8be5\u8fdb\u7a0b\u3002 SIGQUIT \u5f53\u952e\u76d8\u6309\u4e0b CTRL+\\ \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u9000\u51fa (QUIT) \u8be5\u8fdb\u7a0b\u3002 SIGTSTP \u5f53\u952e\u76d8\u6309\u4e0b CTRL+Z \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u6682\u505c (STOP) \u8be5\u8fdb\u7a0b\u3002 SIGCONT \u7528\u4e8e\u901a\u77e5\u6682\u505c\u7684\u8fdb\u7a0b\u7ee7\u7eed\u3002 SIGALRM \u8d77\u5230\u5b9a\u65f6\u5668\u7684\u4f5c\u7528\uff0c\u901a\u5e38\u662f\u7a0b\u5e8f\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\u4e4b\u540e\u624d\u751f\u6210\u8be5\u4fe1\u53f7\u3002 \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7cfb\u7edf\u8c03\u7528\uff1a \u6d88\u606f\u961f\u5217\uff1amsgget\uff08\u521b\u5efa\uff09\u3001msgsnd\uff08\u53d1\u9001\uff09\u3001msgrcv\uff08\u63a5\u6536\uff09 \u5171\u4eab\u5185\u5b58\uff08\u901a\u4fe1\u91cf\u5927\uff09\uff1ashmget\uff08\u521b\u5efa\uff09\u3001shmat\uff08\u6620\u5c04\u5171\u4eab\u5185\u5b58\uff09 \u4fe1\u53f7\u91cf\uff08\u8d44\u6e90\u8bbf\u95ee\u7ade\u4e89\uff09\uff1asem_wait\uff08\u5360\u7528\u8d44\u6e90\uff09\u3001sem_post\uff08\u91ca\u653e\u8d44\u6e90\uff09 \u7ba1\u9053\uff08\u65e0\u540d\u7ba1\u9053\u548c\u547d\u540d\u7ba1\u9053\uff09 Socket \u53c2\u8003 \u8fd9\u91cc C \u51fd\u6570\u5e93\uff08glibc\uff09\u548c\u7cfb\u7edf\u8c03\u7528\u7684\u5173\u7cfb\uff1a C \u51fd\u6570\u5e93\u662f\u5bf9\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u76ee\u7684\u662f\u4ee5\u4e00\u79cd\u66f4\u53cb\u597d\u7684\u65b9\u5f0f\u4f9b\u4e0a\u5c42\u7528\u6237\u7684\u8c03\u7528\u3002\u7cfb\u7edf\u8c03\u7528\u66f4\u50cf\u662f\u7ec4\u6210\u4e00\u4e2a\u6c49\u5b57\u7684 \u7b14\u753b \uff0c\u800c\u5e93\u51fd\u6570\u5219\u50cf \u504f\u65c1\u90e8\u9996 \u3002\u6bd4\u5982 glibc \u4e2d\u7684 printf \u51fd\u6570\u5c31\u4f1a\u8c03\u7528 sys_open \u3001 sys_mmap \u3001 sys_write \u3001 sys_close \u7b49\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002malloc \u51fd\u6570\u4e5f\u4f1a\u8fdb\u4e00\u6b65\u8c03\u7528\u5230 sys_brk \u7b49\u51fd\u6570\u3002 Tips\uff1a $man 2 syscalls \u53ef\u4ee5\u67e5\u770b\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\uff0c $man 2 read \u67e5\u770b\u7cfb\u7edf\u8c03\u7528 read \u7684\u8be6\u7ec6\u8bf4\u660e\u3002 \u4e00\u56fe\u603b\u7ed3 06 x86 \u4f53\u7cfb\u67b6\u6784 \u786c\u4ef6\u56fe\u7ed3\u5408\u8ba1\u7b97\u673a\u7684\u903b\u8f91\u56fe\uff1a CPU \u548c \u5185\u5b58\u5982\u4f55\u914d\u5408\u5de5\u4f5c\uff1a CPU \u5305\u62ec\uff1a \u8fd0\u7b97\u5355\u5143\uff1a\u5982\u52a0\u51cf\u4e58\u9664 \u6570\u636e\u5355\u5143\uff1aCPU \u5185\u90e8\u7684\u7f13\u5b58\u548c\u5bc4\u5b58\u5668\u7ec4 \u63a7\u5236\u5355\u5143\uff1a\u6307\u4ee4\u83b7\u53d6\u3001\u63a7\u5236 \u6307\u4ee4\u6307\u9488\u5bc4\u5b58\u5668\uff1a\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740 \u6307\u4ee4\u5bc4\u5b58\u5668 x86 CPU \u7ec4\u4ef6\u653e\u5927\u56fe\uff1a \u8fd0\u7b97\u5355\u5143\uff1a \u901a\u7528\u5bc4\u5b58\u5668 \u63a7\u5236\u5355\u5143\uff1a IP\uff1a\u6307\u4ee4\u6307\u9488\u5bc4\u5b58\u5668 CS\uff1a \u4ee3\u7801\u5bc4\u5b58\u5668 DS\uff1a\u6570\u636e\u5bc4\u5b58\u5668 SS\uff1a\u6808\u5bc4\u5b58\u5668 \u4e00\u56fe\u603b\u7ed3\u4e4b\uff1a 07 Linux \u542f\u52a8\u8fc7\u7a0b 1 \u6253\u5f00\u7535\u6e90\uff0c\u4ece\u4e3b\u677f\u4e0a\u7684 BIOS \u8bfb\u53d6\u5176\u4e2d\u5b58\u50a8\u7684\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u77e5\u9053\u4e3b\u677f\u8fde\u63a5\u54ea\u4e9b\u786c\u4ef6\uff08\u786c\u76d8\u3001\u7f51\u7edc\u63a5\u53e3\u3001\u952e\u76d8\u3001\u4e32\u53e3\u3001\u5e76\u53e3\uff09\uff0cBIOS \u4f1a\u68c0\u67e5\u4ee5\u54ea\u79cd\u65b9\u5f0f\u542f\u52a8\uff08\u8f6f\u76d8\u3001\u5149\u76d8\u3001\u786c\u76d8\uff09\u3002\uff08BIOS \u5b58\u50a8\u5728 ROM \u53ea\u8bfb\u533a\uff09 2 \u8bfb\u53d6\u542f\u52a8\u76d8\u4e2d\u7684\u524d 512 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f MBR \uff08\u4e3b\u5f15\u5bfc\u6247\u533a\uff09 3 MBR \u4f1a\u4ece\u8bbe\u5907\u7684\u67d0\u4e00\u4e2a\u5206\u533a\u6765\u8f6c\u8f7d \u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f \uff08BootLoader\uff09 \uff0cBootLoader \u542b\u6709 OS \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 OS \u5185\u6838\uff0cOS \u5185\u6838\u6240\u5728\u7684\u4f4d\u7f6e\u7b49\u3002\u5e38\u7528\u7684 BootLoader \u7a0b\u5e8f\u6709 GRUB2 \u548c LILO \u3002 \u53ef\u4ee5\u901a\u8fc7 grub2-mkconfig -o /boot/grub2/grub.cfg \u6765\u914d\u7f6e\u7cfb\u7edf\u542f\u52a8\u7684\u9009\u9879\u3002 4 BootLoader \u63a5\u7740\u4f1a\u52a0\u8f7d\u5185\u6838\u7a0b\u5e8f \u5177\u4f53\u5730\uff0c\u5b83\u4f1a\u5b89\u88c5 boot.img \u3001 core.img \u7b49\u955c\u50cf\u7a0b\u5e8f\u3002\u5176\u4e2d kernel.img \u5c31\u662f\u5b58\u653e\u7684 OS \u5185\u6838\u7a0b\u5e8f\u3002\u4e00\u822c\u4f1a\u6709\u591a\u4e2a\u7a0b\u5e8f\uff08\u591a\u64cd\u4f5c\u7cfb\u7edf\uff09\uff0c\u6211\u4eec\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u3002 5 \u5047\u5982\u9009\u62e9 Linux\u5185\u6838\uff0c\u5185\u6838\u4f1a\u9884\u7559\u4e00\u90e8\u5206\u81ea\u5df1\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u901a\u8fc7\u9a71\u52a8\u7a0b\u5e8f\u68c0\u6d4b\u54ea\u4e9b\u8ba1\u7b97\u673a\u786c\u4ef6\u53ef\u7528\uff0c\u7136\u540e\u4f1a\u542f\u52a8\u4e00\u4e2a init \u8fdb\u7a0b\uff0c\u5b83\u662f Linux \u5185\u6838\u4e2d\u7684 1 \u53f7\u8fdb\u7a0b\uff08Linux \u6ca1\u6709 0 \u53f7\u8fdb\u7a0b\uff09\uff0c\u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u542f\u52a8\u9636\u6bb5\u505a\u7684\u4e8b\uff0c\u63a5\u4e0b\u6765\u5c31\u4ea4\u7ed9 init \u8fdb\u7a0b\u6765\u7ba1\u7406\u3002 6 init \u8fdb\u7a0b\u4f1a\u8fd0\u884c\u4e00\u7cfb\u5217\u7684\u521d\u59cb\u811a\u672c\uff08shell\u811a\u672c\uff09\uff1a \u8bbe\u7f6e\u8ba1\u7b97\u673a\u540d\u79f0\uff0c\u65f6\u533a\uff0c\u68c0\u6d4b\u6587\u4ef6\u7cfb\u7edf\uff0c\u6302\u8f7d\u786c\u76d8\uff0c\u6e05\u7a7a\u4e34\u65f6\u6587\u4ef6\uff0c\u8bbe\u7f6e\u7f51\u7edc\u2026\u2026 \u81f3\u6b64\uff0c\u6574\u4e2a OS \u4fbf\u51c6\u5907\u597d\u4e86\uff0c init \u542f\u52a8\u767b\u5f55\u7a0b\u5e8f\uff0c\u8f93\u5165\u7528\u6237\u540d\u3001\u5bc6\u7801\u4fbf\u53ef\u81ea\u884c\u73a9\u800d\u4e86\u3002 \u9644\uff1a grub2 \u547d\u4ee4\u7684\u4f7f\u7528\u624b\u518c\u89c1\uff1a http://www.cnblogs.com/f-ck-need-u/p/7094693.html 08 \u5185\u6838\u521d\u59cb\u5316 \u4ece\u6e90\u7801\u4e0a\u6765\u8bb2\uff0c\u5185\u6838\u521d\u59cb\u5316\u4ece \u51fd\u6570 start_kernel \u5f00\u59cb\u7684\uff0c\u76f8\u5f53\u4e8e\u5185\u6838\u7684 main \u51fd\u6570\uff0c\u5728\u6587\u4ef6 init/main.c \u4e2d\u3002\u5b83\u603b\u7684\u8981\u8fdb\u884c\u51e0\u4ef6\u4e8b\uff1a \u4efb\u52a1\u521d\u59cb\u5316 \u4e2d\u65ad\u521d\u59cb\u5316 \u5185\u5b58\u7ba1\u7406\u521d\u59cb\u5316 \u8c03\u5ea6\u5668\u521d\u59cb\u5316 \u5176\u4ed6\uff08\u5982\u8fdb\u7a0b\u7ebf\u7a0b\uff09\u521d\u59cb\u5316 init_task \u4ea7\u751f 0 \u53f7\u8fdb\u7a0b\uff0c\u8fd9\u662f\u552f\u4e00\u4e00\u4e2a\u6ca1\u6709\u901a\u8fc7 fork \u6216\u8005\u5176\u4ed6 kernel_thread \u4ea7\u751f\u7684\u8fdb\u7a0b\uff0c\u662f\u8fdb\u7a0b\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u3002 rest_init \u4f1a\u4ea7\u751f\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u4e00\u53f7\u8fdb\u7a0b\u548c\u4e8c\u53f7\u8fdb\u7a0b\u6765\u5bf9\u7528\u6237\u6001\u548c\u5185\u6838\u8fdb\u884c\u521d\u59cb\u5316\u3002 CPU \u7684\u5206\u5c42\u6743\u9650\u9650\u5236\uff0c\u5bfc\u81f4\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u8bbf\u95ee\u9700\u8981\u91c7\u7528\u7cfb\u7edf\u8c03\u7528\u7684\u624b\u6bb5\uff1a \u7cfb\u7edf\u8c03\u7528\u603b\u7684\u4e00\u4e2a\u8fc7\u7a0b\u57fa\u672c\u4e0a\u662f\uff1a 09 \u7cfb\u7edf\u8c03\u7528 \u7528\u6237\u6001\u8bbf\u95ee\u5185\u6838\uff1a \u7cfb\u7edf\u8c03\u7528 C \u51fd\u6570\u5e93 glibc\uff08\u6700\u7ec8\u4e5f\u662f\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff09 \u5728 glibc \u6e90\u4ee3\u7801\u4e2d\uff0c\u6709\u4e2a\u6587\u4ef6 syscallls.list \uff0c\u91cc\u9762\u5217\u7740\u6240\u6709 glibc \u7684\u51fd\u6570\u5bf9\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u3002 # File name Caller Syscall name Args Strong name Weak names open - open Ci:siv __libc_open __open open Glibc \u8fd8\u6709\u4e00\u4e2a\u6587\u4ef6 syscall-tmplate.S \uff0c\u4f7f\u7528 \u5b8f\uff0c\u5b9a\u4e49\u4e86\u7cfb\u7edf\u8c03\u7528\u7684\u8c03\u7528\u65b9\u5f0f\uff1a T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS) ret T_PSEUDO_END (SYSCALL_SYMBOL) #define T_PSEUDO(SYMBOL, NAME, N) PSEUDO (SYMBOL, NAME, N) \u8fd9\u91cc\u6709\u4e00\u4e2a \u5b8f PSEUDO \uff0c\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u90fd\u4f1a\u8c03\u7528\u5230\u8fd9\u4e2a \u5b8f\uff1a #define PSEUDO(name, syscall_name, args) \\ .text; \\ ENTRY (name) \\ DO_CALL (syscall_name, args); \\ cmpl $-4095, %eax; \\ jae SYSCALL_ERROR_LABEL 32 \u4f4d\u7cfb\u7edf\u8c03\u7528\u8fc7\u7a0b\u548c 64 \u4f4d\u8fd8\u6709\u4e9b\u8bb8\u4e0d\u540c\uff0c\u6211\u4eec\u76f4\u63a5\u770b 64 \u4f4d\u7684\uff1a \u63a5\u7740\uff0c\u5f00\u59cb\u9677\u5165\u5185\u6838\uff0cOS \u4f1a\u5c06\u7cfb\u7edf\u8c03\u7528\u540d\u79f0\u8f6c\u6362\u4e3a\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u653e\u5230\u5bc4\u5b58\u5668 rax \u4e2d\uff0c\u7136\u540e\u6267\u884c syscall \uff0c\u7136\u540e\u901a\u8fc7\u4e00\u79cd\u7279\u6b8a\u6a21\u5757\u5bc4\u5b58\u5668\uff08MSR\uff09\u6765\u5b8c\u6210\u7cfb\u7edf\u8c03\u7528\u7684\u529f\u80fd\uff0c\u5b83\u4f1a\u5c06\u7cfb\u7edf\u8c03\u7528\u76f8\u5173\u7684\u6307\u4ee4\u538b\u5165\u5185\u6838\uff1a \u7136\u540e\u901a\u8fc7\u4e00\u4e2a \u7cfb\u7edf\u8c03\u7528\u8868 \u627e\u5230\u76f8\u5e94\u7684\u51fd\u6570\uff0c\u8fdb\u884c\u6267\u884c\u3002 \u7cfb\u7edf\u8c03\u7528\u8868\u5b58\u653e\u7740\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0c\u5bf9\u4e8e 64\u4f4d\u7684\u7cfb\u7edf\uff0c\u662f\u5b9a\u4e49\u5728\u6587\u4ef6 arch/x86/entry/syscalls/syscall_64.tbl \u4e2d\u7684\uff08\u6bd4\u5982 open \u662f\u8fd9\u6837\u5b9a\u4e49\u7684\uff09: 2 common open sys_open \u901a\u8fc7\u5bc4\u5b58\u5668 rax \u4e2d\u7684\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u7cfb\u7edf\u8c03\u7528\u8868\u4e2d\u5bf9\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0c\u4ece\u800c\u6267\u884c\u771f\u6b63\u7684\u5185\u6838\u51fd\u6570\uff0c\u6bd4\u5982 open \u5bf9\u5e94\u5185\u6838\u51fd\u6570\u4e3a sys_open \u3002 10 \u8fdb\u7a0b \u5b89\u88c5\u5f00\u53d1\u5957\u4ef6\uff1a(centos 7) yum -y groupinstall \"Development Tools\" \u7a0b\u5e8f\u6587\u4ef6\u5177\u6709 \u4e25\u683c\u7684\u683c\u5f0f \uff1aELF\uff08Executeable and Linkable Format\uff09 ELF \u662f\u4e00\u79cd\u7528\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\u3001\u53ef\u6267\u884c\u6587\u4ef6\u3001\u76ee\u6807\u4ee3\u7801\u3001\u5171\u4eab\u5e93\u548c\u6838\u5fc3\u8f6c\u50a8\u7684\u6807\u51c6\u6587\u4ef6\u683c\u5f0f\u3002 \u76ee\u6807\u6587\u4ef6\u6709\u4e09\u7c7b\uff08\u53ef\u901a\u8fc7 file \u547d\u4ee4\u67e5\u770b\uff09\uff1a \u53ef\u91cd\u5b9a\u4f4d\u7684\u76ee\u6807\u6587\u4ef6\uff08.o \u6587\u4ef6\uff09 \u53ef\u6267\u884c\u7684\u76ee\u6807\u6587\u4ef6\uff08.exe \u6587\u4ef6\uff09 \u53ef\u88ab\u5171\u4eab\u7684\u76ee\u6807\u6587\u4ef6\uff08.so \u52a8\u6001\u5e93\u6587\u4ef6\uff09 \u4ece\u6587\u672c\u6587\u4ef6\u5230\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8fc7\u7a0b\uff1a 1\u3001.o \u6587\u4ef6\u65f6 ELF \u7684\u7b2c\u4e00\u79cd\u6587\u4ef6\u7c7b\u578b\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a \u5c06 .o \u5f52\u6863\u4e3a .a \u7684\u9759\u6001\u5e93\u6587\u4ef6\uff0c\u4f7f\u7528\u547d\u4ee4 ar\uff1a ar cr libstaticprocess.a process.o .text\uff1a\u5b58\u653e\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u4ee3\u7801 .rodata\uff1a\u53ea\u8bfb\u6570\u636e\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u5e38\u91cf\u3001const \u7684\u53d8\u91cf .data\uff1a\u5df2\u7ecf\u521d\u59cb\u5316\u597d\u7684\u5168\u5c40\u53d8\u91cf .bss\uff1a\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf .symtab\uff1a\u7b26\u53f7\u8868\uff0c\u8bb0\u5f55\u7684\u4e8b\u51fd\u6570\u548c\u53d8\u91cf .strtab\uff1a\u5b57\u7b26\u4e32\u8868\u3001\u5b57\u7b26\u4e32\u5e38\u91cf\u548c\u53d8\u91cf\u540d \u7f16\u8bd1\u7684\u65f6\u5019\u4f7f\u7528\u9759\u6001\u94fe\u63a5\u5e93\uff1a gcc -o staticcreateprocess createprocess.o -L. -lstaticprocess 2\u3001\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u4e3a ELF \u7684\u7b2c\u4e8c\u79cd\u683c\u5f0f\u3002 \u9759\u6001\u94fe\u63a5\u5e93\u5982\u679c\u66f4\u65b0\uff0c\u90a3\u4e2a\u591a\u4e2a\u5f15\u7528\u7684\u7a0b\u5e8f\u90fd\u8981\u968f\u4e4b\u66f4\u65b0\uff0c\u6548\u7387\u4f4e\uff0c\u56e0\u4e3a\u51fa\u73b0\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u53ef\u88ab\u591a\u4e2a\u7a0b\u5e8f\u5171\u4eab\u3002 3\u3001\u52a8\u6001\u94fe\u63a5\u5e93\u662f ELF \u7684\u7b2c\u4e09\u79cd\u683c\u5f0f\u3002\u5171\u4eab\u5bf9\u8c61\u6587\u4ef6\u3002 gcc -shared -fPIC -o libdynamicprocess.so process.o gcc -o dynamiccreateprocess createprocess.o -L. -ldynamicprocess \u5f53\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u88ab\u94fe\u63a5\u5230\u4e00\u4e2a\u7a0b\u5e8f\u6587\u4ef6\u4e2d\u7684\u65f6\u5019\uff0c\u6700\u540e\u7684\u7a0b\u5e8f\u6587\u4ef6\u5e76\u4e0d\u5305\u62ec\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684\u4ee3\u7801\uff0c\u800c\u4ec5\u4ec5\u5305\u62ec\u5bf9\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f15\u7528\uff0c\u5e76\u4e14\u4e0d\u4fdd\u5b58\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5168\u8def\u5f84\uff0c\u4ec5\u4ec5\u4fdd\u5b58\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u540d\u79f0\u3002 \u7cfb\u7edf\u9ed8\u8ba4\u52a0\u8f7d\u7684\u8def\u5f84\u662f /lib \u548c /usr/lib\uff0c\u53ef\u4ee5\u4f7f\u7528 LD_LIBRARY_PATH \u6765\u81ea\u5b9a\u4e49\u52a8\u6001\u5e93\u94fe\u63a5\u7684\u8def\u5f84\u3002 export LD_LIBRARY_PATH = . \u8fdb\u7a0b\u8c03\u7528 exec -> load_elf_binary\uff0c\u6700\u7ec8\u5c06\u52a8\u6001\u5e93\u52a0\u8f7d\u7684\u5185\u5b58\u3002 exec \u51fd\u6570\uff1a \u5305\u542b p \u7684\u51fd\u6570\uff08execvp, execlp\uff09\u4f1a\u5728 PATH \u8def\u5f84\u4e0b\u9762\u5bfb\u627e\u7a0b\u5e8f\uff1b \u4e0d\u5305\u542b p \u7684\u51fd\u6570\u9700\u8981\u8f93\u5165\u7a0b\u5e8f\u7684\u5168\u8def\u5f84\uff1b \u5305\u542b v \u7684\u51fd\u6570\uff08execv, execvp,execve\uff09\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u63a5\u6536\u53c2\u6570\uff1b \u5305\u542b l \u7684\u51fd\u6570\uff08execl, execlp, execle\uff09\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u63a5\u6536\u53c2\u6570\uff1b \u5305\u542b e \u7684\u51fd\u6570\uff08execve, execle\uff09\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u63a5\u6536\u73af\u5883\u53d8\u91cf\u3002 \u8fdb\u7a0b\u6811\uff1a \u6240\u6709\u8fdb\u7a0b\u90fd\u662f\u7531\u7236\u8fdb\u7a0b fork \u8fc7\u6765\u7684\uff0c\u5f80\u524d\u8ffd\u6eaf\uff0c\u4f1a\u627e\u5230\u7956\u5b97\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u7cfb\u7edf\u542f\u52a8\u7684 init \u8fdb\u7a0b\u3002 \u6709\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u6bd4\u5982 centos \uff0c/sbin/init \u4f1a\u88ab\u94fe\u63a5\u5230 systemd\u3002 \u4e00\u56fe\u603b\u7ed3\u4e4b\uff1a Tips: \u67e5\u770b ELF \u6587\u4ef6\u7684\u5de5\u5177\uff1a readelf\uff1a\u5206\u6790 ELF \u6587\u4ef6\u7684\u4fe1\u606f objdump\uff1a\u663e\u793a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4fe1\u606f hexdump\uff1a\u67e5\u770b\u6587\u4ef6\u7684 16\u8fdb\u5236\u7f16\u7801 nm\uff1a\u663e\u793a\u5173\u4e8e\u6307\u5b9a\u6587\u4ef6\u4e2d\u7b26\u53f7\u7684\u4fe1\u606f 11 \u7ebf\u7a0b \u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u7f16\u8bd1\u4f9d\u8d56\u4e8e libpthread.so gcc thread.c -lpthread \u666e\u901a\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u8fd0\u884c\u8fc7\u7a0b\uff1a \u591a\u7ebf\u7a0b\u53ef\u8bbf\u95ee\u7684\u6570\u636e\uff1a \u7ebf\u7a0b\u6808\u4e0a\u7684\u672c\u5730\u6570\u636e\uff0c\u6bd4\u5982\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u3002\uff08 ulimit -a \u67e5\u770b\u6808\u7684\u5927\u5c0f\uff09 \u6574\u4e2a\u8fdb\u7a0b\u91cc\u5171\u4eab\u7684\u5168\u5c40\u6570\u636e\uff0c\u6bd4\u5982\u5168\u5c40\u53d8\u91cf \u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e \u7ebf\u7a0b\u5171\u4eab\u6570\u636e\u7684\u4fdd\u62a4\u95ee\u9898\uff1a Mutex\uff08\u4e92\u65a5\u53d8\u91cf\uff09 \u6761\u4ef6\u53d8\u91cf\uff08\u4e00\u822c\u548c\u4e92\u65a5\u9501\u914d\u5408\u4f7f\u7528\uff09 12 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784 \u5728\u5185\u6838\u4e2d\uff0c\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u662f\u7531\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 task_struct \u6765\u7edf\u4e00\u7ba1\u7406\u3002 \u6bcf\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5b9a\u4e49\u4e00\u4e2a\u8fd9\u4e2a\u7ed3\u6784\uff0c\u591a\u4e2a\u8fdb\u7a0b\u7528\u94fe\u8868\u8fde\u63a5\u8d77\u6765\u3002 \u5176\u4e2d\uff0c \u4efb\u52a1 ID\uff1a pid\uff1a\u8fdb\u7a0b id tgid\uff1a\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u4e3b\u7ebf\u7a0b\u5bf9\u5e94\u7684\u8fdb\u7a0b ID group_leader\uff1a\u591a\u7ebf\u7a0b\u4e2d\u4e3b\u7ebf\u7a0b \u4fe1\u53f7\u5904\u7406\uff1a /* Signal handlers: */ struct signal_struct *signal; struct sighand_struct *sighand; sigset_t blocked; sigset_t real_blocked; sigset_t saved_sigmask; struct sigpending pending; unsigned long sas_ss_sp; size_t sas_ss_size; unsigned int sas_ss_flags; \u5305\u62ec\uff0c blocked\uff1a\u963b\u585e\u6682\u4e0d\u5904\u7406 pending\uff1a\u5c1a\u7b49\u5f85\u5904\u7406 sighand\uff1a\u6b63\u5728\u88ab\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5904\u7406 \u4efb\u52a1\u72b6\u6001\uff1a \u503c\u5b9a\u4e49\u5728 include/linux/sched.h \u4e2d\uff0c /* Used in tsk->state: */ #define TASK_RUNNING 0 #define TASK_INTERRUPTIBLE 1 #define TASK_UNINTERRUPTIBLE 2 #define __TASK_STOPPED 4 #define __TASK_TRACED 8 /* Used in tsk->exit_state: */ #define EXIT_DEAD 16 #define EXIT_ZOMBIE 32 #define EXIT_TRACE (EXIT_ZOMBIE | EXIT_DEAD) /* Used in tsk->state again: */ #define TASK_DEAD 64 #define TASK_WAKEKILL 128 #define TASK_WAKING 256 #define TASK_PARKED 512 #define TASK_NOLOAD 1024 #define TASK_NEW 2048 #define TASK_STATE_MAX 4096 \u6240\u6709\u5b9a\u4e49\u7684\u72b6\u6001\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5176\u4e2d\uff0c TASK_RUNNING\uff1a\u8868\u793a\u8fdb\u7a0b\u5728\u65f6\u523b\u51c6\u5907\u8fd0\u884c\uff08\u5e76\u4e0d\u662f\u6b63\u5728\u8fd0\u884c\uff0c\u5f53\u83b7\u5f97 CPU \u65f6\u95f4\u7247\u7684\u65f6\u5019\u8fdb\u5165\u8fd0\u884c\uff09 TASK_INTERRUPTIBLE\uff1a\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001\uff08\u6d45\u7761\u7720\uff09\uff0c\u5f53\u4fe1\u53f7\u6765\u7684\u65f6\u5019\uff0c\u8fdb\u7a0b\u53ef\u88ab\u5524\u9192 TASK_UNINTERRUPTIBLE\uff1a\u4e0d\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001\uff08\u6df1\u7761\u7720\uff09\uff0c\u4e0d\u53ef\u88ab\u4fe1\u53f7\u5524\u9192\uff0c\u53ea\u80fd\u6b7b\u7b49 I/O \u64cd\u4f5c\u5b8c\u6210\uff0ckill \u4e5f\u4e0d\u884c TASK_KILLABLE\uff1a\u53ef\u4ee5\u7ec8\u6b62\u7684\u7761\u7720\u72b6\u6001\uff0c\u4e0a\u9762\u7684\u6539\u826f\uff0c\u53ef\u4ee5\u54cd\u5e94\u81f4\u547d\u4fe1\u53f7 TASK_WAKEKILL\uff1a\u5728\u63a5\u6536\u81f4\u547d\u4fe1\u53f7\u65f6\u5524\u9192\u8fdb\u7a0b TASK_STOPPED\uff1a\u8fdb\u7a0b\u6536\u5230 SIGSTOP\u3001SIGINT\u3001SIGTSTP \u6216\u8005 SIGTTOU \u540e\u8fdb\u5165\u7684\u72b6\u6001 TASK_TRACED\uff1a\u8fdb\u7a0b\u88ab debugger \u7b49\u8fdb\u7a0b\u76d1\u89c6\uff0c\u8fdb\u7a0b\u6267\u884c\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u6240\u505c\u6b62 EXIT_ZOMBIE\uff1a\u8fdb\u7a0b\u7ed3\u675f\u9996\u5148\u8fdb\u5165\u7684\u72b6\u6001\uff0c\u5982\u679c\u7236\u8fdb\u7a0b\u6ca1\u6709\u8c03\u7528 waitpid() \u51fd\u6570\u7684\u8bdd\uff0c\u5c31\u6210\u4e3a \u50f5\u5c38\u8fdb\u7a0b EXIT_DEAD \u8fdb\u7a0b\u7684\u6700\u7ec8\u72b6\u6001 13 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e2d\uff09 \u8fdb\u7a0b\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e00\u4e9b\u7edf\u8ba1\u91cf\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u4e86\u89e3\u8fdb\u7a0b\u7684\u5de5\u4f5c\u60c5\u51b5\uff1a u64 utime;// \u7528\u6237\u6001\u6d88\u8017\u7684 CPU \u65f6\u95f4 u64 stime;// \u5185\u6838\u6001\u6d88\u8017\u7684 CPU \u65f6\u95f4 unsigned long nvcsw;// \u81ea\u613f (voluntary) \u4e0a\u4e0b\u6587\u5207\u6362\u8ba1\u6570 unsigned long nivcsw;// \u975e\u81ea\u613f (involuntary) \u4e0a\u4e0b\u6587\u5207\u6362\u8ba1\u6570 u64 start_time;// \u8fdb\u7a0b\u542f\u52a8\u65f6\u95f4\uff0c\u4e0d\u5305\u542b\u7761\u7720\u65f6\u95f4 u64 real_start_time;// \u8fdb\u7a0b\u542f\u52a8\u65f6\u95f4\uff0c\u5305\u542b\u7761\u7720\u65f6\u95f4 \u8fdb\u7a0b\u7684\u4eb2\u7f18\u5173\u7cfb\uff1a struct task_struct __rcu *real_parent; /* real parent process */ struct task_struct __rcu *parent; /* recipient of SIGCHLD, wait4() reports */ struct list_head children; /* list of my children */ struct list_head sibling; /* linkage in my parent's children list */ parent\uff1a\u6307\u5411\u5176\u7236\u8fdb\u7a0b children\uff1a\u8868\u793a\u94fe\u8868\u5934\u90e8 sibling\uff1a\u8868\u793a\u5144\u5f1f\u94fe\u8868 \u6574\u4e2a\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fdb\u7a0b\u6743\u9650\u63a7\u5236\uff1a /* Objective and real subjective task credentials (COW): */ const struct cred __rcu *real_cred; /* Effective (overridable) subjective task credentials (COW): */ const struct cred __rcu *cred; real_cred\uff1a\u8c01\u80fd\u64cd\u4f5c\u8fd9\u4e2a\u8fdb\u7a0b cred\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u80fd\u591f\u64cd\u4f5c\u8c01 \u5185\u5b58\u7ba1\u7406\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u7528 mm_struct \u8868\u793a\uff1a struct mm_struct *mm; struct mm_struct *active_mm; \u6587\u4ef6\u4e0e\u6587\u4ef6\u7cfb\u7edf\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u6709\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6570\u636e\u7ed3\u6784\uff0c\u548c\u4e00\u4e2a\u6253\u5f00\u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\uff1a /* Filesystem information: */ struct fs_struct *fs; /* Open file information: */ struct files_struct *files; \u52a0\u9910\uff08\u4e00\uff09\u5b66\u4e60\u653b\u7565 \u4e09\u904d\u5b66\u4e60\u6cd5+PPT\u7b14\u8bb0 \u7b2c\u4e00\u904d\u5b66\u4e60\uff1a\u5148\u8bfb\u8584\uff0c\u4e0d\u8981\u5728\u4e4e\u4e00\u57ce\u4e00\u6c60\u7684\u5f97\u5931\uff0c\u68b3\u7406\u4e3b\u6b21\u77db\u76fe\uff0c\u8bb0\u5f55\u6240\u6709\u95ee\u9898 \u7b2c\u4e8c\u904d\u5b66\u4e60\uff1a\u518d\u8bfb\u539a\uff0c\u628a\u63e1\u4e3b\u7ebf\uff0c\u653b\u514b\u5404\u4e2a\u95ee\u9898\uff08\u7528 PPT \u7b14\u8bb0\u6cd5\u8bb0\u5f55\u8fd9\u4e2a\u8fc7\u7a0b\uff09 \u7b2c\u4e09\u904d\u5b66\u4e60\uff1a\u518d\u8bfb\u8584\uff0c\u53d8\u6210\u81ea\u5df1\u7684\u4e1c\u897f\uff0c\u603b\u4f53\u68b3\u7406\u77e5\u8bc6\u70b9\uff0c\u53ef\u4ee5\u7528xmind\u601d\u7ef4\u5bfc\u56fe\uff0c\u878d\u6c47\u8d2f\u901a 14 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e0b\uff09 \u7528\u6237\u6001\u51fd\u6570\u6808\uff1a \u51fd\u6570\u8c03\u7528\u65f6\u7684\u6808\u5982\u4e0b\u6240\u793a\uff0832\u4f4d\uff09\uff1a\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\uff0c\u5f80\u4e0b\u589e\u957f\uff0c\u4e0a\u9762\u662f\u6808\u5e95\uff0c\u4e0b\u9762\u662f\u6808\u9876\u3002 \u5728 64\u4f4d\u7684\u73af\u5883\uff0cEBP \u53d8\u6210\u4e86 RBP\uff0cESP \u53d8\u6210\u4e86 RSP\u3002 \u5185\u6838\u6001\u51fd\u6570\u6808\uff1a \u8fdb\u7a0b\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u8054\u7cfb\u7528\u5230\u5982\u4e0b\u7ed3\u6784\uff1a struct thread_info thread_info; void *stack; \u5176\u4e2d\uff0cstack \u5373\u7ef4\u62a4\u5185\u6838\u51fd\u6570\u6808\u3002 \u5f53\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u540e\uff0c\u9700\u8981\u5c06\u7528\u6237\u6001\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684 CPU \u4e0a\u4e0b\u6587\u4fdd\u5b58\u8d77\u6765\uff0c\u5176\u5b9e\u662f\u4fdd\u5b58\u7684 pt_regs \u8fd9\u4e2a\u7ed3\u6784\uff0c \u901a\u8fc7 task_struct \u7684 stack \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u5185\u6838\u6808\uff1a static inline void *task_stack_page(const struct task_struct *task) { return task->stack; } \u901a\u8fc7 stack \u5c31\u80fd\u5f88\u65b9\u4fbf\u627e\u5230 pt_regs \uff1a /* * TOP_OF_KERNEL_STACK_PADDING reserves 8 bytes on top of the ring0 stack. * This is necessary to guarantee that the entire \"struct pt_regs\" * is accessible even if the CPU haven't stored the SS/ESP registers * on the stack (interrupt gate does not save these registers * when switching to the same priv ring). * Therefore beware: accessing the ss/esp fields of the * \"struct pt_regs\" is possible, but they may contain the * completely wrong values. */ #define task_pt_regs(task) \\ ({ \\ unsigned long __ptr = (unsigned long)task_stack_page(task); \\ __ptr += THREAD_SIZE - TOP_OF_KERNEL_STACK_PADDING; \\ ((struct pt_regs *)__ptr) - 1; \\ }) \u53cd\u8fc7\u6765\uff0c\u5185\u6838\u6808\u901a\u8fc7 thread_info \u8fd9\u4e2a\u7ed3\u6784\u6765\u627e task_struct \uff0c struct thread_info { struct task_struct *task; /* main task structure */ __u32 flags; /* low level flags */ __u32 status; /* thread synchronous flags */ __u32 cpu; /* current CPU */ mm_segment_t addr_limit; unsigned int sig_on_uaccess_error:1; unsigned int uaccess_err:1; /* uaccess failed */ }; \u5176\u4e2d struct task_struct *task; \u5373\u662f\u6307\u5411 task_struct \uff0c\u901a\u5e38 current_thread_info()->task \u6765\u83b7\u53d6 task_struct \u3002 \u4e00\u56fe\u603b\u7ed3\uff1a 15 \u8c03\u5ea6\uff08\u4e0a\uff09 \u6307\u7684\u662f\u8fdb\u7a0b\u6570\u91cf\u8fdc\u8d85\u8fc7 CPU \u7684\u6570\u76ee\uff0c\u9700\u8981\u8fdb\u884c CPU \u8c03\u5ea6\u6267\u884c\u3002 \u8fdb\u7a0b\u5305\u62ec\u4e24\u79cd\uff1a \u5b9e\u65f6\u8fdb\u7a0b \u666e\u901a\u8fdb\u7a0b \u5b9e\u65f6\u8fdb\u7a0b\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\u6bd4\u666e\u901a\u8fdb\u7a0b\u8981\u9ad8\u3002\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u4f4e\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002 \u5b9e\u65f6\u8fdb\u7a0b\u4f18\u5148\u7ea7\u8303\u56f4\uff1a0-99 \u666e\u901a\u8fdb\u7a0b\u4f18\u5148\u7ea7\u8303\u56f4\uff1a100-139 task_struct \u4e2d\u6709\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\uff0c\u53eb \u8c03\u5ea6\u7b56\u7565 \uff1a unsigned int policy; \u5305\u62ec\u4ee5\u4e0b\u7b56\u7565\uff1a #define SCHED_NORMAL 0 #define SCHED_FIFO 1 #define SCHED_RR 2 #define SCHED_BATCH 3 #define SCHED_IDLE 5 #define SCHED_DEADLINE 6 \u5176\u4e2d\uff0c SCHED_FIFO\uff08\u5148\u6765\u5148\u670d\u52a1\uff09 \u3001 SCHED_RR\uff08\u65f6\u95f4\u7247\u8f6e\u6d41\u8c03\u5ea6\uff09 \u3001 SCHED_DEADLINE\uff08\u6839\u636e deadline \u9009\u62e9\u8c03\u5ea6\uff09 \u662f\u5b9e\u65f6\u8fdb\u7a0b\u8c03\u5ea6\u7b56\u7565\uff0c \u5269\u4f59\uff0c SCHED_NORMAL\uff08\u666e\u901a\u8fdb\u7a0b\uff09 \u3001 SCHED_BATCH\uff08\u540e\u53f0\u8fdb\u7a0b\uff09 \u3001 SCHED_IDLE\uff08\u7a7a\u95f2\u8fdb\u7a0b\uff09 \u662f\u666e\u901a\u8fdb\u7a0b\u8c03\u5ea6\u7b56\u7565\u3002 \u901a\u5e38\u6700\u5e38\u7528\u7684\u8c03\u5ea6\u7b97\u6cd5\u662f \u666e\u901a\u8fdb\u7a0b\u4f7f\u7528\u7684 \u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u7b97\u6cd5\uff1a \u7528\u7403\u88c5\u8fdb\u53e3\u888b\u7684\u4f8b\u5b50\u6765\u7406\u89e3\uff0c\u7403\u5c11\u7684\u888b\u5b50\u591a\u653e\u70b9\u7403\uff0c\u8fd9\u6837\u7ecf\u8fc7\u51e0\u8f6e\uff0c\u867d\u4e0d\u80fd\u4fdd\u8bc1\u6240\u6709\u53e3\u888b\u7403\u5b8c\u5168\u4e00\u6837\uff0c\u4f46\u4e5f\u5dee\u4e0d\u591a\u516c\u5e73\u3002 \u8fd9\u4e2a\u7b97\u6cd5\u7684\u5e95\u5c42\u5b9e\u73b0\u662f\u901a\u8fc7 \u7ea2\u9ed1\u6811 \u6765\u5b9e\u73b0\u7684\u3002 \u7ea2\u9ed1\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u8bb0\u5f55\u4e00\u4e2a vruntime\uff0cvruntime \u662f\u865a\u62df\u8fd0\u884c\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u8fdb\u7a0b\u65f6\u949f tick \u6570\uff0c\u7528\u6765\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u5360\u7528 CPU \u7684\u65f6\u95f4\u6ef4\u7b54\u6570\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u516c\u5e73\u3002 \u603b\u7ed3\uff1a \u4e00\u4e2a CPU \u4e0a\u6709\u4e00\u4e2a\u961f\u5217\uff0c\u5373 CFS\uff08\u516c\u5e73\u8c03\u5ea6\u961f\u5217\uff09\uff0c\u8fd9\u5b9e\u73b0\u4e0a\u662f\u4e00\u9897\u7ea2\u9ed1\u6811\uff0c\u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a sched_entity\uff08\u8c03\u5ea6\u5b9e\u4f53\uff09 \uff0c\u6bcf\u4e2a `sched_entity \u90fd\u5c5e\u4e8e\u4e00\u4e2a task_struct \uff0c task_struct \u91cc\u6709\u6307\u9488\u6307\u5411\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u54ea\u4e2a\u8c03\u5ea6\u7c7b\u3002\u5728\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u4f9d\u6b21\u8c03\u7528\u8c03\u5ea6\u7c7b\u7684\u51fd\u6570\uff0c\u4ece CPU \u7684\u961f\u5217\u4e2d\u53d6\u51fa\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u3002 16 \u8c03\u5ea6\uff08\u4e2d\uff09 \u5206\u4e3a\uff1a\u4e3b\u52a8\u8c03\u5ea6\u548c\u88ab\u52a8\u8c03\u5ea6 \u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff1a \u4e3b\u8981\u5e72\u4e24\u4ef6\u4e8b\uff1a\u4e00\u662f\u5207\u6362\u8fdb\u7a0b\u7a7a\u95f4\uff0c\u4e5f\u5373\u865a\u62df\u5185\u5b58\uff0c\u4e8c\u662f\u5207\u6362\u5bc4\u5b58\u5668\u548c CPU \u4e0a\u4e0b\u6587 \u4e3b\u52a8\u8c03\u5ea6\u7684\u8fc7\u7a0b\uff1a \u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b\u4e3b\u52a8\u8c03\u7528 __schedule \u8ba9\u51fa CPU\uff0c\u5728 __schedule \u91cc\u4f1a\u505a\u4e24\u4ef6\u4e8b\u60c5\uff0c\u7b2c\u4e00\u662f\u9009\u53d6\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7b2c\u4e8c\u662f\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u800c\u4e0a\u4e0b\u6587\u5207\u6362\u53c8\u5206\u4e3a\u7528\u6237\u8fdb\u7a0b\u7a7a\u95f4\u5207\u6362\u548c\u5185\u6838\u6001\u7684\u5207\u6362 17 \u8c03\u5ea6\uff08\u4e0b\uff09 \u62a2\u5360\u5f0f\u8c03\u5ea6\uff1a\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u65f6\u95f4\u592a\u957f\u4e86\uff0c\u662f\u65f6\u5019\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e86\u3002 18 \u8fdb\u7a0b\u7684\u521b\u5efa \u9996\u5148\u8c03\u7528 fork \u7cfb\u7edf\u8c03\u7528 --> sys_call_table --> sys_fork --> _do_fork --> copy_process # \u7b2c\u4e00\u4ef6\u5927\u4e8b --> dup_task_struct --> alloc_task_struct_node # \u5206\u914d task_struct --> alloc_thread_stack_node # \u521b\u5efa\u5185\u6838\u6808 --> arch_dup_task_struct # \u8c03\u7528 memcpy \u5c06task_struct \u8fdb\u884c\u590d\u5236 --> setup_thread_stack # \u8bbe\u7f6e thread_info --> copy_creds --> prepare_creds # memcpy \u590d\u5236\u4e00\u4efd\u7236\u8fdb\u7a0b\u7684 cred --> \u8bbe\u7f6e\u8fdb\u7a0b\u8fd0\u884c\u7edf\u8ba1\u91cf --> sched_fork # \u8bbe\u7f6e\u8c03\u5ea6\u76f8\u5173\u7684\u53d8\u91cf --> __sched_fork # \u8bbe\u7f6e\u5305\u62ec\u8fd0\u884c\u65f6\u95f4\uff0c\u8fdb\u7a0b\u72b6\u6001\uff0c\u4f18\u5148\u7ea7\uff0c\u8c03\u5ea6\u7c7b --> copy_files # \u590d\u5236\u4e00\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u4fe1\u606f --> dup_fd # \u590d\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26 --> file_fs # \u590d\u5236\u4e00\u4e2a\u8fdb\u7a0b\u7684\u76ee\u5f55\u4fe1\u606f --> copy_sighand # \u521d\u59cb\u5316\u4fe1\u53f7\u76f8\u5173\u7684\u53d8\u91cf --> copy_mm # \u590d\u5236\u5185\u5b58\u7a7a\u95f4\uff0c\u8fdb\u7a0b\u7a7a\u95f4\u7528 mm_struct \u7ed3\u6784\u8868\u793a --> wake_up_new_task # \u7b2c\u4e8c\u4ef6\u5927\u4e8b,\u8bd5\u56fe\u5524\u9192\u521b\u5efa\u7684\u5b50\u8fdb\u7a0b --> activate_task --> enqueue_task # \u6fc0\u6d3b\u8fdb\u7a0b --> enqueue_task_fair # \u5982\u679c\u662f CFS \u7684\u8c03\u5ea6\u7c7b\uff0c\u6267\u884c\u76f8\u5e94\u8c03\u5ea6\u7c7b \u4ee5\u4e0a\u7b2c\u4e00\u9636\u6bb5\u7684\u8fc7\u7a0b\u5982\u4ee5\u4e0b\u56fe\u793a\u6240\u793a\uff1a 19 \u7ebf\u7a0b\u7684\u521b\u5efa \u548c\u8fdb\u7a0b\u4e00\u6837\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u662f\u7531\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u5171\u540c\u5b8c\u6210\u7684\u3002 \u5b83\u4eec\u90fd\u8981\u4f9d\u6258\u4e8e\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 task_struct \uff0c\u4e0b\u9762\u770b\u770b\u7ebf\u7a0b\u5177\u4f53\u521b\u5efa\u5c31\u7684\u8fc7\u7a0b\uff1a \u4ece\u7528\u6237\u8c03\u7528 pthread_create \u5f00\u59cb\uff0c 1\u3001\u8bbe\u7f6e\u7ebf\u7a0b\u5c5e\u6027\u53c2\u6570 2\u3001pthread \u7ed3\u6784\u7528\u6237\u6001\u7ef4\u62a4\u7ebf\u7a0b 3\u3001\u521b\u5efa\u7ebf\u7a0b\u6808(ALLOCATE_STACK) - - 4\u3001\u8fdb\u5165\u5185\u6838 \u8c03\u7528 create_thread 5\u3001\u8c03\u7528 __clone --> sys_call --> _do_fork # \u548c\u8fdb\u7a0b\u4e0d\u540c\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u5bf9\u76f8\u5173\u7684 \u7ed3\u6784 \u505a\u5f15\u7528\u8ba1\u6570 +1\uff0c\u800c\u4e0d\u662f\u590d\u5236\u3002 \u4e0b\u56fe\u603b\u7ed3\u4e86\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u521b\u5efa\u7684\u533a\u522b\uff1a 20 \u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09\uff1a\u89c4\u5212\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u5e03\u5c40 \u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684 \u4e09\u4e2a\u65b9\u9762\uff1a \u7269\u7406\u5185\u5b58\u7684\u7ba1\u7406\uff1a\u7269\u7406\u5185\u5b58\u5730\u5740\u53ea\u6709\u5185\u5b58\u7ba1\u7406\u6a21\u5757\u80fd\u591f\u4f7f\u7528 \u865a\u62df\u5185\u5b58\u7684\u7ba1\u7406\uff1a\u6bcf\u4e2a\u8fdb\u7a0b\u770b\u5230\u7684\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e92\u4e0d\u5e72\u6270\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4 \u865a\u62df\u5730\u5740\u548c\u7269\u7406\u7684\u5730\u5740\u7684\u6620\u5c04\u7ba1\u7406\uff1a\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u901a\u8fc7\u9875\u8868\u7ed3\u6784\u5173\u8054\u8d77\u6765 \u6253\u5370\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u5e03\u5c40\u7684\u547d\u4ee4\uff1a cat /proc/$pid/map 21 \u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09 \u865a\u62df\u5185\u5b58\u8f6c\u5230\u7269\u7406\u5185\u5b58\uff0c\u9700\u8981\u7528\u5230\u4e24\u79cd\u673a\u5236\uff1a\u5206\u6bb5\u673a\u5236\u548c\u5206\u9875\u673a\u5236\u3002 \u5206\u6bb5\u673a\u5236\uff1a \u5927\u4f53\u601d\u8def\u662f\u901a\u8fc7\u6bb5\u57fa\u5730\u5740\u548c\u6bb5\u5185\u504f\u79fb\uff0c\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002 \u5206\u9875\u673a\u5236\uff1a \u901a\u8fc7\u9875\u8868\u76ee\u5f55\u9879\u548c\u9875\u5185\u504f\u79fb\u91cf\uff0c\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002 \u5bf9\u4e8e 64\u4f4d\uff0c\u5219\u9875\u8868\u76ee\u5f55\u66f4\u591a\uff0c\u5982\u4e0b\uff1a \u5185\u5b58\u6620\u5c04\uff1a\u5c06\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u6620\u5c04\u8d77\u6765\uff0c\u5e76\u4e14\u5728\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\u53ef\u4ee5\u6362\u51fa\u5230\u786c\u76d8\u4e2d\u3002 22 \u8fdb\u7a0b\u7a7a\u95f4\u7ba1\u7406 \u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u7ba1\u7406\u6765\u81ea\u4e8e\u4e00\u4e2a\u7ed3\u6784\uff1a struct mm_struct **mm \u5176\u4e2d\uff0c\u4e00\u4e2a\u6210\u5458\u53d8\u91cf: unsigned long task_size \u5b9a\u4e49\u4e86\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684\u5927\u5c0f\u5206\u754c\u7ebf\u3002 \u5bf9\u4e8e 32 \u4f4d\u7cfb\u7edf\uff0c\u6700\u5927\u80fd\u591f\u5bfb\u5740 2^32=4G\uff0c\u5176\u4e2d\u7528\u6237\u6001\u865a\u62df\u5730\u5740\u7a7a\u95f4\u662f 3G\uff0c\u5185\u6838\u6001\u662f 1G\u3002 \u5bf9\u4e8e 64 \u4f4d\u7cfb\u7edf\uff0c\u865a\u62df\u5730\u5740\u53ea\u4f7f\u7528\u4e86 48 \u4f4d\u3002\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u5927\u5c0f\u90fd\u662f 128T\u3002 \u5982\u4e0b\uff1a \u5185\u5b58\u7a7a\u95f4\u5e03\u5c40\uff1a \u4ee5\u4e0a\u8fd9\u4e9b\u533a\u57df\u901a\u8fc7\u4e0b\u9762\u7684\u7ed3\u6784\u63cf\u8ff0\uff1a struct vm_area_struct *mmap; /* list of VMAs */ struct rb_root mm_rb; 64\u4f4d\u7684\u5185\u6838\u7a7a\u95f4\u5e03\u5c40\uff1a \u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u4e24\u5e45\u56fe\u8868\u793a\uff1a 32\u4f4d\uff1a 64\u4f4d\uff1a 23 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09 \u7269\u7406\u5185\u5b58\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u6709\u4e24\u79cd\uff1a SMP\uff1a\u5bf9\u79f0\u591a\u5904\u7406\u5668 NUMA \uff1a\u975e\u4e00\u81f4\u5185\u5b58\u8bbf\u95ee \u5728 NUMA \u7ed3\u6784\u4e2d\uff0c\u628a\u5185\u5b58\u5206\u6210\u8282\u70b9\uff0c\u628a\u8282\u70b9\u5206\u6210\u533a\u57dfzone\uff0c\u533a\u57df\u53c8\u5206\u4e3a\u9875\uff0c \u9875\u662f\u7ec4\u6210\u7269\u7406\u5185\u5b58\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u9875\u7684\u6570\u636e\u7ed3\u6784\u662f struct page \u3002 \u5728Linux\u4e2d\uff0c\u5982\u679c\u8981\u5206\u914d\u6bd4\u8f83\u5927\u7684\u5185\u5b58\uff0c\u4f8b\u5982\u5206\u914d\u9875\u7ea7\u522b\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u4f19\u4f34\u7cfb\u7edf\u3002 \u51e0\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u6240\u793a\uff1a 24 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09 \u7269\u7406\u5185\u5b58\u5206 NUMA \u8282\u70b9\uff0c\u5206\u522b\u8fdb\u884c\u7ba1\u7406 \u4f19\u4f34\u7cfb\u7edf\u5c06\u591a\u4e2a\u8fde\u7eed\u7684\u9875\u9762\u4f5c\u4e3a\u4e00\u4e2a\u5927\u7684\u5185\u5b58\u5757\u5206\u914d\u7ed9\u4e0a\u5c42\u3002 \u5c0f\u5185\u5b58\u7684\u5206\u914d\u4f7f\u7528 slub \u5206\u914d\u5668\u3002\u5b83\u4f1a\u4ece\u4f19\u4f34\u7cfb\u7edf\u4e2d\u7533\u8bf7\u5927\u5185\u5b58\u5757\u5207\u5206\u6210\u5c0f\u5757\uff0c\u5206\u914d\u7ed9\u5176\u4ed6\u7cfb\u7edf\u3002 \u5185\u5b58\u9875\u9762\u7684\u6362\u5165\u6362\u51fa\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b kswapd \uff0c\u5b83\u4f1a\u5faa\u73af\u68c0\u67e5\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5f53\u5185\u5b58\u5145\u8db3\u7684\u65f6\u5019\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u4f1a\u505a\uff0c\u5f53\u5185\u5b58\u5403\u7d27\u4e86\uff0c\u5b83\u4f1a\u68c0\u67e5\u662f\u5426\u5e94\u8be5\u6362\u51fa\u4e00\u4e9b\u5185\u5b58\u9875\u3002 \u5e38\u7528\u7684\u4e00\u4e2a\u5185\u5b58\u6362\u51fa\u7b97\u6cd5\u662f LRU\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u3002 \u7528\u4e0b\u9762\u8fd9\u4e2a\u56fe\u603b\u7ed3\uff1a\u4f19\u4f34\u7cfb\u7edf\u548c Slub \u5206\u914d\u5668\uff1a 25 \u7528\u6237\u6001\u5185\u5b58\u6620\u5c04 \u5185\u5b58\u6620\u5c04\uff1a \u7269\u7406\u5185\u5b58\u548c\u865a\u62df\u5185\u5b58\u4e4b\u95f4\u7684\u6620\u5c04 \u5c06\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u6620\u5c04\u5230\u865a\u62df\u5185\u5b58\u7a7a\u95f4 \u5185\u5b58\u6620\u5c04\u901a\u8fc7\u4e00\u4e2a \u7cfb\u7edf\u8c03\u7528 mmap \u6765\u5b8c\u6210\uff0c\u5185\u5b58\u6620\u5c04\u533a\u5728\u5185\u5b58\u7ed3\u6784\u4e2d\u7684\u4f4d\u7f6e\u5982\u4e0b\u6240\u793a\uff1a \u5f53\u6211\u4eec\u5728\u7533\u8bf7\u5185\u5b58\u65f6\uff0c\u5982\u679c\u7533\u8bf7\u7684\u662f\u5c0f\u5757\u5185\u5b58\uff0c\u5c31\u7528 brk\uff0c\u5982\u679c\u7533\u8bf7\u5927\u5757\u5185\u5b58\uff0c\u5c31\u7528 mmap\u3002 mmap \u4f9d\u8d56\u4e8e\u9875\u8868\u9879\uff0c\u9875\u8868\u7531\u4e8e\u4e00\u822c\u90fd\u8f83\u5927\uff0c\u6240\u4ee5\u53ea\u80fd\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u8bbf\u5b58\u7684\u6027\u80fd\u4e0b\u964d\u3002 \u4e3a\u4e86\u52a0\u5feb\u6620\u5c04\u901f\u5ea6\uff0c\u5f15\u5165 TLB \u5757\u8868\uff0cTLB \u5b58\u50a8\u5728 Cache \u4e2d\uff0c\u5b58\u50a8\u7684\u662f\u9875\u8868\u9879\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u865a\u62df\u5730\u5740\u627e\u5230\u7269\u7406\u5730\u5740\u3002\u5185\u5b58\u6620\u5c04\u7684\u65f6\u5019\uff0c\u4f1a\u9996\u5148\u67e5 TLB \u8868\uff0c\u5757\u8868\u4e2d\u6709\u6620\u5c04\u5173\u7cfb\uff0c\u5c31\u76f4\u63a5\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u624d\u4f1a\u5230\u5185\u5b58\u4e2d\u67e5\u8be2\u9875\u8868\u3002 \u5982\u679c\u7528\u6237\u6001\u8bbf\u95ee\u6ca1\u6709\u6620\u5c04\u7684\u5185\u5b58\u4f1a\u5f15\u53d1\u7f3a\u9875\u5f02\u5e38\uff0c\u5206\u914d\u7269\u7406\u9875\u8868\u3001\u8865\u9f50\u9875\u8868\u3002\u5982\u679c\u662f swap\uff0c\u5219\u5c06 swap \u6587\u4ef6\u8bfb\u5165\uff0c\u5982\u679c\u662f\u6587\u4ef6\u6620\u5c04\uff0c\u5219\u5c06\u6587\u4ef6\u8bfb\u5165\u3002 26 \u5185\u6838\u6001\u5185\u5b58\u6620\u5c04 vmalloc \u548c kmap_atomic \u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4 vmalloc \u533a\u57df\u7528\u4e8e\u6620\u5c04 kmap_atomic \u4e34\u65f6\u6620\u5c04 32 \u4f4d, \u8c03\u7528 set_pte \u901a\u8fc7\u5185\u6838\u9875\u8868\u4e34\u65f6\u6620\u5c04 64 \u4f4d, \u8c03\u7528 page_address\u2192lowmem_page_address \u8fdb\u884c\u6620\u5c04 \u5185\u6838\u6001\u7f3a\u9875\u5f02\u5e38 kmap_atomic \u76f4\u63a5\u521b\u5efa\u9875\u8868\u8fdb\u884c\u6620\u5c04 vmalloc \u53ea\u5206\u914d\u5185\u6838\u865a\u62df\u5730\u5740, \u8bbf\u95ee\u65f6\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad, \u8c03\u7528 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff1a \u7528\u6237\u6001\u5185\u5b58\u5206\u914d\uff1a \u5185\u6838\u6001\u5185\u5b58\u5206\u914d\uff1a \u5185\u5b58\u5206\u914d\u4f53\u7cfb\u603b\u56fe\uff1a 27 \u6587\u4ef6\u7cfb\u7edf \u6587\u4ef6\u7cfb\u7edf\u7684\u8bbe\u8ba1\u539f\u5219\uff1a \u4e25\u683c\u7684\u7ec4\u7ec7\u5f62\u5f0f\uff0c\u4ee5\u5757\u4e3a\u5355\u4f4d\u8fdb\u884c\u5b58\u50a8 \u8981\u6709\u7d22\u5f15\u533a \u5e94\u8be5\u6709\u7f13\u5b58\u5c42\uff0c\u5b58\u653e\u7ecf\u5e38\u88ab\u8bfb\u5199\u7684\u6587\u4ef6 \u4ee5\u6587\u4ef6\u5939\u7684\u5f62\u5f0f\u7ec4\u7ec7\uff0c\u65b9\u4fbf\u7ba1\u7406\u548c\u67e5\u8be2 linux \u7ef4\u62a4\u4e00\u5957\u6570\u636e\u7ed3\u6784\uff0c\u4fdd\u5b58\u54ea\u4e9b\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u6253\u5f00\u548c\u4f7f\u7528 \u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u547d\u4ee4\uff1a fdisk -l # \u67e5\u770b\u683c\u5f0f\u5316\u548c\u6ca1\u6709\u683c\u5f0f\u5316\u7684\u5206\u533a mkfs.ext4 /dev/vdc # \u5bf9\u78c1\u76d8\u8fdb\u884c\u683c\u5f0f\u5316\uff0cvdc\u4f1a\u5efa\u7acb\u4e00\u4e2a\u5206\u533a\uff0c\u683c\u5f0f\u5316\u4e3a ext4 \u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u3002 mount /dev/vdc1 / \u6839\u76ee\u5f55 / \u7528\u6237 A \u76ee\u5f55 / \u76ee\u5f55 1 # \u683c\u5f0f\u5316\u7684\u5206\u533a\u9700\u8981\u6302\u5230\u67d0\u4e2a\u76ee\u5f55\u4e0b\u9762\uff0c\u624d\u80fd\u4f5c\u4e3a\u666e\u901a\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u8bbf\u95ee umount / \u6839\u76ee\u5f55 / \u7528\u6237 A \u76ee\u5f55 / \u76ee\u5f55 1 # \u5378\u8f7d\u6302\u8f7d \u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\uff1a \u6587\u4ef6\u76f8\u5173\uff1aopen, write, read, lseek, close \u76ee\u5f55\u76f8\u5173\uff1aopendir\uff0creaddir\uff0cclosedir \u6587\u4ef6\u5c5e\u6027\u7531\u7ed3\u6784\u4f53 struct stat \u6765\u7ef4\u62a4\uff0c\u7531\u51fd\u6570 stat\uff0cfstat\uff0clstat\u6765\u64cd\u4f5c\uff1a int stat(const char *pathname, struct stat *statbuf); int fstat(int fd, struct stat *statbuf); int lstat(const char *pathname, struct stat *statbuf); struct stat { dev_t st_dev; /* ID of device containing file */ ino_t st_ino; /* Inode number */ mode_t st_mode; /* File type and mode */ nlink_t st_nlink; /* Number of hard links */ uid_t st_uid; /* User ID of owner */ gid_t st_gid; /* Group ID of owner */ dev_t st_rdev; /* Device ID (if special file) */ off_t st_size; /* Total size, in bytes */ blksize_t st_blksize; /* Block size for filesystem I/O */ blkcnt_t st_blocks; /* Number of 512B blocks allocated */ struct timespec st_atim; /* Time of last access */ struct timespec st_mtim; /* Time of last modification */ struct timespec st_ctim; /* Time of last status change */ }; \u6700\u540e\uff0c\u7528\u4e00\u5e45\u56fe\u6765\u603b\u7ed3\u4e4b\uff1a 28 \u786c\u76d8\u6587\u4ef6\u7cfb\u7edf \u786c\u76d8\u7ed3\u6784\uff1a https://static001.geekbang.org/resource/image/2e/d2/2ea68b40d928e6469233fcb4948c7cd2.jpg Linux \u4e3b\u6d41\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\uff1aext \u7cfb\u5217\uff0cext3, ext4 \u786c\u76d8\u5206\u6210\u76f8\u540c\u5927\u5c0f\u7684\u5757\uff0c\u4e00\u5757\u7684\u5927\u5c0f\u662f\u6247\u533a\u5927\u5c0f\u7684\u6574\u6570\u500d\uff0c\u9ed8\u8ba4\u662f 4K\uff0c\u683c\u5f0f\u5316\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u3002 \u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u6587\u4ef6\uff0c\u4f7f\u7528\u4e00\u4e2a\u7ed3\u6784 inode \u6765\u7ef4\u62a4\uff0cinode \u4fdd\u5b58\u4e00\u4e2a\u6587\u4ef6\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u63d0\u4f9b\u7d22\u5f15\u673a\u5236\uff0c\u65b9\u4fbf\u67e5\u627e\u548c\u7ba1\u7406\u3002 struct ext4_inode { __le16 i_mode; /* File mode */ __le16 i_uid; /* Low 16 bits of Owner Uid */ __le32 i_size_lo; /* Size in bytes */ __le32 i_atime; /* Access time */ __le32 i_ctime; /* Inode Change time */ __le32 i_mtime; /* Modification time */ __le32 i_dtime; /* Deletion Time */ __le16 i_gid; /* Low 16 bits of Group Id */ __le16 i_links_count; /* Links count */ __le32 i_blocks_lo; /* Blocks count */ __le32 i_flags; /* File flags */ ...... __le32 i_block[EXT4_N_BLOCKS];/* Pointers to blocks */ __le32 i_generation; /* File version (for NFS) */ __le32 i_file_acl_lo; /* File ACL */ __le32 i_size_high; ...... }; \u5176\u4e2d\uff0c i_block[] \u5b9a\u4e49\u4e86\u4e00\u4e2a\u6587\u4ef6\u88ab\u5212\u5206\u4e86\u591a\u5c11\u5757\uff0c\u6bcf\u4e00\u5757\u5728\u54ea\u91cc\u8fd9\u4e9b\u4fe1\u606f\u3002 \u6587\u4ef6\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4f7f\u7528 inode \u6765\u63cf\u8ff0, \u6bcf\u4e2a inode \u4e2d\u90fd\u542b\u6709\u4e00\u4e9b\u5217\u7684\u6570\u636e\u5757 \u5bf9\u4e8e\u666e\u901a\u6587\u4ef6: \u6570\u636e\u5757\u4e2d\u4fdd\u5b58\u7684\u662f\u6587\u4ef6\u6570\u636e \u5bf9\u4e8e\u6587\u4ef6\u5939: \u6570\u636e\u5757\u4e2d\u4fdd\u5b58\u7684\u662f\u5b50\u6587\u4ef6\u7684\u6587\u4ef6\u9879 \u4e3a\u4e86\u52a0\u5feb\u6587\u4ef6\u5939\u4e2d\u6587\u4ef6\u7684\u641c\u7d22\u901f\u5ea6, Linux \u901a\u8fc7\u7d22\u5f15\u6a21\u5f0f, \u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u540d\u7684\u6563\u5217\u5feb\u901f\u5b9a\u4f4d\u5230\u6587\u4ef6\u7684\u4f4d\u7f6e \u6587\u4ef6\u7684\u7ec4\u7ec7 Linux \u4e2d\u5c06\u78c1\u76d8\u7684\u5757\u5206\u6210\u4e00\u4e2a\u4e2a\u7684\u5757\u7ec4, \u6bcf\u4e2a\u5757\u7ec4\u7531\u4e00\u4e2a\u5757\u7ec4\u7684\u4f4d\u56fe\u548c\u5bf9\u5e94\u7684\u6570\u636e\u5757\u63cf\u8ff0, \u6700\u5927\u53ef\u63cf\u8ff0 128M \u7684\u7a7a\u95f4 \u6bcf\u4e2a\u5757\u7ec4\u6709\u5176\u5bf9\u5e94\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26, \u63cf\u8ff0\u7b26\u4e4b\u95f4\u5f62\u6210\u4e00\u4e2a\u94fe\u8868 \u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u5757\u7ec4, Linux \u901a\u8fc7\u5143\u5757\u7ec4\u6765\u63cf\u8ff0\u5757\u7ec4 \u4e00\u4e2a\u5143\u5757\u7ec4\u4e2d\u7531 64 \u4e2a\u5757\u7ec4\u7ec4\u6210, \u5176\u4e2d\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\u4e00\u5171 64 \u9879, \u5206\u522b\u5728 0, 1, 63 \u7684\u4f4d\u7f6e\u7684\u5757\u7ec4\u4e0a\u5907\u4efd\u4e09\u4efd \u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u901a\u8fc7\u8d85\u7ea7\u5757\u6765\u63cf\u8ff0 \u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5 \u8f6f\u94fe\u63a5: \u5728\u94fe\u63a5\u76ee\u6807\u6587\u4ef6\u4e4b\u524d, \u4f1a\u521b\u5efa\u81ea\u5df1\u7684 inode \u548c\u6570\u636e\u5757, \u7136\u540e\u5176\u6570\u636e\u5757\u4e2d\u7684\u5185\u5bb9\u6307\u5411\u76ee\u6807\u6587\u4ef6 \u53ef\u8de8\u7cfb\u7edf\u94fe\u63a5 \u786c\u94fe\u63a5: \u5373\u4e3a\u4e00\u4e2a\u6587\u4ef6\u521b\u5efa\u4e86\u4e00\u4e2a\u522b\u540d, \u8fd9\u4e2a\u522b\u540d\u4f1a\u6307\u5411\u771f\u5b9e\u6587\u4ef6\u7684 inode \u7ed3\u6784\u4f53 \u56e0\u4e3a\u76f4\u63a5\u6307\u5411\u6e90\u6587\u4ef6\u7ed3\u6784\u4f53, \u56e0\u6b64\u4ed6\u65e0\u6cd5\u8de8\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u94fe\u63a5","title":"\u8da3\u8c08Linux\u5185\u6838"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#01","text":"\u5f00\u7bc7\u8bcd\u5c31\u662f\u603b\u7ed3\u4e86\u63a5\u4e0b\u6765\u8981\u5b66\u4e60\u7684\u4e1c\u897f\u3002\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u95e8\u8bfe\u6709\u4ee5\u4e0b\u4eae\u70b9\uff1a \u6709\u6df1\u5ea6\uff08\u5176\u4e2d\u6d89\u53ca\u5230 Linux \u5185\u6838\u6e90\u7801\u89e3\u6790\uff09 \u6709\u5e7f\u5ea6\uff08\u4ece Linux \u57fa\u7840\uff0c\u8c08\u5230\u5185\u6838\uff0c\u5230\u865a\u62df\u5316\uff0c\u5230\u5bb9\u5668\u3001\u96c6\u7fa4\u3001\u6570\u636e\u4e2d\u5fc3\u64cd\u4f5c\u7cfb\u7edf\u7b49\uff09 \u6709\u8da3\u5473\uff08\u7c7b\u6bd4\u4e8e\u4e00\u5bb6\u516c\u53f8\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u8fd9\u5bb6\u516c\u53f8\u7684\u8001\u677f\uff09 \u56fe\u6587\u5e76\u8302 \u5f00\u7bc7\u653e\u51fa\u4e86\u4e00\u5f20 Linux \u64cd\u4f5c\u7cfb\u7edf\u5168\u666f\u56fe\uff08\u6df1\u5165\u5230\u4ee3\u7801\uff09\uff0c\u5982\u4e0b\uff1a \u8fd9\u5f20\u56fe\u5c55\u793a\u4e86\u8fdb\u7a0b\u3001\u6587\u4ef6\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u786c\u76d8\u4e4b\u95f4\u7684\u4e00\u4e2a\u5173\u7cfb\uff08Linux\u7684\u54f2\u5b66\u4e4b\u4e00\u5c31\u662f\u4e00\u5207\u7686\u6587\u4ef6\uff09\uff0c\u8fd9\u91cc\u9762\u6d89\u53ca\u5230\u5185\u6838\u4ee3\u7801\u7ed3\u6784\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u6570\u636e\u7ed3\u6784\u62fc\u63a5\u8d77\u6765\uff0c\u60f3\u8c61\u4e00\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u90a3\u4e48\u591a\u7ec4\u4ef6\uff0c\u600e\u4e48\u6837\u5f88\u597d\u5730\u7ba1\u7406\u8fd9\u4e9b\u7ec4\u4ef6\uff0c\u5c31\u662f\u628a\u4ed6\u4eec\u5b9a\u4e49\u6210\u4e00\u4e2a\u4e2a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u6709\u5173\u7cfb\u7684\u5c31\u8fde\u63a5\u8d77\u6765\u3002","title":"01 \u5f00\u7bc7\u4ecb\u7ecd"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#03","text":"\u4e00\u56fe\u80dc\u5343\u8a00","title":"03 \u5b66\u4e60\u8def\u5f84"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#04-linux","text":"\u4ece\u7535\u8111\u7ec4\u88c5\u8bf4\u8d77\u3002\u4e00\u53f0\u7535\u8111\u786c\u4ef6\u4e0a\u6765\u8bf4\u81f3\u5c11\u5e94\u8be5\u5305\u62ec\u4ee5\u4e0b\u7ec4\u4ef6\uff0c\u624d\u80fd\u6ee1\u8db3\u6211\u4eec\u4e2a\u4eba\u7684\u4f7f\u7528\u9700\u6c42\u3002 \u5149\u6709\u8fd9\u4e9b\u786c\u4ef6\u8bbe\u5907\u4e5f\u73a9\u4e0d\u8f6c\u4e00\u53f0\u7535\u8111\uff0c\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5927\u8111\u7684\u4e1c\u897f\u6765\u6307\u6325\u8fd9\u4e9b\u786c\u4ef6\u624d\u884c\uff0c\u8fd9\u4e2a\u5927\u8111\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u3002 \u64cd\u4f5c\u7cfb\u7edf\u8981\u7ba1\u7406\u4e0d\u540c\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u5c31\u9700\u8981\u6709\u4e0d\u540c\u7684\u6a21\u5757\u7ec4\u4ef6\uff0c\u5c31\u50cf\u4e00\u4e2a\u7ec4\u7ec7\u9700\u8981\u8bbe\u5b9a\u51e0\u4e2a\u4e0d\u540c\u7684\u8d1f\u8d23\u4eba\u4e00\u6837\u3002\u4ece\u529f\u80fd\u548c\u7ba1\u7406\u5bf9\u8c61\u4e0a\u8bf4\uff0c\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u5927\u7c7b\uff08\u64cd\u4f5c\u7cfb\u7edf\u4f53\u7cfb\u7ed3\u6784\u56fe\uff09\uff1a \u4e0a\u9762\u8fd9\u5e45\u56fe\u5173\u6ce8\u70b9\u5728\u4e8e\u5185\u6838\u6001\uff0c\u5bf9\u4e8e\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u5e94\u8be5\u5305\u62ec\u7528\u6237\u6001\uff0c\u4ee5\u53ca\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u4ea4\u4e92\u6a21\u5757\uff0c\u4e0b\u9762\u8fd9\u5e45\u56fe\u5305\u542b\u4e86\u8fd9\u4e00\u5207\uff0c\u800c\u4e14\u8fd8\u5305\u62ec\u4e86\u786c\u4ef6\u90e8\u5206\uff0c\u975e\u5e38\u5b8c\u6574\uff1a","title":"04 \u8ba4\u8bc6 Linux"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_1","text":"\u5982\u4f55\u627e Linux \u5185\u6838\u4ee3\u7801\uff1f Linux \u5185\u6838\u6e90\u7801\u94fe\u63a5\uff1a https://www.kernel.org/ \u5728\u91cc\u9762\u627e\u5230 kernel/git/torvalds/linux.git \u5373\u53ef\u4e0b\u8f7d \u63a8\u8350\u4e00\u4e2a \u5728\u7ebf\u9605\u8bfb\u6e90\u7801 \u7684\u7f51\u7ad9\uff08\u975e\u5e38\u8d5e\uff09\uff1a https://elixir.bootlin.com/linux/latest/source \u5185\u6838\u4ee3\u7801\u7ed3\u6784\u5982\u4f55\u4f53\u73b0\u51fa\u4e0a\u9762\u7684\u51e0\u5927\u5b50\u7cfb\u7edf\u7684\uff1f \u4ee5 Linux 3.0 \u4e3a\u4f8b\u770b\u770b\u5b83\u7684\u4ee3\u7801\u7ed3\u6784\uff1a \u76ee\u5f55 \u63cf\u8ff0 arch \u5305\u542b\u548c\u786c\u4ef6\u4f53\u7cfb\u7ed3\u6784\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u6bcf\u79cd\u5e73\u53f0\u5360\u4e00\u4e2a\u76f8\u5e94\u7684\u76ee\u5f55\uff0c\u5982 i386\u3001 ARM\u3001PowerPC\u3001MIPS \u7b49\u3002 block \u5757\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f I/O \u6a21\u5757\u3002 crypto \u5e38\u7528\u52a0\u5bc6\u548c\u6563\u5217\u7b97\u6cd5\uff08\u5982 AES\u3001SHA \u7b49\uff09\uff0c\u8fd8\u6709\u4e00\u4e9b\u538b\u7f29\u548c CRC \u6821 \u9a8c\u7b97\u6cd5\u3002 Documentation \u5185\u6838\u6e90\u7801\u6587\u6863 drivers \u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff0c\u6bcf\u4e2a\u4e0d\u540c\u7684\u9a71\u52a8\u5360\u7528\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u5982 char\u3001block\u3001net\u3001 mtd\u3001i2c \u7b49\u3002 firmware \u4f7f\u7528\u67d0\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u800c\u9700\u8981\u7684\u8bbe\u5907\u56fa\u4ef6 fs vfs \u548c \u652f\u6301\u7684\u5404\u79cd\u6587\u4ef6\u7cfb\u7edf\uff0c\u5982 EXT\u3001FAT\u3001NTFS\u3001JFFS2 \u7b49\u3002 include \u5185\u6838 \u5934\u6587\u4ef6\uff0c\u4e0e\u7cfb\u7edf\u76f8\u5173\u7684\u5934\u6587\u4ef6\u88ab\u653e\u7f6e\u5728 include/linux \u5b50\u76ee\u5f55\u4e0b init \u5185\u6838\u5f15\u5bfc\u548c\u521d\u59cb\u5316\u4ee3\u7801 ipc \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u4ee3\u7801 kernel \u5185\u6838\u7684\u6700\u6838\u5fc3\u90e8\u5206\uff0c\u5305\u62ec\u8fdb\u7a0b\u8c03\u5ea6\u3001\u5b9a\u65f6\u5668\u7b49\uff0c\u800c\u548c\u5e73\u53f0\u76f8\u5173\u7684\u4e00 \u90e8\u5206\u4ee3\u7801\u653e\u5728 arch/*/kernel \u76ee\u5f55\u4e0b lib \u5e93\u6587\u4ef6\u4ee3\u7801\uff0c\u901a\u7528\u5185\u6838\u51fd\u6570 mm \u5185\u5b58\u7ba1\u7406\u5b50\u7cfb\u7edf\u4ee3\u7801\uff0c\u548c\u5e73\u53f0\u76f8\u5173\u7684\u4e00\u90e8\u5206\u4ee3\u7801\u653e\u5728 arch/*/mm \u76ee\u5f55\u4e0b net \u7f51\u7edc\u5b50\u7cfb\u7edf\u76f8\u5173\u4ee3\u7801\uff0c\u5b9e\u73b0\u4e86\u5404\u79cd\u5e38\u89c1\u7684\u7f51\u7edc\u534f\u8bae samples \u793a\u4f8b\uff0c\u793a\u8303\u4ee3\u7801 scripts \u7f16\u8bd1\u5185\u6838\u6240\u7528\u7684\u811a\u672c\u6587\u4ef6 security Linux \u5b89\u5168\u6a21\u5757\uff0c \u4e3b\u8981\u5305\u542b SELinux \u6a21\u5757\u3002 sound \u97f3\u9891\u5b50\u7cfb\u7edf\uff0c ALSA\u3001OSS \u97f3\u9891\u8bbe\u5907\u7684\u9a71\u52a8\u6838\u5fc3\u4ee3\u7801\u548c\u5e38\u7528\u8bbe\u5907\u9a71\u52a8\u3002 usr \u65e9\u671f\u7528\u6237\u7a7a\u95f4\u4ee3\u7801\uff08\u6240\u8c13\u7684initramfs\uff09\uff0c \u5b9e\u73b0\u4e86\u7528\u4e8e\u6253\u5305\u548c\u538b\u7f29\u7684 cpio \u7b49 tools \u5728 Linux \u5f00\u53d1\u4e2d\u6709\u7528\u7684\u5de5\u5177 virt \u865a\u62df\u5316\u57fa\u7840\u7ed3\u6784","title":"\u5185\u6838\u4ee3\u7801"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#05-linux","text":"","title":"05 \u5feb\u901f\u4e0a\u624b Linux \u547d\u4ee4"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_2","text":"\u914d\u7f6e root \u5bc6\u7801\uff1a passwd \u6216 passwd root \uff08 passwd <user> \uff09 \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\uff1a useradd jay \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7528\u6237\u5e76\u52a0\u5230\u67d0\u4e2a\u7ec4\u91cc\uff1a useradd jay -g <gid> /etc/passwd \u548c /etc/group \u4e2d\u80fd\u591f\u770b\u5230\u7528\u6237\u5bc6\u7801\u548c\u7528\u6237\u7ec4\u7684\u4fe1\u606f","title":"\u7528\u6237\u540d\u548c\u5bc6\u7801"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_3","text":"ls -l drwxr-xr-x 6 root root 4096 Oct 20 2017 apt -rw-r--r-- 1 root root 211 Oct 20 2017 hosts \u7b2c\u4e00\u4e2a\u5b57\u6bb5\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26 - \u8868\u793a\u666e\u901a\u6587\u4ef6\uff0c d \u8868\u793a\u76ee\u5f55\u6587\u4ef6\uff0c l \u8868\u793a\u8fde\u63a5\u6587\u4ef6 \u63a5\u7740\u540e\u9762 9 \u4e2a\u5b57\u7b26\u8868\u793a\u6a21\u5f0f\uff08\u6743\u9650\u4f4d\uff09\uff0c\u524d\u9762 3 \u4e2a\u662f\u6240\u5c5e\u7528\u6237\u7684\u8bfb\u5199\u6267\u884c\u6743\u9650\uff0c\u4e2d\u95f4 3 \u4e2a\u662f\u7528\u6237\u6240\u5c5e\u7ec4\u7684\uff0c\u540e\u9762 3 \u4e2a\u662f\u5176\u4ed6\u7528\u6237\u7684\u3002\u6539\u53d8\u6743\u9650\u4f7f\u7528 chmod 711 <file> \u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u662f\u786c\u94fe\u63a5\u6570\u76ee \u7b2c\u4e09\u4e2a\u5b57\u6bb5\u662f\u6240\u5c5e\u7528\u6237 \u7b2c\u56db\u4e2a\u5b57\u6bb5\u662f\u6240\u5c5e\u7528\u6237\u7ec4 \u7b2c\u4e94\u4e2a\u5b57\u6bb5\u662f\u6587\u4ef6\u5927\u5c0f \u7b2c\u516d\u4e2a\u5b57\u6bb5\u662f\u6587\u4ef6\u88ab\u4fee\u6539\u7684\u65e5\u671f \u6700\u540e\u662f\u6587\u4ef6\u540d chmod \u6539\u53d8\u6587\u4ef6\u6743\u9650\uff0c chown \u6539\u53d8\u6240\u5c5e\u7528\u6237\uff0c chgrp \u6539\u53d8\u6240\u5c5e\u7ec4\u3002 # \u5c06\u6587\u4ef6 file.txt \u7684\u62e5\u6709\u8005\u6539\u4e3a root\uff0c\u8fd9\u4e2a\u547d\u4ee4\u9700\u8981\u6709\u8d85\u7ea7\u7528\u6237\u6743\u9650\u624d\u80fd\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u547d\u4ee4\u4e4b\u524d\u52a0\u4e0asudo sudo chown root file.txt # \u6539\u53d8\u6587\u4ef6\u7684\u62e5\u6709\u7ec4\u4e3aroot\u7ec4 sudo chgrp root file.txt # \u5c06\u6587\u4ef6\u7684\u6240\u5c5e\u7ec4\u7531 root \u6539\u4e3a tim chgrp -v tim file.txt","title":"\u6d4f\u89c8\u6587\u4ef6"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_4","text":"\u76f8\u5bf9\u4e8e Windows \u7684 exe \u3001 zip \u7b49\u5305\uff0cLinux \u5e38\u7528\u6709 rpm \uff08Centos \u7cfb\uff09\u3001 deb \uff08Ubuntu \u7cfb\uff09 \u548c tar.gz \u7b49\u5305\u3002 rpm \u548c deb # centos rpm rpm -i jdk-XXX_linux-x64_bin.rpm # ubuntu deb dpkg -i jdk-xxx_linux-x64_bin.deb # \u67e5\u770b\u5b89\u88c5\u8f6f\u4ef6\u5217\u8868 rpm -qa dpkg -l # \u7ffb\u9875 rpm -qa | more rpm -qa | less # \u52a0\u641c\u7d22 rpm -qa | grep jdk dpkg -l | grep jdk # \u5220\u9664 rpm -e dpkg -r Linux \u8f6f\u4ef6\u7ba1\u5bb6\uff1a yum \u548c apt-get # \u641c\u7d22\u8f6f\u4ef6 yum search jdk apt-cache search jdk # \u5b89\u88c5 yum install java-11-openjdk.x86_64 apt-get install openjdk-9-jdk \u914d\u7f6e\u8f6f\u4ef6\u6e90\uff1a\u56fd\u5185\u5e38\u7528\u662f \u963f\u91cc\u6e90 \u548c 163\u6e90 \u3002\uff08\u7528\u5230\u65f6\u641c\u7d22\u5373\u53ef\uff09 centos\uff1a /etc/yum.repos.d/CentOS-Base.repo ubuntu: /etc/apt/sources.list \u5305\u4e0b\u8f7d\u548c\u538b\u7f29\u89e3\u538b\u7f29 # \u4e0b\u8f7d wget # \u538b\u7f29\u89e3\u538b\u7f29 yum install zip.x86_64 unzip.x86_64 apt-get install zip unzip unzip <xx.zip> tar zxvf jdk-XXX_linux-x64_bin.tar.gz \u8fd0\u884c\u7a0b\u5e8f # 01 \u76f4\u63a5\u8fd0\u884c <command> \u6216\u8005 <./command> # 02 \u540e\u53f0\u8fd0\u884c nohup <command> >out.file 2>&1 & # \u540e\u53f0\u8fdb\u7a0b\u5173\u95ed ps -ef |grep \u5173\u952e\u5b57 |awk '{print $2}'|xargs kill -9 # 03 \u4ee5\u670d\u52a1\u7684\u65b9\u5f0f\u8fd0\u884c /lib/systemd/system # \u6bd4\u5982 mysql apt-get install mysql-server # \u5b89\u88c5 systemctl start mysql # \u542f\u52a8 systemctl enable mysql # \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8 # centos \u4e2d MySQL \u662f MariaDB\u3002/usr/lib/systemd/system/","title":"\u5b89\u88c5\u8f6f\u4ef6"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_5","text":"# \u5173\u673a shutdown -h now poweroff # \u91cd\u542f reboot","title":"\u5f00\u5173\u673a"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_6","text":"","title":"\u4e00\u56fe\u603b\u7ed3\u4e4b"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#05","text":"\u8fdb\u7a0b\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\uff1a fork\uff1a\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u8fd4\u56de\u4e24\u4e2a\u503c\uff0c\u5982\u679c\u662f 0\uff0c\u8868\u793a\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c >0 \u8868\u793a\u7236\u8fdb\u7a0b\uff0c\u503c\u662f\u5b50\u8fdb\u7a0b\u7684 ID\u3002 execve\uff1a\u521b\u5efa\u51fa\u7684\u5b50\u8fdb\u7a0b\u6267\u884c\u7684\u7cfb\u7edf\u8c03\u7528\uff08\u6709\u4e00\u5957\u51fd\u6570\u96c6\uff09\u3002 waitpid\uff1a\u7236\u8fdb\u7a0b\u76d1\u542c\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u60c5\u51b5\u3002 \u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u67e5\u8be2\u66f4\u52a0\u8be6\u7ec6\u7684\u4fe1\u606f: $ps -o pid,pgid,ppid,sid,tty,comm (tty\u8868\u793a\u63a7\u5236\u7ec8\u7aef\uff09 \u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\uff1a \u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u7cfb\u7edf\u8c03\u7528\uff1a brk\uff1a\u5f53\u5206\u914d\u5185\u5b58\u91cf\u5c0f\u7684\u65f6\u5019\uff08\u5177\u4f53\u662f 128K\uff09\u4f7f\u7528\uff1b mmap\uff1a\u5f53\u5206\u914d\u5185\u5b58\u91cf\u5927\u4e8e 128K \u65f6\u4f7f\u7528\uff0c\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u907f\u514d \u5185\u5b58\u788e\u7247 \u7684\u95ee\u9898\u3002\u53c2\u8003 \u8fd9\u91cc \u5f02\u5e38\u4e0e\u4fe1\u53f7\u5904\u7406\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\uff1a kill\uff1a\u7528\u6237\u8fdb\u7a0b\u53d1\u9001\u4e00\u4e2a\u9000\u51fa\u4fe1\u53f7\u7ed9\u53e6\u4e00\u4e2a\u8fdb\u7a0b sigaction\uff1a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff08\u65e0\u89c6(ignore)\u4fe1\u53f7\u3001\u9ed8\u8ba4(default)\u64cd\u4f5c\u3001\u81ea\u5b9a\u4e49\u64cd\u4f5c\uff09 $man 7 signal \u67e5\u9605\u66f4\u591a\u7684\u4fe1\u53f7\u3002\u4e00\u4e9b\u5e38\u7528\u7684\u4fe1\u53f7\uff1a SIGINT \u5f53\u952e\u76d8\u6309\u4e0b CTRL+C \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u4e2d\u65ad (INTERRUPT) \u8be5\u8fdb\u7a0b\u3002 SIGQUIT \u5f53\u952e\u76d8\u6309\u4e0b CTRL+\\ \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u9000\u51fa (QUIT) \u8be5\u8fdb\u7a0b\u3002 SIGTSTP \u5f53\u952e\u76d8\u6309\u4e0b CTRL+Z \u4ece shell \u4e2d\u53d1\u51fa\u4fe1\u53f7\uff0c\u4fe1\u53f7\u88ab\u4f20\u9012\u7ed9shell\u4e2d\u524d\u53f0\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5bf9\u5e94\u8be5\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\u662f\u6682\u505c (STOP) \u8be5\u8fdb\u7a0b\u3002 SIGCONT \u7528\u4e8e\u901a\u77e5\u6682\u505c\u7684\u8fdb\u7a0b\u7ee7\u7eed\u3002 SIGALRM \u8d77\u5230\u5b9a\u65f6\u5668\u7684\u4f5c\u7528\uff0c\u901a\u5e38\u662f\u7a0b\u5e8f\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\u4e4b\u540e\u624d\u751f\u6210\u8be5\u4fe1\u53f7\u3002 \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7cfb\u7edf\u8c03\u7528\uff1a \u6d88\u606f\u961f\u5217\uff1amsgget\uff08\u521b\u5efa\uff09\u3001msgsnd\uff08\u53d1\u9001\uff09\u3001msgrcv\uff08\u63a5\u6536\uff09 \u5171\u4eab\u5185\u5b58\uff08\u901a\u4fe1\u91cf\u5927\uff09\uff1ashmget\uff08\u521b\u5efa\uff09\u3001shmat\uff08\u6620\u5c04\u5171\u4eab\u5185\u5b58\uff09 \u4fe1\u53f7\u91cf\uff08\u8d44\u6e90\u8bbf\u95ee\u7ade\u4e89\uff09\uff1asem_wait\uff08\u5360\u7528\u8d44\u6e90\uff09\u3001sem_post\uff08\u91ca\u653e\u8d44\u6e90\uff09 \u7ba1\u9053\uff08\u65e0\u540d\u7ba1\u9053\u548c\u547d\u540d\u7ba1\u9053\uff09 Socket \u53c2\u8003 \u8fd9\u91cc C \u51fd\u6570\u5e93\uff08glibc\uff09\u548c\u7cfb\u7edf\u8c03\u7528\u7684\u5173\u7cfb\uff1a C \u51fd\u6570\u5e93\u662f\u5bf9\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u76ee\u7684\u662f\u4ee5\u4e00\u79cd\u66f4\u53cb\u597d\u7684\u65b9\u5f0f\u4f9b\u4e0a\u5c42\u7528\u6237\u7684\u8c03\u7528\u3002\u7cfb\u7edf\u8c03\u7528\u66f4\u50cf\u662f\u7ec4\u6210\u4e00\u4e2a\u6c49\u5b57\u7684 \u7b14\u753b \uff0c\u800c\u5e93\u51fd\u6570\u5219\u50cf \u504f\u65c1\u90e8\u9996 \u3002\u6bd4\u5982 glibc \u4e2d\u7684 printf \u51fd\u6570\u5c31\u4f1a\u8c03\u7528 sys_open \u3001 sys_mmap \u3001 sys_write \u3001 sys_close \u7b49\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002malloc \u51fd\u6570\u4e5f\u4f1a\u8fdb\u4e00\u6b65\u8c03\u7528\u5230 sys_brk \u7b49\u51fd\u6570\u3002 Tips\uff1a $man 2 syscalls \u53ef\u4ee5\u67e5\u770b\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\uff0c $man 2 read \u67e5\u770b\u7cfb\u7edf\u8c03\u7528 read \u7684\u8be6\u7ec6\u8bf4\u660e\u3002","title":"05 \u7cfb\u7edf\u8c03\u7528"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_7","text":"","title":"\u4e00\u56fe\u603b\u7ed3"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#06-x86","text":"\u786c\u4ef6\u56fe\u7ed3\u5408\u8ba1\u7b97\u673a\u7684\u903b\u8f91\u56fe\uff1a CPU \u548c \u5185\u5b58\u5982\u4f55\u914d\u5408\u5de5\u4f5c\uff1a CPU \u5305\u62ec\uff1a \u8fd0\u7b97\u5355\u5143\uff1a\u5982\u52a0\u51cf\u4e58\u9664 \u6570\u636e\u5355\u5143\uff1aCPU \u5185\u90e8\u7684\u7f13\u5b58\u548c\u5bc4\u5b58\u5668\u7ec4 \u63a7\u5236\u5355\u5143\uff1a\u6307\u4ee4\u83b7\u53d6\u3001\u63a7\u5236 \u6307\u4ee4\u6307\u9488\u5bc4\u5b58\u5668\uff1a\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4\u5728\u5185\u5b58\u4e2d\u7684\u5730\u5740 \u6307\u4ee4\u5bc4\u5b58\u5668 x86 CPU \u7ec4\u4ef6\u653e\u5927\u56fe\uff1a \u8fd0\u7b97\u5355\u5143\uff1a \u901a\u7528\u5bc4\u5b58\u5668 \u63a7\u5236\u5355\u5143\uff1a IP\uff1a\u6307\u4ee4\u6307\u9488\u5bc4\u5b58\u5668 CS\uff1a \u4ee3\u7801\u5bc4\u5b58\u5668 DS\uff1a\u6570\u636e\u5bc4\u5b58\u5668 SS\uff1a\u6808\u5bc4\u5b58\u5668 \u4e00\u56fe\u603b\u7ed3\u4e4b\uff1a","title":"06 x86 \u4f53\u7cfb\u67b6\u6784"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#07-linux","text":"1 \u6253\u5f00\u7535\u6e90\uff0c\u4ece\u4e3b\u677f\u4e0a\u7684 BIOS \u8bfb\u53d6\u5176\u4e2d\u5b58\u50a8\u7684\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u77e5\u9053\u4e3b\u677f\u8fde\u63a5\u54ea\u4e9b\u786c\u4ef6\uff08\u786c\u76d8\u3001\u7f51\u7edc\u63a5\u53e3\u3001\u952e\u76d8\u3001\u4e32\u53e3\u3001\u5e76\u53e3\uff09\uff0cBIOS \u4f1a\u68c0\u67e5\u4ee5\u54ea\u79cd\u65b9\u5f0f\u542f\u52a8\uff08\u8f6f\u76d8\u3001\u5149\u76d8\u3001\u786c\u76d8\uff09\u3002\uff08BIOS \u5b58\u50a8\u5728 ROM \u53ea\u8bfb\u533a\uff09 2 \u8bfb\u53d6\u542f\u52a8\u76d8\u4e2d\u7684\u524d 512 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f MBR \uff08\u4e3b\u5f15\u5bfc\u6247\u533a\uff09 3 MBR \u4f1a\u4ece\u8bbe\u5907\u7684\u67d0\u4e00\u4e2a\u5206\u533a\u6765\u8f6c\u8f7d \u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f \uff08BootLoader\uff09 \uff0cBootLoader \u542b\u6709 OS \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 OS \u5185\u6838\uff0cOS \u5185\u6838\u6240\u5728\u7684\u4f4d\u7f6e\u7b49\u3002\u5e38\u7528\u7684 BootLoader \u7a0b\u5e8f\u6709 GRUB2 \u548c LILO \u3002 \u53ef\u4ee5\u901a\u8fc7 grub2-mkconfig -o /boot/grub2/grub.cfg \u6765\u914d\u7f6e\u7cfb\u7edf\u542f\u52a8\u7684\u9009\u9879\u3002 4 BootLoader \u63a5\u7740\u4f1a\u52a0\u8f7d\u5185\u6838\u7a0b\u5e8f \u5177\u4f53\u5730\uff0c\u5b83\u4f1a\u5b89\u88c5 boot.img \u3001 core.img \u7b49\u955c\u50cf\u7a0b\u5e8f\u3002\u5176\u4e2d kernel.img \u5c31\u662f\u5b58\u653e\u7684 OS \u5185\u6838\u7a0b\u5e8f\u3002\u4e00\u822c\u4f1a\u6709\u591a\u4e2a\u7a0b\u5e8f\uff08\u591a\u64cd\u4f5c\u7cfb\u7edf\uff09\uff0c\u6211\u4eec\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u3002 5 \u5047\u5982\u9009\u62e9 Linux\u5185\u6838\uff0c\u5185\u6838\u4f1a\u9884\u7559\u4e00\u90e8\u5206\u81ea\u5df1\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u901a\u8fc7\u9a71\u52a8\u7a0b\u5e8f\u68c0\u6d4b\u54ea\u4e9b\u8ba1\u7b97\u673a\u786c\u4ef6\u53ef\u7528\uff0c\u7136\u540e\u4f1a\u542f\u52a8\u4e00\u4e2a init \u8fdb\u7a0b\uff0c\u5b83\u662f Linux \u5185\u6838\u4e2d\u7684 1 \u53f7\u8fdb\u7a0b\uff08Linux \u6ca1\u6709 0 \u53f7\u8fdb\u7a0b\uff09\uff0c\u81f3\u6b64\uff0c\u4fbf\u5b8c\u6210\u542f\u52a8\u9636\u6bb5\u505a\u7684\u4e8b\uff0c\u63a5\u4e0b\u6765\u5c31\u4ea4\u7ed9 init \u8fdb\u7a0b\u6765\u7ba1\u7406\u3002 6 init \u8fdb\u7a0b\u4f1a\u8fd0\u884c\u4e00\u7cfb\u5217\u7684\u521d\u59cb\u811a\u672c\uff08shell\u811a\u672c\uff09\uff1a \u8bbe\u7f6e\u8ba1\u7b97\u673a\u540d\u79f0\uff0c\u65f6\u533a\uff0c\u68c0\u6d4b\u6587\u4ef6\u7cfb\u7edf\uff0c\u6302\u8f7d\u786c\u76d8\uff0c\u6e05\u7a7a\u4e34\u65f6\u6587\u4ef6\uff0c\u8bbe\u7f6e\u7f51\u7edc\u2026\u2026 \u81f3\u6b64\uff0c\u6574\u4e2a OS \u4fbf\u51c6\u5907\u597d\u4e86\uff0c init \u542f\u52a8\u767b\u5f55\u7a0b\u5e8f\uff0c\u8f93\u5165\u7528\u6237\u540d\u3001\u5bc6\u7801\u4fbf\u53ef\u81ea\u884c\u73a9\u800d\u4e86\u3002 \u9644\uff1a grub2 \u547d\u4ee4\u7684\u4f7f\u7528\u624b\u518c\u89c1\uff1a http://www.cnblogs.com/f-ck-need-u/p/7094693.html","title":"07 Linux \u542f\u52a8\u8fc7\u7a0b"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#08","text":"\u4ece\u6e90\u7801\u4e0a\u6765\u8bb2\uff0c\u5185\u6838\u521d\u59cb\u5316\u4ece \u51fd\u6570 start_kernel \u5f00\u59cb\u7684\uff0c\u76f8\u5f53\u4e8e\u5185\u6838\u7684 main \u51fd\u6570\uff0c\u5728\u6587\u4ef6 init/main.c \u4e2d\u3002\u5b83\u603b\u7684\u8981\u8fdb\u884c\u51e0\u4ef6\u4e8b\uff1a \u4efb\u52a1\u521d\u59cb\u5316 \u4e2d\u65ad\u521d\u59cb\u5316 \u5185\u5b58\u7ba1\u7406\u521d\u59cb\u5316 \u8c03\u5ea6\u5668\u521d\u59cb\u5316 \u5176\u4ed6\uff08\u5982\u8fdb\u7a0b\u7ebf\u7a0b\uff09\u521d\u59cb\u5316 init_task \u4ea7\u751f 0 \u53f7\u8fdb\u7a0b\uff0c\u8fd9\u662f\u552f\u4e00\u4e00\u4e2a\u6ca1\u6709\u901a\u8fc7 fork \u6216\u8005\u5176\u4ed6 kernel_thread \u4ea7\u751f\u7684\u8fdb\u7a0b\uff0c\u662f\u8fdb\u7a0b\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u3002 rest_init \u4f1a\u4ea7\u751f\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u4e00\u53f7\u8fdb\u7a0b\u548c\u4e8c\u53f7\u8fdb\u7a0b\u6765\u5bf9\u7528\u6237\u6001\u548c\u5185\u6838\u8fdb\u884c\u521d\u59cb\u5316\u3002 CPU \u7684\u5206\u5c42\u6743\u9650\u9650\u5236\uff0c\u5bfc\u81f4\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u8bbf\u95ee\u9700\u8981\u91c7\u7528\u7cfb\u7edf\u8c03\u7528\u7684\u624b\u6bb5\uff1a \u7cfb\u7edf\u8c03\u7528\u603b\u7684\u4e00\u4e2a\u8fc7\u7a0b\u57fa\u672c\u4e0a\u662f\uff1a","title":"08 \u5185\u6838\u521d\u59cb\u5316"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#09","text":"\u7528\u6237\u6001\u8bbf\u95ee\u5185\u6838\uff1a \u7cfb\u7edf\u8c03\u7528 C \u51fd\u6570\u5e93 glibc\uff08\u6700\u7ec8\u4e5f\u662f\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff09 \u5728 glibc \u6e90\u4ee3\u7801\u4e2d\uff0c\u6709\u4e2a\u6587\u4ef6 syscallls.list \uff0c\u91cc\u9762\u5217\u7740\u6240\u6709 glibc \u7684\u51fd\u6570\u5bf9\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u3002 # File name Caller Syscall name Args Strong name Weak names open - open Ci:siv __libc_open __open open Glibc \u8fd8\u6709\u4e00\u4e2a\u6587\u4ef6 syscall-tmplate.S \uff0c\u4f7f\u7528 \u5b8f\uff0c\u5b9a\u4e49\u4e86\u7cfb\u7edf\u8c03\u7528\u7684\u8c03\u7528\u65b9\u5f0f\uff1a T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS) ret T_PSEUDO_END (SYSCALL_SYMBOL) #define T_PSEUDO(SYMBOL, NAME, N) PSEUDO (SYMBOL, NAME, N) \u8fd9\u91cc\u6709\u4e00\u4e2a \u5b8f PSEUDO \uff0c\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u90fd\u4f1a\u8c03\u7528\u5230\u8fd9\u4e2a \u5b8f\uff1a #define PSEUDO(name, syscall_name, args) \\ .text; \\ ENTRY (name) \\ DO_CALL (syscall_name, args); \\ cmpl $-4095, %eax; \\ jae SYSCALL_ERROR_LABEL 32 \u4f4d\u7cfb\u7edf\u8c03\u7528\u8fc7\u7a0b\u548c 64 \u4f4d\u8fd8\u6709\u4e9b\u8bb8\u4e0d\u540c\uff0c\u6211\u4eec\u76f4\u63a5\u770b 64 \u4f4d\u7684\uff1a \u63a5\u7740\uff0c\u5f00\u59cb\u9677\u5165\u5185\u6838\uff0cOS \u4f1a\u5c06\u7cfb\u7edf\u8c03\u7528\u540d\u79f0\u8f6c\u6362\u4e3a\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u653e\u5230\u5bc4\u5b58\u5668 rax \u4e2d\uff0c\u7136\u540e\u6267\u884c syscall \uff0c\u7136\u540e\u901a\u8fc7\u4e00\u79cd\u7279\u6b8a\u6a21\u5757\u5bc4\u5b58\u5668\uff08MSR\uff09\u6765\u5b8c\u6210\u7cfb\u7edf\u8c03\u7528\u7684\u529f\u80fd\uff0c\u5b83\u4f1a\u5c06\u7cfb\u7edf\u8c03\u7528\u76f8\u5173\u7684\u6307\u4ee4\u538b\u5165\u5185\u6838\uff1a \u7136\u540e\u901a\u8fc7\u4e00\u4e2a \u7cfb\u7edf\u8c03\u7528\u8868 \u627e\u5230\u76f8\u5e94\u7684\u51fd\u6570\uff0c\u8fdb\u884c\u6267\u884c\u3002 \u7cfb\u7edf\u8c03\u7528\u8868\u5b58\u653e\u7740\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0c\u5bf9\u4e8e 64\u4f4d\u7684\u7cfb\u7edf\uff0c\u662f\u5b9a\u4e49\u5728\u6587\u4ef6 arch/x86/entry/syscalls/syscall_64.tbl \u4e2d\u7684\uff08\u6bd4\u5982 open \u662f\u8fd9\u6837\u5b9a\u4e49\u7684\uff09: 2 common open sys_open \u901a\u8fc7\u5bc4\u5b58\u5668 rax \u4e2d\u7684\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u7cfb\u7edf\u8c03\u7528\u8868\u4e2d\u5bf9\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0c\u4ece\u800c\u6267\u884c\u771f\u6b63\u7684\u5185\u6838\u51fd\u6570\uff0c\u6bd4\u5982 open \u5bf9\u5e94\u5185\u6838\u51fd\u6570\u4e3a sys_open \u3002","title":"09 \u7cfb\u7edf\u8c03\u7528"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#10","text":"\u5b89\u88c5\u5f00\u53d1\u5957\u4ef6\uff1a(centos 7) yum -y groupinstall \"Development Tools\" \u7a0b\u5e8f\u6587\u4ef6\u5177\u6709 \u4e25\u683c\u7684\u683c\u5f0f \uff1aELF\uff08Executeable and Linkable Format\uff09 ELF \u662f\u4e00\u79cd\u7528\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\u3001\u53ef\u6267\u884c\u6587\u4ef6\u3001\u76ee\u6807\u4ee3\u7801\u3001\u5171\u4eab\u5e93\u548c\u6838\u5fc3\u8f6c\u50a8\u7684\u6807\u51c6\u6587\u4ef6\u683c\u5f0f\u3002 \u76ee\u6807\u6587\u4ef6\u6709\u4e09\u7c7b\uff08\u53ef\u901a\u8fc7 file \u547d\u4ee4\u67e5\u770b\uff09\uff1a \u53ef\u91cd\u5b9a\u4f4d\u7684\u76ee\u6807\u6587\u4ef6\uff08.o \u6587\u4ef6\uff09 \u53ef\u6267\u884c\u7684\u76ee\u6807\u6587\u4ef6\uff08.exe \u6587\u4ef6\uff09 \u53ef\u88ab\u5171\u4eab\u7684\u76ee\u6807\u6587\u4ef6\uff08.so \u52a8\u6001\u5e93\u6587\u4ef6\uff09 \u4ece\u6587\u672c\u6587\u4ef6\u5230\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8fc7\u7a0b\uff1a 1\u3001.o \u6587\u4ef6\u65f6 ELF \u7684\u7b2c\u4e00\u79cd\u6587\u4ef6\u7c7b\u578b\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a \u5c06 .o \u5f52\u6863\u4e3a .a \u7684\u9759\u6001\u5e93\u6587\u4ef6\uff0c\u4f7f\u7528\u547d\u4ee4 ar\uff1a ar cr libstaticprocess.a process.o .text\uff1a\u5b58\u653e\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u4ee3\u7801 .rodata\uff1a\u53ea\u8bfb\u6570\u636e\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u5e38\u91cf\u3001const \u7684\u53d8\u91cf .data\uff1a\u5df2\u7ecf\u521d\u59cb\u5316\u597d\u7684\u5168\u5c40\u53d8\u91cf .bss\uff1a\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf .symtab\uff1a\u7b26\u53f7\u8868\uff0c\u8bb0\u5f55\u7684\u4e8b\u51fd\u6570\u548c\u53d8\u91cf .strtab\uff1a\u5b57\u7b26\u4e32\u8868\u3001\u5b57\u7b26\u4e32\u5e38\u91cf\u548c\u53d8\u91cf\u540d \u7f16\u8bd1\u7684\u65f6\u5019\u4f7f\u7528\u9759\u6001\u94fe\u63a5\u5e93\uff1a gcc -o staticcreateprocess createprocess.o -L. -lstaticprocess 2\u3001\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u4e3a ELF \u7684\u7b2c\u4e8c\u79cd\u683c\u5f0f\u3002 \u9759\u6001\u94fe\u63a5\u5e93\u5982\u679c\u66f4\u65b0\uff0c\u90a3\u4e2a\u591a\u4e2a\u5f15\u7528\u7684\u7a0b\u5e8f\u90fd\u8981\u968f\u4e4b\u66f4\u65b0\uff0c\u6548\u7387\u4f4e\uff0c\u56e0\u4e3a\u51fa\u73b0\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u53ef\u88ab\u591a\u4e2a\u7a0b\u5e8f\u5171\u4eab\u3002 3\u3001\u52a8\u6001\u94fe\u63a5\u5e93\u662f ELF \u7684\u7b2c\u4e09\u79cd\u683c\u5f0f\u3002\u5171\u4eab\u5bf9\u8c61\u6587\u4ef6\u3002 gcc -shared -fPIC -o libdynamicprocess.so process.o gcc -o dynamiccreateprocess createprocess.o -L. -ldynamicprocess \u5f53\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\u88ab\u94fe\u63a5\u5230\u4e00\u4e2a\u7a0b\u5e8f\u6587\u4ef6\u4e2d\u7684\u65f6\u5019\uff0c\u6700\u540e\u7684\u7a0b\u5e8f\u6587\u4ef6\u5e76\u4e0d\u5305\u62ec\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684\u4ee3\u7801\uff0c\u800c\u4ec5\u4ec5\u5305\u62ec\u5bf9\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f15\u7528\uff0c\u5e76\u4e14\u4e0d\u4fdd\u5b58\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5168\u8def\u5f84\uff0c\u4ec5\u4ec5\u4fdd\u5b58\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u540d\u79f0\u3002 \u7cfb\u7edf\u9ed8\u8ba4\u52a0\u8f7d\u7684\u8def\u5f84\u662f /lib \u548c /usr/lib\uff0c\u53ef\u4ee5\u4f7f\u7528 LD_LIBRARY_PATH \u6765\u81ea\u5b9a\u4e49\u52a8\u6001\u5e93\u94fe\u63a5\u7684\u8def\u5f84\u3002 export LD_LIBRARY_PATH = . \u8fdb\u7a0b\u8c03\u7528 exec -> load_elf_binary\uff0c\u6700\u7ec8\u5c06\u52a8\u6001\u5e93\u52a0\u8f7d\u7684\u5185\u5b58\u3002 exec \u51fd\u6570\uff1a \u5305\u542b p \u7684\u51fd\u6570\uff08execvp, execlp\uff09\u4f1a\u5728 PATH \u8def\u5f84\u4e0b\u9762\u5bfb\u627e\u7a0b\u5e8f\uff1b \u4e0d\u5305\u542b p \u7684\u51fd\u6570\u9700\u8981\u8f93\u5165\u7a0b\u5e8f\u7684\u5168\u8def\u5f84\uff1b \u5305\u542b v \u7684\u51fd\u6570\uff08execv, execvp,execve\uff09\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u63a5\u6536\u53c2\u6570\uff1b \u5305\u542b l \u7684\u51fd\u6570\uff08execl, execlp, execle\uff09\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u63a5\u6536\u53c2\u6570\uff1b \u5305\u542b e \u7684\u51fd\u6570\uff08execve, execle\uff09\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u63a5\u6536\u73af\u5883\u53d8\u91cf\u3002 \u8fdb\u7a0b\u6811\uff1a \u6240\u6709\u8fdb\u7a0b\u90fd\u662f\u7531\u7236\u8fdb\u7a0b fork \u8fc7\u6765\u7684\uff0c\u5f80\u524d\u8ffd\u6eaf\uff0c\u4f1a\u627e\u5230\u7956\u5b97\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u7cfb\u7edf\u542f\u52a8\u7684 init \u8fdb\u7a0b\u3002 \u6709\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u6bd4\u5982 centos \uff0c/sbin/init \u4f1a\u88ab\u94fe\u63a5\u5230 systemd\u3002 \u4e00\u56fe\u603b\u7ed3\u4e4b\uff1a Tips: \u67e5\u770b ELF \u6587\u4ef6\u7684\u5de5\u5177\uff1a readelf\uff1a\u5206\u6790 ELF \u6587\u4ef6\u7684\u4fe1\u606f objdump\uff1a\u663e\u793a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4fe1\u606f hexdump\uff1a\u67e5\u770b\u6587\u4ef6\u7684 16\u8fdb\u5236\u7f16\u7801 nm\uff1a\u663e\u793a\u5173\u4e8e\u6307\u5b9a\u6587\u4ef6\u4e2d\u7b26\u53f7\u7684\u4fe1\u606f","title":"10 \u8fdb\u7a0b"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#11","text":"\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u7f16\u8bd1\u4f9d\u8d56\u4e8e libpthread.so gcc thread.c -lpthread \u666e\u901a\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u8fd0\u884c\u8fc7\u7a0b\uff1a \u591a\u7ebf\u7a0b\u53ef\u8bbf\u95ee\u7684\u6570\u636e\uff1a \u7ebf\u7a0b\u6808\u4e0a\u7684\u672c\u5730\u6570\u636e\uff0c\u6bd4\u5982\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u3002\uff08 ulimit -a \u67e5\u770b\u6808\u7684\u5927\u5c0f\uff09 \u6574\u4e2a\u8fdb\u7a0b\u91cc\u5171\u4eab\u7684\u5168\u5c40\u6570\u636e\uff0c\u6bd4\u5982\u5168\u5c40\u53d8\u91cf \u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e \u7ebf\u7a0b\u5171\u4eab\u6570\u636e\u7684\u4fdd\u62a4\u95ee\u9898\uff1a Mutex\uff08\u4e92\u65a5\u53d8\u91cf\uff09 \u6761\u4ef6\u53d8\u91cf\uff08\u4e00\u822c\u548c\u4e92\u65a5\u9501\u914d\u5408\u4f7f\u7528\uff09","title":"11 \u7ebf\u7a0b"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#12","text":"\u5728\u5185\u6838\u4e2d\uff0c\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u662f\u7531\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 task_struct \u6765\u7edf\u4e00\u7ba1\u7406\u3002 \u6bcf\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5b9a\u4e49\u4e00\u4e2a\u8fd9\u4e2a\u7ed3\u6784\uff0c\u591a\u4e2a\u8fdb\u7a0b\u7528\u94fe\u8868\u8fde\u63a5\u8d77\u6765\u3002 \u5176\u4e2d\uff0c \u4efb\u52a1 ID\uff1a pid\uff1a\u8fdb\u7a0b id tgid\uff1a\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u4e3b\u7ebf\u7a0b\u5bf9\u5e94\u7684\u8fdb\u7a0b ID group_leader\uff1a\u591a\u7ebf\u7a0b\u4e2d\u4e3b\u7ebf\u7a0b \u4fe1\u53f7\u5904\u7406\uff1a /* Signal handlers: */ struct signal_struct *signal; struct sighand_struct *sighand; sigset_t blocked; sigset_t real_blocked; sigset_t saved_sigmask; struct sigpending pending; unsigned long sas_ss_sp; size_t sas_ss_size; unsigned int sas_ss_flags; \u5305\u62ec\uff0c blocked\uff1a\u963b\u585e\u6682\u4e0d\u5904\u7406 pending\uff1a\u5c1a\u7b49\u5f85\u5904\u7406 sighand\uff1a\u6b63\u5728\u88ab\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5904\u7406 \u4efb\u52a1\u72b6\u6001\uff1a \u503c\u5b9a\u4e49\u5728 include/linux/sched.h \u4e2d\uff0c /* Used in tsk->state: */ #define TASK_RUNNING 0 #define TASK_INTERRUPTIBLE 1 #define TASK_UNINTERRUPTIBLE 2 #define __TASK_STOPPED 4 #define __TASK_TRACED 8 /* Used in tsk->exit_state: */ #define EXIT_DEAD 16 #define EXIT_ZOMBIE 32 #define EXIT_TRACE (EXIT_ZOMBIE | EXIT_DEAD) /* Used in tsk->state again: */ #define TASK_DEAD 64 #define TASK_WAKEKILL 128 #define TASK_WAKING 256 #define TASK_PARKED 512 #define TASK_NOLOAD 1024 #define TASK_NEW 2048 #define TASK_STATE_MAX 4096 \u6240\u6709\u5b9a\u4e49\u7684\u72b6\u6001\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5176\u4e2d\uff0c TASK_RUNNING\uff1a\u8868\u793a\u8fdb\u7a0b\u5728\u65f6\u523b\u51c6\u5907\u8fd0\u884c\uff08\u5e76\u4e0d\u662f\u6b63\u5728\u8fd0\u884c\uff0c\u5f53\u83b7\u5f97 CPU \u65f6\u95f4\u7247\u7684\u65f6\u5019\u8fdb\u5165\u8fd0\u884c\uff09 TASK_INTERRUPTIBLE\uff1a\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001\uff08\u6d45\u7761\u7720\uff09\uff0c\u5f53\u4fe1\u53f7\u6765\u7684\u65f6\u5019\uff0c\u8fdb\u7a0b\u53ef\u88ab\u5524\u9192 TASK_UNINTERRUPTIBLE\uff1a\u4e0d\u53ef\u4e2d\u65ad\u7684\u7761\u7720\u72b6\u6001\uff08\u6df1\u7761\u7720\uff09\uff0c\u4e0d\u53ef\u88ab\u4fe1\u53f7\u5524\u9192\uff0c\u53ea\u80fd\u6b7b\u7b49 I/O \u64cd\u4f5c\u5b8c\u6210\uff0ckill \u4e5f\u4e0d\u884c TASK_KILLABLE\uff1a\u53ef\u4ee5\u7ec8\u6b62\u7684\u7761\u7720\u72b6\u6001\uff0c\u4e0a\u9762\u7684\u6539\u826f\uff0c\u53ef\u4ee5\u54cd\u5e94\u81f4\u547d\u4fe1\u53f7 TASK_WAKEKILL\uff1a\u5728\u63a5\u6536\u81f4\u547d\u4fe1\u53f7\u65f6\u5524\u9192\u8fdb\u7a0b TASK_STOPPED\uff1a\u8fdb\u7a0b\u6536\u5230 SIGSTOP\u3001SIGINT\u3001SIGTSTP \u6216\u8005 SIGTTOU \u540e\u8fdb\u5165\u7684\u72b6\u6001 TASK_TRACED\uff1a\u8fdb\u7a0b\u88ab debugger \u7b49\u8fdb\u7a0b\u76d1\u89c6\uff0c\u8fdb\u7a0b\u6267\u884c\u88ab\u8c03\u8bd5\u7a0b\u5e8f\u6240\u505c\u6b62 EXIT_ZOMBIE\uff1a\u8fdb\u7a0b\u7ed3\u675f\u9996\u5148\u8fdb\u5165\u7684\u72b6\u6001\uff0c\u5982\u679c\u7236\u8fdb\u7a0b\u6ca1\u6709\u8c03\u7528 waitpid() \u51fd\u6570\u7684\u8bdd\uff0c\u5c31\u6210\u4e3a \u50f5\u5c38\u8fdb\u7a0b EXIT_DEAD \u8fdb\u7a0b\u7684\u6700\u7ec8\u72b6\u6001","title":"12 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#13","text":"\u8fdb\u7a0b\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e00\u4e9b\u7edf\u8ba1\u91cf\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u4e86\u89e3\u8fdb\u7a0b\u7684\u5de5\u4f5c\u60c5\u51b5\uff1a u64 utime;// \u7528\u6237\u6001\u6d88\u8017\u7684 CPU \u65f6\u95f4 u64 stime;// \u5185\u6838\u6001\u6d88\u8017\u7684 CPU \u65f6\u95f4 unsigned long nvcsw;// \u81ea\u613f (voluntary) \u4e0a\u4e0b\u6587\u5207\u6362\u8ba1\u6570 unsigned long nivcsw;// \u975e\u81ea\u613f (involuntary) \u4e0a\u4e0b\u6587\u5207\u6362\u8ba1\u6570 u64 start_time;// \u8fdb\u7a0b\u542f\u52a8\u65f6\u95f4\uff0c\u4e0d\u5305\u542b\u7761\u7720\u65f6\u95f4 u64 real_start_time;// \u8fdb\u7a0b\u542f\u52a8\u65f6\u95f4\uff0c\u5305\u542b\u7761\u7720\u65f6\u95f4 \u8fdb\u7a0b\u7684\u4eb2\u7f18\u5173\u7cfb\uff1a struct task_struct __rcu *real_parent; /* real parent process */ struct task_struct __rcu *parent; /* recipient of SIGCHLD, wait4() reports */ struct list_head children; /* list of my children */ struct list_head sibling; /* linkage in my parent's children list */ parent\uff1a\u6307\u5411\u5176\u7236\u8fdb\u7a0b children\uff1a\u8868\u793a\u94fe\u8868\u5934\u90e8 sibling\uff1a\u8868\u793a\u5144\u5f1f\u94fe\u8868 \u6574\u4e2a\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fdb\u7a0b\u6743\u9650\u63a7\u5236\uff1a /* Objective and real subjective task credentials (COW): */ const struct cred __rcu *real_cred; /* Effective (overridable) subjective task credentials (COW): */ const struct cred __rcu *cred; real_cred\uff1a\u8c01\u80fd\u64cd\u4f5c\u8fd9\u4e2a\u8fdb\u7a0b cred\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u80fd\u591f\u64cd\u4f5c\u8c01 \u5185\u5b58\u7ba1\u7406\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u72ec\u7acb\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u7528 mm_struct \u8868\u793a\uff1a struct mm_struct *mm; struct mm_struct *active_mm; \u6587\u4ef6\u4e0e\u6587\u4ef6\u7cfb\u7edf\uff1a \u6bcf\u4e2a\u8fdb\u7a0b\u6709\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6570\u636e\u7ed3\u6784\uff0c\u548c\u4e00\u4e2a\u6253\u5f00\u6587\u4ef6\u7684\u6570\u636e\u7ed3\u6784\uff1a /* Filesystem information: */ struct fs_struct *fs; /* Open file information: */ struct files_struct *files;","title":"13 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e2d\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#_8","text":"\u4e09\u904d\u5b66\u4e60\u6cd5+PPT\u7b14\u8bb0 \u7b2c\u4e00\u904d\u5b66\u4e60\uff1a\u5148\u8bfb\u8584\uff0c\u4e0d\u8981\u5728\u4e4e\u4e00\u57ce\u4e00\u6c60\u7684\u5f97\u5931\uff0c\u68b3\u7406\u4e3b\u6b21\u77db\u76fe\uff0c\u8bb0\u5f55\u6240\u6709\u95ee\u9898 \u7b2c\u4e8c\u904d\u5b66\u4e60\uff1a\u518d\u8bfb\u539a\uff0c\u628a\u63e1\u4e3b\u7ebf\uff0c\u653b\u514b\u5404\u4e2a\u95ee\u9898\uff08\u7528 PPT \u7b14\u8bb0\u6cd5\u8bb0\u5f55\u8fd9\u4e2a\u8fc7\u7a0b\uff09 \u7b2c\u4e09\u904d\u5b66\u4e60\uff1a\u518d\u8bfb\u8584\uff0c\u53d8\u6210\u81ea\u5df1\u7684\u4e1c\u897f\uff0c\u603b\u4f53\u68b3\u7406\u77e5\u8bc6\u70b9\uff0c\u53ef\u4ee5\u7528xmind\u601d\u7ef4\u5bfc\u56fe\uff0c\u878d\u6c47\u8d2f\u901a","title":"\u52a0\u9910\uff08\u4e00\uff09\u5b66\u4e60\u653b\u7565"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#14","text":"\u7528\u6237\u6001\u51fd\u6570\u6808\uff1a \u51fd\u6570\u8c03\u7528\u65f6\u7684\u6808\u5982\u4e0b\u6240\u793a\uff0832\u4f4d\uff09\uff1a\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\uff0c\u5f80\u4e0b\u589e\u957f\uff0c\u4e0a\u9762\u662f\u6808\u5e95\uff0c\u4e0b\u9762\u662f\u6808\u9876\u3002 \u5728 64\u4f4d\u7684\u73af\u5883\uff0cEBP \u53d8\u6210\u4e86 RBP\uff0cESP \u53d8\u6210\u4e86 RSP\u3002 \u5185\u6838\u6001\u51fd\u6570\u6808\uff1a \u8fdb\u7a0b\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u8054\u7cfb\u7528\u5230\u5982\u4e0b\u7ed3\u6784\uff1a struct thread_info thread_info; void *stack; \u5176\u4e2d\uff0cstack \u5373\u7ef4\u62a4\u5185\u6838\u51fd\u6570\u6808\u3002 \u5f53\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u540e\uff0c\u9700\u8981\u5c06\u7528\u6237\u6001\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684 CPU \u4e0a\u4e0b\u6587\u4fdd\u5b58\u8d77\u6765\uff0c\u5176\u5b9e\u662f\u4fdd\u5b58\u7684 pt_regs \u8fd9\u4e2a\u7ed3\u6784\uff0c \u901a\u8fc7 task_struct \u7684 stack \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u5185\u6838\u6808\uff1a static inline void *task_stack_page(const struct task_struct *task) { return task->stack; } \u901a\u8fc7 stack \u5c31\u80fd\u5f88\u65b9\u4fbf\u627e\u5230 pt_regs \uff1a /* * TOP_OF_KERNEL_STACK_PADDING reserves 8 bytes on top of the ring0 stack. * This is necessary to guarantee that the entire \"struct pt_regs\" * is accessible even if the CPU haven't stored the SS/ESP registers * on the stack (interrupt gate does not save these registers * when switching to the same priv ring). * Therefore beware: accessing the ss/esp fields of the * \"struct pt_regs\" is possible, but they may contain the * completely wrong values. */ #define task_pt_regs(task) \\ ({ \\ unsigned long __ptr = (unsigned long)task_stack_page(task); \\ __ptr += THREAD_SIZE - TOP_OF_KERNEL_STACK_PADDING; \\ ((struct pt_regs *)__ptr) - 1; \\ }) \u53cd\u8fc7\u6765\uff0c\u5185\u6838\u6808\u901a\u8fc7 thread_info \u8fd9\u4e2a\u7ed3\u6784\u6765\u627e task_struct \uff0c struct thread_info { struct task_struct *task; /* main task structure */ __u32 flags; /* low level flags */ __u32 status; /* thread synchronous flags */ __u32 cpu; /* current CPU */ mm_segment_t addr_limit; unsigned int sig_on_uaccess_error:1; unsigned int uaccess_err:1; /* uaccess failed */ }; \u5176\u4e2d struct task_struct *task; \u5373\u662f\u6307\u5411 task_struct \uff0c\u901a\u5e38 current_thread_info()->task \u6765\u83b7\u53d6 task_struct \u3002 \u4e00\u56fe\u603b\u7ed3\uff1a","title":"14 \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\uff08\u4e0b\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#15","text":"\u6307\u7684\u662f\u8fdb\u7a0b\u6570\u91cf\u8fdc\u8d85\u8fc7 CPU \u7684\u6570\u76ee\uff0c\u9700\u8981\u8fdb\u884c CPU \u8c03\u5ea6\u6267\u884c\u3002 \u8fdb\u7a0b\u5305\u62ec\u4e24\u79cd\uff1a \u5b9e\u65f6\u8fdb\u7a0b \u666e\u901a\u8fdb\u7a0b \u5b9e\u65f6\u8fdb\u7a0b\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\u6bd4\u666e\u901a\u8fdb\u7a0b\u8981\u9ad8\u3002\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u4f4e\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002 \u5b9e\u65f6\u8fdb\u7a0b\u4f18\u5148\u7ea7\u8303\u56f4\uff1a0-99 \u666e\u901a\u8fdb\u7a0b\u4f18\u5148\u7ea7\u8303\u56f4\uff1a100-139 task_struct \u4e2d\u6709\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\uff0c\u53eb \u8c03\u5ea6\u7b56\u7565 \uff1a unsigned int policy; \u5305\u62ec\u4ee5\u4e0b\u7b56\u7565\uff1a #define SCHED_NORMAL 0 #define SCHED_FIFO 1 #define SCHED_RR 2 #define SCHED_BATCH 3 #define SCHED_IDLE 5 #define SCHED_DEADLINE 6 \u5176\u4e2d\uff0c SCHED_FIFO\uff08\u5148\u6765\u5148\u670d\u52a1\uff09 \u3001 SCHED_RR\uff08\u65f6\u95f4\u7247\u8f6e\u6d41\u8c03\u5ea6\uff09 \u3001 SCHED_DEADLINE\uff08\u6839\u636e deadline \u9009\u62e9\u8c03\u5ea6\uff09 \u662f\u5b9e\u65f6\u8fdb\u7a0b\u8c03\u5ea6\u7b56\u7565\uff0c \u5269\u4f59\uff0c SCHED_NORMAL\uff08\u666e\u901a\u8fdb\u7a0b\uff09 \u3001 SCHED_BATCH\uff08\u540e\u53f0\u8fdb\u7a0b\uff09 \u3001 SCHED_IDLE\uff08\u7a7a\u95f2\u8fdb\u7a0b\uff09 \u662f\u666e\u901a\u8fdb\u7a0b\u8c03\u5ea6\u7b56\u7565\u3002 \u901a\u5e38\u6700\u5e38\u7528\u7684\u8c03\u5ea6\u7b97\u6cd5\u662f \u666e\u901a\u8fdb\u7a0b\u4f7f\u7528\u7684 \u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u7b97\u6cd5\uff1a \u7528\u7403\u88c5\u8fdb\u53e3\u888b\u7684\u4f8b\u5b50\u6765\u7406\u89e3\uff0c\u7403\u5c11\u7684\u888b\u5b50\u591a\u653e\u70b9\u7403\uff0c\u8fd9\u6837\u7ecf\u8fc7\u51e0\u8f6e\uff0c\u867d\u4e0d\u80fd\u4fdd\u8bc1\u6240\u6709\u53e3\u888b\u7403\u5b8c\u5168\u4e00\u6837\uff0c\u4f46\u4e5f\u5dee\u4e0d\u591a\u516c\u5e73\u3002 \u8fd9\u4e2a\u7b97\u6cd5\u7684\u5e95\u5c42\u5b9e\u73b0\u662f\u901a\u8fc7 \u7ea2\u9ed1\u6811 \u6765\u5b9e\u73b0\u7684\u3002 \u7ea2\u9ed1\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u8bb0\u5f55\u4e00\u4e2a vruntime\uff0cvruntime \u662f\u865a\u62df\u8fd0\u884c\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u8fdb\u7a0b\u65f6\u949f tick \u6570\uff0c\u7528\u6765\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u5360\u7528 CPU \u7684\u65f6\u95f4\u6ef4\u7b54\u6570\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u516c\u5e73\u3002 \u603b\u7ed3\uff1a \u4e00\u4e2a CPU \u4e0a\u6709\u4e00\u4e2a\u961f\u5217\uff0c\u5373 CFS\uff08\u516c\u5e73\u8c03\u5ea6\u961f\u5217\uff09\uff0c\u8fd9\u5b9e\u73b0\u4e0a\u662f\u4e00\u9897\u7ea2\u9ed1\u6811\uff0c\u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a sched_entity\uff08\u8c03\u5ea6\u5b9e\u4f53\uff09 \uff0c\u6bcf\u4e2a `sched_entity \u90fd\u5c5e\u4e8e\u4e00\u4e2a task_struct \uff0c task_struct \u91cc\u6709\u6307\u9488\u6307\u5411\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u54ea\u4e2a\u8c03\u5ea6\u7c7b\u3002\u5728\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u4f9d\u6b21\u8c03\u7528\u8c03\u5ea6\u7c7b\u7684\u51fd\u6570\uff0c\u4ece CPU \u7684\u961f\u5217\u4e2d\u53d6\u51fa\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u3002","title":"15 \u8c03\u5ea6\uff08\u4e0a\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#16","text":"\u5206\u4e3a\uff1a\u4e3b\u52a8\u8c03\u5ea6\u548c\u88ab\u52a8\u8c03\u5ea6 \u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff1a \u4e3b\u8981\u5e72\u4e24\u4ef6\u4e8b\uff1a\u4e00\u662f\u5207\u6362\u8fdb\u7a0b\u7a7a\u95f4\uff0c\u4e5f\u5373\u865a\u62df\u5185\u5b58\uff0c\u4e8c\u662f\u5207\u6362\u5bc4\u5b58\u5668\u548c CPU \u4e0a\u4e0b\u6587 \u4e3b\u52a8\u8c03\u5ea6\u7684\u8fc7\u7a0b\uff1a \u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b\u4e3b\u52a8\u8c03\u7528 __schedule \u8ba9\u51fa CPU\uff0c\u5728 __schedule \u91cc\u4f1a\u505a\u4e24\u4ef6\u4e8b\u60c5\uff0c\u7b2c\u4e00\u662f\u9009\u53d6\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7b2c\u4e8c\u662f\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u800c\u4e0a\u4e0b\u6587\u5207\u6362\u53c8\u5206\u4e3a\u7528\u6237\u8fdb\u7a0b\u7a7a\u95f4\u5207\u6362\u548c\u5185\u6838\u6001\u7684\u5207\u6362","title":"16 \u8c03\u5ea6\uff08\u4e2d\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#17","text":"\u62a2\u5360\u5f0f\u8c03\u5ea6\uff1a\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u65f6\u95f4\u592a\u957f\u4e86\uff0c\u662f\u65f6\u5019\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e86\u3002","title":"17 \u8c03\u5ea6\uff08\u4e0b\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#18","text":"\u9996\u5148\u8c03\u7528 fork \u7cfb\u7edf\u8c03\u7528 --> sys_call_table --> sys_fork --> _do_fork --> copy_process # \u7b2c\u4e00\u4ef6\u5927\u4e8b --> dup_task_struct --> alloc_task_struct_node # \u5206\u914d task_struct --> alloc_thread_stack_node # \u521b\u5efa\u5185\u6838\u6808 --> arch_dup_task_struct # \u8c03\u7528 memcpy \u5c06task_struct \u8fdb\u884c\u590d\u5236 --> setup_thread_stack # \u8bbe\u7f6e thread_info --> copy_creds --> prepare_creds # memcpy \u590d\u5236\u4e00\u4efd\u7236\u8fdb\u7a0b\u7684 cred --> \u8bbe\u7f6e\u8fdb\u7a0b\u8fd0\u884c\u7edf\u8ba1\u91cf --> sched_fork # \u8bbe\u7f6e\u8c03\u5ea6\u76f8\u5173\u7684\u53d8\u91cf --> __sched_fork # \u8bbe\u7f6e\u5305\u62ec\u8fd0\u884c\u65f6\u95f4\uff0c\u8fdb\u7a0b\u72b6\u6001\uff0c\u4f18\u5148\u7ea7\uff0c\u8c03\u5ea6\u7c7b --> copy_files # \u590d\u5236\u4e00\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u4fe1\u606f --> dup_fd # \u590d\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26 --> file_fs # \u590d\u5236\u4e00\u4e2a\u8fdb\u7a0b\u7684\u76ee\u5f55\u4fe1\u606f --> copy_sighand # \u521d\u59cb\u5316\u4fe1\u53f7\u76f8\u5173\u7684\u53d8\u91cf --> copy_mm # \u590d\u5236\u5185\u5b58\u7a7a\u95f4\uff0c\u8fdb\u7a0b\u7a7a\u95f4\u7528 mm_struct \u7ed3\u6784\u8868\u793a --> wake_up_new_task # \u7b2c\u4e8c\u4ef6\u5927\u4e8b,\u8bd5\u56fe\u5524\u9192\u521b\u5efa\u7684\u5b50\u8fdb\u7a0b --> activate_task --> enqueue_task # \u6fc0\u6d3b\u8fdb\u7a0b --> enqueue_task_fair # \u5982\u679c\u662f CFS \u7684\u8c03\u5ea6\u7c7b\uff0c\u6267\u884c\u76f8\u5e94\u8c03\u5ea6\u7c7b \u4ee5\u4e0a\u7b2c\u4e00\u9636\u6bb5\u7684\u8fc7\u7a0b\u5982\u4ee5\u4e0b\u56fe\u793a\u6240\u793a\uff1a","title":"18 \u8fdb\u7a0b\u7684\u521b\u5efa"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#19","text":"\u548c\u8fdb\u7a0b\u4e00\u6837\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u662f\u7531\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u5171\u540c\u5b8c\u6210\u7684\u3002 \u5b83\u4eec\u90fd\u8981\u4f9d\u6258\u4e8e\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 task_struct \uff0c\u4e0b\u9762\u770b\u770b\u7ebf\u7a0b\u5177\u4f53\u521b\u5efa\u5c31\u7684\u8fc7\u7a0b\uff1a \u4ece\u7528\u6237\u8c03\u7528 pthread_create \u5f00\u59cb\uff0c 1\u3001\u8bbe\u7f6e\u7ebf\u7a0b\u5c5e\u6027\u53c2\u6570 2\u3001pthread \u7ed3\u6784\u7528\u6237\u6001\u7ef4\u62a4\u7ebf\u7a0b 3\u3001\u521b\u5efa\u7ebf\u7a0b\u6808(ALLOCATE_STACK) - - 4\u3001\u8fdb\u5165\u5185\u6838 \u8c03\u7528 create_thread 5\u3001\u8c03\u7528 __clone --> sys_call --> _do_fork # \u548c\u8fdb\u7a0b\u4e0d\u540c\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u5bf9\u76f8\u5173\u7684 \u7ed3\u6784 \u505a\u5f15\u7528\u8ba1\u6570 +1\uff0c\u800c\u4e0d\u662f\u590d\u5236\u3002 \u4e0b\u56fe\u603b\u7ed3\u4e86\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u521b\u5efa\u7684\u533a\u522b\uff1a","title":"19 \u7ebf\u7a0b\u7684\u521b\u5efa"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#20","text":"\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684 \u4e09\u4e2a\u65b9\u9762\uff1a \u7269\u7406\u5185\u5b58\u7684\u7ba1\u7406\uff1a\u7269\u7406\u5185\u5b58\u5730\u5740\u53ea\u6709\u5185\u5b58\u7ba1\u7406\u6a21\u5757\u80fd\u591f\u4f7f\u7528 \u865a\u62df\u5185\u5b58\u7684\u7ba1\u7406\uff1a\u6bcf\u4e2a\u8fdb\u7a0b\u770b\u5230\u7684\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e92\u4e0d\u5e72\u6270\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4 \u865a\u62df\u5730\u5740\u548c\u7269\u7406\u7684\u5730\u5740\u7684\u6620\u5c04\u7ba1\u7406\uff1a\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u901a\u8fc7\u9875\u8868\u7ed3\u6784\u5173\u8054\u8d77\u6765 \u6253\u5370\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u7684\u5e03\u5c40\u7684\u547d\u4ee4\uff1a cat /proc/$pid/map","title":"20 \u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09\uff1a\u89c4\u5212\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u5e03\u5c40"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#21","text":"\u865a\u62df\u5185\u5b58\u8f6c\u5230\u7269\u7406\u5185\u5b58\uff0c\u9700\u8981\u7528\u5230\u4e24\u79cd\u673a\u5236\uff1a\u5206\u6bb5\u673a\u5236\u548c\u5206\u9875\u673a\u5236\u3002 \u5206\u6bb5\u673a\u5236\uff1a \u5927\u4f53\u601d\u8def\u662f\u901a\u8fc7\u6bb5\u57fa\u5730\u5740\u548c\u6bb5\u5185\u504f\u79fb\uff0c\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002 \u5206\u9875\u673a\u5236\uff1a \u901a\u8fc7\u9875\u8868\u76ee\u5f55\u9879\u548c\u9875\u5185\u504f\u79fb\u91cf\uff0c\u5c06\u865a\u62df\u5730\u5740\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002 \u5bf9\u4e8e 64\u4f4d\uff0c\u5219\u9875\u8868\u76ee\u5f55\u66f4\u591a\uff0c\u5982\u4e0b\uff1a \u5185\u5b58\u6620\u5c04\uff1a\u5c06\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u6620\u5c04\u8d77\u6765\uff0c\u5e76\u4e14\u5728\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\u53ef\u4ee5\u6362\u51fa\u5230\u786c\u76d8\u4e2d\u3002","title":"21 \u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#22","text":"\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u7ba1\u7406\u6765\u81ea\u4e8e\u4e00\u4e2a\u7ed3\u6784\uff1a struct mm_struct **mm \u5176\u4e2d\uff0c\u4e00\u4e2a\u6210\u5458\u53d8\u91cf: unsigned long task_size \u5b9a\u4e49\u4e86\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684\u5927\u5c0f\u5206\u754c\u7ebf\u3002 \u5bf9\u4e8e 32 \u4f4d\u7cfb\u7edf\uff0c\u6700\u5927\u80fd\u591f\u5bfb\u5740 2^32=4G\uff0c\u5176\u4e2d\u7528\u6237\u6001\u865a\u62df\u5730\u5740\u7a7a\u95f4\u662f 3G\uff0c\u5185\u6838\u6001\u662f 1G\u3002 \u5bf9\u4e8e 64 \u4f4d\u7cfb\u7edf\uff0c\u865a\u62df\u5730\u5740\u53ea\u4f7f\u7528\u4e86 48 \u4f4d\u3002\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u5927\u5c0f\u90fd\u662f 128T\u3002 \u5982\u4e0b\uff1a \u5185\u5b58\u7a7a\u95f4\u5e03\u5c40\uff1a \u4ee5\u4e0a\u8fd9\u4e9b\u533a\u57df\u901a\u8fc7\u4e0b\u9762\u7684\u7ed3\u6784\u63cf\u8ff0\uff1a struct vm_area_struct *mmap; /* list of VMAs */ struct rb_root mm_rb; 64\u4f4d\u7684\u5185\u6838\u7a7a\u95f4\u5e03\u5c40\uff1a \u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u4e24\u5e45\u56fe\u8868\u793a\uff1a 32\u4f4d\uff1a 64\u4f4d\uff1a","title":"22 \u8fdb\u7a0b\u7a7a\u95f4\u7ba1\u7406"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#23","text":"\u7269\u7406\u5185\u5b58\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u6709\u4e24\u79cd\uff1a SMP\uff1a\u5bf9\u79f0\u591a\u5904\u7406\u5668 NUMA \uff1a\u975e\u4e00\u81f4\u5185\u5b58\u8bbf\u95ee \u5728 NUMA \u7ed3\u6784\u4e2d\uff0c\u628a\u5185\u5b58\u5206\u6210\u8282\u70b9\uff0c\u628a\u8282\u70b9\u5206\u6210\u533a\u57dfzone\uff0c\u533a\u57df\u53c8\u5206\u4e3a\u9875\uff0c \u9875\u662f\u7ec4\u6210\u7269\u7406\u5185\u5b58\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u9875\u7684\u6570\u636e\u7ed3\u6784\u662f struct page \u3002 \u5728Linux\u4e2d\uff0c\u5982\u679c\u8981\u5206\u914d\u6bd4\u8f83\u5927\u7684\u5185\u5b58\uff0c\u4f8b\u5982\u5206\u914d\u9875\u7ea7\u522b\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u4f19\u4f34\u7cfb\u7edf\u3002 \u51e0\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u6240\u793a\uff1a","title":"23 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0a\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#24","text":"\u7269\u7406\u5185\u5b58\u5206 NUMA \u8282\u70b9\uff0c\u5206\u522b\u8fdb\u884c\u7ba1\u7406 \u4f19\u4f34\u7cfb\u7edf\u5c06\u591a\u4e2a\u8fde\u7eed\u7684\u9875\u9762\u4f5c\u4e3a\u4e00\u4e2a\u5927\u7684\u5185\u5b58\u5757\u5206\u914d\u7ed9\u4e0a\u5c42\u3002 \u5c0f\u5185\u5b58\u7684\u5206\u914d\u4f7f\u7528 slub \u5206\u914d\u5668\u3002\u5b83\u4f1a\u4ece\u4f19\u4f34\u7cfb\u7edf\u4e2d\u7533\u8bf7\u5927\u5185\u5b58\u5757\u5207\u5206\u6210\u5c0f\u5757\uff0c\u5206\u914d\u7ed9\u5176\u4ed6\u7cfb\u7edf\u3002 \u5185\u5b58\u9875\u9762\u7684\u6362\u5165\u6362\u51fa\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b kswapd \uff0c\u5b83\u4f1a\u5faa\u73af\u68c0\u67e5\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5f53\u5185\u5b58\u5145\u8db3\u7684\u65f6\u5019\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u4f1a\u505a\uff0c\u5f53\u5185\u5b58\u5403\u7d27\u4e86\uff0c\u5b83\u4f1a\u68c0\u67e5\u662f\u5426\u5e94\u8be5\u6362\u51fa\u4e00\u4e9b\u5185\u5b58\u9875\u3002 \u5e38\u7528\u7684\u4e00\u4e2a\u5185\u5b58\u6362\u51fa\u7b97\u6cd5\u662f LRU\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u3002 \u7528\u4e0b\u9762\u8fd9\u4e2a\u56fe\u603b\u7ed3\uff1a\u4f19\u4f34\u7cfb\u7edf\u548c Slub \u5206\u914d\u5668\uff1a","title":"24 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff08\u4e0b\uff09"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#25","text":"\u5185\u5b58\u6620\u5c04\uff1a \u7269\u7406\u5185\u5b58\u548c\u865a\u62df\u5185\u5b58\u4e4b\u95f4\u7684\u6620\u5c04 \u5c06\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u6620\u5c04\u5230\u865a\u62df\u5185\u5b58\u7a7a\u95f4 \u5185\u5b58\u6620\u5c04\u901a\u8fc7\u4e00\u4e2a \u7cfb\u7edf\u8c03\u7528 mmap \u6765\u5b8c\u6210\uff0c\u5185\u5b58\u6620\u5c04\u533a\u5728\u5185\u5b58\u7ed3\u6784\u4e2d\u7684\u4f4d\u7f6e\u5982\u4e0b\u6240\u793a\uff1a \u5f53\u6211\u4eec\u5728\u7533\u8bf7\u5185\u5b58\u65f6\uff0c\u5982\u679c\u7533\u8bf7\u7684\u662f\u5c0f\u5757\u5185\u5b58\uff0c\u5c31\u7528 brk\uff0c\u5982\u679c\u7533\u8bf7\u5927\u5757\u5185\u5b58\uff0c\u5c31\u7528 mmap\u3002 mmap \u4f9d\u8d56\u4e8e\u9875\u8868\u9879\uff0c\u9875\u8868\u7531\u4e8e\u4e00\u822c\u90fd\u8f83\u5927\uff0c\u6240\u4ee5\u53ea\u80fd\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u8bbf\u5b58\u7684\u6027\u80fd\u4e0b\u964d\u3002 \u4e3a\u4e86\u52a0\u5feb\u6620\u5c04\u901f\u5ea6\uff0c\u5f15\u5165 TLB \u5757\u8868\uff0cTLB \u5b58\u50a8\u5728 Cache \u4e2d\uff0c\u5b58\u50a8\u7684\u662f\u9875\u8868\u9879\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u865a\u62df\u5730\u5740\u627e\u5230\u7269\u7406\u5730\u5740\u3002\u5185\u5b58\u6620\u5c04\u7684\u65f6\u5019\uff0c\u4f1a\u9996\u5148\u67e5 TLB \u8868\uff0c\u5757\u8868\u4e2d\u6709\u6620\u5c04\u5173\u7cfb\uff0c\u5c31\u76f4\u63a5\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u624d\u4f1a\u5230\u5185\u5b58\u4e2d\u67e5\u8be2\u9875\u8868\u3002 \u5982\u679c\u7528\u6237\u6001\u8bbf\u95ee\u6ca1\u6709\u6620\u5c04\u7684\u5185\u5b58\u4f1a\u5f15\u53d1\u7f3a\u9875\u5f02\u5e38\uff0c\u5206\u914d\u7269\u7406\u9875\u8868\u3001\u8865\u9f50\u9875\u8868\u3002\u5982\u679c\u662f swap\uff0c\u5219\u5c06 swap \u6587\u4ef6\u8bfb\u5165\uff0c\u5982\u679c\u662f\u6587\u4ef6\u6620\u5c04\uff0c\u5219\u5c06\u6587\u4ef6\u8bfb\u5165\u3002","title":"25 \u7528\u6237\u6001\u5185\u5b58\u6620\u5c04"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#26","text":"vmalloc \u548c kmap_atomic \u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4 vmalloc \u533a\u57df\u7528\u4e8e\u6620\u5c04 kmap_atomic \u4e34\u65f6\u6620\u5c04 32 \u4f4d, \u8c03\u7528 set_pte \u901a\u8fc7\u5185\u6838\u9875\u8868\u4e34\u65f6\u6620\u5c04 64 \u4f4d, \u8c03\u7528 page_address\u2192lowmem_page_address \u8fdb\u884c\u6620\u5c04 \u5185\u6838\u6001\u7f3a\u9875\u5f02\u5e38 kmap_atomic \u76f4\u63a5\u521b\u5efa\u9875\u8868\u8fdb\u884c\u6620\u5c04 vmalloc \u53ea\u5206\u914d\u5185\u6838\u865a\u62df\u5730\u5740, \u8bbf\u95ee\u65f6\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad, \u8c03\u7528 \u7269\u7406\u5185\u5b58\u7ba1\u7406\uff1a \u7528\u6237\u6001\u5185\u5b58\u5206\u914d\uff1a \u5185\u6838\u6001\u5185\u5b58\u5206\u914d\uff1a \u5185\u5b58\u5206\u914d\u4f53\u7cfb\u603b\u56fe\uff1a","title":"26 \u5185\u6838\u6001\u5185\u5b58\u6620\u5c04"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#27","text":"\u6587\u4ef6\u7cfb\u7edf\u7684\u8bbe\u8ba1\u539f\u5219\uff1a \u4e25\u683c\u7684\u7ec4\u7ec7\u5f62\u5f0f\uff0c\u4ee5\u5757\u4e3a\u5355\u4f4d\u8fdb\u884c\u5b58\u50a8 \u8981\u6709\u7d22\u5f15\u533a \u5e94\u8be5\u6709\u7f13\u5b58\u5c42\uff0c\u5b58\u653e\u7ecf\u5e38\u88ab\u8bfb\u5199\u7684\u6587\u4ef6 \u4ee5\u6587\u4ef6\u5939\u7684\u5f62\u5f0f\u7ec4\u7ec7\uff0c\u65b9\u4fbf\u7ba1\u7406\u548c\u67e5\u8be2 linux \u7ef4\u62a4\u4e00\u5957\u6570\u636e\u7ed3\u6784\uff0c\u4fdd\u5b58\u54ea\u4e9b\u6587\u4ef6\u88ab\u54ea\u4e9b\u8fdb\u7a0b\u6253\u5f00\u548c\u4f7f\u7528 \u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u547d\u4ee4\uff1a fdisk -l # \u67e5\u770b\u683c\u5f0f\u5316\u548c\u6ca1\u6709\u683c\u5f0f\u5316\u7684\u5206\u533a mkfs.ext4 /dev/vdc # \u5bf9\u78c1\u76d8\u8fdb\u884c\u683c\u5f0f\u5316\uff0cvdc\u4f1a\u5efa\u7acb\u4e00\u4e2a\u5206\u533a\uff0c\u683c\u5f0f\u5316\u4e3a ext4 \u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u3002 mount /dev/vdc1 / \u6839\u76ee\u5f55 / \u7528\u6237 A \u76ee\u5f55 / \u76ee\u5f55 1 # \u683c\u5f0f\u5316\u7684\u5206\u533a\u9700\u8981\u6302\u5230\u67d0\u4e2a\u76ee\u5f55\u4e0b\u9762\uff0c\u624d\u80fd\u4f5c\u4e3a\u666e\u901a\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u8bbf\u95ee umount / \u6839\u76ee\u5f55 / \u7528\u6237 A \u76ee\u5f55 / \u76ee\u5f55 1 # \u5378\u8f7d\u6302\u8f7d \u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\uff1a \u6587\u4ef6\u76f8\u5173\uff1aopen, write, read, lseek, close \u76ee\u5f55\u76f8\u5173\uff1aopendir\uff0creaddir\uff0cclosedir \u6587\u4ef6\u5c5e\u6027\u7531\u7ed3\u6784\u4f53 struct stat \u6765\u7ef4\u62a4\uff0c\u7531\u51fd\u6570 stat\uff0cfstat\uff0clstat\u6765\u64cd\u4f5c\uff1a int stat(const char *pathname, struct stat *statbuf); int fstat(int fd, struct stat *statbuf); int lstat(const char *pathname, struct stat *statbuf); struct stat { dev_t st_dev; /* ID of device containing file */ ino_t st_ino; /* Inode number */ mode_t st_mode; /* File type and mode */ nlink_t st_nlink; /* Number of hard links */ uid_t st_uid; /* User ID of owner */ gid_t st_gid; /* Group ID of owner */ dev_t st_rdev; /* Device ID (if special file) */ off_t st_size; /* Total size, in bytes */ blksize_t st_blksize; /* Block size for filesystem I/O */ blkcnt_t st_blocks; /* Number of 512B blocks allocated */ struct timespec st_atim; /* Time of last access */ struct timespec st_mtim; /* Time of last modification */ struct timespec st_ctim; /* Time of last status change */ }; \u6700\u540e\uff0c\u7528\u4e00\u5e45\u56fe\u6765\u603b\u7ed3\u4e4b\uff1a","title":"27 \u6587\u4ef6\u7cfb\u7edf"},{"location":"linux/\u8da3\u8c08Linux\u5b66\u4e60\u7b14\u8bb0/#28","text":"\u786c\u76d8\u7ed3\u6784\uff1a https://static001.geekbang.org/resource/image/2e/d2/2ea68b40d928e6469233fcb4948c7cd2.jpg Linux \u4e3b\u6d41\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\uff1aext \u7cfb\u5217\uff0cext3, ext4 \u786c\u76d8\u5206\u6210\u76f8\u540c\u5927\u5c0f\u7684\u5757\uff0c\u4e00\u5757\u7684\u5927\u5c0f\u662f\u6247\u533a\u5927\u5c0f\u7684\u6574\u6570\u500d\uff0c\u9ed8\u8ba4\u662f 4K\uff0c\u683c\u5f0f\u5316\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u3002 \u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u6587\u4ef6\uff0c\u4f7f\u7528\u4e00\u4e2a\u7ed3\u6784 inode \u6765\u7ef4\u62a4\uff0cinode \u4fdd\u5b58\u4e00\u4e2a\u6587\u4ef6\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u63d0\u4f9b\u7d22\u5f15\u673a\u5236\uff0c\u65b9\u4fbf\u67e5\u627e\u548c\u7ba1\u7406\u3002 struct ext4_inode { __le16 i_mode; /* File mode */ __le16 i_uid; /* Low 16 bits of Owner Uid */ __le32 i_size_lo; /* Size in bytes */ __le32 i_atime; /* Access time */ __le32 i_ctime; /* Inode Change time */ __le32 i_mtime; /* Modification time */ __le32 i_dtime; /* Deletion Time */ __le16 i_gid; /* Low 16 bits of Group Id */ __le16 i_links_count; /* Links count */ __le32 i_blocks_lo; /* Blocks count */ __le32 i_flags; /* File flags */ ...... __le32 i_block[EXT4_N_BLOCKS];/* Pointers to blocks */ __le32 i_generation; /* File version (for NFS) */ __le32 i_file_acl_lo; /* File ACL */ __le32 i_size_high; ...... }; \u5176\u4e2d\uff0c i_block[] \u5b9a\u4e49\u4e86\u4e00\u4e2a\u6587\u4ef6\u88ab\u5212\u5206\u4e86\u591a\u5c11\u5757\uff0c\u6bcf\u4e00\u5757\u5728\u54ea\u91cc\u8fd9\u4e9b\u4fe1\u606f\u3002 \u6587\u4ef6\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4f7f\u7528 inode \u6765\u63cf\u8ff0, \u6bcf\u4e2a inode \u4e2d\u90fd\u542b\u6709\u4e00\u4e9b\u5217\u7684\u6570\u636e\u5757 \u5bf9\u4e8e\u666e\u901a\u6587\u4ef6: \u6570\u636e\u5757\u4e2d\u4fdd\u5b58\u7684\u662f\u6587\u4ef6\u6570\u636e \u5bf9\u4e8e\u6587\u4ef6\u5939: \u6570\u636e\u5757\u4e2d\u4fdd\u5b58\u7684\u662f\u5b50\u6587\u4ef6\u7684\u6587\u4ef6\u9879 \u4e3a\u4e86\u52a0\u5feb\u6587\u4ef6\u5939\u4e2d\u6587\u4ef6\u7684\u641c\u7d22\u901f\u5ea6, Linux \u901a\u8fc7\u7d22\u5f15\u6a21\u5f0f, \u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u540d\u7684\u6563\u5217\u5feb\u901f\u5b9a\u4f4d\u5230\u6587\u4ef6\u7684\u4f4d\u7f6e \u6587\u4ef6\u7684\u7ec4\u7ec7 Linux \u4e2d\u5c06\u78c1\u76d8\u7684\u5757\u5206\u6210\u4e00\u4e2a\u4e2a\u7684\u5757\u7ec4, \u6bcf\u4e2a\u5757\u7ec4\u7531\u4e00\u4e2a\u5757\u7ec4\u7684\u4f4d\u56fe\u548c\u5bf9\u5e94\u7684\u6570\u636e\u5757\u63cf\u8ff0, \u6700\u5927\u53ef\u63cf\u8ff0 128M \u7684\u7a7a\u95f4 \u6bcf\u4e2a\u5757\u7ec4\u6709\u5176\u5bf9\u5e94\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26, \u63cf\u8ff0\u7b26\u4e4b\u95f4\u5f62\u6210\u4e00\u4e2a\u94fe\u8868 \u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u5757\u7ec4, Linux \u901a\u8fc7\u5143\u5757\u7ec4\u6765\u63cf\u8ff0\u5757\u7ec4 \u4e00\u4e2a\u5143\u5757\u7ec4\u4e2d\u7531 64 \u4e2a\u5757\u7ec4\u7ec4\u6210, \u5176\u4e2d\u7684\u5757\u7ec4\u63cf\u8ff0\u7b26\u4e00\u5171 64 \u9879, \u5206\u522b\u5728 0, 1, 63 \u7684\u4f4d\u7f6e\u7684\u5757\u7ec4\u4e0a\u5907\u4efd\u4e09\u4efd \u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u901a\u8fc7\u8d85\u7ea7\u5757\u6765\u63cf\u8ff0 \u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5 \u8f6f\u94fe\u63a5: \u5728\u94fe\u63a5\u76ee\u6807\u6587\u4ef6\u4e4b\u524d, \u4f1a\u521b\u5efa\u81ea\u5df1\u7684 inode \u548c\u6570\u636e\u5757, \u7136\u540e\u5176\u6570\u636e\u5757\u4e2d\u7684\u5185\u5bb9\u6307\u5411\u76ee\u6807\u6587\u4ef6 \u53ef\u8de8\u7cfb\u7edf\u94fe\u63a5 \u786c\u94fe\u63a5: \u5373\u4e3a\u4e00\u4e2a\u6587\u4ef6\u521b\u5efa\u4e86\u4e00\u4e2a\u522b\u540d, \u8fd9\u4e2a\u522b\u540d\u4f1a\u6307\u5411\u771f\u5b9e\u6587\u4ef6\u7684 inode \u7ed3\u6784\u4f53 \u56e0\u4e3a\u76f4\u63a5\u6307\u5411\u6e90\u6587\u4ef6\u7ed3\u6784\u4f53, \u56e0\u6b64\u4ed6\u65e0\u6cd5\u8de8\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u94fe\u63a5","title":"28 \u786c\u76d8\u6587\u4ef6\u7cfb\u7edf"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/","text":"\u7b2c 1 \u8bfe \u7f51\u7edc\u534f\u8bae\u4e00\u89c8 \u7b2c 2 \u8bfe \u7f51\u7edc\u5206\u5c42 \u7b2c 3 \u8bfe ifconfig \u4e0e IP \u5730\u5740\u5206\u7c7b \u7b2c 4 \u8bfe IP \u5730\u5740\u4e0e DHCP \u7b2c 5 \u8bfe MAC \u5730\u5740\u4e0e ARP \u7b2c 6 \u8bfe \u4ea4\u6362\u673a\u548c VLAN \u7b2c 7 \u8bfe ICMP\u3001ping \u4e0e traceroute \u7b2c 8 \u8bfe NAT \u7f51\u5173 \u7b2c 9 \u8bfe \u8def\u7531\u534f\u8bae RIP\u3001OSPF\u3001BGP \u7b2c 10 \u8bfe UDP \u534f\u8bae \u7b2c 11 \u8bfe TCP \u534f\u8bae\uff08\u4e0a\uff09 \u7b2c 12 \u8bfe TCP \u534f\u8bae\uff08\u4e0b\uff09 \u7b2c 13 \u8bfe \u5957\u63a5\u5b57 Socket \u7b2c 14 \u8bfe HTTP \u534f\u8bae \u7b2c 15 \u8bfe HTTPS \u534f\u8bae HTTPS \u7684\u5de5\u4f5c\u6a21\u5f0f \u7b2c 16 \u8bfe \u6d41\u5a92\u4f53\u534f\u8bae \u7b2c 17 \u8bfe P2P \u534f\u8bae \u7b2c 18 \u8bfe DNS \u534f\u8bae \u7b2c 19 \u8bfe HTTPDNS \u7b2c 20 \u8bfe CDN \u7b2c 21 \u8bfe \u6570\u636e\u4e2d\u5fc3 \u7b2c 22 \u8bfe VPN IPsec VPN \u7b2c 23 \u8bfe \u79fb\u52a8\u7f51\u7edc 2G 2.5G 3G 4G \u7b2c 24 \u8bfe \u4e91\u4e2d\u7f51\u7edc \u5171\u4eab\u4e0e\u4e92\u901a\uff1a\u901a\u8fc7 bridge \u9694\u79bb \u7b2c 25 \u8bfe \u8f6f\u4ef6\u5b9a\u4e49\u7f51\u7edc SDN OpenFlow \u548c OpenvSwitch \u7b2c 26 \u8bfe \u4e91\u4e2d\u7684\u7f51\u7edc\u5b89\u5168\uff08iptables\uff09 \u7b2c 27 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684 QoS \u7b2c 28 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684\u9694\u79bb GRE\u3001VXLAN \u7b2c 29 \u8bfe \u5bb9\u5668\u7f51\u7edc \u7b2c 30 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Flannel \u7b2c 31 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Calico \u7b2c 32 \u8bfe RPC \u534f\u8bae\u6982\u8ff0 \u7b2c 33 \u8bfe \u57fa\u4e8e XML \u7684 SOAP \u534f\u8bae \u7b2c 34 \u8bfe \u57fa\u4e8e JSON \u7684 RESTful \u63a5\u53e3\u534f\u8bae \u7b2c 35 \u8bfe \u4e8c\u8fdb\u5236 RPC \u534f\u8bae \u7b2c 36 \u8bfe \u8de8\u8bed\u8a00\u7c7b RPC \u534f\u8bae \u7b2c 37-39 \u8bfe \u7528\u53cc\u5341\u4e00\u7684\u4f8b\u5b50\u4e32\u8bb2\u7f51\u7edc\u534f\u8bae \u7b2c 40 \u8bb2 \u642d\u5efa\u4e00\u4e2a\u7f51\u7edc\u5b9e\u9a8c\u73af\u5883 \u73af\u5883\u642d\u5efa OVS \u5b9e\u9a8c \u7b2c 1 \u8bfe \u7f51\u7edc\u534f\u8bae\u4e00\u89c8 OSI \u4e03\u5c42\u534f\u8bae\uff1a \u4ece\u4e0b\u5230\u4e0a\uff1a\u7269\u7406\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u4f1a\u8bdd\u5c42\u3001\u8868\u793a\u5c42\u3001\u5e94\u7528\u5c42\u3002 \u4f1a\u8bdd\u5c42\uff1a\u533a\u5206\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u6bd4\u5982\u56fe\u7247\uff0c\u58f0\u97f3\uff0c\u89c6\u9891\u7b49\uff1b \u8868\u793a\u5c42\uff1a\u5b9a\u4e49\u8bed\u4e49\u8bed\u6cd5\uff0c\u7f16\u7801\u538b\u7f29\u89c4\u8303\uff0c\u5982\u5f8b\u5e08\u6709\u804c\u4e1a\u7528\u8bed\uff0c\u55b7\u5b50\u6709\u4e13\u95e8\u7684\u8c03\u5b50\u3002 \u5e94\u7528\u5c42\uff1a\u4e0a\u9762\u4e24\u5c42\u901a\u5e38\u548c\u5e94\u7528\u5c42\u5408\u4e3a\u4e00\u4f53\uff0c\u5b9a\u4e49\u5177\u4f53\u7684\u5e94\u7528\u5f62\u6001\uff0c\u6570\u636e\u683c\u5f0f\uff0c\u4f8b\u5b50\uff1a\u7528\u4e8e Web \u7684 HTTP \u534f\u8bae\uff08\u5b89\u5168 HTTPS\uff09\uff0c\u7528\u4e8e\u4f20\u8f93\u6587\u4ef6\u7684 FTP \u534f\u8bae\uff0c\u7528\u4e8e Email \u7684 IMAP \u534f\u8bae\u7b49\u3002 \u5e94\u7528\u5c42\uff1aDHCP\u3001HTTP\u3001HTTPS\u3001DNS\u3001HTTPDNS\uff08\u66f4\u4e3a\u7cbe\u51c6\uff09\u3001RPC\uff08\u8fdb\u7a0b\u7ea7\u522b\u7684\u901a\u4fe1\uff09\u3001FTP\u3001IMAP \u4f20\u8f93\u5c42\uff1aTCP\u3001UDP \u7f51\u7edc\u5c42\uff1aICMP\u3001IP\u3001OSPF\u3001BGP\u3001IPSec\u3001GRE \u94fe\u8def\u5c42\uff1aARP\u3001RARP\u3001VLAN\u3001STP \u7b2c 2 \u8bfe \u7f51\u7edc\u5206\u5c42 \u590d\u6742\u7684\u7a0b\u5e8f\u90fd\u9700\u8981\u5206\u5c42\uff0c\u8fd9\u662f\u7a0b\u5e8f\u8bbe\u8ba1\u7684\u8981\u6c42\u3002 \u7f51\u7edc\u901a\u4fe1\u4e2d\uff0c\u53ef\u4ee5\u6709\u4e0b\u5c42\u6ca1\u4e0a\u5c42\uff0c\u4f46\u4e0d\u80fd\u6709\u4e0a\u5c42\u6ca1\u4e0b\u5c42\u3002 \u7b2c 3 \u8bfe ifconfig \u4e0e IP \u5730\u5740\u5206\u7c7b Windows\uff1aipconfig Linux\uff1aifconfig ifconfig vs ip addr -> net-tools vs iproute2 net-tools \u7cfb\u5de5\u5177\u76ee\u524d\u5f88\u591a Linux \u53d1\u884c\u7248\u90fd\u5df2\u4e0d\u5728\u63d0\u4f9b\uff0c\u5efa\u8bae\u91cd\u70b9\u638c\u63e1 iproute2 \uff0c\u4f46\u5f88\u591a\u8001\u7cfb\u7edf\u4ecd\u7136\u5e38\u7528 net-tools \u7cfb\uff0c\u9700\u8981\u4e24\u4e2a\u90fd\u5f97\u719f\u6089\u3002 \u91cd\u70b9\uff1a net-tools \u901a\u8fc7 procfs(/proc) \u548c ioctl \u7cfb\u7edf\u8c03\u7528\u533a\u8bbf\u95ee\u548c\u6539\u53d8\u5185\u6838\u7f51\u7edc\u53c2\u6570\u914d\u7f6e\u5b9e\u73b0\u7f51\u7edc\u529f\u80fd\uff0c\u800c iproute2 \u5219\u662f\u901a\u8fc7 netlink \u5957\u63a5\u5b57\u76f4\u63a5\u4e0e\u5185\u6838\u901a\u4fe1\uff08\u6027\u80fd\u4e0a\u4f1a\u5360\u4f18\uff09\u3002 A\u3001B\u3001C \u4e09\u7c7b\u5730\u5740\u5305\u542b\u7684\u4e3b\u673a\u6570\u91cf\uff1a \u6700\u53f3\u4e00\u680f\u663e\u793a\u4e86\u79c1\u6709\u5730\u5740\uff0c\u8fd9\u5c31\u662f\u5e73\u5e38\u6211\u4eec\u5728\u529e\u516c\u5ba4\u3001\u5bb6\u91cc\u548c\u5b66\u6821\u91cc\u5e38\u914d\u7684 IP \u5730\u5740\u3002 \u7f13\u89e3 IPv4 \u5730\u5740\u8017\u5c3d\u7684\u4e24\u79cd\u4e34\u65f6\u89e3\u51b3\u65b9\u6848\uff1aCIDR\u3001NAT\u3002 root@ubuntu:~# ifconfig enp0s3 Link encap:Ethernet HWaddr 08:00:27:2d:63:18 inet addr:192.168.0.109 Bcast:192.168.0.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fe2d:6318/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:73 errors:0 dropped:0 overruns:0 frame:0 TX packets:62 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:8927 (8.9 KB) TX bytes:9019 (9.0 KB) \u7f51\u7edc\u8bbe\u5907\u7684\u72b6\u6001\u6807\u8bc6\uff1a <BROADCAST, MULTICAST, UP, LOWER_UP> UP\uff1a\u8868\u793a\u7f51\u5361\u5904\u4e8e\u542f\u52a8\u72b6\u6001 BROADCAST\uff1a\u8868\u793a\u7f51\u5361\u53ef\u4ee5\u53d1\u9001\u5e7f\u64ad MULTICAST\uff1a\u8868\u793a\u7f51\u5361\u53ef\u4ee5\u53d1\u9001\u591a\u64ad LOWER_UP\uff1a\u8868\u793a L1 \u662f\u542f\u52a8\u7684\uff0c\u4e5f\u5373\u7f51\u7ebf\u662f\u63d2\u7740\u7684 MTU 1500\uff1a\u4ee5\u592a\u7f51\u9ed8\u8ba4\u7684\u6700\u5927\u4f20\u8f93\u5355\u5143\uff08\u4ee5\u592a\u7f51\u5934\u90e8+\u6b63\u6587\u90e8\u5206\uff09\u3002\u6ce8\u610f\u548c\u4f20\u8f93\u5c42\u7684 MSS\uff08\u6700\u5927\u62a5\u6587\u6bb5\uff09\u7684\u533a\u522b\u3002 qdisc pfifo_fast \uff1a\u7f51\u5361\u961f\u5217\u6392\u961f\u89c4\u5219\u3002 pfifo \u6700\u7b80\u5355\u7684\u89c4\u5219\uff0c\u6570\u636e\u5305\u5148\u8fdb\u5148\u51fa\u3002 pfifo_fast \u7a0d\u5fae\u590d\u6742\uff0c\u961f\u5217\u5305\u62ec\u4e09\u4e2a\u6ce2\u6bb5\uff08band\uff09\uff0c\u5728\u6bcf\u4e2a\u6ce2\u6bb5\u91cc\uff0c\u540c\u6837\u91c7\u7528\u5148\u8fdb\u5148\u51fa\u3002\u6570\u636e\u5305\u6309\u7167 TOS\uff08Type of Service\uff09 \u88ab\u5206\u914d\u5230\u4e09\u4e2a\u6ce2\u6bb5\u3002 TOS \u6307\u660e\u4e86\u5f53\u524d\u6570\u636e\u5305\u7684\u4f18\u5148\u7ea7\u3002 \u7f51\u7edc\u6536\u53d1\u7684\u5b57\u8282\u6570\u3001\u5305\u6570\u3001\u9519\u8bef\u6570\u4ee5\u53ca\u4e22\u5305\u60c5\u51b5\uff0c\u7279\u522b\u662f TX \u548c RX \u90e8\u5206\u7684 errors\u3001dropped\u3001overruns\u3001carrier \u4ee5\u53ca collisions \u7b49\u6307\u6807 errors\uff1a\u8868\u793a\u53d1\u751f\u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u5982\u6821\u9a8c\u9519\u8bef\u3001\u5e27\u540c\u6b65\u9519\u8bef\u7b49 dropped\uff1a\u8868\u793a\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\uff0c\uff08\u5305\u5df2\u7ecf\u5230\u4e86\u63a5\u6536\u961f\u5217\u7684 ring buffer\uff0c\u4f46\u56e0\u4e3a\u5185\u5b58\u4e0d\u8db3\u7b49\u539f\u56e0\u4e22\u5305\uff09 overruns\uff1a\u8868\u793a\u8d85\u9650\u6570\u636e\u5305\u6570\uff0c\u7f51\u7edc I/O \u901f\u5ea6\u8fc7\u5feb\uff0c\u5bfc\u81f4 ring buffer \u4e2d\u6570\u636e\u5305\u6765\u4e0d\u53ca\u5904\u7406\u800c\u5bfc\u81f4\u4e22\u5305 carrier\uff1a\u8868\u793a\u53d1\u751f carrier \u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u6bd4\u5982\u53cc\u5de5\u6a21\u5f0f\u4e0d\u5339\u914d\uff0c\u7269\u7406\u7535\u7f06\u51fa\u73b0\u95ee\u9898\u7b49 collisions\uff1a\u8868\u793a\u78b0\u649e\u6570\u636e\u5305\u6570 \u7b2c 4 \u8bfe IP \u5730\u5740\u4e0e DHCP ip \u914d\u7f6e\uff1a ifconfig\uff1a sudo ifconfig eth0 10.0.0.1/24 sudo ifconfig eth0 up ip addr: sudo ip addr add 10.0.0.1/24 dev eth0 sudo ip link set up eth1 DHCP \u81ea\u52a8\u914d\u7f6e IP \u5730\u5740\uff1a \u91c7\u7528\u79df\u7ea6\uff08\u79df\u623f\uff09\u5730\u5740\u7684\u65b9\u5f0f\uff0c\u4fbf\u4e8e\u7f51\u7edc\u7ba1\u7406\u3002 \u5de5\u4f5c\u65b9\u5f0f\uff1a 1. DHCP Discover \uff1a\u9996\u6b21\u63a5\u5165\u7684 Client \u7ec8\u7aef\u5e7f\u64ad\u3002\u5e7f\u64ad\u5305 src \u662f\uff1a0.0.0.0\uff0cdst \u662f 255.255.255.255\uff0c\u4f7f\u7528 UDP\uff0cUDP \u5c01\u88c5 BOOTP \uff08BOOTP \u662f DHCP \u7684\u52a0\u5f3a\u7248\uff09\u3002 DHCP Offer \uff1aDHCP Server \u5e7f\u64ad\u3002\u5e7f\u64ad\u5305 src \u662f\uff1aDHCP Server \u7684 IP\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26\u4e86\u5206\u914d\u7684 IP \u5730\u5740\u3002 DHCP Request \uff1aClient \u63a5\u53d7\u5230 IP \u5730\u5740\u540e\u5e7f\u64ad\uff08\u5982\u679c\u5b58\u5728\u591a\u4e2a DHCP Server\uff0c\u5219 Client \u53ef\u80fd\u6536\u5230\u591a\u4e2a IP\uff0c\u5b83\u4f1a\u9009\u62e9\u6700\u5148\u5230\u8fbe\u7684\u4e00\u4e2a\uff09\u3002\u5e7f\u64ad\u5305 src \u662f 0.0.0.0\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26 Client \u63a5\u53d7\u7684 IP\uff0c\u4ee5\u53ca\u63a5\u53d7\u79df\u7ea6\u7684 Server \u7684 IP \u7b49\u4fe1\u606f\uff0c\u76ee\u7684\u662f\u544a\u8bc9\u4f17\u591a Server \u5b83\u5df2\u79df\u5230\u5730\u5740\uff0c\u79df\u5230\u8c01\u7684\u5730\u5740\uff0c\u5bf9\u6ca1\u6709\u63a5\u53d7\u7684 Server \u53ef\u4ee5\u64a4\u9500\u5b83\u4eec\u63d0\u4f9b\u7684\u5730\u5740\u3002 DHCP ACK \uff1aDHCP Server \u5e7f\u64ad\uff08\u7ed9 Client \u786e\u8ba4\u5730\u5740\u53ca\u79df\u671f\u7b49\u4fe1\u606f\uff0c\u540c\u65f6\u544a\u77e5\u5176\u4f59\u89d2\u8272\u8fd9\u4e2a IP \u5df2\u7ed9\u67d0\u4eba\uff09\u3002\u5e7f\u64ad\u5305 src \u662f\uff1aDHCP Server \u7684 IP\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26\u79df\u671f\u7b49\u4fe1\u606f\u3002 IP \u5730\u5740\u7684\u6536\u56de\u4e0e\u7eed\u79df \u5f53 Client \u79df\u671f\u8fc7\u53bb 50% \u7684\u65f6\u5019\uff0c\u4f1a\u76f4\u63a5\u5411\u7ed9\u5b83\u63d0\u4f9b IP \u7684 DHCP Server \u53d1\u9001 DHCP Request \u5305\uff0cServer \u4f1a\u6839\u636e Request \u66f4\u65b0\u79df\u671f\u53ca\u5176\u4ed6 TCP/IP \u53c2\u6570\uff0c\u5411 Client \u53d1\u9001 DHCP ACK \u5305\uff0cClient \u4e5f\u4f1a\u636e\u6b64\u66f4\u65b0\u81ea\u8eab\u7684\u914d\u7f6e\u3002 \u7b2c 5 \u8bfe MAC \u5730\u5740\u4e0e ARP \u89e3\u51b3\uff1a\u53d1\u7ed9\u8c01\uff0c\u51fa\u73b0\u62e5\u5835\u600e\u4e48\u529e\uff1f\u5373\u591a\u8def\u8bbf\u95ee\u62e5\u5835\u7684\u95ee\u9898 MAC \u5c42\u591a\u8def\u8bbf\u95ee\u7b97\u6cd5\uff1a \u4fe1\u9053\u5212\u5206\uff1a\u4f60\u8d70\u4f60\u7684\uff0c\u6211\u8d70\u6211\u7684 \u8f6e\u6d41\u534f\u8bae\uff1a\u4eca\u5929\u5355\u53f7\u51fa\u884c\uff0c\u660e\u5929\u53cc\u53f7\u51fa\u884c \u968f\u673a\u63a5\u5165\u534f\u8bae\uff1a\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\uff0c\u6709\u4e8b\u5148\u51fa\u95e8\uff0c\u53d1\u73b0\u7279\u5835\uff0c\u5c31\u56de\u53bb\uff0c\u9519\u8fc7\u9ad8\u5cf0\u518d\u51fa MAC \u6570\u636e\u5305\u683c\u5f0f\uff1a ARP\uff1aMAC \u5730\u5740\u89e3\u6790 ARP \u62a5\u6587\u683c\u5f0f\uff1a RARP\uff1a\u53cd\u5411\u5730\u5740\u89e3\u6790\uff0c\u6839\u636e MAC \u6c42 IP\u3002 \u5e38\u7528\u5728\u4e00\u4e9b\u65e0\u76d8\u5de5\u4f5c\u7ad9\uff08\u6ca1\u6709\u786c\u76d8\uff0c\u65e0\u6cd5\u4fdd\u5b58 IP \u5730\u5740\uff0c\u4f46\u662f\u6709\u552f\u4e00\u7684 MAC \u5730\u5740\uff09\uff0c\u8fd9\u65f6\u53ef\u4ee5\u901a\u8fc7 RARP \u6839\u636e MAC \u8bf7\u6c42 IP\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 DHCP \u6216 BOOTP\u3002\u6240\u4ee5\uff0cRARP \u4e00\u822c\u4e0d\u5e38\u7528\u3002 Hub \u548c \u4ea4\u6362\u673a\u7684\u533a\u522b\uff1a Hub\uff1a \u4e00\u4e2a\u5e7f\u64ad\u57df\uff0c\u4e00\u4e2a\u51b2\u7a81\u57df \u4f20\u8f93\u6570\u636e\u8fc7\u7a0b\u4e2d\u6613\u4ea7\u751f\u51b2\u7a81\uff0c\u5e26\u5bbd\u5229\u7528\u7387\u4e0d\u9ad8 \u6bcf\u6b21\u6570\u636e\u4f20\u8f93\u90fd\u662f\u5168\u90e8\u7aef\u53e3\u8f6c\u53d1\uff0c\u6ca1\u6709\u5b66\u4e60\u529f\u80fd Switch\uff1a 1. \u5728\u5212\u5206 vlan \u7684\u524d\u63d0\u4e0b\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u5e7f\u64ad\u57df\uff0c\u6bcf\u4e2a\u63a5\u53e3\u90fd\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u51b2\u7a81\u57df\u3002 2. \u901a\u8fc7\u81ea\u6211\u5b66\u4e60\u7684\u65b9\u6cd5\u53ef\u4ee5\u6784\u5efa\u51fa CAM \u8868\uff08MAC \u5730\u5740\u8868\uff0cContent Addressable Memory\uff09\uff0c\u5e76\u57fa\u4e8e CAM \u8868\u8fdb\u884c\u6570\u636e\u8f6c\u53d1\u3002 3. \u652f\u6301\u751f\u6210\u6811\u7b97\u6cd5\uff0c\u53ef\u4ee5\u6784\u5efa\u51fa\u7269\u7406\u6709\u73af\uff0c\u903b\u8f91\u65e0\u73af\u7684\u7f51\u7edc\uff0c\u7f51\u7edc\u5197\u4f59\u548c\u6570\u636e\u4f20\u8f93\u6548\u7387\u90fd\u7529 Hub \u597d\u51e0\u6761\u8857\u3002 \u7b2c 6 \u8bfe \u4ea4\u6362\u673a\u548c VLAN \u4ea4\u6362\u673a\u73af\u8def\u95ee\u9898\uff1a \u6700\u5178\u578b\u7684\u573a\u666f\u662f\uff1a\u4e24\u4e2a\u4ea4\u6362\u673a\u5206\u522b\u8fde\u63a5\u4e24\u4e2a LAN\uff0c\u5982\u4e0b\uff1a \u7834\u89e3\u73af\u8def\u95ee\u9898\uff1aSPT\uff0cSpanning Tree Protocol\uff0c\u6700\u5c0f\u751f\u6210\u6811\u7b97\u6cd5 \u6982\u5ff5\uff1a - Root Bridge \uff1a\u6839\u4ea4\u6362\u673a\uff0c\u638c\u95e8\uff0c\u67d0\u68f5\u6811\u7684\u8001\u5927\u3002 - Designated Bridges \uff1a\u6307\u5b9a\u4ea4\u6362\u673a\uff0c\u4e00\u68f5\u6811\u7684\u6811\u679d\uff0c\u7531\u8001\u5927\u6307\u5b9a\u7684\u7ba1\u4e8b\u7684\u4eba\u3002 - Bridge Protocol Data Units(BPDU) \uff1a\u7f51\u6865\u534f\u8bae\u6570\u636e\u5355\u5143\u3002\u5404\u4ea4\u6362\u673a\u4e4b\u95f4\u534f\u5546\u7684\u534f\u8bae\uff08\u6bd4\u8f83\u5b9e\u529b\uff09\uff0cBPDU \u53ea\u6709\u638c\u95e8\u80fd\u53d1\uff0c\u5df2\u7ecf\u96b6\u5c5e\u4e8e\u67d0\u4e2a\u638c\u95e8\u7684\u4ea4\u6362\u673a\u53ea\u80fd\u4f20\u8fbe\u638c\u95e8\u7684\u6307\u793a\u3002 - Priority Vector \uff1a\u4f18\u5148\u7ea7\u5411\u91cf\u3002\u6bd4\u55bb\u4e3a\u5b9e\u529b\uff08\u503c\u8d8a\u5c0f\u5b9e\u529b\u8d8a\u5f3a\uff09\u3002 <Root Bridge ID, Root Path Cost, Bridge ID, and Port ID> \uff0c\u4e00\u5c42\u5c42\u7684\u6bd4\u8f83\uff08Root Bridge ID \u6bd4\u8f83\u662f\u5426\u96b6\u5c5e\u4e8e\u540c\u4e00\u4e2a\u638c\u95e8\uff0cRoot Path Cost \u6bd4\u8f83\u548c\u638c\u95e8\u7684\u5173\u7cfb\uff0cBridge ID \u6bd4\u8f83\u81ea\u8eab\u7684\u5b9e\u529b\uff09 STP \u7684\u5de5\u4f5c\u8fc7\u7a0b\uff1a \u628a\u4e00\u4e2a\u4e2a\u7684\u4ea4\u6362\u673a\u770b\u4f5c\u662f\u6c5f\u6e56\u4e0a\u5404\u5927\u6b66\u6797\u9ad8\u624b\uff0c\u901a\u8fc7\u4e92\u76f8\u6bd4\u6b66\u7684\u65b9\u5f0f\u6765\u7edf\u4e00\u6c5f\u6e56\u3002 \u638c\u95e8->\u540c\u95e8->\u5c0f\u5f1f \u53ea\u6709\u638c\u95e8\u53ef\u4ee5\u53d1 BPDU\uff0c\u521a\u5f00\u59cb\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u53d1\u3002 Bridge ID \u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff08\u7ba1\u7406\u5458\u4e8b\u5148\u4f1a\u6839\u636e\u4ea4\u6362\u673a\u7684\u4ef7\u683c\u7b49\u56e0\u7d20\u914d\u7f6e\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff09\u3002 \u5de5\u4f5c\u8fc7\u7a0b\u5176\u5b9e\u5c31\u662f\u901a\u8fc7\u4e0d\u65ad\u7684\u76f8\u9047\u3001\u6bd4\u8f83\u3001\u5408\u5e76\u6765\u6700\u7ec8\u7edf\u4e00\u8fd9\u68f5\u6811\u3002\uff08\u4e0d\u540c\u95e8\u6d3e\u7684\u638c\u95e8\u76f8\u9047\uff0c\u540c\u95e8\u76f8\u9047\uff0c\u4e0d\u540c\u95e8\u6d3e\u5c0f\u5f1f\u76f8\u9047\u7b49\uff0c\u901a\u8fc7\u6bd4\u8f83 Priority Vector \u6765\u51b3\u5b9a\uff09 \u8fd9\u4e2a\u4f8b\u5b50\u5177\u4f53\u53c2\u89c1\u8bfe\u7a0b\u63cf\u8ff0\uff0c\u4e00\u770b\u5c31\u61c2\uff01 STP \u7684\u7f3a\u70b9\uff1a \u8ba1\u7b97\u91cf\u5927\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u8de8\u5730\u57df\u548c\u8de8\u56fd\u7684\u7f51\u7edc\u5f62\u6001\u3002 \u6ca1\u6709\u8d1f\u8f7d\u5206\u62c5\uff0c\u56e0\u4e3a\u6709\u4e00\u6761\u94fe\u8def\u4f1a\u88ab\u963b\u585e\uff0c\u4e0d\u80fd\u5f88\u597d\u7684\u5206\u62c5\u7f51\u7edc\u8d1f\u8f7d\uff0ccisco \u7684 PVST+ \u5bf9\u6b64\u4f5c\u4e86\u6539\u8fdb\u3002 VLAN \u7684\u62a5\u6587\u683c\u5f0f\uff1a \u5728\u914d VLAN \u7684\u4ea4\u6362\u673a\u4e2d\uff0c\u8fde\u7ec8\u7aef\u7684\u662f Access \u53e3\uff0c\u8fde\u4ea4\u6362\u673a\u7684\u662f Trunk \u53e3\u3002 \u7b2c 7 \u8bfe ICMP\u3001ping \u4e0e traceroute ICMP \u62a5\u6587\u683c\u5f0f\uff1a ICMP \u62a5\u6587\u7c7b\u578b\uff1a - \u67e5\u8be2\u62a5\u6587\u7c7b\u578b\uff1a\u4e3b\u52a8\u8bf7\u6c42\uff0c\u5982 ping \uff0c\u8bf7\u6c42\u5305\u4e3a ICMP ECHO REQUEST \uff0c\u5e94\u7b54\u5305\u4e3a ICMP ECHO REPLY \u3002 - \u5dee\u9519\u62a5\u6587\u7c7b\u578b\uff1a\u88ab\u52a8\u62a5\u544a\u5dee\u9519\u7c7b\u578b\uff08\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u662f 3\uff0c\u6e90\u6291\u5236\u662f 4\uff0c\u8d85\u65f6\u662f 11\uff0c\u91cd\u5b9a\u5411\u662f 5\uff09\uff0c - \u7ec8\u70b9\u4e0d\u53ef\u8fbe\u5305\u62ec\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3001\u4e3b\u673a\u4e0d\u53ef\u8fbe\u3001\u534f\u8bae\u4e0d\u53ef\u8fbe\u3001\u7aef\u53e3\u4e0d\u53ef\u8fbe\u3001\u9700\u8981\u8fdb\u884c\u5206\u7247\u4f46\u8bbe\u7f6e\u4e86\u4e0d\u5206\u7247\u4f4d\u3002 - \u6e90\u6291\u5236\u662f\u8ba9\u6e90\u7ad9\u653e\u6162\u53d1\u9001\u901f\u5ea6\uff1b - \u8d85\u65f6\u662f\u8d85\u8fc7\u7f51\u7edc\u5305\u7684\u751f\u5b58\u65f6\u95f4\u8fd8\u6ca1\u5230\uff1b - \u8def\u7531\u91cd\u5b9a\u5411\u662f\u4e0b\u6b21\u53d1\u7ed9\u53e6\u4e00\u4e2a\u8def\u7531\u5668\u3002 \u67e5\u8be2\u62a5\u6587\u7684\u4f7f\u7528\u4f8b\u5b50\uff1a ping \u53d1\u9001\u4e0e\u63a5\u6536\u8fc7\u7a0b\uff1a \u6839\u636e ping \u5305\u7684\u7f51\u7edc\u6392\u67e5\u8fc7\u7a0b\uff1a 1. \u77e5\u9053 ping \u5305\u8def\u5f84\u4e0a\u7ecf\u8fc7\u54ea\u4e9b\u8282\u70b9\uff0c\u753b\u51fa\u62d3\u6251\u56fe 2. \u6839\u636e\u62d3\u6251\u56fe\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u6267\u884c\u6293\u5305 tcpdump -i eth0 icmp \u67e5\u770b ICMP \u5305\u7684\u4fe1\u606f 3. \u6709\u4e9b\u8bbe\u5907\u662f\u7981 ping \uff0cping \u4e0d\u540c\u4e0d\u4ee3\u8868\u7f51\u7edc\u4e0d\u901a\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u501f\u52a9 telnet \u4e4b\u7c7b\u7684\u5de5\u5177\u6392\u67e5\u3002 \u5dee\u9519\u62a5\u6587\u7684\u4f7f\u7528\u4f8b\u5b50\uff1a traceroute \uff1a 1. \u901a\u8fc7\u8bbe\u7f6e\u8def\u5f84 TTL \u7684\u65b9\u5f0f\u83b7\u53d6\u8def\u5f84\u4e0a\u8def\u7531\u5668\u7684 IP\uff08\u4ece 1 \u9010\u6e10\u9012\u589e\uff09 2. \u4e3b\u52a8\u77e5\u6653\u76ee\u7684\u4e3b\u673a\u7684\u4e0d\u53ef\u8fbe\u4fe1\u606f\uff08\u9519\u8bef\u8bbe\u7f6e\u4e00\u4e2a\u4e0d\u53ef\u80fd\u7684\u503c\u4f5c\u4e3a UDP \u7aef\u53e3\u53f7\uff0c\u5982\u5927\u4e8e 30000\uff0c\u5f53\u5230\u8fbe\u76ee\u6807\u65f6\uff0c\u4f1a\u4ea7\u751f\u201c\u7aef\u53e3\u4e0d\u53ef\u8fbe\u7684\u201d\u9519\u8befICMP\u62a5\u6587\uff09 3. \u901a\u8fc7\u8bbe\u7f6e\u4e0d\u5206\u7247\u6765\u786e\u5b9a\u8def\u5f84\u7684 MTU\uff08\u6545\u610f\u8bbe\u7f6e\u4e0d\u5206\u7247\uff0c\u4e2d\u95f4\u5361\u4f4f\u4f1a\u53d1 ICMP \u7f51\u7edc\u5dee\u9519\u5305\uff09 4. \u53d1\u9001 UDP \u5305 \u7b2c 8 \u8bfe NAT \u7f51\u5173 MAC \u5934\u548c IP \u5934\uff1a \u7f51\u5173\u7c7b\u578b\uff1a - \u8f6c\u53d1\u7f51\u5173\uff1a\u4e0d\u6539\u53d8 IP \u5730\u5740\u7684\u7f51\u5173 - NAT \u7f51\u5173\uff1a\u6539\u53d8 IP \u5730\u5740\u7684\u7f51\u5173 \u53ef\u4ee5\u901a\u8fc7\uff1a https://www.whatismyip.com/ \u67e5\u770b\u81ea\u5df1 IP \u7684\u51fa\u53e3 IP \u5730\u5740\uff08\u516c\u7f51\u5730\u5740\uff09 \u6269\u5c55\uff1a NAT \u53c8\u5206\u4e3a\u57fa\u7840 NAT \u548c NAPT\u3002 \u57fa\u7840 NAT \u5c31\u662f\u4e00\u5bf9\u4e00\uff08\u4e00\u4e2a\u79c1\u6709\u5730\u5740\u5bf9\u5e94\u4e00\u4e2a\u5168\u7403\u5730\u5740\uff09\uff1b NAPT \u5c31\u662f\u4e00\u4e2a\uff08\u6216\u8005\u591a\u4e2a\u4f46\u5c11\u91cf\u7684\uff09\u5916\u90e8 IP \u548c\u5927\u91cf\u7684\u7aef\u53e3\u53f7\uff0c\u5bf9\u5e94\u591a\u4e2a\u5185\u90e8\u7684 IP \u4ee5\u53ca\u76f8\u5e94\u7684\u7aef\u53e3\u53f7\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5927\u5927\u51cf\u5c11\u4e86\u5bf9\u5168\u7403 IP \u5730\u5740\u7684\u9700\u6c42\u3002 DNAT \u548c SNAT\uff1a SNAT\uff1a \u6e90\u5730\u5740\u8f6c\u6362 DNAT\uff1a\u76ee\u7684\u5730\u5740\u8f6c\u6362 \u7b2c 9 \u8bfe \u8def\u7531\u534f\u8bae RIP\u3001OSPF\u3001BGP \u914d\u7f6e\u9759\u6001\u8def\u7531\uff1a ip route add 192.168.10.0/24 via 192.168.10.1 dev eth0 \u52a8\u6001\u8def\u7531\u9760 RIP\uff0cOSPF \u4e4b\u7c7b\u7684\u534f\u8bae\u81ea\u52a8\u914d\u7f6e\u3002 \u666e\u901a\u8def\u7531 \uff1a\u6839\u636e IP \u6765\u914d\u7f6e\u8def\u7531 \u7b56\u7565\u8def\u7531 \uff1a\u9664\u4e86\u6839\u636e IP \u914d\u7f6e\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u591a\u4e2a\u53c2\u6570\u6765\u914d\u7f6e\uff08\u5165\u53e3\u8bbe\u5907\u3001TOS \u7b49\uff09\uff0c\u4f7f\u5f97\u4ece\u4e0d\u540c\u6765\u6e90\u7684\u5305\u8d70\u4e0d\u540c\u7684\u8def\u7531 \u6bd4\u5982\uff1a ip rule add from 192.168.1.0/24 table 10 ip rule add from 192.168.2.0/24 table 20 # \u8868\u793a\u4ece 192.168.1.0/24 \u7f51\u6bb5\u6765\u7684\u5305\u8d70 table 10 \u4e2d\u7684\u8def\u7531\u8868\uff0c\u4ece 192.168.2.0/24 \u7f51\u6bb5\u6765\u7684\u5305\u8d70 table 20 \u4e2d\u7684\u8def\u7531\u8868 \u5728\u4e00\u6761\u8def\u7531\u89c4\u5219\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u8d70\u591a\u6761\u8def\u5f84\uff0c\u4f8b\u5982\uff1a ip route add default scope global nexthop via 100.100.100.1 weight 1 nexthop 200.200.200.1 weight 2 \u52a8\u6001\u8def\u7531\uff1a \u57fa\u4e8e\u4e24\u79cd\u7b97\u6cd5 Bellman-Ford \u548c Dijkstra \u7b97\u6cd5 Bellman-Ford \uff1a\u8ddd\u79bb\u77e2\u91cf\u8def\u7531\u7b97\u6cd5\uff0c\u8def\u7531\u8868\u4fdd\u5b58\u4e24\u4e2a\u4fe1\u606f\uff1a\u5230\u8fbe\u76ee\u6807\u7684\u8def\u7ebf\u51fa\u53e3\u548c\u8ddd\u79bb\uff0c \u7f3a\u70b9 \uff1a1\uff09\u597d\u6d88\u606f\u4f20\u5f97\u5feb\uff0c\u574f\u6d88\u606f\u4f20\u5f97\u6162\uff08\u7c7b\u6bd4\u4e00\u4e2a\u8d70\u4e22\u4e86\u5230\u5904\u95ee\u4eba\uff09\uff1b2\uff09\u89c4\u6a21\u4e0d\u80fd\u592a\u5927\uff0cRIP \u91c7\u7528\u8fd9\u79cd\u7b97\u6cd5\uff0c\u89c4\u6a21\u9650\u5b9a\u5728 15 hop \u4ee5\u5185\u3002 Dijkstra \uff1a\u94fe\u8def\u72b6\u6001\u8def\u7531\u7b97\u6cd5\uff0c\u4ee3\u8868\uff1aOSPF\u3002\u90bb\u5c45\u53d1\u9001\u94fe\u8def\u72b6\u6001\u6765\u611f\u77e5\u6574\u4e2a\u7f51\u7edc\u62d3\u6251\uff0c\u4ece\u800c\u6839\u636e Dijkstra \u7b97\u6cd5\u6765\u8ba1\u7b97\u4e24\u70b9\u95f4\u7684\u6700\u77ed\u8def\u5f84\u3002 \u4f18\u70b9 \uff1a1\uff09\u53ea\u5e7f\u64ad\u6216\u66f4\u65b0\u6539\u53d8\u7684\u7f51\u7edc\u62d3\u6251\uff0c\u8282\u7701\u4e86\u5e26\u5bbd\u548c CPU \u5229\u7528\u7387\u30022\uff09\u4e00\u65e6\u8282\u70b9\u6302\u4e86\uff0c\u90bb\u5c45\u4f1a\u5e7f\u64ad\u8fd9\u4e2a\u6d88\u606f\uff0c\u574f\u6d88\u606f\u4e5f\u80fd\u8fc5\u901f\u6536\u655b; \u7f3a\u70b9 \uff1a1\uff09\u8ba1\u7b97\u91cf\u5927\uff0c\u6bcf\u6b21\u72b6\u6001\u66f4\u65b0\u90fd\u8981\u8ba1\u7b97\u6700\u77ed\u8def\u5f84\uff1b2\uff09\u9700\u8981\u5b58\u50a8\u7a7a\u95f4\u5927\u3002 OSPF\uff1a OSPF \u57fa\u4e8e Dijkstra \u7b97\u6cd5\u6c42\u6700\u77ed\u8def\u5f84\uff0c\u6765\u901a\u544a\u90bb\u5c45\u72b6\u6001\u6d88\u606f\u3002\u5982\u679c\u53d1\u73b0\u5b58\u5728\u591a\u6761\u6700\u77ed\u8def\u5f84\uff0c\u5219\u53ef\u4ee5\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u79f0\u4e3a \u7b49\u4ef7\u8def\u7531 \u3002\uff08\u4e00\u822c\u5e94\u7528\u7684\u63a5\u5165\u5c42\u6709\u4f1a\u8d1f\u8f7d\u5747\u8861 LVS\uff0c\u53ef\u4ee5\u548c OSPF \u4e00\u8d77\uff0c\u5b9e\u73b0\u9ad8\u541e\u5410\u91cf\u7684\u63a5\u5165\u5c42\u8bbe\u8ba1\uff09 BGP\uff1a \u91c7\u7528\u8def\u5f84\u77e2\u91cf\u7b97\u6cd5\uff0c\u662f\u8ddd\u79bb\u77e2\u91cf\u7b97\u6cd5\u7684\u5347\u7ea7\u7248\uff0c\u7528\u4e8e\u5404\u4e2a\u81ea\u6cbb\u57df AS \u4e4b\u95f4\u7684\u901a\u4fe1\u3002 AS\uff1a Stub AS \uff1a\u5bf9\u5916\u53ea\u6709\u4e00\u4e2a AS\uff0c\u8fd9\u7c7b AS \u4e0d\u4f1a\u4f20\u8f93\u5176\u4ed6 AS \u7684\u5305\uff0c\u4f8b\u5982\uff0c\u4e2a\u4eba\u6216\u8005\u5c0f\u516c\u53f8\u7684\u7f51\u7edc\u3002 Multihomed AS \uff1a\u53ef\u80fd\u6709\u591a\u4e2a\u8fde\u63a5\u8fde\u5230\u5176\u4ed6 AS\uff0c\u4f46\u662f\u5927\u591a\u62d2\u7edd\u5e2e\u5176\u4ed6 AS \u4f20\u8f93\u5305\u3002\u4f8b\u5982\u4e00\u4e9b\u5927\u516c\u53f8\u7684\u7f51\u7edc\u3002 Transit AS \uff1a\u6709\u591a\u4e2a\u8fde\u63a5\u8fde\u5230\u5176\u4ed6 AS\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e2e\u5176\u4ed6 AS \u4f20\u8f93\u5305\uff0c\u4f8b\u5982\u4e3b\u5e72\u7f51\u3002 BGP \uff1aeBGP \u548c iBGP\uff0ceBGP \u8d1f\u8d23 AS \u4e4b\u95f4\u7684\u901a\u4fe1\uff0ciBGP \u5219\u8d1f\u8d23 AS \u5185\u90e8\u7684\u901a\u4fe1 BGP \u57fa\u4e8e TCP\uff0cOSPF \u57fa\u4e8e UDP\uff0cRIP \u57fa\u4e8e UDP\u3002 \u7b2c 10 \u8bfe UDP \u534f\u8bae \u7f51\u7edc\u4f20\u8f93\u662f\u4ee5\u5305\u4e3a\u5355\u4f4d\u7684\uff0c\u4e8c\u5c42\u53eb\u5e27\uff0c\u7f51\u7edc\u5c42\u53eb\u5305\uff0c\u4f20\u8f93\u5c42\u53eb\u6bb5\uff0c\u6211\u4eec\u7b3c\u7edf\u79f0\u4e3a\u5305\u3002 UDP \u5305\u5934\u683c\u5f0f\uff1a QUIC \uff08Quick UDP Internet Connections\uff0c\u5feb\u901f UDP \u4e92\u8054\u7f51\u534f\u8bae\uff09\u662f Google \u63d0\u51fa\u6765\u7684\u4e00\u79cd \u57fa\u4e8e UDP \u6539\u8fdb\u7684\u901a\u4fe1\u534f\u8bae \uff0c\u5176\u76ee\u7684\u662f\u964d\u4f4e\u7f51\u7edc\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0c\u63d0\u4f9b\u66f4\u597d\u7684\u7528\u6237\u4e92\u52a8\u4f53\u9a8c\u3002 Quic \u5728\u5e94\u7528\u5c42\u4e0a\uff0c\u4f1a\u81ea\u5df1\u5b9e\u73b0\u5feb\u901f\u8fde\u63a5\u5efa\u7acb\u3001\u51cf\u5c11\u91cd\u4f20\u65f6\u5ef6\u3001\u81ea\u9002\u5e94\u62e5\u585e\u63a7\u5236\u3002 \u5e94\u7528\u573a\u666f\uff1a - \u7f51\u9875\u6216APP\u7684\u8bbf\u95ee\uff1aQuic - \u6d41\u5a92\u4f53\u534f\u8bae\uff08\u76f4\u64ad\uff09\uff1aRTMP - \u5b9e\u65f6\u6e38\u620f\uff1a\u957f\u8fde\u63a5 - IoT \u7269\u8054\u7f51\uff1aGoogle Next \u5efa\u7acb\u4e86 Thread Group\uff0c\u63a8\u51fa\u4e86\u7269\u8054\u7f51\u901a\u4fe1\u534f\u8bae Thread\uff0c\u5c31\u662f\u57fa\u4e8e UDP \u534f\u8bae - \u79fb\u52a8\u901a\u4fe1\u9886\u57df\uff1a4G \u7f51\u7edc\u4e2d\uff0c\u79fb\u52a8\u6d41\u91cf\u4e0a\u7f51\u7684\u6570\u636e\u9762\u5bf9\u7684\u534f\u8bae GTP-U \u662f\u57fa\u4e8e UDP \u7684\u3002 \u7b2c 11 \u8bfe TCP \u534f\u8bae\uff08\u4e0a\uff09 TCP \u5305\u5934\u683c\u5f0f\uff1a TCP \u7684\u53ef\u9760\u6027\u4f53\u73b0\u5728\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a \u987a\u5e8f\u95ee\u9898\uff0c\u7a33\u91cd\u4e0d\u4e71 \u4e22\u5305\u95ee\u9898\uff0c\u627f\u8bfa\u9760\u8c31 \u8fde\u63a5\u7ef4\u62a4\uff0c\u6709\u59cb\u6709\u7ec8 \u6d41\u91cf\u63a7\u5236\uff0c\u628a\u63e1\u5206\u5bf8 \u62e5\u585e\u63a7\u5236\uff0c\u77e5\u8fdb\u77e5\u9000 TCP \u4e09\u6b21\u63e1\u624b\uff1a TCP \u56db\u6b21\u6325\u624b\uff1a TCP \u72b6\u6001\u673a \u5c06\u8fde\u63a5\u5efa\u7acb\u548c\u8fde\u63a5\u65ad\u5f00\u7684\u4e24\u4e2a\u65f6\u5e8f\u72b6\u6001\u56fe\u7efc\u5408\u8d77\u6765\uff0c\u5c31\u662f TCP \u7684\u72b6\u6001\u673a\u3002 \u7b2c 12 \u8bfe TCP \u534f\u8bae\uff08\u4e0b\uff09 TCP \u7684\u51e0\u5927\u95ee\u9898\uff1a \u987a\u5e8f\u95ee\u9898\uff1a\u7ed9\u6bcf\u4e2a\u5305\u5206\u914d\u4e00\u4e2a ID\uff0c\u7d2f\u8ba1\u786e\u8ba4\u6216\u7d2f\u8ba1\u5e94\u7b54 \u4e22\u5305\u95ee\u9898\uff1a\u5feb\u901f\u91cd\u4f20\u3001\u81ea\u9002\u5e94\u91cd\u4f20 \u6d41\u91cf\u63a7\u5236\u95ee\u9898\uff1a\u6ed1\u52a8\u7a97\u53e3\uff08\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u90fd\u4f1a\u7ef4\u6301\u8be5\u7a97\u53e3\uff09 \u62e5\u585e\u63a7\u5236\u95ee\u9898\uff1a\u62e5\u585e\u907f\u514d\u7b97\u6cd5 \u6ed1\u52a8\u7a97\u53e3\u673a\u5236\uff1a \u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u5206\u522b\u7ef4\u62a4\u7740\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u5305\u7684\u53d1\u9001\u548c\u63a5\u6536\u60c5\u51b5\u3002\u5982\u4e0b\uff1a \u5bf9\u4e8e\u62e5\u585e\u63a7\u5236\u95ee\u9898\uff0cGoogle \u66fe\u63d0\u51fa\u4e86 TCP BBR \u62e5\u585e\u7b97\u6cd5\uff1a \u7b2c 13 \u8bfe \u5957\u63a5\u5b57 Socket \u4ece\u6570\u636e\u7ed3\u6784\u770b socket \u5728\u534f\u8bae\u6808\u4e2d\u7684\u7ed3\u6784\uff1a \u5982\u4e0b\uff0csocket \u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5bf9\u5e94\u5c31\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7531\u6570\u636e\u7ed3\u6784 task_struct \u6765\u5b9a\u4e49\uff0c\u91cc\u9762\u6307\u5411\u7684\u662f\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u7ec4\uff0c\u5217\u51fa\u8fd9\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002 \u63a5\u7740\u901a\u8fc7 struct socket \uff0c\u5c06\u6570\u636e\u8f6c\u6362\u6210 struct sk_buffer \uff0c\u653e\u5165 \u53d1\u9001\u961f\u5217 \u4e2d\uff0c\u53cd\u8fc7\u6765\uff0c\u63a5\u6536\u5230\u7684\u5305\u5c31\u653e\u5165 \u63a5\u6536\u961f\u5217 \u4e2d\u3002 \u901a\u4fe1\u6a21\u578b\uff1a 01 \u591a\u8fdb\u7a0b\u6a21\u578b \u590d\u5236\u4e86\u6587\u4ef6\u63cf\u8ff0\u7b26\u5217\u8868 02 \u591a\u7ebf\u7a0b\u6a21\u578b \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fdb\u7a0b\u7a7a\u95f4\u662f\u5171\u4eab\u7684\uff0c\u53ea\u662f\u591a\u4e86\u4e00\u4e2a\u5f15\u7528\u800c\u5df2\u3002 03 I/O \u591a\u8def\u590d\u7528 select \u4e3b\u52a8\u8f6e\u8be2\uff08\u4e00\u4e2a\u7ebf\u7a0b\u7ef4\u62a4\u591a\u4e2a socket\uff09 04 I/O \u591a\u8def\u590d\u7528 epoll \u4e8b\u4ef6\u56de\u8c03 \u7b2c 14 \u8bfe HTTP \u534f\u8bae HTTP \u8bf7\u6c42\u62a5\u6587\u7684\u683c\u5f0f\uff1a QUIC \u534f\u8bae\uff1a HTTP 2.0 \u76f8\u6bd4 HTTP 1.0\uff0c\u51cf\u5c11\u4e86 TCP \u8fde\u63a5\u6570\u5bf9\u670d\u52a1\u5668\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u52a0\u5feb\u4e86\u9875\u9762\u7ec4\u4ef6\u7684\u4f20\u64ad\u901f\u5ea6\u3002\u4f46 HTTP 2.0 \u7531\u4e8e\u57fa\u4e8e TCP \u534f\u8bae\uff0c\u4f20\u8f93\u6548\u7387\u8fd8\u662f\u8f83\u4e3a\u4f4e\u4e0b\u3002 QUIC \u7684\u51e0\u5927\u673a\u5236\uff1a \u673a\u5236\u4e00\uff1a\u81ea\u5b9a\u4e49\u8fde\u63a5\u673a\u5236\uff0c\u4e0d\u50cf TCP \u8fde\u63a5\u4f7f\u7528\u56db\u5143\u7ec4\uff0cQUIC \u4f7f\u7528\u7684\u662f \u4e00\u4e2a 64 \u4f4d\u7684\u968f\u673a\u6570 ID \u6765\u6807\u8bc6\u4e00\u6b21\u8fde\u63a5\uff0c\u7136\u540e\u57fa\u4e8e UDP\uff0c\u8fd9\u6837\uff0c\u5c31\u4e0d\u9700\u8981\u50cf TCP \u90a3\u6837\u8fde\u63a5\u7aef\u70b9\u5207\u6362\uff08WIFI \u6216\u79fb\u52a8\u7f51\u7edc\u5207\u6362\uff09\u65f6\u5c31\u8981\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002 \u673a\u5236\u4e8c\uff1a\u81ea\u5b9a\u4e49\u91cd\u4f20\u673a\u5236\uff0cQUIC \u7684\u5e8f\u53f7\u4e0d\u7ba1\u5bf9\u65b9\u6709\u6ca1\u6709\u56de\u5e94\uff0c\u90fd\u662f\u9012\u589e\u7684\u3002 \u673a\u5236\u4e09\uff1a\u65e0\u963b\u585e\u7684\u591a\u8def\u590d\u7528 \u673a\u5236\u56db\uff1a\u81ea\u5b9a\u4e49\u6d41\u91cf\u63a7\u5236 \u7b2c 15 \u8bfe HTTPS \u534f\u8bae HTTPS \u7684\u5de5\u4f5c\u6a21\u5f0f HTTPS \u57fa\u4e8e SSL \u534f\u8bae\uff0c\u63e1\u624b\u8fc7\u7a0b\u4e5f\u662f\u57fa\u4e8e SSL \u7684\u4e09\u6b21\u63e1\u624b\u534f\u8bae\uff0c\u5982\u4e0b\uff1a \u7b2c 16 \u8bfe \u6d41\u5a92\u4f53\u534f\u8bae \u8bb2\u5230\u4e86\u4e00\u4e2a CDN \u5185\u5bb9\u5206\u53d1\u7f51\u7edc\uff1a\u5305\u62ec\u4e2d\u5fc3\u548c\u8fb9\u7f18\u4e24\u5c42\u3002 \u8fb9\u7f18\u5c42\u670d\u52a1\u5668\u90e8\u7f72\u5728\u5168\u56fd\u5404\u5730\u53ca\u6a2a\u8de8\u5404\u5927\u8fd0\u8425\u5546\u91cc\uff0c\u548c\u7528\u6237\u8ddd\u79bb\u5f88\u8fd1\u3002\u4e2d\u5fc3\u5c42\u662f\u6d41\u5a92\u4f53\u670d\u52a1\u96c6\u7fa4\uff0c\u8d1f\u8d23\u5185\u5bb9\u7684\u8f6c\u53d1\u3002\u667a\u80fd\u8d1f\u8f7d\u5747\u8861\u7cfb\u7edf\uff0c\u6839\u636e\u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5c31\u8fd1\u9009\u62e9\u8fb9\u7f18\u670d\u52a1\u5668\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u63a8 /\u62c9\u6d41\u670d\u52a1\u3002\u4e2d\u5fc3\u5c42\u4e5f\u8d1f\u8d23\u8f6c\u7801\u670d\u52a1\uff0c\u4f8b\u5982\uff0c\u628a RTMP \u534f\u8bae\u7684\u7801\u6d41\u8f6c\u6362\u4e3a HLS \u7801\u6d41\u3002 \u7b2c 17 \u8bfe P2P \u534f\u8bae \u96c6\u4e2d\u5f0f\u6587\u4ef6\u7684\u4e0b\u8f7d\u65b9\u5f0f\uff1a HTTP + FTP P2P \u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u57fa\u4e8e tracker \u7684\u96c6\u4e2d\u5f0f \u53bb\u4e2d\u5fc3\u5316\u7684\u5b8c\u5168\u5206\u5e03\u5f0f \u7b2c 18 \u8bfe DNS \u534f\u8bae DNS \u670d\u52a1\u5668\u2014\u2014\u7f51\u7edc\u5730\u5740\u7c3f DNS \u670d\u52a1\u5668\uff0c\u4e00\u5b9a\u8981\u8bbe\u8ba1\u6210\u9ad8\u53ef\u7528\u3001\u9ad8\u5e76\u53d1\u548c\u5206\u5e03\u5f0f\u7684 \u4e00\u822c\u5448\u73b0\u8fd9\u6837\u7684\u6811\u72b6\u7ed3\u6784\uff1a \u6839 DNS \u670d\u52a1\u5668 \uff1a\u8fd4\u56de\u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\u7684 IP \u5730\u5740 \u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\uff1a\u8fd4\u56de\u6743\u5a01 DNS \u670d\u52a1\u5668\u7684 IP \u5730\u5740 \u6743\u5a01 DNS \u670d\u52a1\u5668\uff1a\u8fd4\u56de\u76f8\u5e94\u4e3b\u673a\u7684 IP \u5730\u5740 DNS \u67e5\u8be2\u8fc7\u7a0b\u5982\u4e0b\u6240\u793a\uff1a \u672c\u5730 DNS \u670d\u52a1\u5668\uff1a\u4e00\u822c\u5728\u7f51\u7edc\u670d\u52a1\u5546\uff08ISP\uff09\u7684\u673a\u623f\uff0c\u7531 ISP \u5206\u914d \u6839\u57df\u540d\u670d\u52a1\u5668\uff1a\u5206\u5e03\u5728\u5168\u7403\uff0c\u5171\u6709 13 \u5957 \u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\uff1a\u5206\u4e0d\u540c\u533a\u7ba1\u7406\uff0c\u5982 .com\uff0c.cn \u7b49 \u6743\u5a01\u57df\u540d\u670d\u52a1\u5668\uff1a\u66f4\u5177\u4f53\u7684\u57df\u540d\u7ba1\u7406 DNS \u505a\u8d1f\u8f7d\u5747\u8861\uff1a \u5185\u90e8\u8d1f\u8f7d\u5747\u8861 \u8bbf\u95ee\u591a\u4e2a\u5e94\u7528\uff0c\u90e8\u7f72\u591a\u4e2a\uff0c\u6bcf\u6b21\u8fd4\u56de\u4e0d\u4e00\u6837\u7684\u5730\u5740\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861 \u5168\u5c40\u8d1f\u8f7d\u5747\u8861 \u4e00\u4e2a IP \u53ef\u4ee5\u7ba1\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u8f6e\u8be2\u67e5\u8be2\u591a\u4e2a\u670d\u52a1\u5668 \u5177\u4f53\u7684\u8fc7\u7a0b\u53ef\u4ee5\u89c1\u4e0b\u56fe\uff1a \u4e24\u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u7684\u610f\u4e49\u5728\u4e8e\u80fd\u591f\u5c31\u8fd1\u627e\u5230\u5bf9\u5e94\u7684\u5730\u5740\u3002 GSLB\uff1aGlobal Server Load Balance\uff0c\u5168\u5c40\u8d1f\u8d23\u5747\u8861\u5668 \u7b2c 19 \u8bfe HTTPDNS \u4f20\u7edf DNS \u5b58\u5728\u7684\u95ee\u9898\uff1a \u57df\u540d\u7f13\u5b58\u95ee\u9898\uff08\u5f53\u7f13\u5b58\u4f4d\u7f6e\u6539\u53d8\u65f6\uff0c\u6ca1\u6709\u66f4\u65b0\u9875\u9762\uff0c\u8bbf\u95ee\u5230\u8fd8\u662f\u65e7\u7684\u7f13\u5b58\uff0c\u6216\u8005\u5f53\u8bbf\u95ee\u8005\u7684\u4f4d\u7f6e\u6539\u53d8\uff0c\u4f9d\u7136\u63a8\u8350\u65e7\u7684\u7f13\u5b58\u4f4d\u7f6e\uff0c\u5c31\u4e0d\u662f\u6700\u4f18\u7684\u8bbf\u95ee\u8def\u5f84\uff09 \u57df\u540d\u8f6c\u53d1\u95ee\u9898\uff08\u8de8\u8fd0\u8425\u5546\u57df\u540d\u8f6c\u53d1\u89e3\u6790\uff0cA \u8fd0\u8425\u5546\u5077\u61d2\uff0c\u5c06\u57df\u540d\u89e3\u6790\u8bf7\u6c42\u53d1\u7ed9 B \u8fd0\u8425\u5546\uff0c\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u8de8\u8fd0\u8425\u5546\u8bbf\u95ee\u5f00\u9500\uff09 \u51fa\u53e3 NAT \u95ee\u9898\uff08\u51fa\u53e3 NAT\uff0c\u5bfc\u81f4\u57df\u540d\u89e3\u6790\u8bef\u5224\uff09 \u57df\u540d\u66f4\u65b0\u95ee\u9898\uff08\u65f6\u95f4\u7684\u5feb\u6162\u5f71\u54cd DNS \u7684\u89e3\u6790\uff0c\u4ece\u800c\u5f71\u54cd\u7528\u6237\u7684\u8bbf\u95ee\uff09 \u89e3\u6790\u5ef6\u8fdf\u95ee\u9898\uff08\u9012\u5f52\u904d\u5386\u591a\u4e2a DNS \u670d\u52a1\u5668\uff0c\u5bfc\u81f4\u89e3\u6790\u8d85\u65f6\uff09 HTTPDNS \u7684\u5de5\u4f5c\u6a21\u5f0f\uff1a \u81ea\u5df1\u642d\u5efa\u57fa\u4e8e HTTP \u534f\u8bae\u7684 DNS \u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u5206\u5e03\u5728\u591a\u4e2a\u5730\u70b9\u548c\u591a\u4e2a\u8fd0\u8425\u5546\u3002\u5f53\u5ba2\u6237\u7aef\u9700\u8981 DNS \u89e3\u6790\u7684\u65f6\u5019\uff0c\u4e0d\u8d70\u4f20\u7edf\u7684 DNS \u89e3\u6790\uff0c\u800c\u662f\u76f4\u63a5\u901a\u8fc7 HTTP \u534f\u8bae\u8fdb\u884c\u8bf7\u6c42\u8fd9\u4e2a\u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u5f97\u5230\u5c31\u8fd1\u7684\u5730\u5740\u3002 \u8981\u4f7f\u7528 HTTPDNS\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u652f\u6301 HTTPDNS \u7684\u5ba2\u6237\u7aef SDK\u3002 HTTPDNS \u89e3\u51b3\u4e86\u4e24\u5927\u95ee\u9898\uff1a \u89e3\u6790\u901f\u5ea6\u548c\u66f4\u65b0\u901f\u5ea6\u7684\u5e73\u8861\u95ee\u9898\uff08\u7f13\u5b58\u8bbe\u8ba1\uff09 \u667a\u80fd\u8c03\u5ea6\u7684\u95ee\u9898\uff08\u8c03\u5ea6\u8bbe\u8ba1\uff09 HTTPDNS \u7684\u7f13\u5b58\u8bbe\u8ba1\uff1a \u5206\u4e3a\uff1a\u5ba2\u6237\u7aef-\u300bDNS \u7f13\u5b58-\u300b HTTPDNS \u670d\u52a1\u5668 Cache-Aside \u673a\u5236\uff1a \u5148\u8bfb\u7f13\u5b58\uff0c\u4e0d\u547d\u4e2d\u8bfb\u6570\u636e\u5e93\uff0c\u540c\u65f6\u5c06\u7ed3\u679c\u5199\u5165\u7f13\u5b58\u3002 HTTPDNS \u7684\u8c03\u5ea6\u8bbe\u8ba1\uff1a \u5ba2\u6237\u7aef\u638c\u63e1\u6240\u6709\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5168\u5c40\u8c03\u5ea6\u3002 \u7b2c 20 \u8bfe CDN CDN \u5206\u53d1\u7cfb\u7edf\u67b6\u6784\uff1a CDN \u4e3b\u8981\u7f13\u5b58\u9759\u6001\u8d44\u6e90\uff0c\u4e5f\u6709\u6d41\u5a92\u4f53\u8d44\u6e90\uff0c\u53ef\u4ee5\u7ed3\u5408 DNS \u505a\u8d1f\u8f7d\u5747\u8861\uff1a \u4e66\u7c4d\u63a8\u8350\uff1a\u300aCDN\u6280\u672f\u8be6\u89e3\u300b \u7b2c 21 \u8bfe \u6570\u636e\u4e2d\u5fc3 \u6570\u636e\u4e2d\u5fc3\u7684\u51fa\u5165\u53e3\uff0c\u7531\u8def\u7531\u5668\u6765\u8d1f\u8d23\uff0c\u79f0\u4e3a \u8fb9\u754c\u8def\u7531\u5668 \u591a\u53f0\u670d\u52a1\u5668\u5360\u636e\u673a\u67b6\uff08Rack\uff09\uff0c\u5f53\u4e00\u4e2a\u673a\u67b6\u5360\u6ee1\u540e\uff0c\u5c31\u901a\u8fc7 TOR\uff08Top of Rack\uff09\u4ea4\u6362\u673a\u628a\u6240\u6709\u673a\u67b6\u8fde\u63a5\u8d77\u6765\u3002 \u7f51\u5361\u9ad8\u53ef\u7528\uff1a \u4f7f\u7528 \u7f51\u5361\u7ed1\u5b9a\uff08bond\uff09 \u6280\u672f\uff0c\u540c\u65f6\u9700\u8981 LACP\uff08Link Aggregation Control Protocol \u94fe\u8def\u805a\u5408\u63a7\u5236\u534f\u8bae\uff09 \u6765\u652f\u6301\uff0c\u5c06\u591a\u4e2a\u7f51\u5361\u5408\u5e76\u4e3a\u4e00\u4e2a\uff1a \u6570\u636e\u4e2d\u5fc3\u5e38\u89c1\u7684\u67b6\u6784\u662f\u4e00\u79cd\u5206\u5c42\u7684\u67b6\u6784\uff0c\u5206\u4e3a \u63a5\u5165\u5c42\u3001\u6c47\u805a\u5c42\u3001\u6838\u5fc3\u5c42\uff1a \u6c47\u805a\u5c42\u7ba1\u7406\u7684\u533a\u57df\u53eb \u4e00\u4e2a POD\uff08Point of Delivery\uff09\u6216\u8005\u53eb \u53ef\u7528\u533a \uff08Available Zone\uff09\uff0c\u5c06\u591a\u4e2a POD \u8fde\u63a5\u8d77\u6765\u9700\u8981 \u6838\u5fc3\u4ea4\u6362\u673a\u3002 \u4ee5\u4e0a\u6bcf\u4e2a POD \u5728\u4e0d\u540c\u7684\u5e7f\u64ad\u57df\u91cc\u9762\uff0c\u968f\u7740\u4e91\u8ba1\u7b97\u7b49\u53d1\u5c55\uff0c\u8981\u6c42\u6240\u6709\u7684\u670d\u52a1\u5668\u5728\u4e00\u4e2a\u4e8c\u5c42\u7f51\u7edc\u91cc\u9762\uff0c\u6240\u4ee5\u5c31\u6709 \u6c47\u805a\u5c42\u4e0a\u5347\u4e3a\u6838\u5fc3\u5c42\uff0c\u4e5f\u5c31\u662f \u5927\u4e8c\u5c42 : \u6574\u4e2a\u6570\u636e\u4e2d\u5fc3\u7684\u7f51\u7edc\u67b6\u6784\u56fe\u5982\u4e0b\uff1a \u878d\u5408\u4e86\u5b89\u5168\u9632\u62a4\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u8fb9\u754c\u8def\u7531\u5668\uff0c\u8f6f\u4ef6\u5b9a\u4e49\u5b58\u50a8\u7b49\u6280\u672f\u3002 \u76f8\u5bf9\u4e8e \u4e09\u5c42\u67b6\u6784 \u7684\u53e6\u5916\u4e00\u79cd\u67b6\u6784\u662f \u53f6\u810a\u7f51\u7edc\uff08Spine/Leaf\uff09 \uff1a \u53f6\u5b50\u4ea4\u6362\u673a\uff08leaf\uff09\uff1a\u76f4\u63a5\u8fde\u63a5\u670d\u52a1\u5668\u3002 \u810a\u4ea4\u6362\u673a\uff08spine switch\uff09\uff1a\u6838\u5fc3\u4ea4\u6362\u673a \u53f6\u810a\u4e4b\u95f4\u901a\u8fc7 ECMP \u52a8\u6001\u9009\u62e9\u591a\u6761\u8def\u5f84\u3002 \u603b\u7ed3\uff1a \u4f20\u7edf\u6570\u636e\u4e2d\u5fc3\u4e3a\u5782\u76f4\u67b6\u6784\uff0c\u901a\u5e38\u5206\u4e3a\u4e09\u5c42\uff1a\u63a5\u5165\u5c42\u3001\u6c47\u805a\u5c42\u3001\u6838\u5fc3\u5c42\uff0c\u6700\u5916\u9762\u8fde\u63a5\u8fb9\u754c\u8def\u7531\u5668\u548c\u5b89\u5168\u8bbe\u5907 \u968f\u7740\u4e91\u548c\u5927\u6570\u636e\u7684\u53d1\u5c55\uff0c\u4e1c\u897f\u5411\u6d41\u91cf\u76f8\u5bf9\u4e8e\u5357\u5317\u5411\u6d41\u91cf\u8d8a\u6765\u8d8a\u91cd\u8981\uff0c\u67b6\u6784\u9010\u6b65\u6f14\u5316\u4e3a\uff1aspine-leaf \u67b6\u6784 \u6570\u636e\u4e2d\u5fc3\u7684\u6240\u6709\u94fe\u8def\u90fd\u9700\u8981\u9ad8\u53ef\u7528\u6027\u3002\u670d\u52a1\u5668\u9700\u8981\u7ed1\u5b9a\u7f51\u5361\uff0c\u4ea4\u6362\u673a\u9700\u8981\u5806\u53e0\uff0c\u4e09\u5c42\u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7\u7b49\u4ef7\u8def\u7531\uff0c\u4e8c\u5c42\u8bbe\u5907\u901a\u8fc7 TRILL \u534f\u8bae\u3002 \u7b2c 22 \u8bfe VPN VPN\uff1a\u865a\u62df\u4e13\u7528\u7f51 \u5229\u7528\u5f00\u653e\u7684\u516c\u4f17\u7f51\u7edc\uff0c\u5efa\u7acb\u4e13\u7528\u6570\u636e\u4f20\u8f93\u901a\u9053\uff0c\u5c06\u8fdc\u7a0b\u7684\u5206\u652f\u673a\u6784\u3001\u79fb\u52a8\u529e\u516c\u4eba\u5458\u7b49\u8fde\u63a5\u8d77\u6765\u3002 VPN \u901a\u8fc7 \u96a7\u9053 \u6280\u672f\u5728\u516c\u4f17\u7f51\u7edc\u4e0a\u4eff\u771f\u4e00\u6761\u70b9\u5230\u70b9\u7684\u4e13\u7ebf\uff0c\u662f\u901a\u8fc7\u5229\u7528\u4e00\u79cd\u534f\u8bae\u6765\u4f20\u8f93\u53e6\u5916\u4e00\u79cd\u534f\u8bae\u7684\u6280\u672f\uff0c\u6d89\u53ca\u4e09\u79cd\u534f\u8bae\uff1a \u4e58\u5ba2\u534f\u8bae \u96a7\u9053\u534f\u8bae \u627f\u8f7d\u534f\u8bae IPsec VPN \u57fa\u4e8e IP \u534f\u8bae\u7684\u5b89\u5168\u96a7\u9053\u534f\u8bae IPsec VPN \u534f\u8bae\u7c07\uff1a IPsec VPN \u7684\u5c01\u5305\u65b9\u6848\uff1a IP -> ATM -> MPLS VPN \u7b2c 23 \u8bfe \u79fb\u52a8\u7f51\u7edc 2G-> 3G -> 4G -> 5G 2G \u67b6\u6784\u56fe\uff1a BTS\uff1a\u57fa\u7ad9\u6536\u53d1\u4fe1\u53f0\uff0c\u5bf9\u5185\u8fde\u63a5\u6709\u7ebf\u7f51\u7edc\uff0c\u5bf9\u5916\u8fde\u63a5\u65e0\u7ebf\u7f51\u7edc BSC\uff1a\u57fa\u7ad9\u63a7\u5236\u5668\uff0c\u63a5\u6536 BTS \u53d1\u6765\u7684\u65e0\u7ebf\u4fe1\u53f7 RAN\uff1a\u65e0\u7ebf\u63a5\u5165\u7f51 CN\uff1a\u6838\u5fc3\u7f51\u7edc\uff0c\u8fd8\u6ca1\u6709\u8fdb\u5165 Internet MSC\uff1a\u79fb\u52a8\u4e1a\u52a1\u4ea4\u6362\u4e2d\u5fc3\uff0c\u8fdb\u5165\u6838\u5fc3\u7f51\u7684\u5165\u53e3 AUC\uff1a\u9274\u6743\u4e2d\u5fc3 EIR\uff1a\u8bbe\u5907\u8bc6\u522b\u5668\uff0c\u8d1f\u8d23\u5b89\u5168\u6027 VLR\uff1a\u8bbf\u95ee\u4f4d\u7f6e\u5bc4\u5b58\u5668 HLR\uff1a\u5f52\u5c5e\u4f4d\u5bc4\u5b58\u5668\uff0c\u4e24\u8005\u4e3b\u8981\u7528\u4e8e\u8ba1\u8d39\u7528 2.5G \u5728 2G \u7684\u57fa\u7840\u4e0a\uff0c\u591a\u4e86\u4e00\u4e2a PCU \u5206\u7ec4\u63a7\u5236\u5355\u5143\uff0c\u652f\u6301 Packet \u7684\u8f6c\u53d1\uff0c\u652f\u6301 IP \u7f51\u7edc SGSN\uff1aGPRS \u670d\u52a1\u524d\u5411\u652f\u6301\u8282\u70b9\uff0c\u7528\u4e8e\u63a5\u6536 PCU \u5206\u7ec4 GGSN\uff1aGPRS \u670d\u52a1\u540e\u5411\u652f\u6301\u8282\u70b9\uff0c\u7528\u4e8e\u8f6c\u53d1\u5206\u7ec4\u5230 Internet 3G \u4ee5 W-CDMA \u4e3a\u4f8b\uff0c\u57fa\u7ad9\u8f83\u4e8e 2G \u6709\u6240\u6539\u53d8\uff1a 4G \u57fa\u7ad9\u4e3a eNodeB\uff0c\u5305\u542b\u4e86 NodeB \u548c RNC \u529f\u80fd\uff0c\u6838\u5fc3\u7f51\u5b9e\u73b0\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u7684\u5206\u79bb\uff1a HSS \uff1a\u5b58\u50a8\u7528\u6237\u7b7e\u7ea6\u4fe1\u606f\u7684\u6570\u636e\u5e93\uff0c\u4ee5\u53ca\u4e00\u4e9b\u8ba4\u8bc1\u4fe1\u606f MME\uff1a\u6838\u5fc3\u63a7\u5236\u7f51\u5143\uff0c\u63a7\u5236\u9762\u7684\u6838\u5fc3 SGW+PGW\uff1a\u6570\u636e\u9762\u5355\u5143\uff0c\u8d1f\u8d23\u6d41\u91cf\u8f6c\u53d1\uff0cPGW \u662f\u51fa\u53e3\u7f51\u5173 PCRF\uff1a\u7b56\u7565\u548c\u8ba1\u8d39\u63a7\u5236\u5355\u5143 \u7b2c 24 \u8bfe \u4e91\u4e2d\u7f51\u7edc \u865a\u62df\u673a\u57fa\u4e8e tap/tun \u9a71\u52a8\u5c06\u6570\u636e\u5305\u53d1\u51fa\u7269\u7406\u4e3b\u673a\u6d41\u7a0b\uff1a \u4e91\u7f51\u7edc\uff08\u865a\u62df\u673a\u7f51\u7edc\uff09\u51e0\u5927\u7279\u70b9\uff1a \u5171\u4eab\uff1a\u5171\u4eab\u540c\u4e00\u4e2a\u7269\u7406\u51fa\u53e3 \u9694\u79bb\uff1a\u5b89\u5168\u9694\u79bb\u548c\u6d41\u91cf\u9694\u79bb \u4e92\u901a\uff1a\u540c\u4e3b\u673a\u3001\u8de8\u4e3b\u673a \u7075\u6d3b\uff1a\u7ecf\u5e38\u521b\u5efa\u3001\u5220\u9664\u3001\u6f02\u79fb\uff0c\u7075\u6d3b\u914d\u7f6e \u5171\u4eab\u4e0e\u4e92\u901a\uff1a\u901a\u8fc7 bridge \u6865\u63a5\uff1a \u8de8\u4e3b\u673a\uff1a NAT\uff1a \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cVM\u7f51\u7edc\u548c\u4e3b\u673a\u7f51\u7edc\u81ea\u6210\u4f53\u7cfb\uff0c\u6240\u4ee5\uff0cVM\u7f51\u7edc\u91cc\u4f1a\u5185\u7f6e\u4e00\u4e2a DHCP \u670d\u52a1\u5668\u6765\u8fdb\u884c IP \u5730\u5740\u7ba1\u7406\u3002 \u5982\u679c\u4e0d\u9700\u8981 NAT \u548c DHCP \u670d\u52a1\uff0c\u90a3\u4e48\u53ef\u4ee5\u624b\u52a8\u8fdb\u884c NAT \u548c DHCP\uff0c\u5373\u624b\u52a8\u914d\u7f6e\u865a\u62df\u673a IP\uff0c\u8bbe\u7f6e IPtable \u6210 NAT\uff0c\u5982\u4e0b\uff1a \u9694\u79bb \u73b0\u4eca\u7684\u7f51\u5361\u90fd\u652f\u6301\u914d\u7f6e\u5b50\u63a5\u53e3\uff0c\u4e5f\u5c31\u662f VLAN\uff0c\u53ef\u4ee5\u4f7f\u7528 vconfig \u547d\u4ee4\u914d\u7f6e\u3002 \u901a\u8fc7 VLAN \u53ef\u4ee5\u9694\u79bb\u4e0d\u540c\u7684\u7528\u6237\u4e4b\u95f4\u7684 VM \u6d41\u91cf\u3002 \u7b2c 25 \u8bfe \u8f6f\u4ef6\u5b9a\u4e49\u7f51\u7edc SDN \u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a \u63a7\u5236\u4e0e\u8f6c\u53d1\u5206\u79bb \u63a7\u5236\u5e73\u9762\u4e0e\u8f6c\u53d1\u5e73\u9762\u4e4b\u95f4\u7684\u5f00\u653e\u63a5\u53e3\uff1a\u63a7\u5236\u5668\u5411\u4e0a\u63d0\u4f9b\u7684\u662f\u5317\u5411\u63a5\u53e3\uff0c\u4f9b\u5e94\u4e1a\u7a0b\u5e8f\u8c03\u7528\uff0c\u5411\u4e0b\u63d0\u4f9b\u7684\u662f\u5357\u5411\u63a5\u53e3\uff0c\u63a7\u5236\u7f51\u7edc\u8bbe\u5907\u3002 \u903b\u8f91\u4e0a\u7684\u96c6\u4e2d\u63a7\u5236 OpenFlow \u548c OpenvSwitch OpenFlow \u662f SDN \u63a7\u5236\u5668\u548c\u7f51\u7edc\u8bbe\u5907\u4e4b\u95f4\u4e92\u901a\u7684\u5357\u5411\u63a5\u53e3\u534f\u8bae\u3002 OpenvSwitch \u662f\u8f6f\u4ef6\u4ea4\u6362\u673a\uff0c\u5c5e\u4e8e SDN \u7684\u8f6c\u53d1\u9762\uff0c\u901a\u8fc7 OpenFlow \u534f\u8bae\u548c SDN \u63a7\u5236\u5668\u901a\u4fe1\u3002 SDN \u63a7\u5236\u5668\u901a\u8fc7 OpenFlow \u534f\u8bae\u5411 OVS \u4e0b\u53d1\u6d41\u8868\u89c4\u5219\u6765\u63a7\u5236\u7f51\u7edc\u8bbe\u5907\uff0c\u6d41\u8868\u89c4\u5219\u5305\u62ec \u5339\u914d\u89c4\u5219\u3001\u4f18\u5148\u7ea7\u548c\u6267\u884c\u52a8\u4f5c\uff1a \u8fd9\u91cc\u6709\u5f88\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u89c4\u5219\uff0c\u5305\u542b\u4e86 TCP/IP \u534f\u8bae\u6808\u7684\u56db\u5c42\uff0c\u6bcf\u4e00\u5c42\u90fd\u5bf9\u5e94\u4e0d\u540c\u7684\u89c4\u5219\uff0c\u76f8\u5e94\u5730\u4e5f\u4f1a\u6267\u884c\u4e0d\u540c\u7684\u52a8\u4f5c\uff1a OVS \u7684\u67b6\u6784\u56fe\uff1a \u7b2c 26 \u8bfe \u4e91\u4e2d\u7684\u7f51\u7edc\u5b89\u5168\uff08iptables\uff09 \u5b89\u5168\u7b56\u7565 ACL \u63a7\u5236 IP \u548c\u7aef\u53e3 \u8fd9\u4e9b ACL \u89c4\u5219\u7684\u96c6\u5408\u4e3a\u5b89\u5168\u7ec4\u3002 \u4e00\u4e2a\u6570\u636e\u5305\u7684\u5904\u7406\u8fc7\u7a0b\u901a\u5e38\u8981\u7ecf\u5386 5 \u4e2a\u8282\u70b9\uff1a \u76f8\u5173\u7684\u5185\u6838\u6a21\u5757\u5b9e\u73b0\u5982\u4e0b\uff1a iptables \u7684\u8868\u5206\u4e3a\u56db\u79cd\uff1araw->mangle->nat->filter\uff0c\u6bcf\u4e2a\u8868\u53c8\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u94fe\u3002 \u6bd4\u5982\uff1a filter \u8fc7\u6ee4\u8868\uff0c\u5305\u542b\uff1a input \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u76ee\u6807\u5730\u5740\u662f\u672c\u673a\u7684\u6570\u636e\u5305 forward \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u8def\u8fc7\u672c\u673a\u7684\u6570\u636e\u5305 output \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u6709\u672c\u673a\u4ea7\u751f\u7684\u6570\u636e\u5305 nat \u8868\u5904\u7406\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u5305\u542b\uff1a prorouting \u94fe\uff1a\u6570\u636e\u5305\u5230\u8fbe\u9632\u706b\u5899\u65f6\u6539\u53d8\u76ee\u6807\u5730\u5740 output \u94fe\uff1a\u53ef\u4ee5\u6539\u53d8\u672c\u5730\u4ea7\u751f\u7684\u6570\u636e\u5305\u7684\u76ee\u6807\u5730\u5740 postrouting \u94fe\uff1a\u5728\u6570\u636e\u5305\u79bb\u5f00\u9632\u706b\u5899\u65f6\u6539\u53d8\u6570\u636e\u5305\u7684\u6e90\u5730\u5740 mangle \u4fee\u6539\u6570\u636e\u5305\uff0c\u5305\u542b\uff1a PREROUTING \u94fe\uff1b INPUT \u94fe\uff1b FORWARD \u94fe OUTPUT \u94fe POSTROUTING \u94fe \u4e30\u5bcc\u4e0a\u9762\u7684\u56fe\uff1a \u7b2c 27 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684 QoS Linux \u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7 TC \u63a7\u5236\u7f51\u7edc\u7684 QoS\uff0c\u5c31\u662f\u901a\u8fc7\u961f\u5217\u7684\u65b9\u5f0f\u3002 \u63a7\u5236\u7f51\u7edc\u7684 QoS \u7684\u65b9\u5f0f\uff1a 1\u3001\u65e0\u7c7b\u522b\u6392\u961f\u89c4\u5219 pfifo_fast \u968f\u673a\u516c\u5e73\u961f\u5217 \u4ee4\u724c\u6876\u89c4\u5219 2\u3001\u57fa\u4e8e\u7c7b\u522b\u7684\u961f\u5217\u89c4\u5219 \u5206\u5c42\u4ee4\u724c\u6876\u89c4\u5219 \u8fd9\u79cd\u89c4\u5219\u4e5f\u662f OVS \u5e38\u7528\u7684\u4e00\u79cd\u3002 \u7b2c 28 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684\u9694\u79bb GRE\u3001VXLAN Underlay \u7f51\u7edc\uff1a\u5e95\u5c42\u7684\u7269\u7406\u7f51\u7edc\u8bbe\u5907\u7ec4\u6210\u7684\u7f51\u7edc Overlay \u7f51\u7edc\uff1a\u7528\u4e8e\u865a\u62df\u673a\u5c42\u9762\u7684\u7f51\u7edc\uff0c\u5e95\u5c42\u57fa\u4e8e\u7269\u7406\u7f51\u7edc\u7684\u865a\u62df\u7f51\u7edc \u96a7\u9053\u6280\u672f\uff1a GRE\uff1a GRE \u7f51\u7edc\u7684\u7f3a\u70b9\uff1a Tunnel \u6570\u91cf\u95ee\u9898\uff0c\u7f51\u7edc\u8d8a\u591a\uff0c\u6240\u5efa\u7acb\u7684\u96a7\u9053\u6570\u76ee\u5448\u6307\u6570\u589e\u957f \u4e0d\u652f\u6301\u7ec4\u64ad\uff0c\u90fd\u662f\u91c7\u7528\u5e7f\u64ad \u76ee\u524d\u5f88\u591a\u9632\u706b\u5899\u548c\u4e09\u5c42\u7f51\u7edc\u8bbe\u5907\u65e0\u6cd5\u89e3\u6790 GRE VXLAN\uff1a OVS \u652f\u6301\u4e09\u7c7b\u96a7\u9053\uff1a GRE VXLAN IPsec_GRE \u7b2c 29 \u8bfe \u5bb9\u5668\u7f51\u7edc namespace \u548c cgroup \u901a\u8fc7 NAT \u7684\u65b9\u5f0f\u4e0e\u7269\u7406\u7f51\u7edc\u8fdb\u884c\u4e92\u901a\u3002 \u7b2c 30 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Flannel \u6709\u4e00\u4e2a\u96c6\u4e2d\u6ce8\u518c\u7684\u5730\u65b9\uff1a Flannel \u4f7f\u7528 UDP \u5728\u7528\u6237\u6001\u7684\u5c01\u88c5\u5b9e\u73b0 Overlay \u7f51\u7edc\uff1a Flannel \u4f7f\u7528 VXLAN \u5728\u5185\u6838\u6001\u7684\u5c01\u88c5\u5b9e\u73b0 Overlay \u7f51\u7edc\uff1a \u7b2c 31 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Calico Calico \u7f51\u7edc\u7684\u5927\u4f53\u601d\u8def\u662f\uff1a\u4e0d\u8d70 Overlay \u7f51\u7edc\uff0c\u4e0d\u5f15\u5165\u53e6\u5916\u7684\u7f51\u7edc\u6027\u80fd\u635f\u8017\uff0c\u800c\u662f\u5c06\u8f6c\u53d1\u5168\u90e8\u7528\u4e09\u5c42\u7f51\u7edc\u7684\u8def\u7531\u8f6c\u53d1\u6765\u5b9e\u73b0\u3002 \u7b2c 32 \u8bfe RPC \u534f\u8bae\u6982\u8ff0 RPC \u7684\u8c03\u7528\u6807\u51c6\uff1a \u8fd9\u91cc\u5206\u4e86\u4e09\u4e2a\u5c42\u6b21\uff1a \u7528\u6237\u7aef\u548c\u670d\u52a1\u7aef\u50cf\u672c\u5730\u8c03\u7528\u4e00\u6837\uff0c\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u3002 Stub \u5c42\u5904\u7406\u53cc\u65b9\u7ea6\u5b9a\u597d\u7684\u8bed\u6cd5\u3001\u8bed\u4e49\u3001\u5c01\u88c5\u3001\u89e3\u5c01\u88c5\u3002 RPCRuntime\u5219\u662f\u5904\u7406\u9ad8\u6027\u80fd\u7684\u4f20\u8f93\uff0c\u4ee5\u53ca\u7f51\u7edc\u7684\u9519\u8bef\u548c\u5f02\u5e38 NFS \u534f\u8bae\u5c31\u662f\u57fa\u4e8eRPC \u6846\u67b6\u5b9e\u73b0\u7684\u3002NFS \u8fd0\u884c\u9700\u8981\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\u7aef\uff1amountd\uff08\u6302\u8f7d\u6587\u4ef6\uff09 \u548c nfsd\uff08\u8bfb\u5199\u6587\u4ef6\uff09\uff0c\u901a\u8fc7 NFS\uff0c\u53ef\u4ee5 mount \u4e00\u4e2a\u8fdc\u7a0b\u76ee\u5f55\u5230\u672c\u5730\u4e00\u4e2a\u76ee\u5f55\uff0c\u4ece\u800c\u5b9e\u73b0\u5728\u672c\u5730\u64cd\u4f5c\u8fdc\u7a0b\u7684\u6587\u4ef6\u3002\u5982\u4e0b\u56fe\uff0c\u5176\u5e95\u5c42\u5b9e\u73b0\u8fd8\u662f socket\uff1a \u7b2c 33 \u8bfe \u57fa\u4e8e XML \u7684 SOAP \u534f\u8bae XML \u5b9a\u4e49\u4e86\u4e00\u79cd RPC \u4f20\u8f93\u7684\u6587\u672c\u7c7b\u3002 \u8fd9\u662f\u4e00\u79cd\u9762\u5411\u5bf9\u8c61\u7684\u6587\u672c\u63cf\u8ff0\u8bed\u6cd5\uff0c\u53ef\u4ee5\u7075\u6d3b\u5730\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u5b9a\u4e49\u4e00\u4e2a\u5bf9\u8c61\u3002 \u57fa\u4e8e XML \u7684\u901a\u4fe1\u534f\u8bae\uff0c\u6700\u77e5\u540d\u7684\u4e00\u4e2a\u662f SOAP\uff0c\u5373\u7b80\u5355\u5bf9\u8c61\u8bbf\u95ee\u534f\u8bae\uff08Simple Object Access Protocol\uff09\uff0c\u5b83\u4f7f\u7528 XML \u7f16\u5199\u7b80\u5355\u7684\u8bf7\u6c42\u548c\u56de\u590d\u6d88\u606f\uff0c\u5e76\u7528 HTPP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u3002 \u901a\u8fc7 Web \u670d\u52a1\u63cf\u8ff0\u8bed\u8a00 WSDL \u6765\u8fdb\u884c\u534f\u8bae\u7684\u7ea6\u5b9a\u3002 \u901a\u8fc7 UDDI \u7edf\u4e00\u63cf\u8ff0\u3001\u53d1\u73b0\u548c\u96c6\u6210\u534f\u8bae\u6765\u89e3\u51b3\u670d\u52a1\u53d1\u73b0\u7684\u95ee\u9898\u3002 \u7b2c 34 \u8bfe \u57fa\u4e8e JSON \u7684 RESTful \u63a5\u53e3\u534f\u8bae JSON \u662f\u7c7b\u4f3c XML \u7684\u4e00\u79cd\u6587\u672c\u683c\u5f0f\u3002 RESTful API \u4e0d\u4ec5\u4ec5\u6307 API\uff0c\u8fd8\u662f\u4e00\u79cd\u67b6\u6784\u98ce\u683c\uff0c\u4e00\u79cd\u8bbe\u8ba1\u98ce\u683c\u3002\u4e3b\u8981\u9762\u5411\u8d44\u6e90\uff0c\u63d0\u4f9b\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u6709\u5229\u4e8e\u6a2a\u5411\u6269\u5c55\u5e94\u5bf9\u9ad8\u5e76\u53d1\u3002 \u7b2c 35 \u8bfe \u4e8c\u8fdb\u5236 RPC \u534f\u8bae \u6570\u636e\u4e2d\u5fc3\u5185\u90e8\u5e94\u7528\u4e4b\u95f4\u7684\u8c03\u7528\uff1a nginx \u5145\u5f53 API \u7f51\u5173 Controller \u5c42\uff1a\u5177\u4f53 API \u7684\u5b9e\u73b0 \u7ec4\u5408\u5c42\uff1a\u590d\u6742\u4e1a\u52a1\u903b\u8f91\u5b9e\u73b0 \u57fa\u7840\u670d\u52a1\u5c42\uff1a\u539f\u5b50\u5316\u7684\u63a5\u53e3\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u64cd\u4f5c \u7f13\u5b58\u548c\u6301\u4e45\u5316\u5c42\uff1a\u7ef4\u62a4\u6570\u636e\u72b6\u6001 \u4e00\u4e2a\u8457\u540d\u7684\u4f8b\u5b50\u662f Dubbo \u670d\u52a1\u5316\u6846\u67b6\u4e8c\u8fdb\u5236\u7684 RPC \u65b9\u5f0f\uff1a \u7b2c 36 \u8bfe \u8de8\u8bed\u8a00\u7c7b RPC \u534f\u8bae GRPC \u4f7f\u7528 \u4e8c\u8fdb\u5236\u5e8f\u5217\u5316\u534f\u8bae\u662f Protocol Buffers \u6765\u4f20\u8f93\u6570\u636e\u3002 \u7b2c 37-39 \u8bfe \u7528\u53cc\u5341\u4e00\u7684\u4f8b\u5b50\u4e32\u8bb2\u7f51\u7edc\u534f\u8bae \u7b2c 40 \u8bb2 \u642d\u5efa\u4e00\u4e2a\u7f51\u7edc\u5b9e\u9a8c\u73af\u5883 \u73af\u5883\u642d\u5efa OVS \u5b9e\u9a8c OVS \u4f1a\u5c06\u81ea\u5df1\u5bf9\u4e8e\u7f51\u7edc\u7684\u914d\u7f6e\u4fdd\u5b58\u5728\u4e00\u4e2a\u672c\u5730\u5e93\u91cc\u9762\uff0c\u8fd9\u4e2a\u5e93\u7684\u8868\u7ed3\u6784\u5173\u7cfb\u5982\u4e0b\uff1a \u8fd9\u4e2a\u5e93\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a JSON\uff0c\u6253\u5370\u51fa\u6765\uff0c\u5c31\u662f\u8fd9\u6837\uff1a","title":"\u8da3\u8c08\u7f51\u7edc\u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#1","text":"OSI \u4e03\u5c42\u534f\u8bae\uff1a \u4ece\u4e0b\u5230\u4e0a\uff1a\u7269\u7406\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u4f1a\u8bdd\u5c42\u3001\u8868\u793a\u5c42\u3001\u5e94\u7528\u5c42\u3002 \u4f1a\u8bdd\u5c42\uff1a\u533a\u5206\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u6bd4\u5982\u56fe\u7247\uff0c\u58f0\u97f3\uff0c\u89c6\u9891\u7b49\uff1b \u8868\u793a\u5c42\uff1a\u5b9a\u4e49\u8bed\u4e49\u8bed\u6cd5\uff0c\u7f16\u7801\u538b\u7f29\u89c4\u8303\uff0c\u5982\u5f8b\u5e08\u6709\u804c\u4e1a\u7528\u8bed\uff0c\u55b7\u5b50\u6709\u4e13\u95e8\u7684\u8c03\u5b50\u3002 \u5e94\u7528\u5c42\uff1a\u4e0a\u9762\u4e24\u5c42\u901a\u5e38\u548c\u5e94\u7528\u5c42\u5408\u4e3a\u4e00\u4f53\uff0c\u5b9a\u4e49\u5177\u4f53\u7684\u5e94\u7528\u5f62\u6001\uff0c\u6570\u636e\u683c\u5f0f\uff0c\u4f8b\u5b50\uff1a\u7528\u4e8e Web \u7684 HTTP \u534f\u8bae\uff08\u5b89\u5168 HTTPS\uff09\uff0c\u7528\u4e8e\u4f20\u8f93\u6587\u4ef6\u7684 FTP \u534f\u8bae\uff0c\u7528\u4e8e Email \u7684 IMAP \u534f\u8bae\u7b49\u3002 \u5e94\u7528\u5c42\uff1aDHCP\u3001HTTP\u3001HTTPS\u3001DNS\u3001HTTPDNS\uff08\u66f4\u4e3a\u7cbe\u51c6\uff09\u3001RPC\uff08\u8fdb\u7a0b\u7ea7\u522b\u7684\u901a\u4fe1\uff09\u3001FTP\u3001IMAP \u4f20\u8f93\u5c42\uff1aTCP\u3001UDP \u7f51\u7edc\u5c42\uff1aICMP\u3001IP\u3001OSPF\u3001BGP\u3001IPSec\u3001GRE \u94fe\u8def\u5c42\uff1aARP\u3001RARP\u3001VLAN\u3001STP","title":"\u7b2c 1 \u8bfe \u7f51\u7edc\u534f\u8bae\u4e00\u89c8"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#2","text":"\u590d\u6742\u7684\u7a0b\u5e8f\u90fd\u9700\u8981\u5206\u5c42\uff0c\u8fd9\u662f\u7a0b\u5e8f\u8bbe\u8ba1\u7684\u8981\u6c42\u3002 \u7f51\u7edc\u901a\u4fe1\u4e2d\uff0c\u53ef\u4ee5\u6709\u4e0b\u5c42\u6ca1\u4e0a\u5c42\uff0c\u4f46\u4e0d\u80fd\u6709\u4e0a\u5c42\u6ca1\u4e0b\u5c42\u3002","title":"\u7b2c 2 \u8bfe \u7f51\u7edc\u5206\u5c42"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#3-ifconfig-ip","text":"Windows\uff1aipconfig Linux\uff1aifconfig ifconfig vs ip addr -> net-tools vs iproute2 net-tools \u7cfb\u5de5\u5177\u76ee\u524d\u5f88\u591a Linux \u53d1\u884c\u7248\u90fd\u5df2\u4e0d\u5728\u63d0\u4f9b\uff0c\u5efa\u8bae\u91cd\u70b9\u638c\u63e1 iproute2 \uff0c\u4f46\u5f88\u591a\u8001\u7cfb\u7edf\u4ecd\u7136\u5e38\u7528 net-tools \u7cfb\uff0c\u9700\u8981\u4e24\u4e2a\u90fd\u5f97\u719f\u6089\u3002 \u91cd\u70b9\uff1a net-tools \u901a\u8fc7 procfs(/proc) \u548c ioctl \u7cfb\u7edf\u8c03\u7528\u533a\u8bbf\u95ee\u548c\u6539\u53d8\u5185\u6838\u7f51\u7edc\u53c2\u6570\u914d\u7f6e\u5b9e\u73b0\u7f51\u7edc\u529f\u80fd\uff0c\u800c iproute2 \u5219\u662f\u901a\u8fc7 netlink \u5957\u63a5\u5b57\u76f4\u63a5\u4e0e\u5185\u6838\u901a\u4fe1\uff08\u6027\u80fd\u4e0a\u4f1a\u5360\u4f18\uff09\u3002 A\u3001B\u3001C \u4e09\u7c7b\u5730\u5740\u5305\u542b\u7684\u4e3b\u673a\u6570\u91cf\uff1a \u6700\u53f3\u4e00\u680f\u663e\u793a\u4e86\u79c1\u6709\u5730\u5740\uff0c\u8fd9\u5c31\u662f\u5e73\u5e38\u6211\u4eec\u5728\u529e\u516c\u5ba4\u3001\u5bb6\u91cc\u548c\u5b66\u6821\u91cc\u5e38\u914d\u7684 IP \u5730\u5740\u3002 \u7f13\u89e3 IPv4 \u5730\u5740\u8017\u5c3d\u7684\u4e24\u79cd\u4e34\u65f6\u89e3\u51b3\u65b9\u6848\uff1aCIDR\u3001NAT\u3002 root@ubuntu:~# ifconfig enp0s3 Link encap:Ethernet HWaddr 08:00:27:2d:63:18 inet addr:192.168.0.109 Bcast:192.168.0.255 Mask:255.255.255.0 inet6 addr: fe80::a00:27ff:fe2d:6318/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:73 errors:0 dropped:0 overruns:0 frame:0 TX packets:62 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:8927 (8.9 KB) TX bytes:9019 (9.0 KB) \u7f51\u7edc\u8bbe\u5907\u7684\u72b6\u6001\u6807\u8bc6\uff1a <BROADCAST, MULTICAST, UP, LOWER_UP> UP\uff1a\u8868\u793a\u7f51\u5361\u5904\u4e8e\u542f\u52a8\u72b6\u6001 BROADCAST\uff1a\u8868\u793a\u7f51\u5361\u53ef\u4ee5\u53d1\u9001\u5e7f\u64ad MULTICAST\uff1a\u8868\u793a\u7f51\u5361\u53ef\u4ee5\u53d1\u9001\u591a\u64ad LOWER_UP\uff1a\u8868\u793a L1 \u662f\u542f\u52a8\u7684\uff0c\u4e5f\u5373\u7f51\u7ebf\u662f\u63d2\u7740\u7684 MTU 1500\uff1a\u4ee5\u592a\u7f51\u9ed8\u8ba4\u7684\u6700\u5927\u4f20\u8f93\u5355\u5143\uff08\u4ee5\u592a\u7f51\u5934\u90e8+\u6b63\u6587\u90e8\u5206\uff09\u3002\u6ce8\u610f\u548c\u4f20\u8f93\u5c42\u7684 MSS\uff08\u6700\u5927\u62a5\u6587\u6bb5\uff09\u7684\u533a\u522b\u3002 qdisc pfifo_fast \uff1a\u7f51\u5361\u961f\u5217\u6392\u961f\u89c4\u5219\u3002 pfifo \u6700\u7b80\u5355\u7684\u89c4\u5219\uff0c\u6570\u636e\u5305\u5148\u8fdb\u5148\u51fa\u3002 pfifo_fast \u7a0d\u5fae\u590d\u6742\uff0c\u961f\u5217\u5305\u62ec\u4e09\u4e2a\u6ce2\u6bb5\uff08band\uff09\uff0c\u5728\u6bcf\u4e2a\u6ce2\u6bb5\u91cc\uff0c\u540c\u6837\u91c7\u7528\u5148\u8fdb\u5148\u51fa\u3002\u6570\u636e\u5305\u6309\u7167 TOS\uff08Type of Service\uff09 \u88ab\u5206\u914d\u5230\u4e09\u4e2a\u6ce2\u6bb5\u3002 TOS \u6307\u660e\u4e86\u5f53\u524d\u6570\u636e\u5305\u7684\u4f18\u5148\u7ea7\u3002 \u7f51\u7edc\u6536\u53d1\u7684\u5b57\u8282\u6570\u3001\u5305\u6570\u3001\u9519\u8bef\u6570\u4ee5\u53ca\u4e22\u5305\u60c5\u51b5\uff0c\u7279\u522b\u662f TX \u548c RX \u90e8\u5206\u7684 errors\u3001dropped\u3001overruns\u3001carrier \u4ee5\u53ca collisions \u7b49\u6307\u6807 errors\uff1a\u8868\u793a\u53d1\u751f\u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u5982\u6821\u9a8c\u9519\u8bef\u3001\u5e27\u540c\u6b65\u9519\u8bef\u7b49 dropped\uff1a\u8868\u793a\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\uff0c\uff08\u5305\u5df2\u7ecf\u5230\u4e86\u63a5\u6536\u961f\u5217\u7684 ring buffer\uff0c\u4f46\u56e0\u4e3a\u5185\u5b58\u4e0d\u8db3\u7b49\u539f\u56e0\u4e22\u5305\uff09 overruns\uff1a\u8868\u793a\u8d85\u9650\u6570\u636e\u5305\u6570\uff0c\u7f51\u7edc I/O \u901f\u5ea6\u8fc7\u5feb\uff0c\u5bfc\u81f4 ring buffer \u4e2d\u6570\u636e\u5305\u6765\u4e0d\u53ca\u5904\u7406\u800c\u5bfc\u81f4\u4e22\u5305 carrier\uff1a\u8868\u793a\u53d1\u751f carrier \u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u6bd4\u5982\u53cc\u5de5\u6a21\u5f0f\u4e0d\u5339\u914d\uff0c\u7269\u7406\u7535\u7f06\u51fa\u73b0\u95ee\u9898\u7b49 collisions\uff1a\u8868\u793a\u78b0\u649e\u6570\u636e\u5305\u6570","title":"\u7b2c 3 \u8bfe ifconfig \u4e0e IP \u5730\u5740\u5206\u7c7b"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#4-ip-dhcp","text":"ip \u914d\u7f6e\uff1a ifconfig\uff1a sudo ifconfig eth0 10.0.0.1/24 sudo ifconfig eth0 up ip addr: sudo ip addr add 10.0.0.1/24 dev eth0 sudo ip link set up eth1 DHCP \u81ea\u52a8\u914d\u7f6e IP \u5730\u5740\uff1a \u91c7\u7528\u79df\u7ea6\uff08\u79df\u623f\uff09\u5730\u5740\u7684\u65b9\u5f0f\uff0c\u4fbf\u4e8e\u7f51\u7edc\u7ba1\u7406\u3002 \u5de5\u4f5c\u65b9\u5f0f\uff1a 1. DHCP Discover \uff1a\u9996\u6b21\u63a5\u5165\u7684 Client \u7ec8\u7aef\u5e7f\u64ad\u3002\u5e7f\u64ad\u5305 src \u662f\uff1a0.0.0.0\uff0cdst \u662f 255.255.255.255\uff0c\u4f7f\u7528 UDP\uff0cUDP \u5c01\u88c5 BOOTP \uff08BOOTP \u662f DHCP \u7684\u52a0\u5f3a\u7248\uff09\u3002 DHCP Offer \uff1aDHCP Server \u5e7f\u64ad\u3002\u5e7f\u64ad\u5305 src \u662f\uff1aDHCP Server \u7684 IP\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26\u4e86\u5206\u914d\u7684 IP \u5730\u5740\u3002 DHCP Request \uff1aClient \u63a5\u53d7\u5230 IP \u5730\u5740\u540e\u5e7f\u64ad\uff08\u5982\u679c\u5b58\u5728\u591a\u4e2a DHCP Server\uff0c\u5219 Client \u53ef\u80fd\u6536\u5230\u591a\u4e2a IP\uff0c\u5b83\u4f1a\u9009\u62e9\u6700\u5148\u5230\u8fbe\u7684\u4e00\u4e2a\uff09\u3002\u5e7f\u64ad\u5305 src \u662f 0.0.0.0\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26 Client \u63a5\u53d7\u7684 IP\uff0c\u4ee5\u53ca\u63a5\u53d7\u79df\u7ea6\u7684 Server \u7684 IP \u7b49\u4fe1\u606f\uff0c\u76ee\u7684\u662f\u544a\u8bc9\u4f17\u591a Server \u5b83\u5df2\u79df\u5230\u5730\u5740\uff0c\u79df\u5230\u8c01\u7684\u5730\u5740\uff0c\u5bf9\u6ca1\u6709\u63a5\u53d7\u7684 Server \u53ef\u4ee5\u64a4\u9500\u5b83\u4eec\u63d0\u4f9b\u7684\u5730\u5740\u3002 DHCP ACK \uff1aDHCP Server \u5e7f\u64ad\uff08\u7ed9 Client \u786e\u8ba4\u5730\u5740\u53ca\u79df\u671f\u7b49\u4fe1\u606f\uff0c\u540c\u65f6\u544a\u77e5\u5176\u4f59\u89d2\u8272\u8fd9\u4e2a IP \u5df2\u7ed9\u67d0\u4eba\uff09\u3002\u5e7f\u64ad\u5305 src \u662f\uff1aDHCP Server \u7684 IP\uff0cdst \u662f 255.255.255.255\uff0c\u5c01\u88c5\u5305\u643a\u5e26\u79df\u671f\u7b49\u4fe1\u606f\u3002 IP \u5730\u5740\u7684\u6536\u56de\u4e0e\u7eed\u79df \u5f53 Client \u79df\u671f\u8fc7\u53bb 50% \u7684\u65f6\u5019\uff0c\u4f1a\u76f4\u63a5\u5411\u7ed9\u5b83\u63d0\u4f9b IP \u7684 DHCP Server \u53d1\u9001 DHCP Request \u5305\uff0cServer \u4f1a\u6839\u636e Request \u66f4\u65b0\u79df\u671f\u53ca\u5176\u4ed6 TCP/IP \u53c2\u6570\uff0c\u5411 Client \u53d1\u9001 DHCP ACK \u5305\uff0cClient \u4e5f\u4f1a\u636e\u6b64\u66f4\u65b0\u81ea\u8eab\u7684\u914d\u7f6e\u3002","title":"\u7b2c 4 \u8bfe IP \u5730\u5740\u4e0e DHCP"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#5-mac-arp","text":"\u89e3\u51b3\uff1a\u53d1\u7ed9\u8c01\uff0c\u51fa\u73b0\u62e5\u5835\u600e\u4e48\u529e\uff1f\u5373\u591a\u8def\u8bbf\u95ee\u62e5\u5835\u7684\u95ee\u9898 MAC \u5c42\u591a\u8def\u8bbf\u95ee\u7b97\u6cd5\uff1a \u4fe1\u9053\u5212\u5206\uff1a\u4f60\u8d70\u4f60\u7684\uff0c\u6211\u8d70\u6211\u7684 \u8f6e\u6d41\u534f\u8bae\uff1a\u4eca\u5929\u5355\u53f7\u51fa\u884c\uff0c\u660e\u5929\u53cc\u53f7\u51fa\u884c \u968f\u673a\u63a5\u5165\u534f\u8bae\uff1a\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\uff0c\u6709\u4e8b\u5148\u51fa\u95e8\uff0c\u53d1\u73b0\u7279\u5835\uff0c\u5c31\u56de\u53bb\uff0c\u9519\u8fc7\u9ad8\u5cf0\u518d\u51fa MAC \u6570\u636e\u5305\u683c\u5f0f\uff1a ARP\uff1aMAC \u5730\u5740\u89e3\u6790 ARP \u62a5\u6587\u683c\u5f0f\uff1a RARP\uff1a\u53cd\u5411\u5730\u5740\u89e3\u6790\uff0c\u6839\u636e MAC \u6c42 IP\u3002 \u5e38\u7528\u5728\u4e00\u4e9b\u65e0\u76d8\u5de5\u4f5c\u7ad9\uff08\u6ca1\u6709\u786c\u76d8\uff0c\u65e0\u6cd5\u4fdd\u5b58 IP \u5730\u5740\uff0c\u4f46\u662f\u6709\u552f\u4e00\u7684 MAC \u5730\u5740\uff09\uff0c\u8fd9\u65f6\u53ef\u4ee5\u901a\u8fc7 RARP \u6839\u636e MAC \u8bf7\u6c42 IP\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 DHCP \u6216 BOOTP\u3002\u6240\u4ee5\uff0cRARP \u4e00\u822c\u4e0d\u5e38\u7528\u3002 Hub \u548c \u4ea4\u6362\u673a\u7684\u533a\u522b\uff1a Hub\uff1a \u4e00\u4e2a\u5e7f\u64ad\u57df\uff0c\u4e00\u4e2a\u51b2\u7a81\u57df \u4f20\u8f93\u6570\u636e\u8fc7\u7a0b\u4e2d\u6613\u4ea7\u751f\u51b2\u7a81\uff0c\u5e26\u5bbd\u5229\u7528\u7387\u4e0d\u9ad8 \u6bcf\u6b21\u6570\u636e\u4f20\u8f93\u90fd\u662f\u5168\u90e8\u7aef\u53e3\u8f6c\u53d1\uff0c\u6ca1\u6709\u5b66\u4e60\u529f\u80fd Switch\uff1a 1. \u5728\u5212\u5206 vlan \u7684\u524d\u63d0\u4e0b\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u5e7f\u64ad\u57df\uff0c\u6bcf\u4e2a\u63a5\u53e3\u90fd\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u51b2\u7a81\u57df\u3002 2. \u901a\u8fc7\u81ea\u6211\u5b66\u4e60\u7684\u65b9\u6cd5\u53ef\u4ee5\u6784\u5efa\u51fa CAM \u8868\uff08MAC \u5730\u5740\u8868\uff0cContent Addressable Memory\uff09\uff0c\u5e76\u57fa\u4e8e CAM \u8868\u8fdb\u884c\u6570\u636e\u8f6c\u53d1\u3002 3. \u652f\u6301\u751f\u6210\u6811\u7b97\u6cd5\uff0c\u53ef\u4ee5\u6784\u5efa\u51fa\u7269\u7406\u6709\u73af\uff0c\u903b\u8f91\u65e0\u73af\u7684\u7f51\u7edc\uff0c\u7f51\u7edc\u5197\u4f59\u548c\u6570\u636e\u4f20\u8f93\u6548\u7387\u90fd\u7529 Hub \u597d\u51e0\u6761\u8857\u3002","title":"\u7b2c 5 \u8bfe MAC \u5730\u5740\u4e0e ARP"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#6-vlan","text":"\u4ea4\u6362\u673a\u73af\u8def\u95ee\u9898\uff1a \u6700\u5178\u578b\u7684\u573a\u666f\u662f\uff1a\u4e24\u4e2a\u4ea4\u6362\u673a\u5206\u522b\u8fde\u63a5\u4e24\u4e2a LAN\uff0c\u5982\u4e0b\uff1a \u7834\u89e3\u73af\u8def\u95ee\u9898\uff1aSPT\uff0cSpanning Tree Protocol\uff0c\u6700\u5c0f\u751f\u6210\u6811\u7b97\u6cd5 \u6982\u5ff5\uff1a - Root Bridge \uff1a\u6839\u4ea4\u6362\u673a\uff0c\u638c\u95e8\uff0c\u67d0\u68f5\u6811\u7684\u8001\u5927\u3002 - Designated Bridges \uff1a\u6307\u5b9a\u4ea4\u6362\u673a\uff0c\u4e00\u68f5\u6811\u7684\u6811\u679d\uff0c\u7531\u8001\u5927\u6307\u5b9a\u7684\u7ba1\u4e8b\u7684\u4eba\u3002 - Bridge Protocol Data Units(BPDU) \uff1a\u7f51\u6865\u534f\u8bae\u6570\u636e\u5355\u5143\u3002\u5404\u4ea4\u6362\u673a\u4e4b\u95f4\u534f\u5546\u7684\u534f\u8bae\uff08\u6bd4\u8f83\u5b9e\u529b\uff09\uff0cBPDU \u53ea\u6709\u638c\u95e8\u80fd\u53d1\uff0c\u5df2\u7ecf\u96b6\u5c5e\u4e8e\u67d0\u4e2a\u638c\u95e8\u7684\u4ea4\u6362\u673a\u53ea\u80fd\u4f20\u8fbe\u638c\u95e8\u7684\u6307\u793a\u3002 - Priority Vector \uff1a\u4f18\u5148\u7ea7\u5411\u91cf\u3002\u6bd4\u55bb\u4e3a\u5b9e\u529b\uff08\u503c\u8d8a\u5c0f\u5b9e\u529b\u8d8a\u5f3a\uff09\u3002 <Root Bridge ID, Root Path Cost, Bridge ID, and Port ID> \uff0c\u4e00\u5c42\u5c42\u7684\u6bd4\u8f83\uff08Root Bridge ID \u6bd4\u8f83\u662f\u5426\u96b6\u5c5e\u4e8e\u540c\u4e00\u4e2a\u638c\u95e8\uff0cRoot Path Cost \u6bd4\u8f83\u548c\u638c\u95e8\u7684\u5173\u7cfb\uff0cBridge ID \u6bd4\u8f83\u81ea\u8eab\u7684\u5b9e\u529b\uff09 STP \u7684\u5de5\u4f5c\u8fc7\u7a0b\uff1a \u628a\u4e00\u4e2a\u4e2a\u7684\u4ea4\u6362\u673a\u770b\u4f5c\u662f\u6c5f\u6e56\u4e0a\u5404\u5927\u6b66\u6797\u9ad8\u624b\uff0c\u901a\u8fc7\u4e92\u76f8\u6bd4\u6b66\u7684\u65b9\u5f0f\u6765\u7edf\u4e00\u6c5f\u6e56\u3002 \u638c\u95e8->\u540c\u95e8->\u5c0f\u5f1f \u53ea\u6709\u638c\u95e8\u53ef\u4ee5\u53d1 BPDU\uff0c\u521a\u5f00\u59cb\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u53d1\u3002 Bridge ID \u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff08\u7ba1\u7406\u5458\u4e8b\u5148\u4f1a\u6839\u636e\u4ea4\u6362\u673a\u7684\u4ef7\u683c\u7b49\u56e0\u7d20\u914d\u7f6e\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff09\u3002 \u5de5\u4f5c\u8fc7\u7a0b\u5176\u5b9e\u5c31\u662f\u901a\u8fc7\u4e0d\u65ad\u7684\u76f8\u9047\u3001\u6bd4\u8f83\u3001\u5408\u5e76\u6765\u6700\u7ec8\u7edf\u4e00\u8fd9\u68f5\u6811\u3002\uff08\u4e0d\u540c\u95e8\u6d3e\u7684\u638c\u95e8\u76f8\u9047\uff0c\u540c\u95e8\u76f8\u9047\uff0c\u4e0d\u540c\u95e8\u6d3e\u5c0f\u5f1f\u76f8\u9047\u7b49\uff0c\u901a\u8fc7\u6bd4\u8f83 Priority Vector \u6765\u51b3\u5b9a\uff09 \u8fd9\u4e2a\u4f8b\u5b50\u5177\u4f53\u53c2\u89c1\u8bfe\u7a0b\u63cf\u8ff0\uff0c\u4e00\u770b\u5c31\u61c2\uff01 STP \u7684\u7f3a\u70b9\uff1a \u8ba1\u7b97\u91cf\u5927\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u8de8\u5730\u57df\u548c\u8de8\u56fd\u7684\u7f51\u7edc\u5f62\u6001\u3002 \u6ca1\u6709\u8d1f\u8f7d\u5206\u62c5\uff0c\u56e0\u4e3a\u6709\u4e00\u6761\u94fe\u8def\u4f1a\u88ab\u963b\u585e\uff0c\u4e0d\u80fd\u5f88\u597d\u7684\u5206\u62c5\u7f51\u7edc\u8d1f\u8f7d\uff0ccisco \u7684 PVST+ \u5bf9\u6b64\u4f5c\u4e86\u6539\u8fdb\u3002 VLAN \u7684\u62a5\u6587\u683c\u5f0f\uff1a \u5728\u914d VLAN \u7684\u4ea4\u6362\u673a\u4e2d\uff0c\u8fde\u7ec8\u7aef\u7684\u662f Access \u53e3\uff0c\u8fde\u4ea4\u6362\u673a\u7684\u662f Trunk \u53e3\u3002","title":"\u7b2c 6 \u8bfe \u4ea4\u6362\u673a\u548c VLAN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#7-icmpping-traceroute","text":"ICMP \u62a5\u6587\u683c\u5f0f\uff1a ICMP \u62a5\u6587\u7c7b\u578b\uff1a - \u67e5\u8be2\u62a5\u6587\u7c7b\u578b\uff1a\u4e3b\u52a8\u8bf7\u6c42\uff0c\u5982 ping \uff0c\u8bf7\u6c42\u5305\u4e3a ICMP ECHO REQUEST \uff0c\u5e94\u7b54\u5305\u4e3a ICMP ECHO REPLY \u3002 - \u5dee\u9519\u62a5\u6587\u7c7b\u578b\uff1a\u88ab\u52a8\u62a5\u544a\u5dee\u9519\u7c7b\u578b\uff08\u7ec8\u70b9\u4e0d\u53ef\u8fbe\u662f 3\uff0c\u6e90\u6291\u5236\u662f 4\uff0c\u8d85\u65f6\u662f 11\uff0c\u91cd\u5b9a\u5411\u662f 5\uff09\uff0c - \u7ec8\u70b9\u4e0d\u53ef\u8fbe\u5305\u62ec\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3001\u4e3b\u673a\u4e0d\u53ef\u8fbe\u3001\u534f\u8bae\u4e0d\u53ef\u8fbe\u3001\u7aef\u53e3\u4e0d\u53ef\u8fbe\u3001\u9700\u8981\u8fdb\u884c\u5206\u7247\u4f46\u8bbe\u7f6e\u4e86\u4e0d\u5206\u7247\u4f4d\u3002 - \u6e90\u6291\u5236\u662f\u8ba9\u6e90\u7ad9\u653e\u6162\u53d1\u9001\u901f\u5ea6\uff1b - \u8d85\u65f6\u662f\u8d85\u8fc7\u7f51\u7edc\u5305\u7684\u751f\u5b58\u65f6\u95f4\u8fd8\u6ca1\u5230\uff1b - \u8def\u7531\u91cd\u5b9a\u5411\u662f\u4e0b\u6b21\u53d1\u7ed9\u53e6\u4e00\u4e2a\u8def\u7531\u5668\u3002 \u67e5\u8be2\u62a5\u6587\u7684\u4f7f\u7528\u4f8b\u5b50\uff1a ping \u53d1\u9001\u4e0e\u63a5\u6536\u8fc7\u7a0b\uff1a \u6839\u636e ping \u5305\u7684\u7f51\u7edc\u6392\u67e5\u8fc7\u7a0b\uff1a 1. \u77e5\u9053 ping \u5305\u8def\u5f84\u4e0a\u7ecf\u8fc7\u54ea\u4e9b\u8282\u70b9\uff0c\u753b\u51fa\u62d3\u6251\u56fe 2. \u6839\u636e\u62d3\u6251\u56fe\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u6267\u884c\u6293\u5305 tcpdump -i eth0 icmp \u67e5\u770b ICMP \u5305\u7684\u4fe1\u606f 3. \u6709\u4e9b\u8bbe\u5907\u662f\u7981 ping \uff0cping \u4e0d\u540c\u4e0d\u4ee3\u8868\u7f51\u7edc\u4e0d\u901a\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u501f\u52a9 telnet \u4e4b\u7c7b\u7684\u5de5\u5177\u6392\u67e5\u3002 \u5dee\u9519\u62a5\u6587\u7684\u4f7f\u7528\u4f8b\u5b50\uff1a traceroute \uff1a 1. \u901a\u8fc7\u8bbe\u7f6e\u8def\u5f84 TTL \u7684\u65b9\u5f0f\u83b7\u53d6\u8def\u5f84\u4e0a\u8def\u7531\u5668\u7684 IP\uff08\u4ece 1 \u9010\u6e10\u9012\u589e\uff09 2. \u4e3b\u52a8\u77e5\u6653\u76ee\u7684\u4e3b\u673a\u7684\u4e0d\u53ef\u8fbe\u4fe1\u606f\uff08\u9519\u8bef\u8bbe\u7f6e\u4e00\u4e2a\u4e0d\u53ef\u80fd\u7684\u503c\u4f5c\u4e3a UDP \u7aef\u53e3\u53f7\uff0c\u5982\u5927\u4e8e 30000\uff0c\u5f53\u5230\u8fbe\u76ee\u6807\u65f6\uff0c\u4f1a\u4ea7\u751f\u201c\u7aef\u53e3\u4e0d\u53ef\u8fbe\u7684\u201d\u9519\u8befICMP\u62a5\u6587\uff09 3. \u901a\u8fc7\u8bbe\u7f6e\u4e0d\u5206\u7247\u6765\u786e\u5b9a\u8def\u5f84\u7684 MTU\uff08\u6545\u610f\u8bbe\u7f6e\u4e0d\u5206\u7247\uff0c\u4e2d\u95f4\u5361\u4f4f\u4f1a\u53d1 ICMP \u7f51\u7edc\u5dee\u9519\u5305\uff09 4. \u53d1\u9001 UDP \u5305","title":"\u7b2c 7 \u8bfe ICMP\u3001ping \u4e0e traceroute"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#8-nat","text":"MAC \u5934\u548c IP \u5934\uff1a \u7f51\u5173\u7c7b\u578b\uff1a - \u8f6c\u53d1\u7f51\u5173\uff1a\u4e0d\u6539\u53d8 IP \u5730\u5740\u7684\u7f51\u5173 - NAT \u7f51\u5173\uff1a\u6539\u53d8 IP \u5730\u5740\u7684\u7f51\u5173 \u53ef\u4ee5\u901a\u8fc7\uff1a https://www.whatismyip.com/ \u67e5\u770b\u81ea\u5df1 IP \u7684\u51fa\u53e3 IP \u5730\u5740\uff08\u516c\u7f51\u5730\u5740\uff09 \u6269\u5c55\uff1a NAT \u53c8\u5206\u4e3a\u57fa\u7840 NAT \u548c NAPT\u3002 \u57fa\u7840 NAT \u5c31\u662f\u4e00\u5bf9\u4e00\uff08\u4e00\u4e2a\u79c1\u6709\u5730\u5740\u5bf9\u5e94\u4e00\u4e2a\u5168\u7403\u5730\u5740\uff09\uff1b NAPT \u5c31\u662f\u4e00\u4e2a\uff08\u6216\u8005\u591a\u4e2a\u4f46\u5c11\u91cf\u7684\uff09\u5916\u90e8 IP \u548c\u5927\u91cf\u7684\u7aef\u53e3\u53f7\uff0c\u5bf9\u5e94\u591a\u4e2a\u5185\u90e8\u7684 IP \u4ee5\u53ca\u76f8\u5e94\u7684\u7aef\u53e3\u53f7\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5927\u5927\u51cf\u5c11\u4e86\u5bf9\u5168\u7403 IP \u5730\u5740\u7684\u9700\u6c42\u3002 DNAT \u548c SNAT\uff1a SNAT\uff1a \u6e90\u5730\u5740\u8f6c\u6362 DNAT\uff1a\u76ee\u7684\u5730\u5740\u8f6c\u6362","title":"\u7b2c 8 \u8bfe NAT \u7f51\u5173"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#9-ripospfbgp","text":"\u914d\u7f6e\u9759\u6001\u8def\u7531\uff1a ip route add 192.168.10.0/24 via 192.168.10.1 dev eth0 \u52a8\u6001\u8def\u7531\u9760 RIP\uff0cOSPF \u4e4b\u7c7b\u7684\u534f\u8bae\u81ea\u52a8\u914d\u7f6e\u3002 \u666e\u901a\u8def\u7531 \uff1a\u6839\u636e IP \u6765\u914d\u7f6e\u8def\u7531 \u7b56\u7565\u8def\u7531 \uff1a\u9664\u4e86\u6839\u636e IP \u914d\u7f6e\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u591a\u4e2a\u53c2\u6570\u6765\u914d\u7f6e\uff08\u5165\u53e3\u8bbe\u5907\u3001TOS \u7b49\uff09\uff0c\u4f7f\u5f97\u4ece\u4e0d\u540c\u6765\u6e90\u7684\u5305\u8d70\u4e0d\u540c\u7684\u8def\u7531 \u6bd4\u5982\uff1a ip rule add from 192.168.1.0/24 table 10 ip rule add from 192.168.2.0/24 table 20 # \u8868\u793a\u4ece 192.168.1.0/24 \u7f51\u6bb5\u6765\u7684\u5305\u8d70 table 10 \u4e2d\u7684\u8def\u7531\u8868\uff0c\u4ece 192.168.2.0/24 \u7f51\u6bb5\u6765\u7684\u5305\u8d70 table 20 \u4e2d\u7684\u8def\u7531\u8868 \u5728\u4e00\u6761\u8def\u7531\u89c4\u5219\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u8d70\u591a\u6761\u8def\u5f84\uff0c\u4f8b\u5982\uff1a ip route add default scope global nexthop via 100.100.100.1 weight 1 nexthop 200.200.200.1 weight 2 \u52a8\u6001\u8def\u7531\uff1a \u57fa\u4e8e\u4e24\u79cd\u7b97\u6cd5 Bellman-Ford \u548c Dijkstra \u7b97\u6cd5 Bellman-Ford \uff1a\u8ddd\u79bb\u77e2\u91cf\u8def\u7531\u7b97\u6cd5\uff0c\u8def\u7531\u8868\u4fdd\u5b58\u4e24\u4e2a\u4fe1\u606f\uff1a\u5230\u8fbe\u76ee\u6807\u7684\u8def\u7ebf\u51fa\u53e3\u548c\u8ddd\u79bb\uff0c \u7f3a\u70b9 \uff1a1\uff09\u597d\u6d88\u606f\u4f20\u5f97\u5feb\uff0c\u574f\u6d88\u606f\u4f20\u5f97\u6162\uff08\u7c7b\u6bd4\u4e00\u4e2a\u8d70\u4e22\u4e86\u5230\u5904\u95ee\u4eba\uff09\uff1b2\uff09\u89c4\u6a21\u4e0d\u80fd\u592a\u5927\uff0cRIP \u91c7\u7528\u8fd9\u79cd\u7b97\u6cd5\uff0c\u89c4\u6a21\u9650\u5b9a\u5728 15 hop \u4ee5\u5185\u3002 Dijkstra \uff1a\u94fe\u8def\u72b6\u6001\u8def\u7531\u7b97\u6cd5\uff0c\u4ee3\u8868\uff1aOSPF\u3002\u90bb\u5c45\u53d1\u9001\u94fe\u8def\u72b6\u6001\u6765\u611f\u77e5\u6574\u4e2a\u7f51\u7edc\u62d3\u6251\uff0c\u4ece\u800c\u6839\u636e Dijkstra \u7b97\u6cd5\u6765\u8ba1\u7b97\u4e24\u70b9\u95f4\u7684\u6700\u77ed\u8def\u5f84\u3002 \u4f18\u70b9 \uff1a1\uff09\u53ea\u5e7f\u64ad\u6216\u66f4\u65b0\u6539\u53d8\u7684\u7f51\u7edc\u62d3\u6251\uff0c\u8282\u7701\u4e86\u5e26\u5bbd\u548c CPU \u5229\u7528\u7387\u30022\uff09\u4e00\u65e6\u8282\u70b9\u6302\u4e86\uff0c\u90bb\u5c45\u4f1a\u5e7f\u64ad\u8fd9\u4e2a\u6d88\u606f\uff0c\u574f\u6d88\u606f\u4e5f\u80fd\u8fc5\u901f\u6536\u655b; \u7f3a\u70b9 \uff1a1\uff09\u8ba1\u7b97\u91cf\u5927\uff0c\u6bcf\u6b21\u72b6\u6001\u66f4\u65b0\u90fd\u8981\u8ba1\u7b97\u6700\u77ed\u8def\u5f84\uff1b2\uff09\u9700\u8981\u5b58\u50a8\u7a7a\u95f4\u5927\u3002 OSPF\uff1a OSPF \u57fa\u4e8e Dijkstra \u7b97\u6cd5\u6c42\u6700\u77ed\u8def\u5f84\uff0c\u6765\u901a\u544a\u90bb\u5c45\u72b6\u6001\u6d88\u606f\u3002\u5982\u679c\u53d1\u73b0\u5b58\u5728\u591a\u6761\u6700\u77ed\u8def\u5f84\uff0c\u5219\u53ef\u4ee5\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u79f0\u4e3a \u7b49\u4ef7\u8def\u7531 \u3002\uff08\u4e00\u822c\u5e94\u7528\u7684\u63a5\u5165\u5c42\u6709\u4f1a\u8d1f\u8f7d\u5747\u8861 LVS\uff0c\u53ef\u4ee5\u548c OSPF \u4e00\u8d77\uff0c\u5b9e\u73b0\u9ad8\u541e\u5410\u91cf\u7684\u63a5\u5165\u5c42\u8bbe\u8ba1\uff09 BGP\uff1a \u91c7\u7528\u8def\u5f84\u77e2\u91cf\u7b97\u6cd5\uff0c\u662f\u8ddd\u79bb\u77e2\u91cf\u7b97\u6cd5\u7684\u5347\u7ea7\u7248\uff0c\u7528\u4e8e\u5404\u4e2a\u81ea\u6cbb\u57df AS \u4e4b\u95f4\u7684\u901a\u4fe1\u3002 AS\uff1a Stub AS \uff1a\u5bf9\u5916\u53ea\u6709\u4e00\u4e2a AS\uff0c\u8fd9\u7c7b AS \u4e0d\u4f1a\u4f20\u8f93\u5176\u4ed6 AS \u7684\u5305\uff0c\u4f8b\u5982\uff0c\u4e2a\u4eba\u6216\u8005\u5c0f\u516c\u53f8\u7684\u7f51\u7edc\u3002 Multihomed AS \uff1a\u53ef\u80fd\u6709\u591a\u4e2a\u8fde\u63a5\u8fde\u5230\u5176\u4ed6 AS\uff0c\u4f46\u662f\u5927\u591a\u62d2\u7edd\u5e2e\u5176\u4ed6 AS \u4f20\u8f93\u5305\u3002\u4f8b\u5982\u4e00\u4e9b\u5927\u516c\u53f8\u7684\u7f51\u7edc\u3002 Transit AS \uff1a\u6709\u591a\u4e2a\u8fde\u63a5\u8fde\u5230\u5176\u4ed6 AS\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e2e\u5176\u4ed6 AS \u4f20\u8f93\u5305\uff0c\u4f8b\u5982\u4e3b\u5e72\u7f51\u3002 BGP \uff1aeBGP \u548c iBGP\uff0ceBGP \u8d1f\u8d23 AS \u4e4b\u95f4\u7684\u901a\u4fe1\uff0ciBGP \u5219\u8d1f\u8d23 AS \u5185\u90e8\u7684\u901a\u4fe1 BGP \u57fa\u4e8e TCP\uff0cOSPF \u57fa\u4e8e UDP\uff0cRIP \u57fa\u4e8e UDP\u3002","title":"\u7b2c 9 \u8bfe \u8def\u7531\u534f\u8bae RIP\u3001OSPF\u3001BGP"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#10-udp","text":"\u7f51\u7edc\u4f20\u8f93\u662f\u4ee5\u5305\u4e3a\u5355\u4f4d\u7684\uff0c\u4e8c\u5c42\u53eb\u5e27\uff0c\u7f51\u7edc\u5c42\u53eb\u5305\uff0c\u4f20\u8f93\u5c42\u53eb\u6bb5\uff0c\u6211\u4eec\u7b3c\u7edf\u79f0\u4e3a\u5305\u3002 UDP \u5305\u5934\u683c\u5f0f\uff1a QUIC \uff08Quick UDP Internet Connections\uff0c\u5feb\u901f UDP \u4e92\u8054\u7f51\u534f\u8bae\uff09\u662f Google \u63d0\u51fa\u6765\u7684\u4e00\u79cd \u57fa\u4e8e UDP \u6539\u8fdb\u7684\u901a\u4fe1\u534f\u8bae \uff0c\u5176\u76ee\u7684\u662f\u964d\u4f4e\u7f51\u7edc\u901a\u4fe1\u7684\u5ef6\u8fdf\uff0c\u63d0\u4f9b\u66f4\u597d\u7684\u7528\u6237\u4e92\u52a8\u4f53\u9a8c\u3002 Quic \u5728\u5e94\u7528\u5c42\u4e0a\uff0c\u4f1a\u81ea\u5df1\u5b9e\u73b0\u5feb\u901f\u8fde\u63a5\u5efa\u7acb\u3001\u51cf\u5c11\u91cd\u4f20\u65f6\u5ef6\u3001\u81ea\u9002\u5e94\u62e5\u585e\u63a7\u5236\u3002 \u5e94\u7528\u573a\u666f\uff1a - \u7f51\u9875\u6216APP\u7684\u8bbf\u95ee\uff1aQuic - \u6d41\u5a92\u4f53\u534f\u8bae\uff08\u76f4\u64ad\uff09\uff1aRTMP - \u5b9e\u65f6\u6e38\u620f\uff1a\u957f\u8fde\u63a5 - IoT \u7269\u8054\u7f51\uff1aGoogle Next \u5efa\u7acb\u4e86 Thread Group\uff0c\u63a8\u51fa\u4e86\u7269\u8054\u7f51\u901a\u4fe1\u534f\u8bae Thread\uff0c\u5c31\u662f\u57fa\u4e8e UDP \u534f\u8bae - \u79fb\u52a8\u901a\u4fe1\u9886\u57df\uff1a4G \u7f51\u7edc\u4e2d\uff0c\u79fb\u52a8\u6d41\u91cf\u4e0a\u7f51\u7684\u6570\u636e\u9762\u5bf9\u7684\u534f\u8bae GTP-U \u662f\u57fa\u4e8e UDP \u7684\u3002","title":"\u7b2c 10 \u8bfe UDP \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#11-tcp","text":"TCP \u5305\u5934\u683c\u5f0f\uff1a TCP \u7684\u53ef\u9760\u6027\u4f53\u73b0\u5728\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a \u987a\u5e8f\u95ee\u9898\uff0c\u7a33\u91cd\u4e0d\u4e71 \u4e22\u5305\u95ee\u9898\uff0c\u627f\u8bfa\u9760\u8c31 \u8fde\u63a5\u7ef4\u62a4\uff0c\u6709\u59cb\u6709\u7ec8 \u6d41\u91cf\u63a7\u5236\uff0c\u628a\u63e1\u5206\u5bf8 \u62e5\u585e\u63a7\u5236\uff0c\u77e5\u8fdb\u77e5\u9000 TCP \u4e09\u6b21\u63e1\u624b\uff1a TCP \u56db\u6b21\u6325\u624b\uff1a TCP \u72b6\u6001\u673a \u5c06\u8fde\u63a5\u5efa\u7acb\u548c\u8fde\u63a5\u65ad\u5f00\u7684\u4e24\u4e2a\u65f6\u5e8f\u72b6\u6001\u56fe\u7efc\u5408\u8d77\u6765\uff0c\u5c31\u662f TCP \u7684\u72b6\u6001\u673a\u3002","title":"\u7b2c 11 \u8bfe TCP \u534f\u8bae\uff08\u4e0a\uff09"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#12-tcp","text":"TCP \u7684\u51e0\u5927\u95ee\u9898\uff1a \u987a\u5e8f\u95ee\u9898\uff1a\u7ed9\u6bcf\u4e2a\u5305\u5206\u914d\u4e00\u4e2a ID\uff0c\u7d2f\u8ba1\u786e\u8ba4\u6216\u7d2f\u8ba1\u5e94\u7b54 \u4e22\u5305\u95ee\u9898\uff1a\u5feb\u901f\u91cd\u4f20\u3001\u81ea\u9002\u5e94\u91cd\u4f20 \u6d41\u91cf\u63a7\u5236\u95ee\u9898\uff1a\u6ed1\u52a8\u7a97\u53e3\uff08\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u90fd\u4f1a\u7ef4\u6301\u8be5\u7a97\u53e3\uff09 \u62e5\u585e\u63a7\u5236\u95ee\u9898\uff1a\u62e5\u585e\u907f\u514d\u7b97\u6cd5 \u6ed1\u52a8\u7a97\u53e3\u673a\u5236\uff1a \u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u5206\u522b\u7ef4\u62a4\u7740\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u5305\u7684\u53d1\u9001\u548c\u63a5\u6536\u60c5\u51b5\u3002\u5982\u4e0b\uff1a \u5bf9\u4e8e\u62e5\u585e\u63a7\u5236\u95ee\u9898\uff0cGoogle \u66fe\u63d0\u51fa\u4e86 TCP BBR \u62e5\u585e\u7b97\u6cd5\uff1a","title":"\u7b2c 12 \u8bfe TCP \u534f\u8bae\uff08\u4e0b\uff09"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#13-socket","text":"\u4ece\u6570\u636e\u7ed3\u6784\u770b socket \u5728\u534f\u8bae\u6808\u4e2d\u7684\u7ed3\u6784\uff1a \u5982\u4e0b\uff0csocket \u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5bf9\u5e94\u5c31\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7531\u6570\u636e\u7ed3\u6784 task_struct \u6765\u5b9a\u4e49\uff0c\u91cc\u9762\u6307\u5411\u7684\u662f\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u7ec4\uff0c\u5217\u51fa\u8fd9\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002 \u63a5\u7740\u901a\u8fc7 struct socket \uff0c\u5c06\u6570\u636e\u8f6c\u6362\u6210 struct sk_buffer \uff0c\u653e\u5165 \u53d1\u9001\u961f\u5217 \u4e2d\uff0c\u53cd\u8fc7\u6765\uff0c\u63a5\u6536\u5230\u7684\u5305\u5c31\u653e\u5165 \u63a5\u6536\u961f\u5217 \u4e2d\u3002 \u901a\u4fe1\u6a21\u578b\uff1a 01 \u591a\u8fdb\u7a0b\u6a21\u578b \u590d\u5236\u4e86\u6587\u4ef6\u63cf\u8ff0\u7b26\u5217\u8868 02 \u591a\u7ebf\u7a0b\u6a21\u578b \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fdb\u7a0b\u7a7a\u95f4\u662f\u5171\u4eab\u7684\uff0c\u53ea\u662f\u591a\u4e86\u4e00\u4e2a\u5f15\u7528\u800c\u5df2\u3002 03 I/O \u591a\u8def\u590d\u7528 select \u4e3b\u52a8\u8f6e\u8be2\uff08\u4e00\u4e2a\u7ebf\u7a0b\u7ef4\u62a4\u591a\u4e2a socket\uff09 04 I/O \u591a\u8def\u590d\u7528 epoll \u4e8b\u4ef6\u56de\u8c03","title":"\u7b2c 13 \u8bfe \u5957\u63a5\u5b57 Socket"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#14-http","text":"HTTP \u8bf7\u6c42\u62a5\u6587\u7684\u683c\u5f0f\uff1a QUIC \u534f\u8bae\uff1a HTTP 2.0 \u76f8\u6bd4 HTTP 1.0\uff0c\u51cf\u5c11\u4e86 TCP \u8fde\u63a5\u6570\u5bf9\u670d\u52a1\u5668\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u52a0\u5feb\u4e86\u9875\u9762\u7ec4\u4ef6\u7684\u4f20\u64ad\u901f\u5ea6\u3002\u4f46 HTTP 2.0 \u7531\u4e8e\u57fa\u4e8e TCP \u534f\u8bae\uff0c\u4f20\u8f93\u6548\u7387\u8fd8\u662f\u8f83\u4e3a\u4f4e\u4e0b\u3002 QUIC \u7684\u51e0\u5927\u673a\u5236\uff1a \u673a\u5236\u4e00\uff1a\u81ea\u5b9a\u4e49\u8fde\u63a5\u673a\u5236\uff0c\u4e0d\u50cf TCP \u8fde\u63a5\u4f7f\u7528\u56db\u5143\u7ec4\uff0cQUIC \u4f7f\u7528\u7684\u662f \u4e00\u4e2a 64 \u4f4d\u7684\u968f\u673a\u6570 ID \u6765\u6807\u8bc6\u4e00\u6b21\u8fde\u63a5\uff0c\u7136\u540e\u57fa\u4e8e UDP\uff0c\u8fd9\u6837\uff0c\u5c31\u4e0d\u9700\u8981\u50cf TCP \u90a3\u6837\u8fde\u63a5\u7aef\u70b9\u5207\u6362\uff08WIFI \u6216\u79fb\u52a8\u7f51\u7edc\u5207\u6362\uff09\u65f6\u5c31\u8981\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002 \u673a\u5236\u4e8c\uff1a\u81ea\u5b9a\u4e49\u91cd\u4f20\u673a\u5236\uff0cQUIC \u7684\u5e8f\u53f7\u4e0d\u7ba1\u5bf9\u65b9\u6709\u6ca1\u6709\u56de\u5e94\uff0c\u90fd\u662f\u9012\u589e\u7684\u3002 \u673a\u5236\u4e09\uff1a\u65e0\u963b\u585e\u7684\u591a\u8def\u590d\u7528 \u673a\u5236\u56db\uff1a\u81ea\u5b9a\u4e49\u6d41\u91cf\u63a7\u5236","title":"\u7b2c 14 \u8bfe HTTP \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#15-https","text":"","title":"\u7b2c 15 \u8bfe HTTPS \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#https","text":"HTTPS \u57fa\u4e8e SSL \u534f\u8bae\uff0c\u63e1\u624b\u8fc7\u7a0b\u4e5f\u662f\u57fa\u4e8e SSL \u7684\u4e09\u6b21\u63e1\u624b\u534f\u8bae\uff0c\u5982\u4e0b\uff1a","title":"HTTPS \u7684\u5de5\u4f5c\u6a21\u5f0f"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#16","text":"\u8bb2\u5230\u4e86\u4e00\u4e2a CDN \u5185\u5bb9\u5206\u53d1\u7f51\u7edc\uff1a\u5305\u62ec\u4e2d\u5fc3\u548c\u8fb9\u7f18\u4e24\u5c42\u3002 \u8fb9\u7f18\u5c42\u670d\u52a1\u5668\u90e8\u7f72\u5728\u5168\u56fd\u5404\u5730\u53ca\u6a2a\u8de8\u5404\u5927\u8fd0\u8425\u5546\u91cc\uff0c\u548c\u7528\u6237\u8ddd\u79bb\u5f88\u8fd1\u3002\u4e2d\u5fc3\u5c42\u662f\u6d41\u5a92\u4f53\u670d\u52a1\u96c6\u7fa4\uff0c\u8d1f\u8d23\u5185\u5bb9\u7684\u8f6c\u53d1\u3002\u667a\u80fd\u8d1f\u8f7d\u5747\u8861\u7cfb\u7edf\uff0c\u6839\u636e\u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5c31\u8fd1\u9009\u62e9\u8fb9\u7f18\u670d\u52a1\u5668\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u63a8 /\u62c9\u6d41\u670d\u52a1\u3002\u4e2d\u5fc3\u5c42\u4e5f\u8d1f\u8d23\u8f6c\u7801\u670d\u52a1\uff0c\u4f8b\u5982\uff0c\u628a RTMP \u534f\u8bae\u7684\u7801\u6d41\u8f6c\u6362\u4e3a HLS \u7801\u6d41\u3002","title":"\u7b2c 16 \u8bfe \u6d41\u5a92\u4f53\u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#17-p2p","text":"\u96c6\u4e2d\u5f0f\u6587\u4ef6\u7684\u4e0b\u8f7d\u65b9\u5f0f\uff1a HTTP + FTP P2P \u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u57fa\u4e8e tracker \u7684\u96c6\u4e2d\u5f0f \u53bb\u4e2d\u5fc3\u5316\u7684\u5b8c\u5168\u5206\u5e03\u5f0f","title":"\u7b2c 17 \u8bfe P2P \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#18-dns","text":"DNS \u670d\u52a1\u5668\u2014\u2014\u7f51\u7edc\u5730\u5740\u7c3f DNS \u670d\u52a1\u5668\uff0c\u4e00\u5b9a\u8981\u8bbe\u8ba1\u6210\u9ad8\u53ef\u7528\u3001\u9ad8\u5e76\u53d1\u548c\u5206\u5e03\u5f0f\u7684 \u4e00\u822c\u5448\u73b0\u8fd9\u6837\u7684\u6811\u72b6\u7ed3\u6784\uff1a \u6839 DNS \u670d\u52a1\u5668 \uff1a\u8fd4\u56de\u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\u7684 IP \u5730\u5740 \u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\uff1a\u8fd4\u56de\u6743\u5a01 DNS \u670d\u52a1\u5668\u7684 IP \u5730\u5740 \u6743\u5a01 DNS \u670d\u52a1\u5668\uff1a\u8fd4\u56de\u76f8\u5e94\u4e3b\u673a\u7684 IP \u5730\u5740 DNS \u67e5\u8be2\u8fc7\u7a0b\u5982\u4e0b\u6240\u793a\uff1a \u672c\u5730 DNS \u670d\u52a1\u5668\uff1a\u4e00\u822c\u5728\u7f51\u7edc\u670d\u52a1\u5546\uff08ISP\uff09\u7684\u673a\u623f\uff0c\u7531 ISP \u5206\u914d \u6839\u57df\u540d\u670d\u52a1\u5668\uff1a\u5206\u5e03\u5728\u5168\u7403\uff0c\u5171\u6709 13 \u5957 \u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\uff1a\u5206\u4e0d\u540c\u533a\u7ba1\u7406\uff0c\u5982 .com\uff0c.cn \u7b49 \u6743\u5a01\u57df\u540d\u670d\u52a1\u5668\uff1a\u66f4\u5177\u4f53\u7684\u57df\u540d\u7ba1\u7406 DNS \u505a\u8d1f\u8f7d\u5747\u8861\uff1a \u5185\u90e8\u8d1f\u8f7d\u5747\u8861 \u8bbf\u95ee\u591a\u4e2a\u5e94\u7528\uff0c\u90e8\u7f72\u591a\u4e2a\uff0c\u6bcf\u6b21\u8fd4\u56de\u4e0d\u4e00\u6837\u7684\u5730\u5740\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861 \u5168\u5c40\u8d1f\u8f7d\u5747\u8861 \u4e00\u4e2a IP \u53ef\u4ee5\u7ba1\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u8f6e\u8be2\u67e5\u8be2\u591a\u4e2a\u670d\u52a1\u5668 \u5177\u4f53\u7684\u8fc7\u7a0b\u53ef\u4ee5\u89c1\u4e0b\u56fe\uff1a \u4e24\u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u7684\u610f\u4e49\u5728\u4e8e\u80fd\u591f\u5c31\u8fd1\u627e\u5230\u5bf9\u5e94\u7684\u5730\u5740\u3002 GSLB\uff1aGlobal Server Load Balance\uff0c\u5168\u5c40\u8d1f\u8d23\u5747\u8861\u5668","title":"\u7b2c 18 \u8bfe DNS \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#19-httpdns","text":"\u4f20\u7edf DNS \u5b58\u5728\u7684\u95ee\u9898\uff1a \u57df\u540d\u7f13\u5b58\u95ee\u9898\uff08\u5f53\u7f13\u5b58\u4f4d\u7f6e\u6539\u53d8\u65f6\uff0c\u6ca1\u6709\u66f4\u65b0\u9875\u9762\uff0c\u8bbf\u95ee\u5230\u8fd8\u662f\u65e7\u7684\u7f13\u5b58\uff0c\u6216\u8005\u5f53\u8bbf\u95ee\u8005\u7684\u4f4d\u7f6e\u6539\u53d8\uff0c\u4f9d\u7136\u63a8\u8350\u65e7\u7684\u7f13\u5b58\u4f4d\u7f6e\uff0c\u5c31\u4e0d\u662f\u6700\u4f18\u7684\u8bbf\u95ee\u8def\u5f84\uff09 \u57df\u540d\u8f6c\u53d1\u95ee\u9898\uff08\u8de8\u8fd0\u8425\u5546\u57df\u540d\u8f6c\u53d1\u89e3\u6790\uff0cA \u8fd0\u8425\u5546\u5077\u61d2\uff0c\u5c06\u57df\u540d\u89e3\u6790\u8bf7\u6c42\u53d1\u7ed9 B \u8fd0\u8425\u5546\uff0c\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u8de8\u8fd0\u8425\u5546\u8bbf\u95ee\u5f00\u9500\uff09 \u51fa\u53e3 NAT \u95ee\u9898\uff08\u51fa\u53e3 NAT\uff0c\u5bfc\u81f4\u57df\u540d\u89e3\u6790\u8bef\u5224\uff09 \u57df\u540d\u66f4\u65b0\u95ee\u9898\uff08\u65f6\u95f4\u7684\u5feb\u6162\u5f71\u54cd DNS \u7684\u89e3\u6790\uff0c\u4ece\u800c\u5f71\u54cd\u7528\u6237\u7684\u8bbf\u95ee\uff09 \u89e3\u6790\u5ef6\u8fdf\u95ee\u9898\uff08\u9012\u5f52\u904d\u5386\u591a\u4e2a DNS \u670d\u52a1\u5668\uff0c\u5bfc\u81f4\u89e3\u6790\u8d85\u65f6\uff09 HTTPDNS \u7684\u5de5\u4f5c\u6a21\u5f0f\uff1a \u81ea\u5df1\u642d\u5efa\u57fa\u4e8e HTTP \u534f\u8bae\u7684 DNS \u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u5206\u5e03\u5728\u591a\u4e2a\u5730\u70b9\u548c\u591a\u4e2a\u8fd0\u8425\u5546\u3002\u5f53\u5ba2\u6237\u7aef\u9700\u8981 DNS \u89e3\u6790\u7684\u65f6\u5019\uff0c\u4e0d\u8d70\u4f20\u7edf\u7684 DNS \u89e3\u6790\uff0c\u800c\u662f\u76f4\u63a5\u901a\u8fc7 HTTP \u534f\u8bae\u8fdb\u884c\u8bf7\u6c42\u8fd9\u4e2a\u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u5f97\u5230\u5c31\u8fd1\u7684\u5730\u5740\u3002 \u8981\u4f7f\u7528 HTTPDNS\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u652f\u6301 HTTPDNS \u7684\u5ba2\u6237\u7aef SDK\u3002 HTTPDNS \u89e3\u51b3\u4e86\u4e24\u5927\u95ee\u9898\uff1a \u89e3\u6790\u901f\u5ea6\u548c\u66f4\u65b0\u901f\u5ea6\u7684\u5e73\u8861\u95ee\u9898\uff08\u7f13\u5b58\u8bbe\u8ba1\uff09 \u667a\u80fd\u8c03\u5ea6\u7684\u95ee\u9898\uff08\u8c03\u5ea6\u8bbe\u8ba1\uff09 HTTPDNS \u7684\u7f13\u5b58\u8bbe\u8ba1\uff1a \u5206\u4e3a\uff1a\u5ba2\u6237\u7aef-\u300bDNS \u7f13\u5b58-\u300b HTTPDNS \u670d\u52a1\u5668 Cache-Aside \u673a\u5236\uff1a \u5148\u8bfb\u7f13\u5b58\uff0c\u4e0d\u547d\u4e2d\u8bfb\u6570\u636e\u5e93\uff0c\u540c\u65f6\u5c06\u7ed3\u679c\u5199\u5165\u7f13\u5b58\u3002 HTTPDNS \u7684\u8c03\u5ea6\u8bbe\u8ba1\uff1a \u5ba2\u6237\u7aef\u638c\u63e1\u6240\u6709\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5168\u5c40\u8c03\u5ea6\u3002","title":"\u7b2c 19 \u8bfe HTTPDNS"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#20-cdn","text":"CDN \u5206\u53d1\u7cfb\u7edf\u67b6\u6784\uff1a CDN \u4e3b\u8981\u7f13\u5b58\u9759\u6001\u8d44\u6e90\uff0c\u4e5f\u6709\u6d41\u5a92\u4f53\u8d44\u6e90\uff0c\u53ef\u4ee5\u7ed3\u5408 DNS \u505a\u8d1f\u8f7d\u5747\u8861\uff1a \u4e66\u7c4d\u63a8\u8350\uff1a\u300aCDN\u6280\u672f\u8be6\u89e3\u300b","title":"\u7b2c 20 \u8bfe CDN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#21","text":"\u6570\u636e\u4e2d\u5fc3\u7684\u51fa\u5165\u53e3\uff0c\u7531\u8def\u7531\u5668\u6765\u8d1f\u8d23\uff0c\u79f0\u4e3a \u8fb9\u754c\u8def\u7531\u5668 \u591a\u53f0\u670d\u52a1\u5668\u5360\u636e\u673a\u67b6\uff08Rack\uff09\uff0c\u5f53\u4e00\u4e2a\u673a\u67b6\u5360\u6ee1\u540e\uff0c\u5c31\u901a\u8fc7 TOR\uff08Top of Rack\uff09\u4ea4\u6362\u673a\u628a\u6240\u6709\u673a\u67b6\u8fde\u63a5\u8d77\u6765\u3002 \u7f51\u5361\u9ad8\u53ef\u7528\uff1a \u4f7f\u7528 \u7f51\u5361\u7ed1\u5b9a\uff08bond\uff09 \u6280\u672f\uff0c\u540c\u65f6\u9700\u8981 LACP\uff08Link Aggregation Control Protocol \u94fe\u8def\u805a\u5408\u63a7\u5236\u534f\u8bae\uff09 \u6765\u652f\u6301\uff0c\u5c06\u591a\u4e2a\u7f51\u5361\u5408\u5e76\u4e3a\u4e00\u4e2a\uff1a \u6570\u636e\u4e2d\u5fc3\u5e38\u89c1\u7684\u67b6\u6784\u662f\u4e00\u79cd\u5206\u5c42\u7684\u67b6\u6784\uff0c\u5206\u4e3a \u63a5\u5165\u5c42\u3001\u6c47\u805a\u5c42\u3001\u6838\u5fc3\u5c42\uff1a \u6c47\u805a\u5c42\u7ba1\u7406\u7684\u533a\u57df\u53eb \u4e00\u4e2a POD\uff08Point of Delivery\uff09\u6216\u8005\u53eb \u53ef\u7528\u533a \uff08Available Zone\uff09\uff0c\u5c06\u591a\u4e2a POD \u8fde\u63a5\u8d77\u6765\u9700\u8981 \u6838\u5fc3\u4ea4\u6362\u673a\u3002 \u4ee5\u4e0a\u6bcf\u4e2a POD \u5728\u4e0d\u540c\u7684\u5e7f\u64ad\u57df\u91cc\u9762\uff0c\u968f\u7740\u4e91\u8ba1\u7b97\u7b49\u53d1\u5c55\uff0c\u8981\u6c42\u6240\u6709\u7684\u670d\u52a1\u5668\u5728\u4e00\u4e2a\u4e8c\u5c42\u7f51\u7edc\u91cc\u9762\uff0c\u6240\u4ee5\u5c31\u6709 \u6c47\u805a\u5c42\u4e0a\u5347\u4e3a\u6838\u5fc3\u5c42\uff0c\u4e5f\u5c31\u662f \u5927\u4e8c\u5c42 : \u6574\u4e2a\u6570\u636e\u4e2d\u5fc3\u7684\u7f51\u7edc\u67b6\u6784\u56fe\u5982\u4e0b\uff1a \u878d\u5408\u4e86\u5b89\u5168\u9632\u62a4\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u8fb9\u754c\u8def\u7531\u5668\uff0c\u8f6f\u4ef6\u5b9a\u4e49\u5b58\u50a8\u7b49\u6280\u672f\u3002 \u76f8\u5bf9\u4e8e \u4e09\u5c42\u67b6\u6784 \u7684\u53e6\u5916\u4e00\u79cd\u67b6\u6784\u662f \u53f6\u810a\u7f51\u7edc\uff08Spine/Leaf\uff09 \uff1a \u53f6\u5b50\u4ea4\u6362\u673a\uff08leaf\uff09\uff1a\u76f4\u63a5\u8fde\u63a5\u670d\u52a1\u5668\u3002 \u810a\u4ea4\u6362\u673a\uff08spine switch\uff09\uff1a\u6838\u5fc3\u4ea4\u6362\u673a \u53f6\u810a\u4e4b\u95f4\u901a\u8fc7 ECMP \u52a8\u6001\u9009\u62e9\u591a\u6761\u8def\u5f84\u3002 \u603b\u7ed3\uff1a \u4f20\u7edf\u6570\u636e\u4e2d\u5fc3\u4e3a\u5782\u76f4\u67b6\u6784\uff0c\u901a\u5e38\u5206\u4e3a\u4e09\u5c42\uff1a\u63a5\u5165\u5c42\u3001\u6c47\u805a\u5c42\u3001\u6838\u5fc3\u5c42\uff0c\u6700\u5916\u9762\u8fde\u63a5\u8fb9\u754c\u8def\u7531\u5668\u548c\u5b89\u5168\u8bbe\u5907 \u968f\u7740\u4e91\u548c\u5927\u6570\u636e\u7684\u53d1\u5c55\uff0c\u4e1c\u897f\u5411\u6d41\u91cf\u76f8\u5bf9\u4e8e\u5357\u5317\u5411\u6d41\u91cf\u8d8a\u6765\u8d8a\u91cd\u8981\uff0c\u67b6\u6784\u9010\u6b65\u6f14\u5316\u4e3a\uff1aspine-leaf \u67b6\u6784 \u6570\u636e\u4e2d\u5fc3\u7684\u6240\u6709\u94fe\u8def\u90fd\u9700\u8981\u9ad8\u53ef\u7528\u6027\u3002\u670d\u52a1\u5668\u9700\u8981\u7ed1\u5b9a\u7f51\u5361\uff0c\u4ea4\u6362\u673a\u9700\u8981\u5806\u53e0\uff0c\u4e09\u5c42\u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7\u7b49\u4ef7\u8def\u7531\uff0c\u4e8c\u5c42\u8bbe\u5907\u901a\u8fc7 TRILL \u534f\u8bae\u3002","title":"\u7b2c 21 \u8bfe \u6570\u636e\u4e2d\u5fc3"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#22-vpn","text":"VPN\uff1a\u865a\u62df\u4e13\u7528\u7f51 \u5229\u7528\u5f00\u653e\u7684\u516c\u4f17\u7f51\u7edc\uff0c\u5efa\u7acb\u4e13\u7528\u6570\u636e\u4f20\u8f93\u901a\u9053\uff0c\u5c06\u8fdc\u7a0b\u7684\u5206\u652f\u673a\u6784\u3001\u79fb\u52a8\u529e\u516c\u4eba\u5458\u7b49\u8fde\u63a5\u8d77\u6765\u3002 VPN \u901a\u8fc7 \u96a7\u9053 \u6280\u672f\u5728\u516c\u4f17\u7f51\u7edc\u4e0a\u4eff\u771f\u4e00\u6761\u70b9\u5230\u70b9\u7684\u4e13\u7ebf\uff0c\u662f\u901a\u8fc7\u5229\u7528\u4e00\u79cd\u534f\u8bae\u6765\u4f20\u8f93\u53e6\u5916\u4e00\u79cd\u534f\u8bae\u7684\u6280\u672f\uff0c\u6d89\u53ca\u4e09\u79cd\u534f\u8bae\uff1a \u4e58\u5ba2\u534f\u8bae \u96a7\u9053\u534f\u8bae \u627f\u8f7d\u534f\u8bae","title":"\u7b2c 22 \u8bfe VPN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#ipsec-vpn","text":"\u57fa\u4e8e IP \u534f\u8bae\u7684\u5b89\u5168\u96a7\u9053\u534f\u8bae IPsec VPN \u534f\u8bae\u7c07\uff1a IPsec VPN \u7684\u5c01\u5305\u65b9\u6848\uff1a IP -> ATM -> MPLS VPN","title":"IPsec VPN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#23","text":"2G-> 3G -> 4G -> 5G","title":"\u7b2c 23 \u8bfe \u79fb\u52a8\u7f51\u7edc"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#2g","text":"\u67b6\u6784\u56fe\uff1a BTS\uff1a\u57fa\u7ad9\u6536\u53d1\u4fe1\u53f0\uff0c\u5bf9\u5185\u8fde\u63a5\u6709\u7ebf\u7f51\u7edc\uff0c\u5bf9\u5916\u8fde\u63a5\u65e0\u7ebf\u7f51\u7edc BSC\uff1a\u57fa\u7ad9\u63a7\u5236\u5668\uff0c\u63a5\u6536 BTS \u53d1\u6765\u7684\u65e0\u7ebf\u4fe1\u53f7 RAN\uff1a\u65e0\u7ebf\u63a5\u5165\u7f51 CN\uff1a\u6838\u5fc3\u7f51\u7edc\uff0c\u8fd8\u6ca1\u6709\u8fdb\u5165 Internet MSC\uff1a\u79fb\u52a8\u4e1a\u52a1\u4ea4\u6362\u4e2d\u5fc3\uff0c\u8fdb\u5165\u6838\u5fc3\u7f51\u7684\u5165\u53e3 AUC\uff1a\u9274\u6743\u4e2d\u5fc3 EIR\uff1a\u8bbe\u5907\u8bc6\u522b\u5668\uff0c\u8d1f\u8d23\u5b89\u5168\u6027 VLR\uff1a\u8bbf\u95ee\u4f4d\u7f6e\u5bc4\u5b58\u5668 HLR\uff1a\u5f52\u5c5e\u4f4d\u5bc4\u5b58\u5668\uff0c\u4e24\u8005\u4e3b\u8981\u7528\u4e8e\u8ba1\u8d39\u7528","title":"2G"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#25g","text":"\u5728 2G \u7684\u57fa\u7840\u4e0a\uff0c\u591a\u4e86\u4e00\u4e2a PCU \u5206\u7ec4\u63a7\u5236\u5355\u5143\uff0c\u652f\u6301 Packet \u7684\u8f6c\u53d1\uff0c\u652f\u6301 IP \u7f51\u7edc SGSN\uff1aGPRS \u670d\u52a1\u524d\u5411\u652f\u6301\u8282\u70b9\uff0c\u7528\u4e8e\u63a5\u6536 PCU \u5206\u7ec4 GGSN\uff1aGPRS \u670d\u52a1\u540e\u5411\u652f\u6301\u8282\u70b9\uff0c\u7528\u4e8e\u8f6c\u53d1\u5206\u7ec4\u5230 Internet","title":"2.5G"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#3g","text":"\u4ee5 W-CDMA \u4e3a\u4f8b\uff0c\u57fa\u7ad9\u8f83\u4e8e 2G \u6709\u6240\u6539\u53d8\uff1a","title":"3G"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#4g","text":"\u57fa\u7ad9\u4e3a eNodeB\uff0c\u5305\u542b\u4e86 NodeB \u548c RNC \u529f\u80fd\uff0c\u6838\u5fc3\u7f51\u5b9e\u73b0\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u7684\u5206\u79bb\uff1a HSS \uff1a\u5b58\u50a8\u7528\u6237\u7b7e\u7ea6\u4fe1\u606f\u7684\u6570\u636e\u5e93\uff0c\u4ee5\u53ca\u4e00\u4e9b\u8ba4\u8bc1\u4fe1\u606f MME\uff1a\u6838\u5fc3\u63a7\u5236\u7f51\u5143\uff0c\u63a7\u5236\u9762\u7684\u6838\u5fc3 SGW+PGW\uff1a\u6570\u636e\u9762\u5355\u5143\uff0c\u8d1f\u8d23\u6d41\u91cf\u8f6c\u53d1\uff0cPGW \u662f\u51fa\u53e3\u7f51\u5173 PCRF\uff1a\u7b56\u7565\u548c\u8ba1\u8d39\u63a7\u5236\u5355\u5143","title":"4G"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#24","text":"\u865a\u62df\u673a\u57fa\u4e8e tap/tun \u9a71\u52a8\u5c06\u6570\u636e\u5305\u53d1\u51fa\u7269\u7406\u4e3b\u673a\u6d41\u7a0b\uff1a \u4e91\u7f51\u7edc\uff08\u865a\u62df\u673a\u7f51\u7edc\uff09\u51e0\u5927\u7279\u70b9\uff1a \u5171\u4eab\uff1a\u5171\u4eab\u540c\u4e00\u4e2a\u7269\u7406\u51fa\u53e3 \u9694\u79bb\uff1a\u5b89\u5168\u9694\u79bb\u548c\u6d41\u91cf\u9694\u79bb \u4e92\u901a\uff1a\u540c\u4e3b\u673a\u3001\u8de8\u4e3b\u673a \u7075\u6d3b\uff1a\u7ecf\u5e38\u521b\u5efa\u3001\u5220\u9664\u3001\u6f02\u79fb\uff0c\u7075\u6d3b\u914d\u7f6e","title":"\u7b2c 24 \u8bfe \u4e91\u4e2d\u7f51\u7edc"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#bridge","text":"\u6865\u63a5\uff1a \u8de8\u4e3b\u673a\uff1a NAT\uff1a \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cVM\u7f51\u7edc\u548c\u4e3b\u673a\u7f51\u7edc\u81ea\u6210\u4f53\u7cfb\uff0c\u6240\u4ee5\uff0cVM\u7f51\u7edc\u91cc\u4f1a\u5185\u7f6e\u4e00\u4e2a DHCP \u670d\u52a1\u5668\u6765\u8fdb\u884c IP \u5730\u5740\u7ba1\u7406\u3002 \u5982\u679c\u4e0d\u9700\u8981 NAT \u548c DHCP \u670d\u52a1\uff0c\u90a3\u4e48\u53ef\u4ee5\u624b\u52a8\u8fdb\u884c NAT \u548c DHCP\uff0c\u5373\u624b\u52a8\u914d\u7f6e\u865a\u62df\u673a IP\uff0c\u8bbe\u7f6e IPtable \u6210 NAT\uff0c\u5982\u4e0b\uff1a","title":"\u5171\u4eab\u4e0e\u4e92\u901a\uff1a\u901a\u8fc7 bridge"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#_1","text":"\u73b0\u4eca\u7684\u7f51\u5361\u90fd\u652f\u6301\u914d\u7f6e\u5b50\u63a5\u53e3\uff0c\u4e5f\u5c31\u662f VLAN\uff0c\u53ef\u4ee5\u4f7f\u7528 vconfig \u547d\u4ee4\u914d\u7f6e\u3002 \u901a\u8fc7 VLAN \u53ef\u4ee5\u9694\u79bb\u4e0d\u540c\u7684\u7528\u6237\u4e4b\u95f4\u7684 VM \u6d41\u91cf\u3002","title":"\u9694\u79bb"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#25-sdn","text":"\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a \u63a7\u5236\u4e0e\u8f6c\u53d1\u5206\u79bb \u63a7\u5236\u5e73\u9762\u4e0e\u8f6c\u53d1\u5e73\u9762\u4e4b\u95f4\u7684\u5f00\u653e\u63a5\u53e3\uff1a\u63a7\u5236\u5668\u5411\u4e0a\u63d0\u4f9b\u7684\u662f\u5317\u5411\u63a5\u53e3\uff0c\u4f9b\u5e94\u4e1a\u7a0b\u5e8f\u8c03\u7528\uff0c\u5411\u4e0b\u63d0\u4f9b\u7684\u662f\u5357\u5411\u63a5\u53e3\uff0c\u63a7\u5236\u7f51\u7edc\u8bbe\u5907\u3002 \u903b\u8f91\u4e0a\u7684\u96c6\u4e2d\u63a7\u5236","title":"\u7b2c 25 \u8bfe \u8f6f\u4ef6\u5b9a\u4e49\u7f51\u7edc SDN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#openflow-openvswitch","text":"OpenFlow \u662f SDN \u63a7\u5236\u5668\u548c\u7f51\u7edc\u8bbe\u5907\u4e4b\u95f4\u4e92\u901a\u7684\u5357\u5411\u63a5\u53e3\u534f\u8bae\u3002 OpenvSwitch \u662f\u8f6f\u4ef6\u4ea4\u6362\u673a\uff0c\u5c5e\u4e8e SDN \u7684\u8f6c\u53d1\u9762\uff0c\u901a\u8fc7 OpenFlow \u534f\u8bae\u548c SDN \u63a7\u5236\u5668\u901a\u4fe1\u3002 SDN \u63a7\u5236\u5668\u901a\u8fc7 OpenFlow \u534f\u8bae\u5411 OVS \u4e0b\u53d1\u6d41\u8868\u89c4\u5219\u6765\u63a7\u5236\u7f51\u7edc\u8bbe\u5907\uff0c\u6d41\u8868\u89c4\u5219\u5305\u62ec \u5339\u914d\u89c4\u5219\u3001\u4f18\u5148\u7ea7\u548c\u6267\u884c\u52a8\u4f5c\uff1a \u8fd9\u91cc\u6709\u5f88\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u89c4\u5219\uff0c\u5305\u542b\u4e86 TCP/IP \u534f\u8bae\u6808\u7684\u56db\u5c42\uff0c\u6bcf\u4e00\u5c42\u90fd\u5bf9\u5e94\u4e0d\u540c\u7684\u89c4\u5219\uff0c\u76f8\u5e94\u5730\u4e5f\u4f1a\u6267\u884c\u4e0d\u540c\u7684\u52a8\u4f5c\uff1a OVS \u7684\u67b6\u6784\u56fe\uff1a","title":"OpenFlow \u548c OpenvSwitch"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#26-iptables","text":"\u5b89\u5168\u7b56\u7565 ACL \u63a7\u5236 IP \u548c\u7aef\u53e3 \u8fd9\u4e9b ACL \u89c4\u5219\u7684\u96c6\u5408\u4e3a\u5b89\u5168\u7ec4\u3002 \u4e00\u4e2a\u6570\u636e\u5305\u7684\u5904\u7406\u8fc7\u7a0b\u901a\u5e38\u8981\u7ecf\u5386 5 \u4e2a\u8282\u70b9\uff1a \u76f8\u5173\u7684\u5185\u6838\u6a21\u5757\u5b9e\u73b0\u5982\u4e0b\uff1a iptables \u7684\u8868\u5206\u4e3a\u56db\u79cd\uff1araw->mangle->nat->filter\uff0c\u6bcf\u4e2a\u8868\u53c8\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u94fe\u3002 \u6bd4\u5982\uff1a filter \u8fc7\u6ee4\u8868\uff0c\u5305\u542b\uff1a input \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u76ee\u6807\u5730\u5740\u662f\u672c\u673a\u7684\u6570\u636e\u5305 forward \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u8def\u8fc7\u672c\u673a\u7684\u6570\u636e\u5305 output \u94fe\uff1a\u8fc7\u6ee4\u6240\u6709\u6709\u672c\u673a\u4ea7\u751f\u7684\u6570\u636e\u5305 nat \u8868\u5904\u7406\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u5305\u542b\uff1a prorouting \u94fe\uff1a\u6570\u636e\u5305\u5230\u8fbe\u9632\u706b\u5899\u65f6\u6539\u53d8\u76ee\u6807\u5730\u5740 output \u94fe\uff1a\u53ef\u4ee5\u6539\u53d8\u672c\u5730\u4ea7\u751f\u7684\u6570\u636e\u5305\u7684\u76ee\u6807\u5730\u5740 postrouting \u94fe\uff1a\u5728\u6570\u636e\u5305\u79bb\u5f00\u9632\u706b\u5899\u65f6\u6539\u53d8\u6570\u636e\u5305\u7684\u6e90\u5730\u5740 mangle \u4fee\u6539\u6570\u636e\u5305\uff0c\u5305\u542b\uff1a PREROUTING \u94fe\uff1b INPUT \u94fe\uff1b FORWARD \u94fe OUTPUT \u94fe POSTROUTING \u94fe \u4e30\u5bcc\u4e0a\u9762\u7684\u56fe\uff1a","title":"\u7b2c 26 \u8bfe \u4e91\u4e2d\u7684\u7f51\u7edc\u5b89\u5168\uff08iptables\uff09"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#27-qos","text":"Linux \u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7 TC \u63a7\u5236\u7f51\u7edc\u7684 QoS\uff0c\u5c31\u662f\u901a\u8fc7\u961f\u5217\u7684\u65b9\u5f0f\u3002 \u63a7\u5236\u7f51\u7edc\u7684 QoS \u7684\u65b9\u5f0f\uff1a 1\u3001\u65e0\u7c7b\u522b\u6392\u961f\u89c4\u5219 pfifo_fast \u968f\u673a\u516c\u5e73\u961f\u5217 \u4ee4\u724c\u6876\u89c4\u5219 2\u3001\u57fa\u4e8e\u7c7b\u522b\u7684\u961f\u5217\u89c4\u5219 \u5206\u5c42\u4ee4\u724c\u6876\u89c4\u5219 \u8fd9\u79cd\u89c4\u5219\u4e5f\u662f OVS \u5e38\u7528\u7684\u4e00\u79cd\u3002","title":"\u7b2c 27 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684 QoS"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#28-grevxlan","text":"Underlay \u7f51\u7edc\uff1a\u5e95\u5c42\u7684\u7269\u7406\u7f51\u7edc\u8bbe\u5907\u7ec4\u6210\u7684\u7f51\u7edc Overlay \u7f51\u7edc\uff1a\u7528\u4e8e\u865a\u62df\u673a\u5c42\u9762\u7684\u7f51\u7edc\uff0c\u5e95\u5c42\u57fa\u4e8e\u7269\u7406\u7f51\u7edc\u7684\u865a\u62df\u7f51\u7edc \u96a7\u9053\u6280\u672f\uff1a GRE\uff1a GRE \u7f51\u7edc\u7684\u7f3a\u70b9\uff1a Tunnel \u6570\u91cf\u95ee\u9898\uff0c\u7f51\u7edc\u8d8a\u591a\uff0c\u6240\u5efa\u7acb\u7684\u96a7\u9053\u6570\u76ee\u5448\u6307\u6570\u589e\u957f \u4e0d\u652f\u6301\u7ec4\u64ad\uff0c\u90fd\u662f\u91c7\u7528\u5e7f\u64ad \u76ee\u524d\u5f88\u591a\u9632\u706b\u5899\u548c\u4e09\u5c42\u7f51\u7edc\u8bbe\u5907\u65e0\u6cd5\u89e3\u6790 GRE VXLAN\uff1a OVS \u652f\u6301\u4e09\u7c7b\u96a7\u9053\uff1a GRE VXLAN IPsec_GRE","title":"\u7b2c 28 \u8bfe \u4e91\u4e2d\u7f51\u7edc\u7684\u9694\u79bb GRE\u3001VXLAN"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#29","text":"namespace \u548c cgroup \u901a\u8fc7 NAT \u7684\u65b9\u5f0f\u4e0e\u7269\u7406\u7f51\u7edc\u8fdb\u884c\u4e92\u901a\u3002","title":"\u7b2c 29 \u8bfe \u5bb9\u5668\u7f51\u7edc"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#30-flannel","text":"\u6709\u4e00\u4e2a\u96c6\u4e2d\u6ce8\u518c\u7684\u5730\u65b9\uff1a Flannel \u4f7f\u7528 UDP \u5728\u7528\u6237\u6001\u7684\u5c01\u88c5\u5b9e\u73b0 Overlay \u7f51\u7edc\uff1a Flannel \u4f7f\u7528 VXLAN \u5728\u5185\u6838\u6001\u7684\u5c01\u88c5\u5b9e\u73b0 Overlay \u7f51\u7edc\uff1a","title":"\u7b2c 30 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Flannel"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#31-calico","text":"Calico \u7f51\u7edc\u7684\u5927\u4f53\u601d\u8def\u662f\uff1a\u4e0d\u8d70 Overlay \u7f51\u7edc\uff0c\u4e0d\u5f15\u5165\u53e6\u5916\u7684\u7f51\u7edc\u6027\u80fd\u635f\u8017\uff0c\u800c\u662f\u5c06\u8f6c\u53d1\u5168\u90e8\u7528\u4e09\u5c42\u7f51\u7edc\u7684\u8def\u7531\u8f6c\u53d1\u6765\u5b9e\u73b0\u3002","title":"\u7b2c 31 \u8bfe \u5bb9\u5668\u7f51\u7edc\u4e4b Calico"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#32-rpc","text":"RPC \u7684\u8c03\u7528\u6807\u51c6\uff1a \u8fd9\u91cc\u5206\u4e86\u4e09\u4e2a\u5c42\u6b21\uff1a \u7528\u6237\u7aef\u548c\u670d\u52a1\u7aef\u50cf\u672c\u5730\u8c03\u7528\u4e00\u6837\uff0c\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u3002 Stub \u5c42\u5904\u7406\u53cc\u65b9\u7ea6\u5b9a\u597d\u7684\u8bed\u6cd5\u3001\u8bed\u4e49\u3001\u5c01\u88c5\u3001\u89e3\u5c01\u88c5\u3002 RPCRuntime\u5219\u662f\u5904\u7406\u9ad8\u6027\u80fd\u7684\u4f20\u8f93\uff0c\u4ee5\u53ca\u7f51\u7edc\u7684\u9519\u8bef\u548c\u5f02\u5e38 NFS \u534f\u8bae\u5c31\u662f\u57fa\u4e8eRPC \u6846\u67b6\u5b9e\u73b0\u7684\u3002NFS \u8fd0\u884c\u9700\u8981\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\u7aef\uff1amountd\uff08\u6302\u8f7d\u6587\u4ef6\uff09 \u548c nfsd\uff08\u8bfb\u5199\u6587\u4ef6\uff09\uff0c\u901a\u8fc7 NFS\uff0c\u53ef\u4ee5 mount \u4e00\u4e2a\u8fdc\u7a0b\u76ee\u5f55\u5230\u672c\u5730\u4e00\u4e2a\u76ee\u5f55\uff0c\u4ece\u800c\u5b9e\u73b0\u5728\u672c\u5730\u64cd\u4f5c\u8fdc\u7a0b\u7684\u6587\u4ef6\u3002\u5982\u4e0b\u56fe\uff0c\u5176\u5e95\u5c42\u5b9e\u73b0\u8fd8\u662f socket\uff1a","title":"\u7b2c 32 \u8bfe RPC \u534f\u8bae\u6982\u8ff0"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#33-xml-soap","text":"XML \u5b9a\u4e49\u4e86\u4e00\u79cd RPC \u4f20\u8f93\u7684\u6587\u672c\u7c7b\u3002 \u8fd9\u662f\u4e00\u79cd\u9762\u5411\u5bf9\u8c61\u7684\u6587\u672c\u63cf\u8ff0\u8bed\u6cd5\uff0c\u53ef\u4ee5\u7075\u6d3b\u5730\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u5b9a\u4e49\u4e00\u4e2a\u5bf9\u8c61\u3002 \u57fa\u4e8e XML \u7684\u901a\u4fe1\u534f\u8bae\uff0c\u6700\u77e5\u540d\u7684\u4e00\u4e2a\u662f SOAP\uff0c\u5373\u7b80\u5355\u5bf9\u8c61\u8bbf\u95ee\u534f\u8bae\uff08Simple Object Access Protocol\uff09\uff0c\u5b83\u4f7f\u7528 XML \u7f16\u5199\u7b80\u5355\u7684\u8bf7\u6c42\u548c\u56de\u590d\u6d88\u606f\uff0c\u5e76\u7528 HTPP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u3002 \u901a\u8fc7 Web \u670d\u52a1\u63cf\u8ff0\u8bed\u8a00 WSDL \u6765\u8fdb\u884c\u534f\u8bae\u7684\u7ea6\u5b9a\u3002 \u901a\u8fc7 UDDI \u7edf\u4e00\u63cf\u8ff0\u3001\u53d1\u73b0\u548c\u96c6\u6210\u534f\u8bae\u6765\u89e3\u51b3\u670d\u52a1\u53d1\u73b0\u7684\u95ee\u9898\u3002","title":"\u7b2c 33 \u8bfe \u57fa\u4e8e XML \u7684 SOAP \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#34-json-restful","text":"JSON \u662f\u7c7b\u4f3c XML \u7684\u4e00\u79cd\u6587\u672c\u683c\u5f0f\u3002 RESTful API \u4e0d\u4ec5\u4ec5\u6307 API\uff0c\u8fd8\u662f\u4e00\u79cd\u67b6\u6784\u98ce\u683c\uff0c\u4e00\u79cd\u8bbe\u8ba1\u98ce\u683c\u3002\u4e3b\u8981\u9762\u5411\u8d44\u6e90\uff0c\u63d0\u4f9b\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u6709\u5229\u4e8e\u6a2a\u5411\u6269\u5c55\u5e94\u5bf9\u9ad8\u5e76\u53d1\u3002","title":"\u7b2c 34 \u8bfe \u57fa\u4e8e JSON \u7684 RESTful \u63a5\u53e3\u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#35-rpc","text":"\u6570\u636e\u4e2d\u5fc3\u5185\u90e8\u5e94\u7528\u4e4b\u95f4\u7684\u8c03\u7528\uff1a nginx \u5145\u5f53 API \u7f51\u5173 Controller \u5c42\uff1a\u5177\u4f53 API \u7684\u5b9e\u73b0 \u7ec4\u5408\u5c42\uff1a\u590d\u6742\u4e1a\u52a1\u903b\u8f91\u5b9e\u73b0 \u57fa\u7840\u670d\u52a1\u5c42\uff1a\u539f\u5b50\u5316\u7684\u63a5\u53e3\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u64cd\u4f5c \u7f13\u5b58\u548c\u6301\u4e45\u5316\u5c42\uff1a\u7ef4\u62a4\u6570\u636e\u72b6\u6001 \u4e00\u4e2a\u8457\u540d\u7684\u4f8b\u5b50\u662f Dubbo \u670d\u52a1\u5316\u6846\u67b6\u4e8c\u8fdb\u5236\u7684 RPC \u65b9\u5f0f\uff1a","title":"\u7b2c 35 \u8bfe \u4e8c\u8fdb\u5236 RPC \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#36-rpc","text":"GRPC \u4f7f\u7528 \u4e8c\u8fdb\u5236\u5e8f\u5217\u5316\u534f\u8bae\u662f Protocol Buffers \u6765\u4f20\u8f93\u6570\u636e\u3002","title":"\u7b2c 36 \u8bfe \u8de8\u8bed\u8a00\u7c7b RPC \u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#37-39","text":"","title":"\u7b2c 37-39 \u8bfe \u7528\u53cc\u5341\u4e00\u7684\u4f8b\u5b50\u4e32\u8bb2\u7f51\u7edc\u534f\u8bae"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#40","text":"","title":"\u7b2c 40 \u8bb2 \u642d\u5efa\u4e00\u4e2a\u7f51\u7edc\u5b9e\u9a8c\u73af\u5883"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#_2","text":"","title":"\u73af\u5883\u642d\u5efa"},{"location":"net/\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u7b14\u8bb0/#ovs","text":"OVS \u4f1a\u5c06\u81ea\u5df1\u5bf9\u4e8e\u7f51\u7edc\u7684\u914d\u7f6e\u4fdd\u5b58\u5728\u4e00\u4e2a\u672c\u5730\u5e93\u91cc\u9762\uff0c\u8fd9\u4e2a\u5e93\u7684\u8868\u7ed3\u6784\u5173\u7cfb\u5982\u4e0b\uff1a \u8fd9\u4e2a\u5e93\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a JSON\uff0c\u6253\u5370\u51fa\u6765\uff0c\u5c31\u662f\u8fd9\u6837\uff1a","title":"OVS \u5b9e\u9a8c"}]}